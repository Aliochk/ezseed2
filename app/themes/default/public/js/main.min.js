
/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */
/*jslint regexp: true */
/*global require, XMLHttpRequest, ActiveXObject,
  define, window, process, Packages,
  java, location, Components, FileUtils */

define('text',['module'], function (module) {
    

    var text, fs, Cc, Ci, xpcIsWindows,
        progIds = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'],
        xmlRegExp = /^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,
        bodyRegExp = /<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,
        hasLocation = typeof location !== 'undefined' && location.href,
        defaultProtocol = hasLocation && location.protocol && location.protocol.replace(/\:/, ''),
        defaultHostName = hasLocation && location.hostname,
        defaultPort = hasLocation && (location.port || undefined),
        buildMap = {},
        masterConfig = (module.config && module.config()) || {};

    text = {
        version: '2.0.10',

        strip: function (content) {
            //Strips <?xml ...?> declarations so that external SVG and XML
            //documents can be added to a document without worry. Also, if the string
            //is an HTML document, only the part inside the body tag is returned.
            if (content) {
                content = content.replace(xmlRegExp, "");
                var matches = content.match(bodyRegExp);
                if (matches) {
                    content = matches[1];
                }
            } else {
                content = "";
            }
            return content;
        },

        jsEscape: function (content) {
            return content.replace(/(['\\])/g, '\\$1')
                .replace(/[\f]/g, "\\f")
                .replace(/[\b]/g, "\\b")
                .replace(/[\n]/g, "\\n")
                .replace(/[\t]/g, "\\t")
                .replace(/[\r]/g, "\\r")
                .replace(/[\u2028]/g, "\\u2028")
                .replace(/[\u2029]/g, "\\u2029");
        },

        createXhr: masterConfig.createXhr || function () {
            //Would love to dump the ActiveX crap in here. Need IE 6 to die first.
            var xhr, i, progId;
            if (typeof XMLHttpRequest !== "undefined") {
                return new XMLHttpRequest();
            } else if (typeof ActiveXObject !== "undefined") {
                for (i = 0; i < 3; i += 1) {
                    progId = progIds[i];
                    try {
                        xhr = new ActiveXObject(progId);
                    } catch (e) {}

                    if (xhr) {
                        progIds = [progId];  // so faster next time
                        break;
                    }
                }
            }

            return xhr;
        },

        /**
         * Parses a resource name into its component parts. Resource names
         * look like: module/name.ext!strip, where the !strip part is
         * optional.
         * @param {String} name the resource name
         * @returns {Object} with properties "moduleName", "ext" and "strip"
         * where strip is a boolean.
         */
        parseName: function (name) {
            var modName, ext, temp,
                strip = false,
                index = name.indexOf("."),
                isRelative = name.indexOf('./') === 0 ||
                             name.indexOf('../') === 0;

            if (index !== -1 && (!isRelative || index > 1)) {
                modName = name.substring(0, index);
                ext = name.substring(index + 1, name.length);
            } else {
                modName = name;
            }

            temp = ext || modName;
            index = temp.indexOf("!");
            if (index !== -1) {
                //Pull off the strip arg.
                strip = temp.substring(index + 1) === "strip";
                temp = temp.substring(0, index);
                if (ext) {
                    ext = temp;
                } else {
                    modName = temp;
                }
            }

            return {
                moduleName: modName,
                ext: ext,
                strip: strip
            };
        },

        xdRegExp: /^((\w+)\:)?\/\/([^\/\\]+)/,

        /**
         * Is an URL on another domain. Only works for browser use, returns
         * false in non-browser environments. Only used to know if an
         * optimized .js version of a text resource should be loaded
         * instead.
         * @param {String} url
         * @returns Boolean
         */
        useXhr: function (url, protocol, hostname, port) {
            var uProtocol, uHostName, uPort,
                match = text.xdRegExp.exec(url);
            if (!match) {
                return true;
            }
            uProtocol = match[2];
            uHostName = match[3];

            uHostName = uHostName.split(':');
            uPort = uHostName[1];
            uHostName = uHostName[0];

            return (!uProtocol || uProtocol === protocol) &&
                   (!uHostName || uHostName.toLowerCase() === hostname.toLowerCase()) &&
                   ((!uPort && !uHostName) || uPort === port);
        },

        finishLoad: function (name, strip, content, onLoad) {
            content = strip ? text.strip(content) : content;
            if (masterConfig.isBuild) {
                buildMap[name] = content;
            }
            onLoad(content);
        },

        load: function (name, req, onLoad, config) {
            //Name has format: some.module.filext!strip
            //The strip part is optional.
            //if strip is present, then that means only get the string contents
            //inside a body tag in an HTML string. For XML/SVG content it means
            //removing the <?xml ...?> declarations so the content can be inserted
            //into the current doc without problems.

            // Do not bother with the work if a build and text will
            // not be inlined.
            if (config.isBuild && !config.inlineText) {
                onLoad();
                return;
            }

            masterConfig.isBuild = config.isBuild;

            var parsed = text.parseName(name),
                nonStripName = parsed.moduleName +
                    (parsed.ext ? '.' + parsed.ext : ''),
                url = req.toUrl(nonStripName),
                useXhr = (masterConfig.useXhr) ||
                         text.useXhr;

            // Do not load if it is an empty: url
            if (url.indexOf('empty:') === 0) {
                onLoad();
                return;
            }

            //Load the text. Use XHR if possible and in a browser.
            if (!hasLocation || useXhr(url, defaultProtocol, defaultHostName, defaultPort)) {
                text.get(url, function (content) {
                    text.finishLoad(name, parsed.strip, content, onLoad);
                }, function (err) {
                    if (onLoad.error) {
                        onLoad.error(err);
                    }
                });
            } else {
                //Need to fetch the resource across domains. Assume
                //the resource has been optimized into a JS module. Fetch
                //by the module name + extension, but do not include the
                //!strip part to avoid file system issues.
                req([nonStripName], function (content) {
                    text.finishLoad(parsed.moduleName + '.' + parsed.ext,
                                    parsed.strip, content, onLoad);
                });
            }
        },

        write: function (pluginName, moduleName, write, config) {
            if (buildMap.hasOwnProperty(moduleName)) {
                var content = text.jsEscape(buildMap[moduleName]);
                write.asModule(pluginName + "!" + moduleName,
                               "define(function () { return '" +
                                   content +
                               "';});\n");
            }
        },

        writeFile: function (pluginName, moduleName, req, write, config) {
            var parsed = text.parseName(moduleName),
                extPart = parsed.ext ? '.' + parsed.ext : '',
                nonStripName = parsed.moduleName + extPart,
                //Use a '.js' file name so that it indicates it is a
                //script that can be loaded across domains.
                fileName = req.toUrl(parsed.moduleName + extPart) + '.js';

            //Leverage own load() method to load plugin value, but only
            //write out values that do not have the strip argument,
            //to avoid any potential issues with ! in file names.
            text.load(nonStripName, req, function (value) {
                //Use own write() method to construct full module value.
                //But need to create shell that translates writeFile's
                //write() to the right interface.
                var textWrite = function (contents) {
                    return write(fileName, contents);
                };
                textWrite.asModule = function (moduleName, contents) {
                    return write.asModule(moduleName, fileName, contents);
                };

                text.write(pluginName, nonStripName, textWrite, config);
            }, config);
        }
    };

    if (masterConfig.env === 'node' || (!masterConfig.env &&
            typeof process !== "undefined" &&
            process.versions &&
            !!process.versions.node &&
            !process.versions['node-webkit'])) {
        //Using special require.nodeRequire, something added by r.js.
        fs = require.nodeRequire('fs');

        text.get = function (url, callback, errback) {
            try {
                var file = fs.readFileSync(url, 'utf8');
                //Remove BOM (Byte Mark Order) from utf8 files if it is there.
                if (file.indexOf('\uFEFF') === 0) {
                    file = file.substring(1);
                }
                callback(file);
            } catch (e) {
                errback(e);
            }
        };
    } else if (masterConfig.env === 'xhr' || (!masterConfig.env &&
            text.createXhr())) {
        text.get = function (url, callback, errback, headers) {
            var xhr = text.createXhr(), header;
            xhr.open('GET', url, true);

            //Allow plugins direct access to xhr headers
            if (headers) {
                for (header in headers) {
                    if (headers.hasOwnProperty(header)) {
                        xhr.setRequestHeader(header.toLowerCase(), headers[header]);
                    }
                }
            }

            //Allow overrides specified in config
            if (masterConfig.onXhr) {
                masterConfig.onXhr(xhr, url);
            }

            xhr.onreadystatechange = function (evt) {
                var status, err;
                //Do not explicitly handle errors, those should be
                //visible via console output in the browser.
                if (xhr.readyState === 4) {
                    status = xhr.status;
                    if (status > 399 && status < 600) {
                        //An http 4xx or 5xx error. Signal an error.
                        err = new Error(url + ' HTTP status: ' + status);
                        err.xhr = xhr;
                        errback(err);
                    } else {
                        callback(xhr.responseText);
                    }

                    if (masterConfig.onXhrComplete) {
                        masterConfig.onXhrComplete(xhr, url);
                    }
                }
            };
            xhr.send(null);
        };
    } else if (masterConfig.env === 'rhino' || (!masterConfig.env &&
            typeof Packages !== 'undefined' && typeof java !== 'undefined')) {
        //Why Java, why is this so awkward?
        text.get = function (url, callback) {
            var stringBuffer, line,
                encoding = "utf-8",
                file = new java.io.File(url),
                lineSeparator = java.lang.System.getProperty("line.separator"),
                input = new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file), encoding)),
                content = '';
            try {
                stringBuffer = new java.lang.StringBuffer();
                line = input.readLine();

                // Byte Order Mark (BOM) - The Unicode Standard, version 3.0, page 324
                // http://www.unicode.org/faq/utf_bom.html

                // Note that when we use utf-8, the BOM should appear as "EF BB BF", but it doesn't due to this bug in the JDK:
                // http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4508058
                if (line && line.length() && line.charAt(0) === 0xfeff) {
                    // Eat the BOM, since we've already found the encoding on this file,
                    // and we plan to concatenating this buffer with others; the BOM should
                    // only appear at the top of a file.
                    line = line.substring(1);
                }

                if (line !== null) {
                    stringBuffer.append(line);
                }

                while ((line = input.readLine()) !== null) {
                    stringBuffer.append(lineSeparator);
                    stringBuffer.append(line);
                }
                //Make sure we return a JavaScript string and not a Java string.
                content = String(stringBuffer.toString()); //String
            } finally {
                input.close();
            }
            callback(content);
        };
    } else if (masterConfig.env === 'xpconnect' || (!masterConfig.env &&
            typeof Components !== 'undefined' && Components.classes &&
            Components.interfaces)) {
        //Avert your gaze!
        Cc = Components.classes,
        Ci = Components.interfaces;
        Components.utils['import']('resource://gre/modules/FileUtils.jsm');
        xpcIsWindows = ('@mozilla.org/windows-registry-key;1' in Cc);

        text.get = function (url, callback) {
            var inStream, convertStream, fileObj,
                readData = {};

            if (xpcIsWindows) {
                url = url.replace(/\//g, '\\');
            }

            fileObj = new FileUtils.File(url);

            //XPCOM, you so crazy
            try {
                inStream = Cc['@mozilla.org/network/file-input-stream;1']
                           .createInstance(Ci.nsIFileInputStream);
                inStream.init(fileObj, 1, 0, false);

                convertStream = Cc['@mozilla.org/intl/converter-input-stream;1']
                                .createInstance(Ci.nsIConverterInputStream);
                convertStream.init(inStream, "utf-8", inStream.available(),
                Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER);

                convertStream.readString(inStream.available(), readData);
                convertStream.close();
                inStream.close();
                callback(readData.value);
            } catch (e) {
                throw new Error((fileObj && fileObj.path || '') + ': ' + e);
            }
        };
    }
    return text;
});
define('text!../views/albums.ejs',[],function () { return '<%\nalbums.forEach(function(album) {\n\n\talbum.title = \'\';\n\talbum.title += (album.artist !== undefined && album.artist !== null) ? album.artist : \'\';\n\talbum.title += (album.album !== undefined && album.album !== null) ? \' - \' + album.album : \'\';\n\tif(album.title.length == 0) {\n\t\tvar t = album.prevDir.split(\'/\');\n\t\tt = t[t.length-1];\n\n\t\talbum.title += t;\n\t}\n\tif(album.songs.length > 1) {\n\t\tvar tailleDossier = 0;\n\n\t\tfor(var i = 0; i < album.songs.length; i++) {\n\t\t\ttailleDossier += parseFloat(album.songs[i].size);\n\t\t}\n\n\t}\n\t%>\n\t<div data-id="<%- album._id %>" class="element list audio clearfix" data-date-added="<%- new Date(album.dateAdded).getTime() %>">\n\t\t<div class="pullLeft">\n\t\t\t<a href="#/listen/<%- album._id %>" title="Écouter" class="listen">\n\t\t\t\t<div class="cover">\n\t\t\t\t\t<div class="cover-hover">\n\t\t\t\t\t\t<i class="entypo-play"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<% if(album.picture == undefined || album.picture === null) {%>\n\t\t\t\t\t\t<img src="/images/cover/audio.png" />\n\t\t\t\t\t<% } else { %>\n\t\t\t\t\t\t<img src="<%- album.picture %>" />\n\t\t\t\t\t<% } %>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="list-infos">\n\t\t\t<h1 class="league-gothic"><%- album.title %></h1>\n\n\t\t\t<div class="button-group">\n\t\t\t\t<a href="#/listen/<%- album._id %>" title="Écouter" class="listen">\n\t\t\t\t\t<i class="entypo-note-beamed"></i>\n\t\t\t\t</a>\n\t\t\t\t<% if(album.songs.length > 1) {%>\n\t\t\t\t<a href="/archive/<%- album._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t\t<% } else {%>\n\t\t\t\t<a href="/download/<%- album._id %>" title="Télécharger">\n\t\t\t\t<% } %>\n\t\t\t\t\t<i class="entypo-download"></i>\n\t\t\t\t</a>\n\t\t\t\t<a href="/delete/album/<%- album._id %>" class="delete-item" title="Supprimer">\n\t\t\t\t\t<i class="entypo-trash"></i>\n\t\t\t\t</a>\n\t\t\t\t<!-- <a href="#" class="reset-item" title="Enlever de la base de données (il reviens)" data-type="album">\n\t\t\t\t\t<i class="entypo-cancel"></i>\n\t\t\t\t</a> -->\n\t\t\t</div>\n\n\t\t\t<hr />\n\t\t\t<p class="infos">\n\t\t\t\t<% if(!_.isEmpty(album.artist)) { %>\n\t\t\t\t\tArtiste : <%- album.artist %><br />\n\t\t\t\t<% } %>\n\t\t\t\t<% if(!_.isEmpty(album.album)) { %>\n\t\t\t\t\tAlbum : <%- album.album %><br />\n\t\t\t\t<% } %>\n\n\t\t\t\t<% if(!_.isEmpty(album.genre)) { %>\n\t\t\t\t\tGenre : <%- album.genre %><br />\n\t\t\t\t<% } %>\n\n\t\t\t\t<% if(!_.isEmpty(album.year)) { %>\n\t\t\t\t\tAnnée : <%- album.year %><br />\n\t\t\t\t<% } %>\n\t\t\t</p>\n\n\t\t</div>\n\n\t\t<% if(album.songs.length) { %>\n\t\t\t<div class="showFiles">\n\t\t\t\t<i class="entypo-attach"></i>Fichiers\n\t\t\t</div>\n\t\t\t<div class="files">\n\t\t\t\t<table>\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr><th>#</th><th>Nom</th><th>Poids</th></tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<%\t\n\t\t\t\t\t\tvar i = 1, songs, hasDiscs = false;\n\n\t\t\t\t\t\tif(album.songs[0].disc !== undefined) {\n\t\t\t\t\t\t\tsongs = _.groupBy(album.songs, function(e) { return e.disc; });\n\t\t\t\t\t\t\thasDiscs = true;\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\tsongs = [album.songs];\n\n\n\t\t\t\t\t\t_.each(songs, function(disk, i) {\n\t\t\t\t\t\t\tsongs[i] = disk.sort(function(a, b) {\n\t\t\t\t\t\t\t\tif (a.name == b.name)\n\t\t\t\t\t\t\t        return 0;\n\t\t\t\t\t\t\t    else if (a.name > b.name)\n\t\t\t\t\t\t\t        return 1;\n\t\t\t\t\t\t\t   \telse\n\t\t\t\t\t\t\t\t    return -1;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t_.each(songs, function(disc, noDisc) {\n\t\t\t\t\t\t\tif(hasDiscs) {\n\t\t\t\t\t\t\t\t%>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td colspan="3" style="text-align:center">Disque n°<%= noDisc %></td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t<%\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t_.each(disc, function(file) {\n\t\t\t\t\t\t%>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td><%- i %></td>\n\t\t\t\t\t\t\t\t<td style="text-align:left"><a href="/download/<%- album._id %>/<%- file._id%>"><%- file.name %></a></td>\n\t\t\t\t\t\t\t\t<td><%- bytesToSize(file.size) %></td>\n\t\t\t\t\t\t\t</tr>\t\t\t\n\t\t\t\t\t\t<% \n\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\ti = 1;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}); \n\t\t\t\t\t\t%>\n\t\t\t\t\t</tbody>\n\t\t\t\t\t<tfoot>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan="2" style="text-align:left">Taille totale : <%- bytesToSize(tailleDossier) %></td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<a href="/archive/<%- album._id %>" data-full-size="<%- tailleDossier %>" class="archive">Télécharger le dossier</a>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tfoot>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t<% } %>\n\t</div>\n\t<div data-id="<%- album._id %>" class="element miniature audio clearfix" data-date-added="<%- new Date(album.dateAdded).getTime() %>">\n\t\t<div class="titre"><h1 class="league-gothic" title="<%- album.title %>"><%- album.title %></h1></div>\n\n\t\t<a href="#/listen/<%- album._id %>" title="Écouter" class="listen">\n\t\t\t<% if(album.picture == undefined || album.picture === null) {%>\n\t\t\t\t<img src="/images/cover/audio.png" />\n\t\t\t<% } else { %>\n\t\t\t\t<img src="<%- album.picture %>" />\n\t\t\t<% } %>\n\t\t</a>\n\t</div>\n\t<div data-id="<%- album._id %>" class="element table audio" data-date-added="<%- new Date(album.dateAdded).getTime() %>">\n\t\t<i class="entypo-music"></i>\n\t\t<a href="#/listen/<%- album._id %>" title="Écouter" class="listen table-link">\n\t\t\t<%- album.title %>\n\t\t</a>\n\t\t<div class="button-group">\n\t\t\t<a href="#/listen/<%- album._id %>" title="Écouter" class="listen">\n\t\t\t\t<i class="entypo-note-beamed"></i>\n\t\t\t</a>\n\t\t\t<% if(album.songs.length > 1) {%>\n\t\t\t<a href="/archive/<%- album._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t<% } else {%>\n\t\t\t<a href="/download/<%- album._id %>" title="Télécharger">\n\t\t\t<% } %>\n\t\t\t\t<i class="entypo-download"></i>\n\t\t\t</a>\n\t\t\t<a href="/delete/album/<%- album._id %>" class="delete-item" title="Supprimer">\n\t\t\t\t<i class="entypo-trash"></i>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n<%\n});\n%>';});

define('text!../views/movies.ejs',[],function () { return '<%\nmovies.forEach(function(movie) {\n\tvar tailleDossier = 0;\n\n\tfor(var i = 0; i < movie.videos.length; i++)\n\t\ttailleDossier += parseFloat(movie.videos[i].size);\n\n%>\n\t<div data-id="<%- movie._id %>" class="element list video clearfix" data-date-added="<%- new Date(movie.dateAdded).getTime() %>">\n\t\t<div class="pullLeft">\n\t\t\t<a href="/watch/<%- movie._id %>" title="Visionner">\n\t\t\t\t<div class="cover">\n\t\t\t\t\t<div class="cover-hover">\n\t\t\t\t\t\t<i class="entypo-play"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<% if(movie.infos.picture == undefined) {%>\n\t\t\t\t\t\t<img src="/images/cover/video.png" />\n\t\t\t\t\t<% } else { %>\n\t\t\t\t\t\t<img src="<%- movie.infos.picture %>" />\n\t\t\t\t\t<% } %>\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="list-infos">\n\t\t\t<h1 class="league-gothic"><%- movie.infos.title %><% if(movie.infos.season != undefined) { %> - S<%- movie.infos.season%><% if(movie.videos[0].episode != undefined && movie.videos.length <= 1) { %>E<%- movie.videos[0].episode%><% } } %></h1>\n\n\t\t\t<div class="button-group">\n\t\t\t\t<a href="/watch/<%- movie._id %>" title="Visionner">\n\t\t\t\t\t<i class="entypo-eye"></i>\n\t\t\t\t</a>\n\n\t\t\t\t<% if(movie.videos.length > 1 ) { %>\n\t\t\t\t<a href="/archive/<%- movie._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t\t<% } else {%>\n\t\t\t\t<a href="/download/<%- movie._id %>" title="Télécharger">\n\t\t\t\t<% } %>\n\t\t\t\t\t<i class="entypo-download"></i>\n\t\t\t\t</a>\n\n\t\t\t\t<a href="/delete/movie/<%- movie._id %>" class="delete-item" title="Supprimer">\n\t\t\t\t\t<i class="entypo-trash"></i>\n\t\t\t\t</a>\n<!-- \n\t\t\t\t<a href="#" class="reset-item" title="Enlever de la base de données (il reviens)" data-type="movie">\n\t\t\t\t\t<i class="entypo-cancel"></i>\n\t\t\t\t</a> -->\n\t\t\t</div>\n\n\t\t\t<hr />\n\t\t\t<p class="infos">\n\t\t\t\t<%- movie.infos.synopsis %><br>\n\t\t\t\t<% if(movie.infos.trailer != undefined) { %>\n\t\t\t\t\t<a href="<%- movie.infos.trailer %>" target="_blank">Voir le trailer</a>\n\t\t\t\t<% } %>\n\t\t\t</p>\n\n\t\t\t<% if(movie.quality != undefined && movie.quality.length > 0) { %>\n\t\t\t\t<p class="info"><i class="entypo-monitor"></i><%- movie.quality %></p>\n\t\t\t<% } %>\n\t\t\t<% if(movie.format != undefined && movie.format.length > 0) { %>\n\t\t\t\t<p class="info"><i class="entypo-doc-landscape"></i><%- movie.format %></p>\n\t\t\t<% } %>\n\t\t\t<% if(movie.language != undefined && movie.language.length > 0) { %>\n\t\t\t\t<p class="info"><i class="entypo-sound"></i><%- movie.language %></p>\n\t\t\t<% } %>\n\t\t\t<% if(movie.subtitles != undefined && movie.subtitles.length > 0) { %>\n\t\t\t\t<p class="info"><i class="entypo-text-doc"></i><%- movie.subtitles %></p>\n\t\t\t<% } %>\n\n\t\t\t<% if(movie.audio != undefined && movie.audio.length > 0 ) { %>\n\t\t\t\t<p class="info"><i class="entypo-sound"></i><%- movie.audio %></p>\n\t\t\t<% } %>\n\n\t\t</div>\n\t\t<% if(movie.videos.length > 1) { %>\n\t\t\t<div class="showFiles">\n\t\t\t\t<i class="entypo-attach"></i><% if(movie.type == \'tvseries\') { %>Episodes<%} else {%>Fichiers<%}%>\n\t\t\t</div>\n\t\t\t<div class="files">\n\t\t\t\t<table>\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr><th>#</th><th>Nom</th><th>Poids</th><th>Options</th></tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<%\tvar i = 1;\n\n\t\t\t\t\t\tif(movie.movieType == "tvseries") {\n\t\t\t\t\t\t\tmovie.videos.sort(function (a, b) {\n\t\t\t\t\t\t\t\tif(a.episode == b.episode)\n\t\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\t\telse if(a.episode > b.episode)\n\t\t\t\t\t\t\t\t\treturn 1;\n\n\t\t\t\t\t\t\t\treturn -1;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tmovie.videos.sort(function (a, b) {\n\t\t\t\t\t\t\t    if (a.name == b.name) {\n\t\t\t\t\t\t\t        return 0;\n\t\t\t\t\t\t\t    } else if (a.name > b.name) {\n\t\t\t\t\t\t\t        return 1;\n\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t    return -1;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmovie.videos.forEach(function(file) {\n\t\t\t\t\t\t%>\n\t\t\t\t\t\t<tr data-id="<%if(file.episode !== undefined){%><%-file._id%><%} %>">\n\t\t\t\t\t\t\t<td><%- i %></td>\n\t\t\t\t\t\t\t<td class="file_name" style="text-align:left"><%- file.name %> <%= (file.episode !== null && file.episode.length) ? \'- E\' + file.episode : \'\' %></td>\n\t\t\t\t\t\t\t<td><%- bytesToSize(file.size) %></td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a href="/download/<%-movie._id%>/<%-file._id%>"><i class="entypo-download"></i></a>\n\t\t\t\t\t\t\t\t<a href="/watch/<%-movie._id%>/<%-file._id%>"><i class="entypo-eye"></i></a>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\t\t\t\n\t\t\t\t\t\t<% \n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t}); \n\t\t\t\t\t\t%>\n\t\t\t\t\t</tbody>\n\t\t\t\t\t<tfoot>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<% if(movie.videos[0].episode === null ) { %> \n\t\t\t\t\t\t\t\t<td colspan="3" style="text-align:left">Taille totale : <%- bytesToSize(tailleDossier) %></td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<a href="/archive/<%- movie._id %>" data-full-size="<%- tailleDossier %>" class="archive">Télécharger le dossier</a>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<% } %>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tfoot>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t<% } %>\n\t</div>\n\t<div data-id="<%- movie._id %>" class="element miniature video" data-date-added="<%- new Date(movie.dateAdded).getTime() %>">\n\t\t<div class="titre"><h1 class="league-gothic"><%- movie.infos.title %><% if(movie.infos.season != undefined) { %> - S<%- movie.infos.season%><% if(movie.videos[0].episode != undefined && movie.videos.length <= 1) { %>E<%- movie.videos[0].episode%><% } } %></h1></div>\n\t\n\t\t<a href="/watch/<%- movie._id %>">\n \t\t\t<% if(movie.infos.picture == undefined) {%>\n\t\t\t\t<img src="/images/cover/video.png" />\n\t\t\t<% } else { %>\n\t\t\t\t<img src="<%- movie.infos.picture %>" />\n\t\t\t<% } %>\n\t\t</a>\n\t</div>\n\t<div data-id="<%- movie._id %>" class="element table video" data-date-added="<%- new Date(movie.dateAdded).getTime() %>">\n\t\t<i class="entypo-video"></i>\n\n\t\t<a href="/watch/<%- movie._id %>" class="table-link">\n\t\t\t<%- movie.infos.title %><% if(movie.infos.season != undefined) { %> - S<%- movie.infos.season%><% if(movie.videos[0].episode != undefined && movie.videos.length <= 1) { %>E<%- movie.videos[0].episode%><% } } %>\n\t\t</a>\n\n\t\t<div class="button-group">\n\t\t\t<a href="/watch/<%- movie._id %>" title="Visionner">\n\t\t\t\t<i class="entypo-eye"></i>\n\t\t\t</a>\n\n\t\t\t<% if(movie.videos.length > 1 ) { %>\n\t\t\t<a href="/archive/<%- movie._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t<% } else {%>\n\t\t\t<a href="/download/<%- movie._id %>" title="Télécharger">\n\t\t\t<% } %>\n\t\t\t\t<i class="entypo-download"></i>\n\t\t\t</a>\n\n\t\t\t<a href="/delete/movie/<%- movie._id %>" class="delete-item" title="Supprimer">\n\t\t\t\t<i class="entypo-trash"></i>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n<%\n});\n%>';});

define('text!../views/others.ejs',[],function () { return '<%\nothers.forEach(function(other) {\n\n\tif(other.files.length > 1) {\n\t\tvar tailleDossier = 0;\n\n\t\tfor(var i = 0; i < other.files.length; i++) {\n\t\t\ttailleDossier += parseFloat(other.files[i].size);\n\t\t}\n\n\t}\n%>\n\t<div data-id="<%- other._id %>" class="element list other clearfix" data-date-added="<%- new Date(other.dateAdded).getTime() %>">\n\t\t<div class="pullLeft">\n\t\t\t<% if(other.files.length > 1) {%>\n\t\t\t<a href="/archive/<%- other._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t<% } else {%>\n\t\t\t<a href="/download/<%- other._id %>" title="Télécharger">\n\t\t\t<% } %>\n\t\t\t\t<div class="cover">\n\t\t\t\t\t<div class="cover-hover">\n\t\t\t\t\t\t<i class="entypo-play"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<img src="/images/cover/other.png" />\n\t\t\t\t</div>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="list-infos">\n\t\t\t<h1 class="league-gothic"><%- other.name %></h1>\n\t\t\t<div class="button-group">\n\t\t\t\t<% if(other.files.length > 1) {%>\n\t\t\t\t<a href="/archive/<%- other._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t\t<% } else {%>\n\t\t\t\t<a href="/download/<%- other._id %>" title="Télécharger">\n\t\t\t\t<% } %>\n\t\t\t\t\t<i class="entypo-download"></i>\n\t\t\t\t</a>\n\n\t\t\t\t<a href="/delete/other/<%- other._id %>" class="delete-item" title="Supprimer">\n\t\t\t\t\t<i class="entypo-trash"></i>\n\t\t\t\t</a>\n\n\t\t\t\t<!-- <a href="#" class="reset-item" title="Enlever de la base de données (il reviens)" data-type="other">\n\t\t\t\t\t<i class="entypo-cancel"></i>\n\t\t\t\t</a> -->\n\t\t\t</div>\n\t\t\t<hr />\n\t\t\t<p class="infos">\n\t\t\t\t<% if(other.files) {%>\n\t\t\t\tType : <%- other.files[0].type %> <br />\n\t\t\t\t\t<% if(other.files.length == 1) { %>\n\t\t\t\t\tTaille : <%- bytesToSize(other.files[0].size) %>\n\t\t\t\t\t<% } else { %>\n\t\t\t\t\tTaille : <%- bytesToSize(tailleDossier) %>\n\t\t\t\t\t<% } %>\n\t\t\t\t<% } %>\n\t\t\t</p>\n\t\t</div>\n\t\t<% if(other.files.length > 1) { %>\n\t\t\t<div class="showFiles">\n\t\t\t\t<i class="entypo-attach"></i>Fichiers\n\t\t\t</div>\n\t\t\t<div class="files">\n\t\t\t\t<table>\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr><th>#</th><th>Nom</th><th>Poids</th><th>Options</th></tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<%\tvar i = 1;\n\t\t\t\t\t\tother.files.sort(function (a, b) {\n\t\t\t\t\t\t    if (a.name == b.name) {\n\t\t\t\t\t\t        return 0;\n\t\t\t\t\t\t    } else if (a.name > b.name) {\n\t\t\t\t\t\t        return 1;\n\t\t\t\t\t\t    }\n\t\t\t\t\t\t    return -1;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tother.files.forEach(function(file) {\n\t\t\t\t\t\t%>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td><%- i %></td>\n\t\t\t\t\t\t\t<td style="text-align:left"><%- file.name %></td>\n\t\t\t\t\t\t\t<td><%- bytesToSize(file.size) %></td>\n\t\t\t\t\t\t\t<td><a href="/download/<%-other._id%>/<%-file._id%>"><i class="entypo-download"></i></a></td>\n\t\t\t\t\t\t</tr>\t\t\t\n\t\t\t\t\t\t<% \n\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t}); \n\t\t\t\t\t\t%>\n\t\t\t\t\t</tbody>\n\t\t\t\t\t<tfoot>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td colspan="3" style="text-align:left">Taille totale : <%- bytesToSize(tailleDossier) %></td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<a href="/archive/<%- other._id %>" data-full-size="<%- tailleDossier %>" class="archive">Télécharger le dossier</a>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tfoot>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t<% } %>\n\t</div>\n\t<div data-id="<%- other._id %>" class="element miniature other clearfix" data-date-added="<%- new Date(other.dateAdded).getTime() %>">\n\t\t<div class="titre"><h1 class="league-gothic" title="<%- other.name %>"><%- other.name %></h1></div>\n\t\t<% if(other.files.length > 1) {%>\n\t\t<a href="/archive/<%- other._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t<% } else {%>\n\t\t<a href="/download/<%- other._id %>" title="Télécharger">\n\t\t<% } %>\n\t\t\t<img src="/images/cover/other.png" />\n\t\t</a>\n\t</div>\n\t<div data-id="<%- other._id %>" class="element table other" data-date-added="<%- new Date(other.dateAdded).getTime() %>">\n\t\t<i class="entypo-box"></i> \n\t\t<a href="/download/<%- other._id %>" class="table-link" title="Télécharger">\n\t\t\t<%- other.name %>\n\t\t</a>\n\t\t<div class="button-group">\n\t\t\t<% if(other.files.length > 1) {%>\n\t\t\t<a href="/archive/<%- other._id %>" data-full-size="<%- tailleDossier %>" class="archive" title="Télécharger">\n\t\t\t<% } else {%>\n\t\t\t<a href="/download/<%- other._id %>" title="Télécharger">\n\t\t\t<% } %>\n\t\t\t\t<i class="entypo-download"></i>\n\t\t\t</a>\n\n\t\t\t<a href="/delete/other/<%- other._id %>" class="delete-item" title="Supprimer">\n\t\t\t\t<i class="entypo-trash"></i>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t<%\n\t});\n\t%>';});

/*!
 * classie - class helper functions
 * from bonzo https://github.com/ded/bonzo
 * 
 * classie.has( elem, 'my-class' ) -> true/false
 * classie.add( elem, 'my-new-class' )
 * classie.remove( elem, 'my-unwanted-class' )
 * classie.toggle( elem, 'my-class' )
 */

/*jshint browser: true, strict: true, undef: true */
/*global define: false */

( function( window ) {



// class helper functions from bonzo https://github.com/ded/bonzo

function classReg( className ) {
  return new RegExp("(^|\\s+)" + className + "(\\s+|$)");
}

// classList support for class management
// altho to be fair, the api sucks because it won't accept multiple classes at once
var hasClass, addClass, removeClass;

if ( 'classList' in document.documentElement ) {
  hasClass = function( elem, c ) {
    return elem.classList.contains( c );
  };
  addClass = function( elem, c ) {
    elem.classList.add( c );
  };
  removeClass = function( elem, c ) {
    elem.classList.remove( c );
  };
}
else {
  hasClass = function( elem, c ) {
    return classReg( c ).test( elem.className );
  };
  addClass = function( elem, c ) {
    if ( !hasClass( elem, c ) ) {
      elem.className = elem.className + ' ' + c;
    }
  };
  removeClass = function( elem, c ) {
    elem.className = elem.className.replace( classReg( c ), ' ' );
  };
}

function toggleClass( elem, c ) {
  var fn = hasClass( elem, c ) ? removeClass : addClass;
  fn( elem, c );
}

var classie = {
  // full names
  hasClass: hasClass,
  addClass: addClass,
  removeClass: removeClass,
  toggleClass: toggleClass,
  // short names
  has: hasClass,
  add: addClass,
  remove: removeClass,
  toggle: toggleClass
};

// transport
if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'classie/classie',classie );
} else {
  // browser global
  window.classie = classie;
}

})( window );

/*!
 * getStyleProperty v1.0.3
 * original by kangax
 * http://perfectionkills.com/feature-testing-css-properties/
 */

/*jshint browser: true, strict: true, undef: true */
/*global define: false, exports: false, module: false */

( function( window ) {



var prefixes = 'Webkit Moz ms Ms O'.split(' ');
var docElemStyle = document.documentElement.style;

function getStyleProperty( propName ) {
  if ( !propName ) {
    return;
  }

  // test standard property first
  if ( typeof docElemStyle[ propName ] === 'string' ) {
    return propName;
  }

  // capitalize
  propName = propName.charAt(0).toUpperCase() + propName.slice(1);

  // test vendor specific properties
  var prefixed;
  for ( var i=0, len = prefixes.length; i < len; i++ ) {
    prefixed = prefixes[i] + propName;
    if ( typeof docElemStyle[ prefixed ] === 'string' ) {
      return prefixed;
    }
  }
}

// transport
if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'get-style-property/get-style-property',[],function() {
    return getStyleProperty;
  });
} else if ( typeof exports === 'object' ) {
  // CommonJS for Component
  module.exports = getStyleProperty;
} else {
  // browser global
  window.getStyleProperty = getStyleProperty;
}

})( window );

/**
 * getSize v1.1.6
 * measure size of elements
 */

/*jshint browser: true, strict: true, undef: true, unused: true */
/*global define: false, exports: false, require: false, module: false */

( function( window, undefined ) {



// -------------------------- helpers -------------------------- //

var defView = document.defaultView;
var isComputedStyle = defView && defView.getComputedStyle;

var getStyle = isComputedStyle ?
  function( elem ) {
    return defView.getComputedStyle( elem, null );
  } :
  function( elem ) {
    return elem.currentStyle;
  };

// get a number from a string, not a percentage
function getStyleSize( value ) {
  var num = parseFloat( value );
  // not a percent like '100%', and a number
  var isValid = value.indexOf('%') === -1 && !isNaN( num );
  return isValid && num;
}

// -------------------------- measurements -------------------------- //

var measurements = [
  'paddingLeft',
  'paddingRight',
  'paddingTop',
  'paddingBottom',
  'marginLeft',
  'marginRight',
  'marginTop',
  'marginBottom',
  'borderLeftWidth',
  'borderRightWidth',
  'borderTopWidth',
  'borderBottomWidth'
];

function getZeroSize() {
  var size = {
    width: 0,
    height: 0,
    innerWidth: 0,
    innerHeight: 0,
    outerWidth: 0,
    outerHeight: 0
  };
  for ( var i=0, len = measurements.length; i < len; i++ ) {
    var measurement = measurements[i];
    size[ measurement ] = 0;
  }
  return size;
}



function defineGetSize( getStyleProperty ) {

// -------------------------- box sizing -------------------------- //

var boxSizingProp = getStyleProperty('boxSizing');
var isBoxSizeOuter;

/**
 * WebKit measures the outer-width on style.width on border-box elems
 * IE & Firefox measures the inner-width
 */
( function() {
  if ( !boxSizingProp ) {
    return;
  }

  var div = document.createElement('div');
  div.style.width = '200px';
  div.style.padding = '1px 2px 3px 4px';
  div.style.borderStyle = 'solid';
  div.style.borderWidth = '1px 2px 3px 4px';
  div.style[ boxSizingProp ] = 'border-box';

  var body = document.body || document.documentElement;
  body.appendChild( div );
  var style = getStyle( div );

  isBoxSizeOuter = getStyleSize( style.width ) === 200;
  body.removeChild( div );
})();


// -------------------------- getSize -------------------------- //

function getSize( elem ) {
  // use querySeletor if elem is string
  if ( typeof elem === 'string' ) {
    elem = document.querySelector( elem );
  }

  // do not proceed on non-objects
  if ( !elem || typeof elem !== 'object' || !elem.nodeType ) {
    return;
  }

  var style = getStyle( elem );

  // if hidden, everything is 0
  if ( style.display === 'none' ) {
    return getZeroSize();
  }

  var size = {};
  size.width = elem.offsetWidth;
  size.height = elem.offsetHeight;

  var isBorderBox = size.isBorderBox = !!( boxSizingProp &&
    style[ boxSizingProp ] && style[ boxSizingProp ] === 'border-box' );

  // get all measurements
  for ( var i=0, len = measurements.length; i < len; i++ ) {
    var measurement = measurements[i];
    var value = style[ measurement ];
    value = mungeNonPixel( elem, value );
    var num = parseFloat( value );
    // any 'auto', 'medium' value will be 0
    size[ measurement ] = !isNaN( num ) ? num : 0;
  }

  var paddingWidth = size.paddingLeft + size.paddingRight;
  var paddingHeight = size.paddingTop + size.paddingBottom;
  var marginWidth = size.marginLeft + size.marginRight;
  var marginHeight = size.marginTop + size.marginBottom;
  var borderWidth = size.borderLeftWidth + size.borderRightWidth;
  var borderHeight = size.borderTopWidth + size.borderBottomWidth;

  var isBorderBoxSizeOuter = isBorderBox && isBoxSizeOuter;

  // overwrite width and height if we can get it from style
  var styleWidth = getStyleSize( style.width );
  if ( styleWidth !== false ) {
    size.width = styleWidth +
      // add padding and border unless it's already including it
      ( isBorderBoxSizeOuter ? 0 : paddingWidth + borderWidth );
  }

  var styleHeight = getStyleSize( style.height );
  if ( styleHeight !== false ) {
    size.height = styleHeight +
      // add padding and border unless it's already including it
      ( isBorderBoxSizeOuter ? 0 : paddingHeight + borderHeight );
  }

  size.innerWidth = size.width - ( paddingWidth + borderWidth );
  size.innerHeight = size.height - ( paddingHeight + borderHeight );

  size.outerWidth = size.width + marginWidth;
  size.outerHeight = size.height + marginHeight;

  return size;
}

// IE8 returns percent values, not pixels
// taken from jQuery's curCSS
function mungeNonPixel( elem, value ) {
  // IE8 and has percent value
  if ( isComputedStyle || value.indexOf('%') === -1 ) {
    return value;
  }
  var style = elem.style;
  // Remember the original values
  var left = style.left;
  var rs = elem.runtimeStyle;
  var rsLeft = rs && rs.left;

  // Put in the new values to get a computed value out
  if ( rsLeft ) {
    rs.left = elem.currentStyle.left;
  }
  style.left = value;
  value = style.pixelLeft;

  // Revert the changed values
  style.left = left;
  if ( rsLeft ) {
    rs.left = rsLeft;
  }

  return value;
}

return getSize;

}

// transport
if ( typeof define === 'function' && define.amd ) {
  // AMD for RequireJS
  define( 'get-size/get-size',[ 'get-style-property/get-style-property' ], defineGetSize );
} else if ( typeof exports === 'object' ) {
  // CommonJS for Component
  module.exports = defineGetSize( require('get-style-property') );
} else {
  // browser global
  window.getSize = defineGetSize( window.getStyleProperty );
}

})( window );

/*!
 * eventie v1.0.3
 * event binding helper
 *   eventie.bind( elem, 'click', myFn )
 *   eventie.unbind( elem, 'click', myFn )
 */

/*jshint browser: true, undef: true, unused: true */
/*global define: false */

( function( window ) {



var docElem = document.documentElement;

var bind = function() {};

if ( docElem.addEventListener ) {
  bind = function( obj, type, fn ) {
    obj.addEventListener( type, fn, false );
  };
} else if ( docElem.attachEvent ) {
  bind = function( obj, type, fn ) {
    obj[ type + fn ] = fn.handleEvent ?
      function() {
        var event = window.event;
        // add event.target
        event.target = event.target || event.srcElement;
        fn.handleEvent.call( fn, event );
      } :
      function() {
        var event = window.event;
        // add event.target
        event.target = event.target || event.srcElement;
        fn.call( obj, event );
      };
    obj.attachEvent( "on" + type, obj[ type + fn ] );
  };
}

var unbind = function() {};

if ( docElem.removeEventListener ) {
  unbind = function( obj, type, fn ) {
    obj.removeEventListener( type, fn, false );
  };
} else if ( docElem.detachEvent ) {
  unbind = function( obj, type, fn ) {
    obj.detachEvent( "on" + type, obj[ type + fn ] );
    try {
      delete obj[ type + fn ];
    } catch ( err ) {
      // can't delete window object properties
      obj[ type + fn ] = undefined;
    }
  };
}

var eventie = {
  bind: bind,
  unbind: unbind
};

// transport
if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'eventie/eventie',eventie );
} else {
  // browser global
  window.eventie = eventie;
}

})( this );

/*!
 * docReady
 * Cross browser DOMContentLoaded event emitter
 */

/*jshint browser: true, strict: true, undef: true, unused: true*/
/*global define: false */

( function( window ) {



var document = window.document;
// collection of functions to be triggered on ready
var queue = [];

function docReady( fn ) {
  // throw out non-functions
  if ( typeof fn !== 'function' ) {
    return;
  }

  if ( docReady.isReady ) {
    // ready now, hit it
    fn();
  } else {
    // queue function when ready
    queue.push( fn );
  }
}

docReady.isReady = false;

// triggered on various doc ready events
function init( event ) {
  // bail if IE8 document is not ready just yet
  var isIE8NotReady = event.type === 'readystatechange' && document.readyState !== 'complete';
  if ( docReady.isReady || isIE8NotReady ) {
    return;
  }
  docReady.isReady = true;

  // process queue
  for ( var i=0, len = queue.length; i < len; i++ ) {
    var fn = queue[i];
    fn();
  }
}

function defineDocReady( eventie ) {
  eventie.bind( document, 'DOMContentLoaded', init );
  eventie.bind( document, 'readystatechange', init );
  eventie.bind( window, 'load', init );

  return docReady;
}

// transport
if ( typeof define === 'function' && define.amd ) {
  // AMD
  // if RequireJS, then doc is already ready
  docReady.isReady = typeof requirejs === 'function';
  define( 'doc-ready/doc-ready',[ 'eventie/eventie' ], defineDocReady );
} else {
  // browser global
  window.docReady = defineDocReady( window.eventie );
}

})( this );

/*!
 * EventEmitter v4.2.5 - git.io/ee
 * Oliver Caldwell
 * MIT license
 * @preserve
 */

(function () {
	

	/**
	 * Class for managing events.
	 * Can be extended to provide event functionality in other classes.
	 *
	 * @class EventEmitter Manages event registering and emitting.
	 */
	function EventEmitter() {}

	// Shortcuts to improve speed and size
	var proto = EventEmitter.prototype;
	var exports = this;
	var originalGlobalValue = exports.EventEmitter;

	/**
	 * Finds the index of the listener for the event in it's storage array.
	 *
	 * @param {Function[]} listeners Array of listeners to search through.
	 * @param {Function} listener Method to look for.
	 * @return {Number} Index of the specified listener, -1 if not found
	 * @api private
	 */
	function indexOfListener(listeners, listener) {
		var i = listeners.length;
		while (i--) {
			if (listeners[i].listener === listener) {
				return i;
			}
		}

		return -1;
	}

	/**
	 * Alias a method while keeping the context correct, to allow for overwriting of target method.
	 *
	 * @param {String} name The name of the target method.
	 * @return {Function} The aliased method
	 * @api private
	 */
	function alias(name) {
		return function aliasClosure() {
			return this[name].apply(this, arguments);
		};
	}

	/**
	 * Returns the listener array for the specified event.
	 * Will initialise the event object and listener arrays if required.
	 * Will return an object if you use a regex search. The object contains keys for each matched event. So /ba[rz]/ might return an object containing bar and baz. But only if you have either defined them with defineEvent or added some listeners to them.
	 * Each property in the object response is an array of listener functions.
	 *
	 * @param {String|RegExp} evt Name of the event to return the listeners from.
	 * @return {Function[]|Object} All listener functions for the event.
	 */
	proto.getListeners = function getListeners(evt) {
		var events = this._getEvents();
		var response;
		var key;

		// Return a concatenated array of all matching events if
		// the selector is a regular expression.
		if (typeof evt === 'object') {
			response = {};
			for (key in events) {
				if (events.hasOwnProperty(key) && evt.test(key)) {
					response[key] = events[key];
				}
			}
		}
		else {
			response = events[evt] || (events[evt] = []);
		}

		return response;
	};

	/**
	 * Takes a list of listener objects and flattens it into a list of listener functions.
	 *
	 * @param {Object[]} listeners Raw listener objects.
	 * @return {Function[]} Just the listener functions.
	 */
	proto.flattenListeners = function flattenListeners(listeners) {
		var flatListeners = [];
		var i;

		for (i = 0; i < listeners.length; i += 1) {
			flatListeners.push(listeners[i].listener);
		}

		return flatListeners;
	};

	/**
	 * Fetches the requested listeners via getListeners but will always return the results inside an object. This is mainly for internal use but others may find it useful.
	 *
	 * @param {String|RegExp} evt Name of the event to return the listeners from.
	 * @return {Object} All listener functions for an event in an object.
	 */
	proto.getListenersAsObject = function getListenersAsObject(evt) {
		var listeners = this.getListeners(evt);
		var response;

		if (listeners instanceof Array) {
			response = {};
			response[evt] = listeners;
		}

		return response || listeners;
	};

	/**
	 * Adds a listener function to the specified event.
	 * The listener will not be added if it is a duplicate.
	 * If the listener returns true then it will be removed after it is called.
	 * If you pass a regular expression as the event name then the listener will be added to all events that match it.
	 *
	 * @param {String|RegExp} evt Name of the event to attach the listener to.
	 * @param {Function} listener Method to be called when the event is emitted. If the function returns true then it will be removed after calling.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.addListener = function addListener(evt, listener) {
		var listeners = this.getListenersAsObject(evt);
		var listenerIsWrapped = typeof listener === 'object';
		var key;

		for (key in listeners) {
			if (listeners.hasOwnProperty(key) && indexOfListener(listeners[key], listener) === -1) {
				listeners[key].push(listenerIsWrapped ? listener : {
					listener: listener,
					once: false
				});
			}
		}

		return this;
	};

	/**
	 * Alias of addListener
	 */
	proto.on = alias('addListener');

	/**
	 * Semi-alias of addListener. It will add a listener that will be
	 * automatically removed after it's first execution.
	 *
	 * @param {String|RegExp} evt Name of the event to attach the listener to.
	 * @param {Function} listener Method to be called when the event is emitted. If the function returns true then it will be removed after calling.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.addOnceListener = function addOnceListener(evt, listener) {
		return this.addListener(evt, {
			listener: listener,
			once: true
		});
	};

	/**
	 * Alias of addOnceListener.
	 */
	proto.once = alias('addOnceListener');

	/**
	 * Defines an event name. This is required if you want to use a regex to add a listener to multiple events at once. If you don't do this then how do you expect it to know what event to add to? Should it just add to every possible match for a regex? No. That is scary and bad.
	 * You need to tell it what event names should be matched by a regex.
	 *
	 * @param {String} evt Name of the event to create.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.defineEvent = function defineEvent(evt) {
		this.getListeners(evt);
		return this;
	};

	/**
	 * Uses defineEvent to define multiple events.
	 *
	 * @param {String[]} evts An array of event names to define.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.defineEvents = function defineEvents(evts) {
		for (var i = 0; i < evts.length; i += 1) {
			this.defineEvent(evts[i]);
		}
		return this;
	};

	/**
	 * Removes a listener function from the specified event.
	 * When passed a regular expression as the event name, it will remove the listener from all events that match it.
	 *
	 * @param {String|RegExp} evt Name of the event to remove the listener from.
	 * @param {Function} listener Method to remove from the event.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.removeListener = function removeListener(evt, listener) {
		var listeners = this.getListenersAsObject(evt);
		var index;
		var key;

		for (key in listeners) {
			if (listeners.hasOwnProperty(key)) {
				index = indexOfListener(listeners[key], listener);

				if (index !== -1) {
					listeners[key].splice(index, 1);
				}
			}
		}

		return this;
	};

	/**
	 * Alias of removeListener
	 */
	proto.off = alias('removeListener');

	/**
	 * Adds listeners in bulk using the manipulateListeners method.
	 * If you pass an object as the second argument you can add to multiple events at once. The object should contain key value pairs of events and listeners or listener arrays. You can also pass it an event name and an array of listeners to be added.
	 * You can also pass it a regular expression to add the array of listeners to all events that match it.
	 * Yeah, this function does quite a bit. That's probably a bad thing.
	 *
	 * @param {String|Object|RegExp} evt An event name if you will pass an array of listeners next. An object if you wish to add to multiple events at once.
	 * @param {Function[]} [listeners] An optional array of listener functions to add.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.addListeners = function addListeners(evt, listeners) {
		// Pass through to manipulateListeners
		return this.manipulateListeners(false, evt, listeners);
	};

	/**
	 * Removes listeners in bulk using the manipulateListeners method.
	 * If you pass an object as the second argument you can remove from multiple events at once. The object should contain key value pairs of events and listeners or listener arrays.
	 * You can also pass it an event name and an array of listeners to be removed.
	 * You can also pass it a regular expression to remove the listeners from all events that match it.
	 *
	 * @param {String|Object|RegExp} evt An event name if you will pass an array of listeners next. An object if you wish to remove from multiple events at once.
	 * @param {Function[]} [listeners] An optional array of listener functions to remove.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.removeListeners = function removeListeners(evt, listeners) {
		// Pass through to manipulateListeners
		return this.manipulateListeners(true, evt, listeners);
	};

	/**
	 * Edits listeners in bulk. The addListeners and removeListeners methods both use this to do their job. You should really use those instead, this is a little lower level.
	 * The first argument will determine if the listeners are removed (true) or added (false).
	 * If you pass an object as the second argument you can add/remove from multiple events at once. The object should contain key value pairs of events and listeners or listener arrays.
	 * You can also pass it an event name and an array of listeners to be added/removed.
	 * You can also pass it a regular expression to manipulate the listeners of all events that match it.
	 *
	 * @param {Boolean} remove True if you want to remove listeners, false if you want to add.
	 * @param {String|Object|RegExp} evt An event name if you will pass an array of listeners next. An object if you wish to add/remove from multiple events at once.
	 * @param {Function[]} [listeners] An optional array of listener functions to add/remove.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.manipulateListeners = function manipulateListeners(remove, evt, listeners) {
		var i;
		var value;
		var single = remove ? this.removeListener : this.addListener;
		var multiple = remove ? this.removeListeners : this.addListeners;

		// If evt is an object then pass each of it's properties to this method
		if (typeof evt === 'object' && !(evt instanceof RegExp)) {
			for (i in evt) {
				if (evt.hasOwnProperty(i) && (value = evt[i])) {
					// Pass the single listener straight through to the singular method
					if (typeof value === 'function') {
						single.call(this, i, value);
					}
					else {
						// Otherwise pass back to the multiple function
						multiple.call(this, i, value);
					}
				}
			}
		}
		else {
			// So evt must be a string
			// And listeners must be an array of listeners
			// Loop over it and pass each one to the multiple method
			i = listeners.length;
			while (i--) {
				single.call(this, evt, listeners[i]);
			}
		}

		return this;
	};

	/**
	 * Removes all listeners from a specified event.
	 * If you do not specify an event then all listeners will be removed.
	 * That means every event will be emptied.
	 * You can also pass a regex to remove all events that match it.
	 *
	 * @param {String|RegExp} [evt] Optional name of the event to remove all listeners for. Will remove from every event if not passed.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.removeEvent = function removeEvent(evt) {
		var type = typeof evt;
		var events = this._getEvents();
		var key;

		// Remove different things depending on the state of evt
		if (type === 'string') {
			// Remove all listeners for the specified event
			delete events[evt];
		}
		else if (type === 'object') {
			// Remove all events matching the regex.
			for (key in events) {
				if (events.hasOwnProperty(key) && evt.test(key)) {
					delete events[key];
				}
			}
		}
		else {
			// Remove all listeners in all events
			delete this._events;
		}

		return this;
	};

	/**
	 * Alias of removeEvent.
	 *
	 * Added to mirror the node API.
	 */
	proto.removeAllListeners = alias('removeEvent');

	/**
	 * Emits an event of your choice.
	 * When emitted, every listener attached to that event will be executed.
	 * If you pass the optional argument array then those arguments will be passed to every listener upon execution.
	 * Because it uses `apply`, your array of arguments will be passed as if you wrote them out separately.
	 * So they will not arrive within the array on the other side, they will be separate.
	 * You can also pass a regular expression to emit to all events that match it.
	 *
	 * @param {String|RegExp} evt Name of the event to emit and execute listeners for.
	 * @param {Array} [args] Optional array of arguments to be passed to each listener.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.emitEvent = function emitEvent(evt, args) {
		var listeners = this.getListenersAsObject(evt);
		var listener;
		var i;
		var key;
		var response;

		for (key in listeners) {
			if (listeners.hasOwnProperty(key)) {
				i = listeners[key].length;

				while (i--) {
					// If the listener returns true then it shall be removed from the event
					// The function is executed either with a basic call or an apply if there is an args array
					listener = listeners[key][i];

					if (listener.once === true) {
						this.removeListener(evt, listener.listener);
					}

					response = listener.listener.apply(this, args || []);

					if (response === this._getOnceReturnValue()) {
						this.removeListener(evt, listener.listener);
					}
				}
			}
		}

		return this;
	};

	/**
	 * Alias of emitEvent
	 */
	proto.trigger = alias('emitEvent');

	/**
	 * Subtly different from emitEvent in that it will pass its arguments on to the listeners, as opposed to taking a single array of arguments to pass on.
	 * As with emitEvent, you can pass a regex in place of the event name to emit to all events that match it.
	 *
	 * @param {String|RegExp} evt Name of the event to emit and execute listeners for.
	 * @param {...*} Optional additional arguments to be passed to each listener.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.emit = function emit(evt) {
		var args = Array.prototype.slice.call(arguments, 1);
		return this.emitEvent(evt, args);
	};

	/**
	 * Sets the current value to check against when executing listeners. If a
	 * listeners return value matches the one set here then it will be removed
	 * after execution. This value defaults to true.
	 *
	 * @param {*} value The new value to check for when executing listeners.
	 * @return {Object} Current instance of EventEmitter for chaining.
	 */
	proto.setOnceReturnValue = function setOnceReturnValue(value) {
		this._onceReturnValue = value;
		return this;
	};

	/**
	 * Fetches the current value to check against when executing listeners. If
	 * the listeners return value matches this one then it should be removed
	 * automatically. It will return true by default.
	 *
	 * @return {*|Boolean} The current value to check for or the default, true.
	 * @api private
	 */
	proto._getOnceReturnValue = function _getOnceReturnValue() {
		if (this.hasOwnProperty('_onceReturnValue')) {
			return this._onceReturnValue;
		}
		else {
			return true;
		}
	};

	/**
	 * Fetches the events object and creates one if required.
	 *
	 * @return {Object} The events storage object.
	 * @api private
	 */
	proto._getEvents = function _getEvents() {
		return this._events || (this._events = {});
	};

	/**
	 * Reverts the global {@link EventEmitter} to its previous value and returns a reference to this version.
	 *
	 * @return {Function} Non conflicting EventEmitter class.
	 */
	EventEmitter.noConflict = function noConflict() {
		exports.EventEmitter = originalGlobalValue;
		return EventEmitter;
	};

	// Expose the class either via AMD, CommonJS or the global object
	if (typeof define === 'function' && define.amd) {
		define('eventEmitter/EventEmitter',[],function () {
			return EventEmitter;
		});
	}
	else if (typeof module === 'object' && module.exports){
		module.exports = EventEmitter;
	}
	else {
		this.EventEmitter = EventEmitter;
	}
}.call(this));

/**
 * matchesSelector helper v1.0.1
 *
 * @name matchesSelector
 *   @param {Element} elem
 *   @param {String} selector
 */

/*jshint browser: true, strict: true, undef: true, unused: true */
/*global define: false */

( function( global, ElemProto ) {

  

  var matchesMethod = ( function() {
    // check un-prefixed
    if ( ElemProto.matchesSelector ) {
      return 'matchesSelector';
    }
    // check vendor prefixes
    var prefixes = [ 'webkit', 'moz', 'ms', 'o' ];

    for ( var i=0, len = prefixes.length; i < len; i++ ) {
      var prefix = prefixes[i];
      var method = prefix + 'MatchesSelector';
      if ( ElemProto[ method ] ) {
        return method;
      }
    }
  })();

  // ----- match ----- //

  function match( elem, selector ) {
    return elem[ matchesMethod ]( selector );
  }

  // ----- appendToFragment ----- //

  function checkParent( elem ) {
    // not needed if already has parent
    if ( elem.parentNode ) {
      return;
    }
    var fragment = document.createDocumentFragment();
    fragment.appendChild( elem );
  }

  // ----- query ----- //

  // fall back to using QSA
  // thx @jonathantneal https://gist.github.com/3062955
  function query( elem, selector ) {
    // append to fragment if no parent
    checkParent( elem );

    // match elem with all selected elems of parent
    var elems = elem.parentNode.querySelectorAll( selector );
    for ( var i=0, len = elems.length; i < len; i++ ) {
      // return true if match
      if ( elems[i] === elem ) {
        return true;
      }
    }
    // otherwise return false
    return false;
  }

  // ----- matchChild ----- //

  function matchChild( elem, selector ) {
    checkParent( elem );
    return match( elem, selector );
  }

  // ----- matchesSelector ----- //

  var matchesSelector;

  if ( matchesMethod ) {
    // IE9 supports matchesSelector, but doesn't work on orphaned elems
    // check for that
    var div = document.createElement('div');
    var supportsOrphans = match( div, 'div' );
    matchesSelector = supportsOrphans ? match : matchChild;
  } else {
    matchesSelector = query;
  }

  // transport
  if ( typeof define === 'function' && define.amd ) {
    // AMD
    define( 'matches-selector/matches-selector',[],function() {
      return matchesSelector;
    });
  } else {
    // browser global
    window.matchesSelector = matchesSelector;
  }

})( this, Element.prototype );

/**
 * Outlayer Item
**/

( function( window ) {



// ----- get style ----- //

var defView = document.defaultView;

var getStyle = defView && defView.getComputedStyle ?
  function( elem ) {
    return defView.getComputedStyle( elem, null );
  } :
  function( elem ) {
    return elem.currentStyle;
  };


// extend objects
function extend( a, b ) {
  for ( var prop in b ) {
    a[ prop ] = b[ prop ];
  }
  return a;
}

function isEmptyObj( obj ) {
  for ( var prop in obj ) {
    return false;
  }
  prop = null;
  return true;
}

// http://jamesroberts.name/blog/2010/02/22/string-functions-for-javascript-trim-to-camel-case-to-dashed-and-to-underscore/
function toDash( str ) {
  return str.replace( /([A-Z])/g, function( $1 ){
    return '-' + $1.toLowerCase();
  });
}

// -------------------------- Outlayer definition -------------------------- //

function outlayerItemDefinition( EventEmitter, getSize, getStyleProperty ) {

// -------------------------- CSS3 support -------------------------- //

var transitionProperty = getStyleProperty('transition');
var transformProperty = getStyleProperty('transform');
var supportsCSS3 = transitionProperty && transformProperty;
var is3d = !!getStyleProperty('perspective');

var transitionEndEvent = {
  WebkitTransition: 'webkitTransitionEnd',
  MozTransition: 'transitionend',
  OTransition: 'otransitionend',
  transition: 'transitionend'
}[ transitionProperty ];

// properties that could have vendor prefix
var prefixableProperties = [
  'transform',
  'transition',
  'transitionDuration',
  'transitionProperty'
];

// cache all vendor properties
var vendorProperties = ( function() {
  var cache = {};
  for ( var i=0, len = prefixableProperties.length; i < len; i++ ) {
    var prop = prefixableProperties[i];
    var supportedProp = getStyleProperty( prop );
    if ( supportedProp && supportedProp !== prop ) {
      cache[ prop ] = supportedProp;
    }
  }
  return cache;
})();

// -------------------------- Item -------------------------- //

function Item( element, layout ) {
  if ( !element ) {
    return;
  }

  this.element = element;
  // parent layout class, i.e. Masonry, Isotope, or Packery
  this.layout = layout;
  this.position = {
    x: 0,
    y: 0
  };

  this._create();
}

// inherit EventEmitter
extend( Item.prototype, EventEmitter.prototype );

Item.prototype._create = function() {
  // transition objects
  this._transition = {
    ingProperties: {},
    clean: {},
    onEnd: {}
  };

  this.css({
    position: 'absolute'
  });
};

// trigger specified handler for event type
Item.prototype.handleEvent = function( event ) {
  var method = 'on' + event.type;
  if ( this[ method ] ) {
    this[ method ]( event );
  }
};

Item.prototype.getSize = function() {
  this.size = getSize( this.element );
};

/**
 * apply CSS styles to element
 * @param {Object} style
 */
Item.prototype.css = function( style ) {
  var elemStyle = this.element.style;

  for ( var prop in style ) {
    // use vendor property if available
    var supportedProp = vendorProperties[ prop ] || prop;
    elemStyle[ supportedProp ] = style[ prop ];
  }
};

 // measure position, and sets it
Item.prototype.getPosition = function() {
  var style = getStyle( this.element );
  var layoutOptions = this.layout.options;
  var isOriginLeft = layoutOptions.isOriginLeft;
  var isOriginTop = layoutOptions.isOriginTop;
  var x = parseInt( style[ isOriginLeft ? 'left' : 'right' ], 10 );
  var y = parseInt( style[ isOriginTop ? 'top' : 'bottom' ], 10 );

  // clean up 'auto' or other non-integer values
  x = isNaN( x ) ? 0 : x;
  y = isNaN( y ) ? 0 : y;
  // remove padding from measurement
  var layoutSize = this.layout.size;
  x -= isOriginLeft ? layoutSize.paddingLeft : layoutSize.paddingRight;
  y -= isOriginTop ? layoutSize.paddingTop : layoutSize.paddingBottom;

  this.position.x = x;
  this.position.y = y;
};

// set settled position, apply padding
Item.prototype.layoutPosition = function() {
  var layoutSize = this.layout.size;
  var layoutOptions = this.layout.options;
  var style = {};

  if ( layoutOptions.isOriginLeft ) {
    style.left = ( this.position.x + layoutSize.paddingLeft ) + 'px';
    // reset other property
    style.right = '';
  } else {
    style.right = ( this.position.x + layoutSize.paddingRight ) + 'px';
    style.left = '';
  }

  if ( layoutOptions.isOriginTop ) {
    style.top = ( this.position.y + layoutSize.paddingTop ) + 'px';
    style.bottom = '';
  } else {
    style.bottom = ( this.position.y + layoutSize.paddingBottom ) + 'px';
    style.top = '';
  }

  this.css( style );
  this.emitEvent( 'layout', [ this ] );
};


// transform translate function
var translate = is3d ?
  function( x, y ) {
    return 'translate3d(' + x + 'px, ' + y + 'px, 0)';
  } :
  function( x, y ) {
    return 'translate(' + x + 'px, ' + y + 'px)';
  };


Item.prototype._transitionTo = function( x, y ) {
  this.getPosition();
  // get current x & y from top/left
  var curX = this.position.x;
  var curY = this.position.y;

  var compareX = parseInt( x, 10 );
  var compareY = parseInt( y, 10 );
  var didNotMove = compareX === this.position.x && compareY === this.position.y;

  // save end position
  this.setPosition( x, y );

  // if did not move and not transitioning, just go to layout
  if ( didNotMove && !this.isTransitioning ) {
    this.layoutPosition();
    return;
  }

  var transX = x - curX;
  var transY = y - curY;
  var transitionStyle = {};
  // flip cooridinates if origin on right or bottom
  var layoutOptions = this.layout.options;
  transX = layoutOptions.isOriginLeft ? transX : -transX;
  transY = layoutOptions.isOriginTop ? transY : -transY;
  transitionStyle.transform = translate( transX, transY );

  this.transition({
    to: transitionStyle,
    onTransitionEnd: {
      transform: this.layoutPosition
    },
    isCleaning: true
  });
};

// non transition + transform support
Item.prototype.goTo = function( x, y ) {
  this.setPosition( x, y );
  this.layoutPosition();
};

// use transition and transforms if supported
Item.prototype.moveTo = supportsCSS3 ?
  Item.prototype._transitionTo : Item.prototype.goTo;

Item.prototype.setPosition = function( x, y ) {
  this.position.x = parseInt( x, 10 );
  this.position.y = parseInt( y, 10 );
};

// ----- transition ----- //

/**
 * @param {Object} style - CSS
 * @param {Function} onTransitionEnd
 */

// non transition, just trigger callback
Item.prototype._nonTransition = function( args ) {
  this.css( args.to );
  if ( args.isCleaning ) {
    this._removeStyles( args.to );
  }
  for ( var prop in args.onTransitionEnd ) {
    args.onTransitionEnd[ prop ].call( this );
  }
};

/**
 * proper transition
 * @param {Object} args - arguments
 *   @param {Object} to - style to transition to
 *   @param {Object} from - style to start transition from
 *   @param {Boolean} isCleaning - removes transition styles after transition
 *   @param {Function} onTransitionEnd - callback
 */
Item.prototype._transition = function( args ) {
  // redirect to nonTransition if no transition duration
  if ( !parseFloat( this.layout.options.transitionDuration ) ) {
    this._nonTransition( args );
    return;
  }

  var _transition = this._transition;
  // keep track of onTransitionEnd callback by css property
  for ( var prop in args.onTransitionEnd ) {
    _transition.onEnd[ prop ] = args.onTransitionEnd[ prop ];
  }
  // keep track of properties that are transitioning
  for ( prop in args.to ) {
    _transition.ingProperties[ prop ] = true;
    // keep track of properties to clean up when transition is done
    if ( args.isCleaning ) {
      _transition.clean[ prop ] = true;
    }
  }

  // set from styles
  if ( args.from ) {
    this.css( args.from );
    // force redraw. http://blog.alexmaccaw.com/css-transitions
    var h = this.element.offsetHeight;
    // hack for JSHint to hush about unused var
    h = null;
  }
  // enable transition
  this.enableTransition( args.to );
  // set styles that are transitioning
  this.css( args.to );

  this.isTransitioning = true;

};

var itemTransitionProperties = transformProperty && ( toDash( transformProperty ) +
  ',opacity' );

Item.prototype.enableTransition = function(/* style */) {
  // only enable if not already transitioning
  // bug in IE10 were re-setting transition style will prevent
  // transitionend event from triggering
  if ( this.isTransitioning ) {
    return;
  }

  // make transition: foo, bar, baz from style object
  // TODO uncomment this bit when IE10 bug is resolved
  // var transitionValue = [];
  // for ( var prop in style ) {
  //   // dash-ify camelCased properties like WebkitTransition
  //   transitionValue.push( toDash( prop ) );
  // }
  // enable transition styles
  // HACK always enable transform,opacity for IE10
  this.css({
    transitionProperty: itemTransitionProperties,
    transitionDuration: this.layout.options.transitionDuration
  });
  // listen for transition end event
  this.element.addEventListener( transitionEndEvent, this, false );
};

Item.prototype.transition = Item.prototype[ transitionProperty ? '_transition' : '_nonTransition' ];

// ----- events ----- //

Item.prototype.onwebkitTransitionEnd = function( event ) {
  this.ontransitionend( event );
};

Item.prototype.onotransitionend = function( event ) {
  this.ontransitionend( event );
};

// properties that I munge to make my life easier
var dashedVendorProperties = {
  '-webkit-transform': 'transform',
  '-moz-transform': 'transform',
  '-o-transform': 'transform'
};

Item.prototype.ontransitionend = function( event ) {
  // disregard bubbled events from children
  if ( event.target !== this.element ) {
    return;
  }
  var _transition = this._transition;
  // get property name of transitioned property, convert to prefix-free
  var propertyName = dashedVendorProperties[ event.propertyName ] || event.propertyName;

  // remove property that has completed transitioning
  delete _transition.ingProperties[ propertyName ];
  // check if any properties are still transitioning
  if ( isEmptyObj( _transition.ingProperties ) ) {
    // all properties have completed transitioning
    this.disableTransition();
  }
  // clean style
  if ( propertyName in _transition.clean ) {
    // clean up style
    this.element.style[ event.propertyName ] = '';
    delete _transition.clean[ propertyName ];
  }
  // trigger onTransitionEnd callback
  if ( propertyName in _transition.onEnd ) {
    var onTransitionEnd = _transition.onEnd[ propertyName ];
    onTransitionEnd.call( this );
    delete _transition.onEnd[ propertyName ];
  }

  this.emitEvent( 'transitionEnd', [ this ] );
};

Item.prototype.disableTransition = function() {
  this.removeTransitionStyles();
  this.element.removeEventListener( transitionEndEvent, this, false );
  this.isTransitioning = false;
};

/**
 * removes style property from element
 * @param {Object} style
**/
Item.prototype._removeStyles = function( style ) {
  // clean up transition styles
  var cleanStyle = {};
  for ( var prop in style ) {
    cleanStyle[ prop ] = '';
  }
  this.css( cleanStyle );
};

var cleanTransitionStyle = {
  transitionProperty: '',
  transitionDuration: ''
};

Item.prototype.removeTransitionStyles = function() {
  // remove transition
  this.css( cleanTransitionStyle );
};

// ----- show/hide/remove ----- //

// remove element from DOM
Item.prototype.removeElem = function() {
  this.element.parentNode.removeChild( this.element );
  this.emitEvent( 'remove', [ this ] );
};

Item.prototype.remove = function() {
  // just remove element if no transition support or no transition
  if ( !transitionProperty || !parseFloat( this.layout.options.transitionDuration ) ) {
    this.removeElem();
    return;
  }

  // start transition
  var _this = this;
  this.on( 'transitionEnd', function() {
    _this.removeElem();
    return true; // bind once
  });
  this.hide();
};

Item.prototype.reveal = function() {
  delete this.isHidden;
  // remove display: none
  this.css({ display: '' });

  var options = this.layout.options;
  this.transition({
    from: options.hiddenStyle,
    to: options.visibleStyle,
    isCleaning: true
  });
};

Item.prototype.hide = function() {
  // set flag
  this.isHidden = true;
  // remove display: none
  this.css({ display: '' });

  var options = this.layout.options;
  this.transition({
    from: options.visibleStyle,
    to: options.hiddenStyle,
    // keep hidden stuff hidden
    isCleaning: true,
    onTransitionEnd: {
      opacity: function() {
        this.css({ display: 'none' });
      }
    }
  });
};

Item.prototype.destroy = function() {
  this.css({
    position: '',
    left: '',
    right: '',
    top: '',
    bottom: '',
    transition: '',
    transform: ''
  });
};

return Item;

}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'outlayer/item',[
      'eventEmitter/EventEmitter',
      'get-size/get-size',
      'get-style-property/get-style-property'
    ],
    outlayerItemDefinition );
} else {
  // browser global
  window.Outlayer = {};
  window.Outlayer.Item = outlayerItemDefinition(
    window.EventEmitter,
    window.getSize,
    window.getStyleProperty
  );
}

})( window );

/*!
 * Outlayer v1.1.8
 * the brains and guts of a layout library
 */

( function( window ) {



// ----- vars ----- //

var document = window.document;
var console = window.console;
var jQuery = window.jQuery;

var noop = function() {};

// -------------------------- helpers -------------------------- //

// extend objects
function extend( a, b ) {
  for ( var prop in b ) {
    a[ prop ] = b[ prop ];
  }
  return a;
}


var objToString = Object.prototype.toString;
function isArray( obj ) {
  return objToString.call( obj ) === '[object Array]';
}

// turn element or nodeList into an array
function makeArray( obj ) {
  var ary = [];
  if ( isArray( obj ) ) {
    // use object if already an array
    ary = obj;
  } else if ( obj && typeof obj.length === 'number' ) {
    // convert nodeList to array
    for ( var i=0, len = obj.length; i < len; i++ ) {
      ary.push( obj[i] );
    }
  } else {
    // array of single index
    ary.push( obj );
  }
  return ary;
}

// http://stackoverflow.com/a/384380/182183
var isElement = ( typeof HTMLElement === 'object' ) ?
  function isElementDOM2( obj ) {
    return obj instanceof HTMLElement;
  } :
  function isElementQuirky( obj ) {
    return obj && typeof obj === 'object' &&
      obj.nodeType === 1 && typeof obj.nodeName === 'string';
  };

// index of helper cause IE8
var indexOf = Array.prototype.indexOf ? function( ary, obj ) {
    return ary.indexOf( obj );
  } : function( ary, obj ) {
    for ( var i=0, len = ary.length; i < len; i++ ) {
      if ( ary[i] === obj ) {
        return i;
      }
    }
    return -1;
  };

function removeFrom( obj, ary ) {
  var index = indexOf( ary, obj );
  if ( index !== -1 ) {
    ary.splice( index, 1 );
  }
}

// http://jamesroberts.name/blog/2010/02/22/string-functions-for-javascript-trim-to-camel-case-to-dashed-and-to-underscore/
function toDashed( str ) {
  return str.replace( /(.)([A-Z])/g, function( match, $1, $2 ) {
    return $1 + '-' + $2;
  }).toLowerCase();
}


function outlayerDefinition( eventie, docReady, EventEmitter, getSize, matchesSelector, Item ) {

// -------------------------- Outlayer -------------------------- //

// globally unique identifiers
var GUID = 0;
// internal store of all Outlayer intances
var instances = {};


/**
 * @param {Element, String} element
 * @param {Object} options
 * @constructor
 */
function Outlayer( element, options ) {
  // use element as selector string
  if ( typeof element === 'string' ) {
    element = document.querySelector( element );
  }

  // bail out if not proper element
  if ( !element || !isElement( element ) ) {
    if ( console ) {
      console.error( 'Bad ' + this.settings.namespace + ' element: ' + element );
    }
    return;
  }

  this.element = element;

  // options
  this.options = extend( {}, this.options );
  this.option( options );

  // add id for Outlayer.getFromElement
  var id = ++GUID;
  this.element.outlayerGUID = id; // expando
  instances[ id ] = this; // associate via id

  // kick it off
  this._create();

  if ( this.options.isInitLayout ) {
    this.layout();
  }
}

// settings are for internal use only
Outlayer.prototype.settings = {
  namespace: 'outlayer',
  item: Item
};

// default options
Outlayer.prototype.options = {
  containerStyle: {
    position: 'relative'
  },
  isInitLayout: true,
  isOriginLeft: true,
  isOriginTop: true,
  isResizeBound: true,
  // item options
  transitionDuration: '0.4s',
  hiddenStyle: {
    opacity: 0,
    transform: 'scale(0.001)'
  },
  visibleStyle: {
    opacity: 1,
    transform: 'scale(1)'
  }
};

// inherit EventEmitter
extend( Outlayer.prototype, EventEmitter.prototype );

/**
 * set options
 * @param {Object} opts
 */
Outlayer.prototype.option = function( opts ) {
  extend( this.options, opts );
};

Outlayer.prototype._create = function() {
  // get items from children
  this.reloadItems();
  // elements that affect layout, but are not laid out
  this.stamps = [];
  this.stamp( this.options.stamp );
  // set container style
  extend( this.element.style, this.options.containerStyle );

  // bind resize method
  if ( this.options.isResizeBound ) {
    this.bindResize();
  }
};

// goes through all children again and gets bricks in proper order
Outlayer.prototype.reloadItems = function() {
  // collection of item elements
  this.items = this._itemize( this.element.children );
};


/**
 * turn elements into Outlayer.Items to be used in layout
 * @param {Array or NodeList or HTMLElement} elems
 * @returns {Array} items - collection of new Outlayer Items
 */
Outlayer.prototype._itemize = function( elems ) {

  var itemElems = this._filterFindItemElements( elems );
  var Item = this.settings.item;

  // create new Outlayer Items for collection
  var items = [];
  for ( var i=0, len = itemElems.length; i < len; i++ ) {
    var elem = itemElems[i];
    var item = new Item( elem, this );
    items.push( item );
  }

  return items;
};

/**
 * get item elements to be used in layout
 * @param {Array or NodeList or HTMLElement} elems
 * @returns {Array} items - item elements
 */
Outlayer.prototype._filterFindItemElements = function( elems ) {
  // make array of elems
  elems = makeArray( elems );
  var itemSelector = this.options.itemSelector;
  var itemElems = [];

  for ( var i=0, len = elems.length; i < len; i++ ) {
    var elem = elems[i];
    // check that elem is an actual element
    if ( !isElement( elem ) ) {
      continue;
    }
    // filter & find items if we have an item selector
    if ( itemSelector ) {
      // filter siblings
      if ( matchesSelector( elem, itemSelector ) ) {
        itemElems.push( elem );
      }
      // find children
      var childElems = elem.querySelectorAll( itemSelector );
      // concat childElems to filterFound array
      for ( var j=0, jLen = childElems.length; j < jLen; j++ ) {
        itemElems.push( childElems[j] );
      }
    } else {
      itemElems.push( elem );
    }
  }

  return itemElems;
};

/**
 * getter method for getting item elements
 * @returns {Array} elems - collection of item elements
 */
Outlayer.prototype.getItemElements = function() {
  var elems = [];
  for ( var i=0, len = this.items.length; i < len; i++ ) {
    elems.push( this.items[i].element );
  }
  return elems;
};

// ----- init & layout ----- //

/**
 * lays out all items
 */
Outlayer.prototype.layout = function() {
  this._resetLayout();
  this._manageStamps();

  // don't animate first layout
  var isInstant = this.options.isLayoutInstant !== undefined ?
    this.options.isLayoutInstant : !this._isLayoutInited;
  this.layoutItems( this.items, isInstant );

  // flag for initalized
  this._isLayoutInited = true;
};

// _init is alias for layout
Outlayer.prototype._init = Outlayer.prototype.layout;

/**
 * logic before any new layout
 */
Outlayer.prototype._resetLayout = function() {
  this.getSize();
};


Outlayer.prototype.getSize = function() {
  this.size = getSize( this.element );
};

/**
 * get measurement from option, for columnWidth, rowHeight, gutter
 * if option is String -> get element from selector string, & get size of element
 * if option is Element -> get size of element
 * else use option as a number
 *
 * @param {String} measurement
 * @param {String} size - width or height
 * @private
 */
Outlayer.prototype._getMeasurement = function( measurement, size ) {
  var option = this.options[ measurement ];
  var elem;
  if ( !option ) {
    // default to 0
    this[ measurement ] = 0;
  } else {
    if ( typeof option === 'string' ) {
      elem = this.element.querySelector( option );
    } else if ( isElement( option ) ) {
      elem = option;
    }
    // use size of element, if element
    this[ measurement ] = elem ? getSize( elem )[ size ] : option;
  }
};

/**
 * layout a collection of item elements
 * @api public
 */
Outlayer.prototype.layoutItems = function( items, isInstant ) {
  items = this._getItemsForLayout( items );

  this._layoutItems( items, isInstant );

  this._postLayout();
};

/**
 * get the items to be laid out
 * you may want to skip over some items
 * @param {Array} items
 * @returns {Array} items
 */
Outlayer.prototype._getItemsForLayout = function( items ) {
  var layoutItems = [];
  for ( var i=0, len = items.length; i < len; i++ ) {
    var item = items[i];
    if ( !item.isIgnored ) {
      layoutItems.push( item );
    }
  }
  return layoutItems;
};

/**
 * layout items
 * @param {Array} items
 * @param {Boolean} isInstant
 */
Outlayer.prototype._layoutItems = function( items, isInstant ) {
  if ( !items || !items.length ) {
    // no items, emit event with empty array
    this.emitEvent( 'layoutComplete', [ this, items ] );
    return;
  }

  // emit layoutComplete when done
  this._itemsOn( items, 'layout', function onItemsLayout() {
    this.emitEvent( 'layoutComplete', [ this, items ] );
  });

  var queue = [];

  for ( var i=0, len = items.length; i < len; i++ ) {
    var item = items[i];
    // get x/y object from method
    var position = this._getItemLayoutPosition( item );
    // enqueue
    position.item = item;
    position.isInstant = isInstant;
    queue.push( position );
  }

  this._processLayoutQueue( queue );
};

/**
 * get item layout position
 * @param {Outlayer.Item} item
 * @returns {Object} x and y position
 */
Outlayer.prototype._getItemLayoutPosition = function( /* item */ ) {
  return {
    x: 0,
    y: 0
  };
};

/**
 * iterate over array and position each item
 * Reason being - separating this logic prevents 'layout invalidation'
 * thx @paul_irish
 * @param {Array} queue
 */
Outlayer.prototype._processLayoutQueue = function( queue ) {
  for ( var i=0, len = queue.length; i < len; i++ ) {
    var obj = queue[i];
    this._positionItem( obj.item, obj.x, obj.y, obj.isInstant );
  }
};

/**
 * Sets position of item in DOM
 * @param {Outlayer.Item} item
 * @param {Number} x - horizontal position
 * @param {Number} y - vertical position
 * @param {Boolean} isInstant - disables transitions
 */
Outlayer.prototype._positionItem = function( item, x, y, isInstant ) {
  if ( isInstant ) {
    // if not transition, just set CSS
    item.goTo( x, y );
  } else {
    item.moveTo( x, y );
  }
};

/**
 * Any logic you want to do after each layout,
 * i.e. size the container
 */
Outlayer.prototype._postLayout = function() {
  var size = this._getContainerSize();
  if ( size ) {
    this._setContainerMeasure( size.width, true );
    this._setContainerMeasure( size.height, false );
  }
};

/**
 * @returns {Object} size
 *   @param {Number} width
 *   @param {Number} height
 */
Outlayer.prototype._getContainerSize = noop;

/**
 * @param {Number} measure - size of width or height
 * @param {Boolean} isWidth
 */
Outlayer.prototype._setContainerMeasure = function( measure, isWidth ) {
  if ( measure === undefined ) {
    return;
  }

  var elemSize = this.size;
  // add padding and border width if border box
  if ( elemSize.isBorderBox ) {
    measure += isWidth ? elemSize.paddingLeft + elemSize.paddingRight +
      elemSize.borderLeftWidth + elemSize.borderRightWidth :
      elemSize.paddingBottom + elemSize.paddingTop +
      elemSize.borderTopWidth + elemSize.borderBottomWidth;
  }

  measure = Math.max( measure, 0 );
  this.element.style[ isWidth ? 'width' : 'height' ] = measure + 'px';
};

/**
 * trigger a callback for a collection of items events
 * @param {Array} items - Outlayer.Items
 * @param {String} eventName
 * @param {Function} callback
 */
Outlayer.prototype._itemsOn = function( items, eventName, callback ) {
  var doneCount = 0;
  var count = items.length;
  // event callback
  var _this = this;
  function tick() {
    doneCount++;
    if ( doneCount === count ) {
      callback.call( _this );
    }
    return true; // bind once
  }
  // bind callback
  for ( var i=0, len = items.length; i < len; i++ ) {
    var item = items[i];
    item.on( eventName, tick );
  }
};

// -------------------------- ignore & stamps -------------------------- //


/**
 * keep item in collection, but do not lay it out
 * ignored items do not get skipped in layout
 * @param {Element} elem
 */
Outlayer.prototype.ignore = function( elem ) {
  var item = this.getItem( elem );
  if ( item ) {
    item.isIgnored = true;
  }
};

/**
 * return item to layout collection
 * @param {Element} elem
 */
Outlayer.prototype.unignore = function( elem ) {
  var item = this.getItem( elem );
  if ( item ) {
    delete item.isIgnored;
  }
};

/**
 * adds elements to stamps
 * @param {NodeList, Array, Element, or String} elems
 */
Outlayer.prototype.stamp = function( elems ) {
  elems = this._find( elems );
  if ( !elems ) {
    return;
  }

  this.stamps = this.stamps.concat( elems );
  // ignore
  for ( var i=0, len = elems.length; i < len; i++ ) {
    var elem = elems[i];
    this.ignore( elem );
  }
};

/**
 * removes elements to stamps
 * @param {NodeList, Array, or Element} elems
 */
Outlayer.prototype.unstamp = function( elems ) {
  elems = this._find( elems );
  if ( !elems ){
    return;
  }

  for ( var i=0, len = elems.length; i < len; i++ ) {
    var elem = elems[i];
    // filter out removed stamp elements
    removeFrom( elem, this.stamps );
    this.unignore( elem );
  }

};

/**
 * finds child elements
 * @param {NodeList, Array, Element, or String} elems
 * @returns {Array} elems
 */
Outlayer.prototype._find = function( elems ) {
  if ( !elems ) {
    return;
  }
  // if string, use argument as selector string
  if ( typeof elems === 'string' ) {
    elems = this.element.querySelectorAll( elems );
  }
  elems = makeArray( elems );
  return elems;
};

Outlayer.prototype._manageStamps = function() {
  if ( !this.stamps || !this.stamps.length ) {
    return;
  }

  this._getBoundingRect();

  for ( var i=0, len = this.stamps.length; i < len; i++ ) {
    var stamp = this.stamps[i];
    this._manageStamp( stamp );
  }
};

// update boundingLeft / Top
Outlayer.prototype._getBoundingRect = function() {
  // get bounding rect for container element
  var boundingRect = this.element.getBoundingClientRect();
  var size = this.size;
  this._boundingRect = {
    left: boundingRect.left + size.paddingLeft + size.borderLeftWidth,
    top: boundingRect.top + size.paddingTop + size.borderTopWidth,
    right: boundingRect.right - ( size.paddingRight + size.borderRightWidth ),
    bottom: boundingRect.bottom - ( size.paddingBottom + size.borderBottomWidth )
  };
};

/**
 * @param {Element} stamp
**/
Outlayer.prototype._manageStamp = noop;

/**
 * get x/y position of element relative to container element
 * @param {Element} elem
 * @returns {Object} offset - has left, top, right, bottom
 */
Outlayer.prototype._getElementOffset = function( elem ) {
  var boundingRect = elem.getBoundingClientRect();
  var thisRect = this._boundingRect;
  var size = getSize( elem );
  var offset = {
    left: boundingRect.left - thisRect.left - size.marginLeft,
    top: boundingRect.top - thisRect.top - size.marginTop,
    right: thisRect.right - boundingRect.right - size.marginRight,
    bottom: thisRect.bottom - boundingRect.bottom - size.marginBottom
  };
  return offset;
};

// -------------------------- resize -------------------------- //

// enable event handlers for listeners
// i.e. resize -> onresize
Outlayer.prototype.handleEvent = function( event ) {
  var method = 'on' + event.type;
  if ( this[ method ] ) {
    this[ method ]( event );
  }
};

/**
 * Bind layout to window resizing
 */
Outlayer.prototype.bindResize = function() {
  // bind just one listener
  if ( this.isResizeBound ) {
    return;
  }
  eventie.bind( window, 'resize', this );
  this.isResizeBound = true;
};

/**
 * Unbind layout to window resizing
 */
Outlayer.prototype.unbindResize = function() {
  eventie.unbind( window, 'resize', this );
  this.isResizeBound = false;
};

// original debounce by John Hann
// http://unscriptable.com/index.php/2009/03/20/debouncing-javascript-methods/

// this fires every resize
Outlayer.prototype.onresize = function() {
  if ( this.resizeTimeout ) {
    clearTimeout( this.resizeTimeout );
  }

  var _this = this;
  function delayed() {
    _this.resize();
    delete _this.resizeTimeout;
  }

  this.resizeTimeout = setTimeout( delayed, 100 );
};

// debounced, layout on resize
Outlayer.prototype.resize = function() {
  // don't trigger if size did not change
  var size = getSize( this.element );
  // check that this.size and size are there
  // IE8 triggers resize on body size change, so they might not be
  var hasSizes = this.size && size;
  if ( hasSizes && size.innerWidth === this.size.innerWidth ) {
    return;
  }

  this.layout();
};


// -------------------------- methods -------------------------- //

/**
 * add items to Outlayer instance
 * @param {Array or NodeList or Element} elems
 * @returns {Array} items - Outlayer.Items
**/
Outlayer.prototype.addItems = function( elems ) {
  var items = this._itemize( elems );
  // add items to collection
  if ( items.length ) {
    this.items = this.items.concat( items );
  }
  return items;
};

/**
 * Layout newly-appended item elements
 * @param {Array or NodeList or Element} elems
 */
Outlayer.prototype.appended = function( elems ) {
  var items = this.addItems( elems );
  if ( !items.length ) {
    return;
  }
  // layout and reveal just the new items
  this.layoutItems( items, true );
  this.reveal( items );
};

/**
 * Layout prepended elements
 * @param {Array or NodeList or Element} elems
 */
Outlayer.prototype.prepended = function( elems ) {
  var items = this._itemize( elems );
  if ( !items.length ) {
    return;
  }
  // add items to beginning of collection
  var previousItems = this.items.slice(0);
  this.items = items.concat( previousItems );
  // start new layout
  this._resetLayout();
  this._manageStamps();
  // layout new stuff without transition
  this.layoutItems( items, true );
  this.reveal( items );
  // layout previous items
  this.layoutItems( previousItems );
};

/**
 * reveal a collection of items
 * @param {Array of Outlayer.Items} items
 */
Outlayer.prototype.reveal = function( items ) {
  if ( !items || !items.length ) {
    return;
  }
  for ( var i=0, len = items.length; i < len; i++ ) {
    var item = items[i];
    item.reveal();
  }
};

/**
 * hide a collection of items
 * @param {Array of Outlayer.Items} items
 */
Outlayer.prototype.hide = function( items ) {
  if ( !items || !items.length ) {
    return;
  }
  for ( var i=0, len = items.length; i < len; i++ ) {
    var item = items[i];
    item.hide();
  }
};

/**
 * get Outlayer.Item, given an Element
 * @param {Element} elem
 * @param {Function} callback
 * @returns {Outlayer.Item} item
 */
Outlayer.prototype.getItem = function( elem ) {
  // loop through items to get the one that matches
  for ( var i=0, len = this.items.length; i < len; i++ ) {
    var item = this.items[i];
    if ( item.element === elem ) {
      // return item
      return item;
    }
  }
};

/**
 * get collection of Outlayer.Items, given Elements
 * @param {Array} elems
 * @returns {Array} items - Outlayer.Items
 */
Outlayer.prototype.getItems = function( elems ) {
  if ( !elems || !elems.length ) {
    return;
  }
  var items = [];
  for ( var i=0, len = elems.length; i < len; i++ ) {
    var elem = elems[i];
    var item = this.getItem( elem );
    if ( item ) {
      items.push( item );
    }
  }

  return items;
};

/**
 * remove element(s) from instance and DOM
 * @param {Array or NodeList or Element} elems
 */
Outlayer.prototype.remove = function( elems ) {
  elems = makeArray( elems );

  var removeItems = this.getItems( elems );
  // bail if no items to remove
  if ( !removeItems || !removeItems.length ) {
    return;
  }

  this._itemsOn( removeItems, 'remove', function() {
    this.emitEvent( 'removeComplete', [ this, removeItems ] );
  });

  for ( var i=0, len = removeItems.length; i < len; i++ ) {
    var item = removeItems[i];
    item.remove();
    // remove item from collection
    removeFrom( item, this.items );
  }
};

// ----- destroy ----- //

// remove and disable Outlayer instance
Outlayer.prototype.destroy = function() {
  // clean up dynamic styles
  var style = this.element.style;
  style.height = '';
  style.position = '';
  style.width = '';
  // destroy items
  for ( var i=0, len = this.items.length; i < len; i++ ) {
    var item = this.items[i];
    item.destroy();
  }

  this.unbindResize();

  delete this.element.outlayerGUID;
  // remove data for jQuery
  if ( jQuery ) {
    jQuery.removeData( this.element, this.settings.namespace );
  }

};

// -------------------------- data -------------------------- //

/**
 * get Outlayer instance from element
 * @param {Element} elem
 * @returns {Outlayer}
 */
Outlayer.data = function( elem ) {
  var id = elem && elem.outlayerGUID;
  return id && instances[ id ];
};

// --------------------------  -------------------------- //

// copy an object on the Outlayer prototype
// used in options and settings
function copyOutlayerProto( obj, property ) {
  obj.prototype[ property ] = extend( {}, Outlayer.prototype[ property ] );
}

// -------------------------- create Outlayer class -------------------------- //

/**
 * create a layout class
 * @param {String} namespace
 */
Outlayer.create = function( namespace, options ) {
  // sub-class Outlayer
  function Layout() {
    Outlayer.apply( this, arguments );
  }

  extend( Layout.prototype, Outlayer.prototype );

  copyOutlayerProto( Layout, 'options' );
  copyOutlayerProto( Layout, 'settings' );

  extend( Layout.prototype.options, options );

  Layout.prototype.settings.namespace = namespace;

  Layout.data = Outlayer.data;

  // sub-class Item
  Layout.Item = function LayoutItem() {
    Item.apply( this, arguments );
  };

  Layout.Item.prototype = new Item();

  Layout.prototype.settings.item = Layout.Item;

  // -------------------------- declarative -------------------------- //

  /**
   * allow user to initialize Outlayer via .js-namespace class
   * options are parsed from data-namespace-option attribute
   */
  docReady( function() {
    var dashedNamespace = toDashed( namespace );
    var elems = document.querySelectorAll( '.js-' + dashedNamespace );
    var dataAttr = 'data-' + dashedNamespace + '-options';

    for ( var i=0, len = elems.length; i < len; i++ ) {
      var elem = elems[i];
      var attr = elem.getAttribute( dataAttr );
      var options;
      try {
        options = attr && JSON.parse( attr );
      } catch ( error ) {
        // log error, do not initialize
        if ( console ) {
          console.error( 'Error parsing ' + dataAttr + ' on ' +
            elem.nodeName.toLowerCase() + ( elem.id ? '#' + elem.id : '' ) + ': ' +
            error );
        }
        continue;
      }
      // initialize
      var instance = new Layout( elem, options );
      // make available via $().data('layoutname')
      if ( jQuery ) {
        jQuery.data( elem, namespace, instance );
      }
    }
  });

  // -------------------------- jQuery bridge -------------------------- //

  // make into jQuery plugin
  if ( jQuery && jQuery.bridget ) {
    jQuery.bridget( namespace, Layout );
  }

  return Layout;
};

// ----- fin ----- //

// back in global
Outlayer.Item = Item;

return Outlayer;

}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'outlayer/outlayer',[
      'eventie/eventie',
      'doc-ready/doc-ready',
      'eventEmitter/EventEmitter',
      'get-size/get-size',
      'matches-selector/matches-selector',
      './item'
    ],
    outlayerDefinition );
} else {
  // browser global
  window.Outlayer = outlayerDefinition(
    window.eventie,
    window.docReady,
    window.EventEmitter,
    window.getSize,
    window.matchesSelector,
    window.Outlayer.Item
  );
}

})( window );

/**
 * Rect
 * low-level utility class for basic geometry
 */

( function( window ) {



// -------------------------- Packery -------------------------- //

// global namespace
var Packery = window.Packery = function() {};

function rectDefinition() {

// -------------------------- Rect -------------------------- //

function Rect( props ) {
  // extend properties from defaults
  for ( var prop in Rect.defaults ) {
    this[ prop ] = Rect.defaults[ prop ];
  }

  for ( prop in props ) {
    this[ prop ] = props[ prop ];
  }

}

// make available
Packery.Rect = Rect;

Rect.defaults = {
  x: 0,
  y: 0,
  width: 0,
  height: 0
};

/**
 * Determines whether or not this rectangle wholly encloses another rectangle or point.
 * @param {Rect} rect
 * @returns {Boolean}
**/
Rect.prototype.contains = function( rect ) {
  // points don't have width or height
  var otherWidth = rect.width || 0;
  var otherHeight = rect.height || 0;
  return this.x <= rect.x &&
    this.y <= rect.y &&
    this.x + this.width >= rect.x + otherWidth &&
    this.y + this.height >= rect.y + otherHeight;
};

/**
 * Determines whether or not the rectangle intersects with another.
 * @param {Rect} rect
 * @returns {Boolean}
**/
Rect.prototype.overlaps = function( rect ) {
  var thisRight = this.x + this.width;
  var thisBottom = this.y + this.height;
  var rectRight = rect.x + rect.width;
  var rectBottom = rect.y + rect.height;

  // http://stackoverflow.com/a/306332
  return this.x < rectRight &&
    thisRight > rect.x &&
    this.y < rectBottom &&
    thisBottom > rect.y;
};

/**
 * @param {Rect} rect - the overlapping rect
 * @returns {Array} freeRects - rects representing the area around the rect
**/
Rect.prototype.getMaximalFreeRects = function( rect ) {

  // if no intersection, return false
  if ( !this.overlaps( rect ) ) {
    return false;
  }

  var freeRects = [];
  var freeRect;

  var thisRight = this.x + this.width;
  var thisBottom = this.y + this.height;
  var rectRight = rect.x + rect.width;
  var rectBottom = rect.y + rect.height;

  // top
  if ( this.y < rect.y ) {
    freeRect = new Rect({
      x: this.x,
      y: this.y,
      width: this.width,
      height: rect.y - this.y
    });
    freeRects.push( freeRect );
  }

  // right
  if ( thisRight > rectRight ) {
    freeRect = new Rect({
      x: rectRight,
      y: this.y,
      width: thisRight - rectRight,
      height: this.height
    });
    freeRects.push( freeRect );
  }

  // bottom
  if ( thisBottom > rectBottom ) {
    freeRect = new Rect({
      x: this.x,
      y: rectBottom,
      width: this.width,
      height: thisBottom - rectBottom
    });
    freeRects.push( freeRect );
  }

  // left
  if ( this.x < rect.x ) {
    freeRect = new Rect({
      x: this.x,
      y: this.y,
      width: rect.x - this.x,
      height: this.height
    });
    freeRects.push( freeRect );
  }

  return freeRects;
};

Rect.prototype.canFit = function( rect ) {
  return this.width >= rect.width && this.height >= rect.height;
};

return Rect;

}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'packery/rect',rectDefinition );
} else {
  // browser global
  window.Packery = window.Packery || {};
  window.Packery.Rect = rectDefinition();
}

})( window );

( function( window ) {



// -------------------------- Packer -------------------------- //

function packerDefinition( Rect ) {

function Packer( width, height ) {
  this.width = width || 0;
  this.height = height || 0;

  this.reset();
}

Packer.prototype.reset = function() {
  this.spaces = [];
  this.newSpaces = [];

  var initialSpace = new Rect({
    x: 0,
    y: 0,
    width: this.width,
    height: this.height
  });

  this.spaces.push( initialSpace );
};

// change x and y of rect to fit with in Packer's available spaces
Packer.prototype.pack = function( rect ) {
  for ( var i=0, len = this.spaces.length; i < len; i++ ) {
    var space = this.spaces[i];
    if ( space.canFit( rect ) ) {
      this.placeInSpace( rect, space );
      break;
    }
  }
};

Packer.prototype.placeInSpace = function( rect, space ) {
  // place rect in space
  rect.x = space.x;
  rect.y = space.y;

  this.placed( rect );
};

// update spaces with placed rect
Packer.prototype.placed = function( rect ) {
  // update spaces
  var revisedSpaces = [];
  for ( var i=0, len = this.spaces.length; i < len; i++ ) {
    var space = this.spaces[i];
    var newSpaces = space.getMaximalFreeRects( rect );
    // add either the original space or the new spaces to the revised spaces
    if ( newSpaces ) {
      revisedSpaces.push.apply( revisedSpaces, newSpaces );
    } else {
      revisedSpaces.push( space );
    }
  }

  this.spaces = revisedSpaces;

  // remove redundant spaces
  Packer.mergeRects( this.spaces );

  this.spaces.sort( Packer.spaceSorterTopLeft );
};

// -------------------------- utility functions -------------------------- //

/**
 * Remove redundant rectangle from array of rectangles
 * @param {Array} rects: an array of Rects
 * @returns {Array} rects: an array of Rects
**/
Packer.mergeRects = function( rects ) {
  for ( var i=0, len = rects.length; i < len; i++ ) {
    var rect = rects[i];
    // skip over this rect if it was already removed
    if ( !rect ) {
      continue;
    }
    // clone rects we're testing, remove this rect
    var compareRects = rects.slice(0);
    // do not compare with self
    compareRects.splice( i, 1 );
    // compare this rect with others
    var removedCount = 0;
    for ( var j=0, jLen = compareRects.length; j < jLen; j++ ) {
      var compareRect = compareRects[j];
      // if this rect contains another,
      // remove that rect from test collection
      var indexAdjust = i > j ? 0 : 1;
      if ( rect.contains( compareRect ) ) {
        // console.log( 'current test rects:' + testRects.length, testRects );
        // console.log( i, j, indexAdjust, rect, compareRect );
        rects.splice( j + indexAdjust - removedCount, 1 );
        removedCount++;
      }
    }
  }

  return rects;
};

// top down, then left to right
Packer.spaceSorterTopLeft = function( a, b ) {
  return a.y - b.y || a.x - b.x;
};

// left to right, then top down
Packer.spaceSorterLeftTop = function( a, b ) {
  return a.x - b.x || a.y - b.y;
};

return Packer;

}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'packery/packer',[ './rect' ], packerDefinition );
} else {
  // browser global
  var Packery = window.Packery = window.Packery || {};
  Packery.Packer = packerDefinition( Packery.Rect );
}

})( window );

/**
 * Packery Item Element
**/

( function( window ) {



// -------------------------- Item -------------------------- //

function itemDefinition( getStyleProperty, Outlayer, Rect ) {

var transformProperty = getStyleProperty('transform');

// sub-class Item
var Item = function PackeryItem() {
  Outlayer.Item.apply( this, arguments );
};

Item.prototype = new Outlayer.Item();

var protoCreate = Item.prototype._create;
Item.prototype._create = function() {
  // call default _create logic
  protoCreate.call( this );
  this.rect = new Rect();
  // rect used for placing, in drag or Packery.fit()
  this.placeRect = new Rect();
};

// -------------------------- drag -------------------------- //

Item.prototype.dragStart = function() {
  this.getPosition();
  this.removeTransitionStyles();
  // remove transform property from transition
  if ( this.isTransitioning && transformProperty ) {
    this.element.style[ transformProperty ] = 'none';
  }
  this.getSize();
  // create place rect, used for position when dragged then dropped
  // or when positioning
  this.isPlacing = true;
  this.needsPositioning = false;
  this.positionPlaceRect( this.position.x, this.position.y );
  this.isTransitioning = false;
  this.didDrag = false;
};

/**
 * handle item when it is dragged
 * @param {Number} x - horizontal position of dragged item
 * @param {Number} y - vertical position of dragged item
 */
Item.prototype.dragMove = function( x, y ) {
  this.didDrag = true;
  var packerySize = this.layout.size;
  x -= packerySize.paddingLeft;
  y -= packerySize.paddingTop;
  this.positionPlaceRect( x, y );
};

Item.prototype.dragStop = function() {
  this.getPosition();
  var isDiffX = this.position.x !== this.placeRect.x;
  var isDiffY = this.position.y !== this.placeRect.y;
  // set post-drag positioning flag
  this.needsPositioning = isDiffX || isDiffY;
  // reset flag
  this.didDrag = false;
};

// -------------------------- placing -------------------------- //

/**
 * position a rect that will occupy space in the packer
 * @param {Number} x
 * @param {Number} y
 * @param {Boolean} isMaxYContained
 */
Item.prototype.positionPlaceRect = function( x, y, isMaxYOpen ) {
  this.placeRect.x = this.getPlaceRectCoord( x, true );
  this.placeRect.y = this.getPlaceRectCoord( y, false, isMaxYOpen );
};

/**
 * get x/y coordinate for place rect
 * @param {Number} coord - x or y
 * @param {Boolean} isX
 * @param {Boolean} isMaxOpen - does not limit value to outer bound
 * @returns {Number} coord - processed x or y
 */
Item.prototype.getPlaceRectCoord = function( coord, isX, isMaxOpen ) {
  var measure = isX ? 'Width' : 'Height';
  var size = this.size[ 'outer' + measure ];
  var segment = this.layout[ isX ? 'columnWidth' : 'rowHeight' ];
  var parentSize = this.layout.size[ 'inner' + measure ];

  // additional parentSize calculations for Y
  if ( !isX ) {
    parentSize = Math.max( parentSize, this.layout.maxY );
    // prevent gutter from bumping up height when non-vertical grid
    if ( !this.layout.rowHeight ) {
      parentSize -= this.layout.gutter;
    }
  }

  var max;

  if ( segment ) {
    segment += this.layout.gutter;
    // allow for last column to reach the edge
    parentSize += isX ? this.layout.gutter : 0;
    // snap to closest segment
    coord = Math.round( coord / segment );
    // contain to outer bound
    // x values must be contained, y values can grow box by 1
    var maxSegments = Math[ isX ? 'floor' : 'ceil' ]( parentSize / segment );
    maxSegments -= Math.ceil( size / segment );
    max = maxSegments;
  } else {
    max = parentSize - size;
  }

  coord = isMaxOpen ? coord : Math.min( coord, max );
  coord *= segment || 1;

  return Math.max( 0, coord );
};

Item.prototype.copyPlaceRectPosition = function() {
  this.rect.x = this.placeRect.x;
  this.rect.y = this.placeRect.y;
};

return Item;

}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'packery/item',[
      'get-style-property/get-style-property',
      'outlayer/outlayer',
      './rect'
    ],
    itemDefinition );
} else {
  // browser global
  window.Packery.Item = itemDefinition(
    window.getStyleProperty,
    window.Outlayer,
    window.Packery.Rect
  );
}

})( window );

/*!
 * Packery v1.1.2
 * bin-packing layout library
 * http://packery.metafizzy.co
 *
 * Commercial use requires one-time purchase of a commercial license
 * http://packery.metafizzy.co/license.html
 *
 * Non-commercial use is licensed under the GPL v3 License
 *
 * Copyright 2013 Metafizzy
 */

( function( window ) {



// -------------------------- Packery -------------------------- //

// used for AMD definition and requires
function packeryDefinition( classie, getSize, Outlayer, Rect, Packer, Item ) {

// create an Outlayer layout class
var Packery = Outlayer.create('packery');
Packery.Item = Packery.prototype.settings.item = Item;

Packery.prototype._create = function() {
  // call super
  Outlayer.prototype._create.call( this );

  // initial properties
  this.packer = new Packer();

  // Left over from v1.0
  this.stamp( this.options.stamped );

  // create drag handlers
  var _this = this;
  this.handleDraggabilly = {
    dragStart: function( draggie ) {
      _this.itemDragStart( draggie.element );
    },
    dragMove: function( draggie ) {
      _this.itemDragMove( draggie.element, draggie.position.x, draggie.position.y );
    },
    dragEnd: function( draggie ) {
      _this.itemDragEnd( draggie.element );
    }
  };

  this.handleUIDraggable = {
    start: function handleUIDraggableStart( event ) {
      _this.itemDragStart( event.currentTarget );
    },
    drag: function handleUIDraggableDrag( event, ui ) {
      _this.itemDragMove( event.currentTarget, ui.position.left, ui.position.top );
    },
    stop: function handleUIDraggableStop( event ) {
      _this.itemDragEnd( event.currentTarget );
    }
  };

};


// ----- init & layout ----- //

/**
 * logic before any new layout
 */
Packery.prototype._resetLayout = function() {
  this.getSize();

  this._getMeasurements();

  // reset packer
  this.packer.width = this.size.innerWidth + this.gutter;
  this.packer.height = Number.POSITIVE_INFINITY;
  this.packer.reset();

  // layout
  this.maxY = 0;
};

/**
 * update columnWidth, rowHeight, & gutter
 * @private
 */
Packery.prototype._getMeasurements = function() {
  this._getMeasurement( 'columnWidth', 'width' );
  this._getMeasurement( 'rowHeight', 'height' );
  this._getMeasurement( 'gutter', 'width' );
};

Packery.prototype._getItemLayoutPosition = function( item ) {
  this._packItem( item );
  return item.rect;
};


/**
 * layout item in packer
 * @param {Packery.Item} item
 */
Packery.prototype._packItem = function( item ) {
  this._setRectSize( item.element, item.rect );
  // pack the rect in the packer
  this.packer.pack( item.rect );
  this._setMaxY( item.rect );
};

/**
 * set max Y value, for height of container
 * @param {Packery.Rect} rect
 * @private
 */
Packery.prototype._setMaxY = function( rect ) {
  this.maxY = Math.max( rect.y + rect.height, this.maxY );
};

/**
 * set the width and height of a rect, applying columnWidth and rowHeight
 * @param {Element} elem
 * @param {Packery.Rect} rect
 */
Packery.prototype._setRectSize = function( elem, rect ) {
  var size = getSize( elem );
  var w = size.outerWidth;
  var h = size.outerHeight;
  // size for columnWidth and rowHeight, if available
  var colW = this.columnWidth + this.gutter;
  var rowH = this.rowHeight + this.gutter;
  w = this.columnWidth ? Math.ceil( w / colW ) * colW : w + this.gutter;
  h = this.rowHeight ? Math.ceil( h / rowH ) * rowH : h + this.gutter;
  // rect must fit in packer
  rect.width = Math.min( w, this.packer.width );
  rect.height = h;
};

Packery.prototype._getContainerSize = function() {
  return {
    height: this.maxY - this.gutter
  };
};


// -------------------------- stamp -------------------------- //

/**
 * makes space for element
 * @param {Element} elem
 */
Packery.prototype._manageStamp = function( elem ) {

  var item = this.getItem( elem );
  var rect;
  if ( item && item.isPlacing ) {
    rect = item.placeRect;
  } else {
    var offset = this._getElementOffset( elem );
    rect = new Rect({
      x: this.options.isOriginLeft ? offset.left : offset.right,
      y: this.options.isOriginTop ? offset.top : offset.bottom
    });
  }

  this._setRectSize( elem, rect );
  // save its space in the packer
  this.packer.placed( rect );
  this._setMaxY( rect );
};

// -------------------------- methods -------------------------- //


Packery.prototype.sortItemsByPosition = function() {
  this.items.sort( function( a, b ) {
    return a.position.y - b.position.y || a.position.x - b.position.x;
  });
};

/**
 * Fit item element in its current position
 * Packery will position elements around it
 * useful for expanding elements
 *
 * @param {Element} elem
 * @param {Number} x - horizontal destination position, optional
 * @param {Number} y - vertical destination position, optional
 */
Packery.prototype.fit = function( elem, x, y ) {
  var item = this.getItem( elem );
  if ( !item ) {
    return;
  }

  // prepare internal properties
  this._getMeasurements();

  // stamp item to get it out of layout
  this.stamp( item.element );
  // required for positionPlaceRect
  item.getSize();
  // set placing flag
  item.isPlacing = true;
  // fall back to current position for fitting
  x = x === undefined ? item.rect.x: x;
  y = y === undefined ? item.rect.y: y;

  // position it best at its destination
  item.positionPlaceRect( x, y, true );

  this._bindFitEvents( item );
  item.moveTo( item.placeRect.x, item.placeRect.y );
  // layout everything else
  this.layout();

  // return back to regularly scheduled programming
  this.unstamp( item.element );
  this.sortItemsByPosition();
  // un set placing flag, back to normal
  item.isPlacing = false;
  // copy place rect position
  item.copyPlaceRectPosition();
};

/**
 * emit event when item is fit and other items are laid out
 * @param {Packery.Item} item
 * @private
 */
Packery.prototype._bindFitEvents = function( item ) {
  var _this = this;
  var ticks = 0;
  function tick() {
    ticks++;
    if ( ticks !== 2 ) {
      return;
    }
    _this.emitEvent( 'fitComplete', [ _this, item ] );
  }
  // when item is laid out
  item.on( 'layout', function() {
    tick();
    return true;
  });
  // when all items are laid out
  this.on( 'layoutComplete', function() {
    tick();
    return true;
  });
};


// -------------------------- drag -------------------------- //

/**
 * handle an item drag start event
 * @param {Element} elem
 */
Packery.prototype.itemDragStart = function( elem ) {
  this.stamp( elem );
  var item = this.getItem( elem );
  if ( item ) {
    item.dragStart();
  }
};

/**
 * handle an item drag move event
 * @param {Element} elem
 * @param {Number} x - horizontal change in position
 * @param {Number} y - vertical change in position
 */
Packery.prototype.itemDragMove = function( elem, x, y ) {
  var item = this.getItem( elem );
  if ( item ) {
    item.dragMove( x, y );
  }

  // debounce
  var _this = this;
  // debounce triggering layout
  function delayed() {
    _this.layout();
    delete _this.dragTimeout;
  }

  this.clearDragTimeout();

  this.dragTimeout = setTimeout( delayed, 40 );
};

Packery.prototype.clearDragTimeout = function() {
  if ( this.dragTimeout ) {
    clearTimeout( this.dragTimeout );
  }
};

/**
 * handle an item drag end event
 * @param {Element} elem
 */
Packery.prototype.itemDragEnd = function( elem ) {
  var item = this.getItem( elem );
  var itemDidDrag;
  if ( item ) {
    itemDidDrag = item.didDrag;
    item.dragStop();
  }
  // if elem didn't move, or if it doesn't need positioning
  // unignore and unstamp and call it a day
  if ( !item || ( !itemDidDrag && !item.needsPositioning ) ) {
    this.unstamp( elem );
    return;
  }
  // procced with dragged item

  classie.add( item.element, 'is-positioning-post-drag' );

  // save this var, as it could get reset in dragStart
  var onLayoutComplete = this._getDragEndLayoutComplete( elem, item );

  if ( item.needsPositioning ) {
    item.on( 'layout', onLayoutComplete );
    item.moveTo( item.placeRect.x, item.placeRect.y );
  } else if ( item ) {
    // item didn't need placement
    item.copyPlaceRectPosition();
  }

  this.clearDragTimeout();
  this.on( 'layoutComplete', onLayoutComplete );
  this.layout();

};

/**
 * get drag end callback
 * @param {Element} elem
 * @param {Packery.Item} item
 * @returns {Function} onLayoutComplete
 */
Packery.prototype._getDragEndLayoutComplete = function( elem, item ) {
  var itemNeedsPositioning = item && item.needsPositioning;
  var completeCount = 0;
  var asyncCount = itemNeedsPositioning ? 2 : 1;
  var _this = this;

  return function onLayoutComplete() {
    completeCount++;
    // don't proceed if not complete
    if ( completeCount !== asyncCount ) {
      return true;
    }
    // reset item
    if ( item ) {
      classie.remove( item.element, 'is-positioning-post-drag' );
      item.isPlacing = false;
      item.copyPlaceRectPosition();
    }

    _this.unstamp( elem );
    // only sort when item moved
    _this.sortItemsByPosition();

    // emit item drag event now that everything is done
    if ( itemNeedsPositioning ) {
      _this.emitEvent( 'dragItemPositioned', [ _this, item ] );
    }
    // listen once
    return true;
  };
};

/**
 * binds Draggabilly events
 * @param {Draggabilly} draggie
 */
Packery.prototype.bindDraggabillyEvents = function( draggie ) {
  draggie.on( 'dragStart', this.handleDraggabilly.dragStart );
  draggie.on( 'dragMove', this.handleDraggabilly.dragMove );
  draggie.on( 'dragEnd', this.handleDraggabilly.dragEnd );
};

/**
 * binds jQuery UI Draggable events
 * @param {jQuery} $elems
 */
Packery.prototype.bindUIDraggableEvents = function( $elems ) {
  $elems
    .on( 'dragstart', this.handleUIDraggable.start )
    .on( 'drag', this.handleUIDraggable.drag )
    .on( 'dragstop', this.handleUIDraggable.stop );
};

Packery.Rect = Rect;
Packery.Packer = Packer;

return Packery;

}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'packery/packery',[
      'classie/classie',
      'get-size/get-size',
      'outlayer/outlayer',
      './rect',
      './packer',
      './item'
    ],
    packeryDefinition );
} else {
  // browser global
  window.Packery = packeryDefinition(
    window.classie,
    window.getSize,
    window.Outlayer,
    window.Packery.Rect,
    window.Packery.Packer,
    window.Packery.Item
  );
}

})( window );

/*!
 * imagesLoaded v3.0.4
 * JavaScript is all like "You images are done yet or what?"
 */

( function( window ) {



var $ = window.jQuery;
var console = window.console;
var hasConsole = typeof console !== 'undefined';

// -------------------------- helpers -------------------------- //

// extend objects
function extend( a, b ) {
  for ( var prop in b ) {
    a[ prop ] = b[ prop ];
  }
  return a;
}

var objToString = Object.prototype.toString;
function isArray( obj ) {
  return objToString.call( obj ) === '[object Array]';
}

// turn element or nodeList into an array
function makeArray( obj ) {
  var ary = [];
  if ( isArray( obj ) ) {
    // use object if already an array
    ary = obj;
  } else if ( typeof obj.length === 'number' ) {
    // convert nodeList to array
    for ( var i=0, len = obj.length; i < len; i++ ) {
      ary.push( obj[i] );
    }
  } else {
    // array of single index
    ary.push( obj );
  }
  return ary;
}

// --------------------------  -------------------------- //

function defineImagesLoaded( EventEmitter, eventie ) {

  /**
   * @param {Array, Element, NodeList, String} elem
   * @param {Object or Function} options - if function, use as callback
   * @param {Function} onAlways - callback function
   */
  function ImagesLoaded( elem, options, onAlways ) {
    // coerce ImagesLoaded() without new, to be new ImagesLoaded()
    if ( !( this instanceof ImagesLoaded ) ) {
      return new ImagesLoaded( elem, options );
    }
    // use elem as selector string
    if ( typeof elem === 'string' ) {
      elem = document.querySelectorAll( elem );
    }

    this.elements = makeArray( elem );
    this.options = extend( {}, this.options );

    if ( typeof options === 'function' ) {
      onAlways = options;
    } else {
      extend( this.options, options );
    }

    if ( onAlways ) {
      this.on( 'always', onAlways );
    }

    this.getImages();

    if ( $ ) {
      // add jQuery Deferred object
      this.jqDeferred = new $.Deferred();
    }

    // HACK check async to allow time to bind listeners
    var _this = this;
    setTimeout( function() {
      _this.check();
    });
  }

  ImagesLoaded.prototype = new EventEmitter();

  ImagesLoaded.prototype.options = {};

  ImagesLoaded.prototype.getImages = function() {
    this.images = [];

    // filter & find items if we have an item selector
    for ( var i=0, len = this.elements.length; i < len; i++ ) {
      var elem = this.elements[i];
      // filter siblings
      if ( elem.nodeName === 'IMG' ) {
        this.addImage( elem );
      }
      // find children
      var childElems = elem.querySelectorAll('img');
      // concat childElems to filterFound array
      for ( var j=0, jLen = childElems.length; j < jLen; j++ ) {
        var img = childElems[j];
        this.addImage( img );
      }
    }
  };

  /**
   * @param {Image} img
   */
  ImagesLoaded.prototype.addImage = function( img ) {
    var loadingImage = new LoadingImage( img );
    this.images.push( loadingImage );
  };

  ImagesLoaded.prototype.check = function() {
    var _this = this;
    var checkedCount = 0;
    var length = this.images.length;
    this.hasAnyBroken = false;
    // complete if no images
    if ( !length ) {
      this.complete();
      return;
    }

    function onConfirm( image, message ) {
      if ( _this.options.debug && hasConsole ) {
        console.log( 'confirm', image, message );
      }

      _this.progress( image );
      checkedCount++;
      if ( checkedCount === length ) {
        _this.complete();
      }
      return true; // bind once
    }

    for ( var i=0; i < length; i++ ) {
      var loadingImage = this.images[i];
      loadingImage.on( 'confirm', onConfirm );
      loadingImage.check();
    }
  };

  ImagesLoaded.prototype.progress = function( image ) {
    this.hasAnyBroken = this.hasAnyBroken || !image.isLoaded;
    // HACK - Chrome triggers event before object properties have changed. #83
    var _this = this;
    setTimeout( function() {
      _this.emit( 'progress', _this, image );
      if ( _this.jqDeferred ) {
        _this.jqDeferred.notify( _this, image );
      }
    });
  };

  ImagesLoaded.prototype.complete = function() {
    var eventName = this.hasAnyBroken ? 'fail' : 'done';
    this.isComplete = true;
    var _this = this;
    // HACK - another setTimeout so that confirm happens after progress
    setTimeout( function() {
      _this.emit( eventName, _this );
      _this.emit( 'always', _this );
      if ( _this.jqDeferred ) {
        var jqMethod = _this.hasAnyBroken ? 'reject' : 'resolve';
        _this.jqDeferred[ jqMethod ]( _this );
      }
    });
  };

  // -------------------------- jquery -------------------------- //

  if ( $ ) {
    $.fn.imagesLoaded = function( options, callback ) {
      var instance = new ImagesLoaded( this, options, callback );
      return instance.jqDeferred.promise( $(this) );
    };
  }


  // --------------------------  -------------------------- //

  var cache = {};

  function LoadingImage( img ) {
    this.img = img;
  }

  LoadingImage.prototype = new EventEmitter();

  LoadingImage.prototype.check = function() {
    // first check cached any previous images that have same src
    var cached = cache[ this.img.src ];
    if ( cached ) {
      this.useCached( cached );
      return;
    }
    // add this to cache
    cache[ this.img.src ] = this;

    // If complete is true and browser supports natural sizes,
    // try to check for image status manually.
    if ( this.img.complete && this.img.naturalWidth !== undefined ) {
      // report based on naturalWidth
      this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );
      return;
    }

    // If none of the checks above matched, simulate loading on detached element.
    var proxyImage = this.proxyImage = new Image();
    eventie.bind( proxyImage, 'load', this );
    eventie.bind( proxyImage, 'error', this );
    proxyImage.src = this.img.src;
  };

  LoadingImage.prototype.useCached = function( cached ) {
    if ( cached.isConfirmed ) {
      this.confirm( cached.isLoaded, 'cached was confirmed' );
    } else {
      var _this = this;
      cached.on( 'confirm', function( image ) {
        _this.confirm( image.isLoaded, 'cache emitted confirmed' );
        return true; // bind once
      });
    }
  };

  LoadingImage.prototype.confirm = function( isLoaded, message ) {
    this.isConfirmed = true;
    this.isLoaded = isLoaded;
    this.emit( 'confirm', this, message );
  };

  // trigger specified handler for event type
  LoadingImage.prototype.handleEvent = function( event ) {
    var method = 'on' + event.type;
    if ( this[ method ] ) {
      this[ method ]( event );
    }
  };

  LoadingImage.prototype.onload = function() {
    this.confirm( true, 'onload' );
    this.unbindProxyEvents();
  };

  LoadingImage.prototype.onerror = function() {
    this.confirm( false, 'onerror' );
    this.unbindProxyEvents();
  };

  LoadingImage.prototype.unbindProxyEvents = function() {
    eventie.unbind( this.proxyImage, 'load', this );
    eventie.unbind( this.proxyImage, 'error', this );
  };

  // -----  ----- //

  return ImagesLoaded;
}

// -------------------------- transport -------------------------- //

if ( typeof define === 'function' && define.amd ) {
  // AMD
  define( 'imagesloaded',[
      'eventEmitter/EventEmitter',
      'eventie/eventie'
    ],
    defineImagesLoaded );
} else {
  // browser global
  window.imagesLoaded = defineImagesLoaded(
    window.EventEmitter,
    window.eventie
  );
}

})( window );

/*global setImmediate: false, setTimeout: false, console: false */
(function () {

    var async = {};

    // global on the server, window in the browser
    var root, previous_async;

    root = this;
    if (root != null) {
      previous_async = root.async;
    }

    async.noConflict = function () {
        root.async = previous_async;
        return async;
    };

    function only_once(fn) {
        var called = false;
        return function() {
            if (called) throw new Error("Callback was already called.");
            called = true;
            fn.apply(root, arguments);
        }
    }

    //// cross-browser compatiblity functions ////

    var _each = function (arr, iterator) {
        if (arr.forEach) {
            return arr.forEach(iterator);
        }
        for (var i = 0; i < arr.length; i += 1) {
            iterator(arr[i], i, arr);
        }
    };

    var _map = function (arr, iterator) {
        if (arr.map) {
            return arr.map(iterator);
        }
        var results = [];
        _each(arr, function (x, i, a) {
            results.push(iterator(x, i, a));
        });
        return results;
    };

    var _reduce = function (arr, iterator, memo) {
        if (arr.reduce) {
            return arr.reduce(iterator, memo);
        }
        _each(arr, function (x, i, a) {
            memo = iterator(memo, x, i, a);
        });
        return memo;
    };

    var _keys = function (obj) {
        if (Object.keys) {
            return Object.keys(obj);
        }
        var keys = [];
        for (var k in obj) {
            if (obj.hasOwnProperty(k)) {
                keys.push(k);
            }
        }
        return keys;
    };

    //// exported async module functions ////

    //// nextTick implementation with browser-compatible fallback ////
    if (typeof process === 'undefined' || !(process.nextTick)) {
        if (typeof setImmediate === 'function') {
            async.nextTick = function (fn) {
                // not a direct alias for IE10 compatibility
                setImmediate(fn);
            };
            async.setImmediate = async.nextTick;
        }
        else {
            async.nextTick = function (fn) {
                setTimeout(fn, 0);
            };
            async.setImmediate = async.nextTick;
        }
    }
    else {
        async.nextTick = process.nextTick;
        if (typeof setImmediate !== 'undefined') {
            async.setImmediate = setImmediate;
        }
        else {
            async.setImmediate = async.nextTick;
        }
    }

    async.each = function (arr, iterator, callback) {
        callback = callback || function () {};
        if (!arr.length) {
            return callback();
        }
        var completed = 0;
        _each(arr, function (x) {
            iterator(x, only_once(function (err) {
                if (err) {
                    callback(err);
                    callback = function () {};
                }
                else {
                    completed += 1;
                    if (completed >= arr.length) {
                        callback(null);
                    }
                }
            }));
        });
    };
    async.forEach = async.each;

    async.eachSeries = function (arr, iterator, callback) {
        callback = callback || function () {};
        if (!arr.length) {
            return callback();
        }
        var completed = 0;
        var iterate = function () {
            iterator(arr[completed], function (err) {
                if (err) {
                    callback(err);
                    callback = function () {};
                }
                else {
                    completed += 1;
                    if (completed >= arr.length) {
                        callback(null);
                    }
                    else {
                        iterate();
                    }
                }
            });
        };
        iterate();
    };
    async.forEachSeries = async.eachSeries;

    async.eachLimit = function (arr, limit, iterator, callback) {
        var fn = _eachLimit(limit);
        fn.apply(null, [arr, iterator, callback]);
    };
    async.forEachLimit = async.eachLimit;

    var _eachLimit = function (limit) {

        return function (arr, iterator, callback) {
            callback = callback || function () {};
            if (!arr.length || limit <= 0) {
                return callback();
            }
            var completed = 0;
            var started = 0;
            var running = 0;

            (function replenish () {
                if (completed >= arr.length) {
                    return callback();
                }

                while (running < limit && started < arr.length) {
                    started += 1;
                    running += 1;
                    iterator(arr[started - 1], function (err) {
                        if (err) {
                            callback(err);
                            callback = function () {};
                        }
                        else {
                            completed += 1;
                            running -= 1;
                            if (completed >= arr.length) {
                                callback();
                            }
                            else {
                                replenish();
                            }
                        }
                    });
                }
            })();
        };
    };


    var doParallel = function (fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [async.each].concat(args));
        };
    };
    var doParallelLimit = function(limit, fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [_eachLimit(limit)].concat(args));
        };
    };
    var doSeries = function (fn) {
        return function () {
            var args = Array.prototype.slice.call(arguments);
            return fn.apply(null, [async.eachSeries].concat(args));
        };
    };


    var _asyncMap = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (err, v) {
                results[x.index] = v;
                callback(err);
            });
        }, function (err) {
            callback(err, results);
        });
    };
    async.map = doParallel(_asyncMap);
    async.mapSeries = doSeries(_asyncMap);
    async.mapLimit = function (arr, limit, iterator, callback) {
        return _mapLimit(limit)(arr, iterator, callback);
    };

    var _mapLimit = function(limit) {
        return doParallelLimit(limit, _asyncMap);
    };

    // reduce only has a series version, as doing reduce in parallel won't
    // work in many situations.
    async.reduce = function (arr, memo, iterator, callback) {
        async.eachSeries(arr, function (x, callback) {
            iterator(memo, x, function (err, v) {
                memo = v;
                callback(err);
            });
        }, function (err) {
            callback(err, memo);
        });
    };
    // inject alias
    async.inject = async.reduce;
    // foldl alias
    async.foldl = async.reduce;

    async.reduceRight = function (arr, memo, iterator, callback) {
        var reversed = _map(arr, function (x) {
            return x;
        }).reverse();
        async.reduce(reversed, memo, iterator, callback);
    };
    // foldr alias
    async.foldr = async.reduceRight;

    var _filter = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (v) {
                if (v) {
                    results.push(x);
                }
                callback();
            });
        }, function (err) {
            callback(_map(results.sort(function (a, b) {
                return a.index - b.index;
            }), function (x) {
                return x.value;
            }));
        });
    };
    async.filter = doParallel(_filter);
    async.filterSeries = doSeries(_filter);
    // select alias
    async.select = async.filter;
    async.selectSeries = async.filterSeries;

    var _reject = function (eachfn, arr, iterator, callback) {
        var results = [];
        arr = _map(arr, function (x, i) {
            return {index: i, value: x};
        });
        eachfn(arr, function (x, callback) {
            iterator(x.value, function (v) {
                if (!v) {
                    results.push(x);
                }
                callback();
            });
        }, function (err) {
            callback(_map(results.sort(function (a, b) {
                return a.index - b.index;
            }), function (x) {
                return x.value;
            }));
        });
    };
    async.reject = doParallel(_reject);
    async.rejectSeries = doSeries(_reject);

    var _detect = function (eachfn, arr, iterator, main_callback) {
        eachfn(arr, function (x, callback) {
            iterator(x, function (result) {
                if (result) {
                    main_callback(x);
                    main_callback = function () {};
                }
                else {
                    callback();
                }
            });
        }, function (err) {
            main_callback();
        });
    };
    async.detect = doParallel(_detect);
    async.detectSeries = doSeries(_detect);

    async.some = function (arr, iterator, main_callback) {
        async.each(arr, function (x, callback) {
            iterator(x, function (v) {
                if (v) {
                    main_callback(true);
                    main_callback = function () {};
                }
                callback();
            });
        }, function (err) {
            main_callback(false);
        });
    };
    // any alias
    async.any = async.some;

    async.every = function (arr, iterator, main_callback) {
        async.each(arr, function (x, callback) {
            iterator(x, function (v) {
                if (!v) {
                    main_callback(false);
                    main_callback = function () {};
                }
                callback();
            });
        }, function (err) {
            main_callback(true);
        });
    };
    // all alias
    async.all = async.every;

    async.sortBy = function (arr, iterator, callback) {
        async.map(arr, function (x, callback) {
            iterator(x, function (err, criteria) {
                if (err) {
                    callback(err);
                }
                else {
                    callback(null, {value: x, criteria: criteria});
                }
            });
        }, function (err, results) {
            if (err) {
                return callback(err);
            }
            else {
                var fn = function (left, right) {
                    var a = left.criteria, b = right.criteria;
                    return a < b ? -1 : a > b ? 1 : 0;
                };
                callback(null, _map(results.sort(fn), function (x) {
                    return x.value;
                }));
            }
        });
    };

    async.auto = function (tasks, callback) {
        callback = callback || function () {};
        var keys = _keys(tasks);
        if (!keys.length) {
            return callback(null);
        }

        var results = {};

        var listeners = [];
        var addListener = function (fn) {
            listeners.unshift(fn);
        };
        var removeListener = function (fn) {
            for (var i = 0; i < listeners.length; i += 1) {
                if (listeners[i] === fn) {
                    listeners.splice(i, 1);
                    return;
                }
            }
        };
        var taskComplete = function () {
            _each(listeners.slice(0), function (fn) {
                fn();
            });
        };

        addListener(function () {
            if (_keys(results).length === keys.length) {
                callback(null, results);
                callback = function () {};
            }
        });

        _each(keys, function (k) {
            var task = (tasks[k] instanceof Function) ? [tasks[k]]: tasks[k];
            var taskCallback = function (err) {
                var args = Array.prototype.slice.call(arguments, 1);
                if (args.length <= 1) {
                    args = args[0];
                }
                if (err) {
                    var safeResults = {};
                    _each(_keys(results), function(rkey) {
                        safeResults[rkey] = results[rkey];
                    });
                    safeResults[k] = args;
                    callback(err, safeResults);
                    // stop subsequent errors hitting callback multiple times
                    callback = function () {};
                }
                else {
                    results[k] = args;
                    async.setImmediate(taskComplete);
                }
            };
            var requires = task.slice(0, Math.abs(task.length - 1)) || [];
            var ready = function () {
                return _reduce(requires, function (a, x) {
                    return (a && results.hasOwnProperty(x));
                }, true) && !results.hasOwnProperty(k);
            };
            if (ready()) {
                task[task.length - 1](taskCallback, results);
            }
            else {
                var listener = function () {
                    if (ready()) {
                        removeListener(listener);
                        task[task.length - 1](taskCallback, results);
                    }
                };
                addListener(listener);
            }
        });
    };

    async.waterfall = function (tasks, callback) {
        callback = callback || function () {};
        if (tasks.constructor !== Array) {
          var err = new Error('First argument to waterfall must be an array of functions');
          return callback(err);
        }
        if (!tasks.length) {
            return callback();
        }
        var wrapIterator = function (iterator) {
            return function (err) {
                if (err) {
                    callback.apply(null, arguments);
                    callback = function () {};
                }
                else {
                    var args = Array.prototype.slice.call(arguments, 1);
                    var next = iterator.next();
                    if (next) {
                        args.push(wrapIterator(next));
                    }
                    else {
                        args.push(callback);
                    }
                    async.setImmediate(function () {
                        iterator.apply(null, args);
                    });
                }
            };
        };
        wrapIterator(async.iterator(tasks))();
    };

    var _parallel = function(eachfn, tasks, callback) {
        callback = callback || function () {};
        if (tasks.constructor === Array) {
            eachfn.map(tasks, function (fn, callback) {
                if (fn) {
                    fn(function (err) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        if (args.length <= 1) {
                            args = args[0];
                        }
                        callback.call(null, err, args);
                    });
                }
            }, callback);
        }
        else {
            var results = {};
            eachfn.each(_keys(tasks), function (k, callback) {
                tasks[k](function (err) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    if (args.length <= 1) {
                        args = args[0];
                    }
                    results[k] = args;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };

    async.parallel = function (tasks, callback) {
        _parallel({ map: async.map, each: async.each }, tasks, callback);
    };

    async.parallelLimit = function(tasks, limit, callback) {
        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);
    };

    async.series = function (tasks, callback) {
        callback = callback || function () {};
        if (tasks.constructor === Array) {
            async.mapSeries(tasks, function (fn, callback) {
                if (fn) {
                    fn(function (err) {
                        var args = Array.prototype.slice.call(arguments, 1);
                        if (args.length <= 1) {
                            args = args[0];
                        }
                        callback.call(null, err, args);
                    });
                }
            }, callback);
        }
        else {
            var results = {};
            async.eachSeries(_keys(tasks), function (k, callback) {
                tasks[k](function (err) {
                    var args = Array.prototype.slice.call(arguments, 1);
                    if (args.length <= 1) {
                        args = args[0];
                    }
                    results[k] = args;
                    callback(err);
                });
            }, function (err) {
                callback(err, results);
            });
        }
    };

    async.iterator = function (tasks) {
        var makeCallback = function (index) {
            var fn = function () {
                if (tasks.length) {
                    tasks[index].apply(null, arguments);
                }
                return fn.next();
            };
            fn.next = function () {
                return (index < tasks.length - 1) ? makeCallback(index + 1): null;
            };
            return fn;
        };
        return makeCallback(0);
    };

    async.apply = function (fn) {
        var args = Array.prototype.slice.call(arguments, 1);
        return function () {
            return fn.apply(
                null, args.concat(Array.prototype.slice.call(arguments))
            );
        };
    };

    var _concat = function (eachfn, arr, fn, callback) {
        var r = [];
        eachfn(arr, function (x, cb) {
            fn(x, function (err, y) {
                r = r.concat(y || []);
                cb(err);
            });
        }, function (err) {
            callback(err, r);
        });
    };
    async.concat = doParallel(_concat);
    async.concatSeries = doSeries(_concat);

    async.whilst = function (test, iterator, callback) {
        if (test()) {
            iterator(function (err) {
                if (err) {
                    return callback(err);
                }
                async.whilst(test, iterator, callback);
            });
        }
        else {
            callback();
        }
    };

    async.doWhilst = function (iterator, test, callback) {
        iterator(function (err) {
            if (err) {
                return callback(err);
            }
            if (test()) {
                async.doWhilst(iterator, test, callback);
            }
            else {
                callback();
            }
        });
    };

    async.until = function (test, iterator, callback) {
        if (!test()) {
            iterator(function (err) {
                if (err) {
                    return callback(err);
                }
                async.until(test, iterator, callback);
            });
        }
        else {
            callback();
        }
    };

    async.doUntil = function (iterator, test, callback) {
        iterator(function (err) {
            if (err) {
                return callback(err);
            }
            if (!test()) {
                async.doUntil(iterator, test, callback);
            }
            else {
                callback();
            }
        });
    };

    async.queue = function (worker, concurrency) {
        if (concurrency === undefined) {
            concurrency = 1;
        }
        function _insert(q, data, pos, callback) {
          if(data.constructor !== Array) {
              data = [data];
          }
          _each(data, function(task) {
              var item = {
                  data: task,
                  callback: typeof callback === 'function' ? callback : null
              };

              if (pos) {
                q.tasks.unshift(item);
              } else {
                q.tasks.push(item);
              }

              if (q.saturated && q.tasks.length === concurrency) {
                  q.saturated();
              }
              async.setImmediate(q.process);
          });
        }

        var workers = 0;
        var q = {
            tasks: [],
            concurrency: concurrency,
            saturated: null,
            empty: null,
            drain: null,
            push: function (data, callback) {
              _insert(q, data, false, callback);
            },
            unshift: function (data, callback) {
              _insert(q, data, true, callback);
            },
            process: function () {
                if (workers < q.concurrency && q.tasks.length) {
                    var task = q.tasks.shift();
                    if (q.empty && q.tasks.length === 0) {
                        q.empty();
                    }
                    workers += 1;
                    var next = function () {
                        workers -= 1;
                        if (task.callback) {
                            task.callback.apply(task, arguments);
                        }
                        if (q.drain && q.tasks.length + workers === 0) {
                            q.drain();
                        }
                        q.process();
                    };
                    var cb = only_once(next);
                    worker(task.data, cb);
                }
            },
            length: function () {
                return q.tasks.length;
            },
            running: function () {
                return workers;
            }
        };
        return q;
    };

    async.cargo = function (worker, payload) {
        var working     = false,
            tasks       = [];

        var cargo = {
            tasks: tasks,
            payload: payload,
            saturated: null,
            empty: null,
            drain: null,
            push: function (data, callback) {
                if(data.constructor !== Array) {
                    data = [data];
                }
                _each(data, function(task) {
                    tasks.push({
                        data: task,
                        callback: typeof callback === 'function' ? callback : null
                    });
                    if (cargo.saturated && tasks.length === payload) {
                        cargo.saturated();
                    }
                });
                async.setImmediate(cargo.process);
            },
            process: function process() {
                if (working) return;
                if (tasks.length === 0) {
                    if(cargo.drain) cargo.drain();
                    return;
                }

                var ts = typeof payload === 'number'
                            ? tasks.splice(0, payload)
                            : tasks.splice(0);

                var ds = _map(ts, function (task) {
                    return task.data;
                });

                if(cargo.empty) cargo.empty();
                working = true;
                worker(ds, function () {
                    working = false;

                    var args = arguments;
                    _each(ts, function (data) {
                        if (data.callback) {
                            data.callback.apply(null, args);
                        }
                    });

                    process();
                });
            },
            length: function () {
                return tasks.length;
            },
            running: function () {
                return working;
            }
        };
        return cargo;
    };

    var _console_fn = function (name) {
        return function (fn) {
            var args = Array.prototype.slice.call(arguments, 1);
            fn.apply(null, args.concat([function (err) {
                var args = Array.prototype.slice.call(arguments, 1);
                if (typeof console !== 'undefined') {
                    if (err) {
                        if (console.error) {
                            console.error(err);
                        }
                    }
                    else if (console[name]) {
                        _each(args, function (x) {
                            console[name](x);
                        });
                    }
                }
            }]));
        };
    };
    async.log = _console_fn('log');
    async.dir = _console_fn('dir');
    /*async.info = _console_fn('info');
    async.warn = _console_fn('warn');
    async.error = _console_fn('error');*/

    async.memoize = function (fn, hasher) {
        var memo = {};
        var queues = {};
        hasher = hasher || function (x) {
            return x;
        };
        var memoized = function () {
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            var key = hasher.apply(null, args);
            if (key in memo) {
                callback.apply(null, memo[key]);
            }
            else if (key in queues) {
                queues[key].push(callback);
            }
            else {
                queues[key] = [callback];
                fn.apply(null, args.concat([function () {
                    memo[key] = arguments;
                    var q = queues[key];
                    delete queues[key];
                    for (var i = 0, l = q.length; i < l; i++) {
                      q[i].apply(null, arguments);
                    }
                }]));
            }
        };
        memoized.memo = memo;
        memoized.unmemoized = fn;
        return memoized;
    };

    async.unmemoize = function (fn) {
      return function () {
        return (fn.unmemoized || fn).apply(null, arguments);
      };
    };

    async.times = function (count, iterator, callback) {
        var counter = [];
        for (var i = 0; i < count; i++) {
            counter.push(i);
        }
        return async.map(counter, iterator, callback);
    };

    async.timesSeries = function (count, iterator, callback) {
        var counter = [];
        for (var i = 0; i < count; i++) {
            counter.push(i);
        }
        return async.mapSeries(counter, iterator, callback);
    };

    async.compose = function (/* functions... */) {
        var fns = Array.prototype.reverse.call(arguments);
        return function () {
            var that = this;
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            async.reduce(fns, args, function (newargs, fn, cb) {
                fn.apply(that, newargs.concat([function () {
                    var err = arguments[0];
                    var nextargs = Array.prototype.slice.call(arguments, 1);
                    cb(err, nextargs);
                }]))
            },
            function (err, results) {
                callback.apply(that, [err].concat(results));
            });
        };
    };

    var _applyEach = function (eachfn, fns /*args...*/) {
        var go = function () {
            var that = this;
            var args = Array.prototype.slice.call(arguments);
            var callback = args.pop();
            return eachfn(fns, function (fn, cb) {
                fn.apply(that, args.concat([cb]));
            },
            callback);
        };
        if (arguments.length > 2) {
            var args = Array.prototype.slice.call(arguments, 2);
            return go.apply(this, args);
        }
        else {
            return go;
        }
    };
    async.applyEach = doParallel(_applyEach);
    async.applyEachSeries = doSeries(_applyEach);

    async.forever = function (fn, callback) {
        function next(err) {
            if (err) {
                if (callback) {
                    return callback(err);
                }
                throw err;
            }
            fn(next);
        }
        next();
    };

    // AMD / RequireJS
    if (typeof define !== 'undefined' && define.amd) {
        define('async',[], function () {
            return async;
        });
    }
    // Node.js
    else if (typeof module !== 'undefined' && module.exports) {
        module.exports = async;
    }
    // included directly via <script> tag
    else {
        root.async = async;
    }

}());
//     Underscore.js 1.5.2
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,w=Object.keys,_=i.bind,j=function(n){return n instanceof j?n:this instanceof j?(this._wrapped=n,void 0):new j(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):n._=j,j.VERSION="1.5.2";var A=j.each=j.forEach=function(n,t,e){if(null!=n)if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a=j.keys(n),u=0,i=a.length;i>u;u++)if(t.call(e,n[a[u]],a[u],n)===r)return};j.map=j.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e.push(t.call(r,n,u,i))}),e)};var E="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=j.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(E);return r},j.reduceRight=j.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=j.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=j.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(E);return r},j.find=j.detect=function(n,t,r){var e;return O(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},j.filter=j.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&e.push(n)}),e)},j.reject=function(n,t,r){return j.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},j.every=j.all=function(n,t,e){t||(t=j.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var O=j.some=j.any=function(n,t,e){t||(t=j.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};j.contains=j.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:O(n,function(n){return n===t})},j.invoke=function(n,t){var r=o.call(arguments,2),e=j.isFunction(t);return j.map(n,function(n){return(e?t:n[t]).apply(n,r)})},j.pluck=function(n,t){return j.map(n,function(n){return n[t]})},j.where=function(n,t,r){return j.isEmpty(t)?r?void 0:[]:j[r?"find":"filter"](n,function(n){for(var r in t)if(t[r]!==n[r])return!1;return!0})},j.findWhere=function(n,t){return j.where(n,t,!0)},j.max=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);if(!t&&j.isEmpty(n))return-1/0;var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>e.computed&&(e={value:n,computed:a})}),e.value},j.min=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);if(!t&&j.isEmpty(n))return 1/0;var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a<e.computed&&(e={value:n,computed:a})}),e.value},j.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=j.random(r++),e[r-1]=e[t],e[t]=n}),e},j.sample=function(n,t,r){return arguments.length<2||r?n[j.random(n.length-1)]:j.shuffle(n).slice(0,Math.max(0,t))};var k=function(n){return j.isFunction(n)?n:function(t){return t[n]}};j.sortBy=function(n,t,r){var e=k(t);return j.pluck(j.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={},i=null==r?j.identity:k(r);return A(t,function(r,a){var o=i.call(e,r,a,t);n(u,o,r)}),u}};j.groupBy=F(function(n,t,r){(j.has(n,t)?n[t]:n[t]=[]).push(r)}),j.indexBy=F(function(n,t,r){n[t]=r}),j.countBy=F(function(n,t){j.has(n,t)?n[t]++:n[t]=1}),j.sortedIndex=function(n,t,r,e){r=null==r?j.identity:k(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;r.call(e,n[o])<u?i=o+1:a=o}return i},j.toArray=function(n){return n?j.isArray(n)?o.call(n):n.length===+n.length?j.map(n,j.identity):j.values(n):[]},j.size=function(n){return null==n?0:n.length===+n.length?n.length:j.keys(n).length},j.first=j.head=j.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},j.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},j.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},j.rest=j.tail=j.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},j.compact=function(n){return j.filter(n,j.identity)};var M=function(n,t,r){return t&&j.every(n,j.isArray)?c.apply(r,n):(A(n,function(n){j.isArray(n)||j.isArguments(n)?t?a.apply(r,n):M(n,t,r):r.push(n)}),r)};j.flatten=function(n,t){return M(n,t,[])},j.without=function(n){return j.difference(n,o.call(arguments,1))},j.uniq=j.unique=function(n,t,r,e){j.isFunction(t)&&(e=r,r=t,t=!1);var u=r?j.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:j.contains(a,r))||(a.push(r),i.push(n[e]))}),i},j.union=function(){return j.uniq(j.flatten(arguments,!0))},j.intersection=function(n){var t=o.call(arguments,1);return j.filter(j.uniq(n),function(n){return j.every(t,function(t){return j.indexOf(t,n)>=0})})},j.difference=function(n){var t=c.apply(e,o.call(arguments,1));return j.filter(n,function(n){return!j.contains(t,n)})},j.zip=function(){for(var n=j.max(j.pluck(arguments,"length").concat(0)),t=new Array(n),r=0;n>r;r++)t[r]=j.pluck(arguments,""+r);return t},j.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},j.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=j.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},j.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},j.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=new Array(e);e>u;)i[u++]=n,n+=r;return i};var R=function(){};j.bind=function(n,t){var r,e;if(_&&n.bind===_)return _.apply(n,o.call(arguments,1));if(!j.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));R.prototype=n.prototype;var u=new R;R.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},j.partial=function(n){var t=o.call(arguments,1);return function(){return n.apply(this,t.concat(o.call(arguments)))}},j.bindAll=function(n){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){n[t]=j.bind(n[t],n)}),n},j.memoize=function(n,t){var r={};return t||(t=j.identity),function(){var e=t.apply(this,arguments);return j.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},j.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},j.defer=function(n){return j.delay.apply(j,[n,1].concat(o.call(arguments,1)))},j.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var c=function(){o=r.leading===!1?0:new Date,a=null,i=n.apply(e,u)};return function(){var l=new Date;o||r.leading!==!1||(o=l);var f=t-(l-o);return e=this,u=arguments,0>=f?(clearTimeout(a),a=null,o=l,i=n.apply(e,u)):a||r.trailing===!1||(a=setTimeout(c,f)),i}},j.debounce=function(n,t,r){var e,u,i,a,o;return function(){i=this,u=arguments,a=new Date;var c=function(){var l=new Date-a;t>l?e=setTimeout(c,t-l):(e=null,r||(o=n.apply(i,u)))},l=r&&!e;return e||(e=setTimeout(c,t)),l&&(o=n.apply(i,u)),o}},j.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},j.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},j.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},j.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},j.keys=w||function(n){if(n!==Object(n))throw new TypeError("Invalid object");var t=[];for(var r in n)j.has(n,r)&&t.push(r);return t},j.values=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},j.pairs=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},j.invert=function(n){for(var t={},r=j.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},j.functions=j.methods=function(n){var t=[];for(var r in n)j.isFunction(n[r])&&t.push(r);return t.sort()},j.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},j.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},j.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)j.contains(r,u)||(t[u]=n[u]);return t},j.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]===void 0&&(n[r]=t[r])}),n},j.clone=function(n){return j.isObject(n)?j.isArray(n)?n.slice():j.extend({},n):n},j.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof j&&(n=n._wrapped),t instanceof j&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;var a=n.constructor,o=t.constructor;if(a!==o&&!(j.isFunction(a)&&a instanceof a&&j.isFunction(o)&&o instanceof o))return!1;r.push(n),e.push(t);var c=0,f=!0;if("[object Array]"==u){if(c=n.length,f=c==t.length)for(;c--&&(f=S(n[c],t[c],r,e)););}else{for(var s in n)if(j.has(n,s)&&(c++,!(f=j.has(t,s)&&S(n[s],t[s],r,e))))break;if(f){for(s in t)if(j.has(t,s)&&!c--)break;f=!c}}return r.pop(),e.pop(),f};j.isEqual=function(n,t){return S(n,t,[],[])},j.isEmpty=function(n){if(null==n)return!0;if(j.isArray(n)||j.isString(n))return 0===n.length;for(var t in n)if(j.has(n,t))return!1;return!0},j.isElement=function(n){return!(!n||1!==n.nodeType)},j.isArray=x||function(n){return"[object Array]"==l.call(n)},j.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){j["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),j.isArguments(arguments)||(j.isArguments=function(n){return!(!n||!j.has(n,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(n){return"function"==typeof n}),j.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},j.isNaN=function(n){return j.isNumber(n)&&n!=+n},j.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},j.isNull=function(n){return null===n},j.isUndefined=function(n){return n===void 0},j.has=function(n,t){return f.call(n,t)},j.noConflict=function(){return n._=t,this},j.identity=function(n){return n},j.times=function(n,t,r){for(var e=Array(Math.max(0,n)),u=0;n>u;u++)e[u]=t.call(r,u);return e},j.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=j.invert(I.escape);var T={escape:new RegExp("["+j.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(I.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(n){j[n]=function(t){return null==t?"":(""+t).replace(T[n],function(t){return I[n][t]})}}),j.result=function(n,t){if(null==n)return void 0;var r=n[t];return j.isFunction(r)?r.call(n):r},j.mixin=function(n){A(j.functions(n),function(t){var r=j[t]=n[t];j.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(j,n))}})};var N=0;j.uniqueId=function(n){var t=++N+"";return n?n+t:t},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(n,t,r){var e;r=j.defaults({},r,j.templateSettings);var u=new RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(D,function(n){return"\\"+B[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,j);var c=function(n){return e.call(this,n,j)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},j.chain=function(n){return j(n).chain()};var z=function(n){return this._chain?j(n).chain():n};j.mixin(j),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];j.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];j.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);

define("underscore", function(){});

(function(e){function m(t,n){var r;return e.Notification?r=new e.Notification(t,{icon:c(n.icon)?n.icon:n.icon.x32,body:n.body||u,tag:n.tag||u}):e.webkitNotifications?(r=e.webkitNotifications.createNotification(n.icon,t,n.body),r.show()):navigator.mozNotification?(r=navigator.mozNotification.createNotification(t,n.body,n.icon),r.show()):e.external&&e.external.msIsSiteMode()&&(e.external.msSiteModeClearIconOverlay(),e.external.msSiteModeSetIconOverlay(c(n.icon)?n.icon:n.icon.x16,t),e.external.msSiteModeActivate(),r={ieVerification:f+1}),r}function g(t){return{close:function(){t&&(t.close?t.close():e.external&&e.external.msIsSiteMode()&&t.ieVerification===f&&e.external.msSiteModeClearIconOverlay())}}}function y(t){if(!a)return;var n=l(t)?t:d;e.webkitNotifications&&e.webkitNotifications.checkPermission?e.webkitNotifications.requestPermission(n):e.Notification&&e.Notification.requestPermission&&e.Notification.requestPermission(n)}function b(){var r;if(!a)return;return e.Notification&&e.Notification.permissionLevel?r=e.Notification.permissionLevel():e.webkitNotifications&&e.webkitNotifications.checkPermission?r=i[e.webkitNotifications.checkPermission()]:navigator.mozNotification?r=n:e.Notification&&e.Notification.permission?r=e.Notification.permission:e.external&&e.external.msIsSiteMode()!==undefined&&(r=e.external.msIsSiteMode()?n:t),r}function w(e){return e&&h(e)&&p(v,e),v}function E(){return v.pageVisibility?document.hidden||document.msHidden||document.mozHidden||document.webkitHidden:!0}function S(t,r){var i,s;return a&&E()&&c(t)&&r&&(c(r.icon)||h(r.icon))&&b()===n&&(i=m(t,r)),s=g(i),v.autoClose&&i&&!i.ieVerification&&i.addEventListener&&i.addEventListener("show",function(){var t=s;e.setTimeout(function(){t.close()},v.autoClose)}),s}var t="default",n="granted",r="denied",i=[n,t,r],s={pageVisibility:!1,autoClose:0},o={},u="",a=function(){var t=!1;try{t=!!(e.Notification||e.webkitNotifications||navigator.mozNotification||e.external&&e.external.msIsSiteMode()!==undefined)}catch(n){}return t}(),f=Math.floor(Math.random()*10+1),l=function(e){return e&&e.constructor===Function},c=function(e){return e&&e.constructor===String},h=function(e){return e&&e.constructor===Object},p=function(e,t){var n,r;for(n in t){r=t[n];if(!(n in e)||e[n]!==r&&(!(n in o)||o[n]!==r))e[n]=r}return e},d=function(){},v=s;e.notify={PERMISSION_DEFAULT:t,PERMISSION_GRANTED:n,PERMISSION_DENIED:r,isSupported:a,config:w,createNotification:S,permissionLevel:b,requestPermission:y},l(Object.freeze)&&Object.freeze(e.notify)})(window);
define("notify", function(){});

/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as anonymous module.
		define('cookie',['jquery'], factory);
	} else {
		// Browser globals.
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function raw(s) {
		return s;
	}

	function decoded(s) {
		return decodeURIComponent(s.replace(pluses, ' '));
	}

	function converted(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}
		try {
			return config.json ? JSON.parse(s) : s;
		} catch(er) {}
	}

	var config = $.cookie = function (key, value, options) {

		// write
		if (value !== undefined) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setDate(t.getDate() + days);
			}

			value = config.json ? JSON.stringify(value) : String(value);

			return (document.cookie = [
				config.raw ? key : encodeURIComponent(key),
				'=',
				config.raw ? value : encodeURIComponent(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// read
		var decode = config.raw ? raw : decoded;
		var cookies = document.cookie.split('; ');
		var result = key ? undefined : {};
		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = decode(parts.join('='));

			if (key && key === name) {
				result = converted(cookie);
				break;
			}

			if (!key) {
				result[name] = converted(cookie);
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) !== undefined) {
			// Must not alter options, thus extending a fresh object...
			$.cookie(key, '', $.extend({}, options, { expires: -1 }));
			return true;
		}
		return false;
	};

}));
(function($) {
    var Quickfit, QuickfitHelper, defaults, pluginName;
    pluginName = 'quickfit';
    defaults = {
      min: 18,
      max: 20,
      tolerance: 0.02,
      truncate: true,
      width: 240,
      sample_number_of_letters: 10,
      sample_font_size: 12
    };
    QuickfitHelper = (function() {
      var shared_instance;

      shared_instance = null;

      QuickfitHelper.instance = function(options) {
        if (!shared_instance) shared_instance = new QuickfitHelper(options);
        return shared_instance;
      };

      function QuickfitHelper(options) {
        this.options = options;
        this.item = $('<span id="meassure"></span>');
        this.item.css({
          position: 'absolute',
          left: '-1000px',
          top: '-1000px',
          'font-size': "" + this.options.sample_font_size + "px"
        });
        $('body').append(this.item);
        this.meassures = {};
      }

      QuickfitHelper.prototype.get_meassure = function(letter) {
        var current_meassure;
        current_meassure = this.meassures[letter];
        if (current_meassure === void 0) {
          current_meassure = this.set_meassure(letter);
        }
        return current_meassure;
      };

      QuickfitHelper.prototype.set_meassure = function(letter) {
        var current_meassure, index, sample_letter, text, _ref;
        text = '';
        sample_letter = letter === ' ' ? '&nbsp;' : letter;
        for (index = 0, _ref = this.options.sample_number_of_letters - 1; 0 <= _ref ? index <= _ref : index >= _ref; 0 <= _ref ? index++ : index--) {
          text += sample_letter;
        }
        this.item.html(text);
        current_meassure = this.item.width() / this.options.sample_number_of_letters / this.options.sample_font_size;
        this.meassures[letter] = current_meassure;
        return current_meassure;
      };

      return QuickfitHelper;

    })();
    Quickfit = (function() {

      function Quickfit(element, options) {
        this.element = element;
        this.options = $.extend({}, defaults, options);
        this.element = $(this.element);
        this._defaults = defaults;
        this._name = pluginName;
        this.quickfit_helper = QuickfitHelper.instance(this.options);
      }

      Quickfit.prototype.fit = function() {
        var element_width;
        if (!this.options.width) {
          element_width = this.element.width();
          this.options.width = element_width - this.options.tolerance * element_width;
        }
        if (this.text = this.element.attr('data-quickfit')) {
          this.previously_truncated = true;
        } else {
          this.text = this.element.html();
        }
        this.calculate_font_size();
        if (this.options.truncate) this.truncate();
        return this.element.css('font-size', "" + this.font_size + "px");
      };

      Quickfit.prototype.calculate_font_size = function() {
        var letter, text_width, _i, _len, _ref;
        text_width = 0;
        _ref = this.text;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          letter = _ref[_i];
          text_width += this.quickfit_helper.get_meassure(letter);
        }
        this.target_font_size = parseInt(this.options.width / text_width);
        return this.font_size = Math.max(this.options.min, Math.min(this.options.max, this.target_font_size));
      };

      Quickfit.prototype.truncate = function() {
        var index, last_letter, letter, set_text, text_width;
        if (this.font_size > this.target_font_size) {
          set_text = '';
          text_width = 3 * this.quickfit_helper.get_meassure('.') * this.font_size;
          index = 0;
          while (text_width < this.options.width && index < this.text.length) {
            letter = this.text[index++];
            if (last_letter) set_text += last_letter;
            text_width += this.font_size * this.quickfit_helper.get_meassure(letter);
            last_letter = letter;
          }
          if (set_text.length + 1 === this.text.length) {
            set_text = this.text;
          } else {
            set_text += '...';
          }
          this.text_was_truncated = true;
          return this.element.attr('data-quickfit', this.text).html(set_text);
        } else {
          if (this.previously_truncated) return this.element.html(this.text);
        }
      };

      return Quickfit;

    })();
    return $.fn.quickfit = function(options) {
      return this.each(function() {
        return new Quickfit(this, options).fit();
      });
    };
  })(jQuery, window);
define("quickfit", function(){});

define('api',[
	'jquery',
    //Helpers
    'underscore', 'notify', 'cookie', 'quickfit',
], function($){

	var last_update = 0;

	var countData = function(data) {
		var c = 0, l = data.paths.length;

		while(l--)
			c += data.paths[l].movies.length + data.paths[l].albums.length + data.paths[l].others.length;
		
		return c;
	}

	var api = {
		interval: null,
		files: function(cb) {
			var self = this, url = '/api/'+user.id+'/files';

        	if(last_update !== 0) {
        		url = url + '?t=' + last_update;
			}

            jQuery.getJSON( url
                , function( data, textStatus ) {
                    
                    if(data) {

                        if(countData(data)) {
                            self.desktop.append(data.paths);
                            last_update = Date.now();
                        } else {
                            console.log('Aucuns fichiers trouvés');
                        }

                    } else {
                        console.error(textStatus, data);
                    }

                    return typeof cb == 'function' ? cb(null, data) : true;

            });
		},
		size: function() {

			jQuery.getJSON( '/api/'+user.id+'/size', function(size) {

				if(size) {
			        $('#diskSpace #usedBar').css('width', size.percent);
			        $('#diskSpace .used').text(size.pretty);
			        $('#diskSpace .left').text(' / ' + size.left)
				} else
					console.error('No size');		    
			});

		},
		fetchRemove: function(cb) {
			var self = this;

			jQuery.getJSON( '/api/'+user.id+'/files/to_remove', function(to_remove) {

				self.desktop.remove(to_remove);

				return typeof cb == 'function' ? cb(null, to_remove) : true;

			});
		},
		setInterval: function() {
			var self = this;
			
			self.interval = setInterval(function() {
				clearInterval(self.interval);

				self.fetchRemove(function(err, to_remove) {
					self.files(function() {
						self.setInterval();
					});
				});
				
			}, config.fetchTime)
		},
		init: function(Desktop) {
			var self = this;

			this.desktop = Desktop;
			this.size();
			this.files(function() {
				self.setInterval();
			});

		}
	};

	return api;
});


/*! alertify - v0.3.11 - 2013-10-08 */
!function(a,b){var c,d=a.document;c=function(){var c,e,f,g,h,i,j,k,l,m,n,o,p,q={},r={},s=!1,t={ENTER:13,ESC:27,SPACE:32},u=[];return r={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},p=function(){var a,c,e=!1,f=d.createElement("fakeelement"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(a in g)if(f.style[a]!==b){c=g[a],e=!0;break}return{type:c,supported:e}},c=function(a){return d.getElementById(a)},q={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:b,addListeners:function(a){var b,c,i,j,k,l="undefined"!=typeof f,m="undefined"!=typeof e,n="undefined"!=typeof o,p="",q=this;b=function(b){return"undefined"!=typeof b.preventDefault&&b.preventDefault(),i(b),"undefined"!=typeof o&&(p=o.value),"function"==typeof a&&("undefined"!=typeof o?a(!0,p):a(!0)),!1},c=function(b){return"undefined"!=typeof b.preventDefault&&b.preventDefault(),i(b),"function"==typeof a&&a(!1),!1},i=function(){q.hide(),q.unbind(d.body,"keyup",j),q.unbind(g,"focus",k),l&&q.unbind(f,"click",b),m&&q.unbind(e,"click",c)},j=function(a){var d=a.keyCode;(d===t.SPACE&&!n||n&&d===t.ENTER)&&b(a),d===t.ESC&&m&&c(a)},k=function(){n?o.focus():!m||q.buttonReverse?f.focus():e.focus()},this.bind(g,"focus",k),this.bind(h,"focus",k),l&&this.bind(f,"click",b),m&&this.bind(e,"click",c),this.bind(d.body,"keyup",j),this.transition.supported||this.setFocus()},bind:function(a,b,c){"function"==typeof a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},handleErrors:function(){if("undefined"!=typeof a.onerror){var b=this;return a.onerror=function(a,c,d){b.error("["+a+" on line "+d+" of "+c+"]",0)},!0}return!1},appendButtons:function(a,b){return this.buttonReverse?b+a:a+b},build:function(a){var b="",c=a.type,d=a.message,e=a.cssClass||"";switch(b+='<div class="alertify-dialog">',b+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===q.buttonFocus&&(b+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===c&&(b+='<div id="alertify-form">'),b+='<article class="alertify-inner">',b+=r.message.replace("{{message}}",d),"prompt"===c&&(b+=r.input),b+=r.buttons.holder,b+="</article>","prompt"===c&&(b+="</div>"),b+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',b+="</div>",c){case"confirm":b=b.replace("{{buttons}}",this.appendButtons(r.buttons.cancel,r.buttons.ok)),b=b.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":b=b.replace("{{buttons}}",this.appendButtons(r.buttons.cancel,r.buttons.submit)),b=b.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":b=b.replace("{{buttons}}",r.buttons.ok),b=b.replace("{{ok}}",this.labels.ok)}return l.className="alertify alertify-"+c+" "+e,k.className="alertify-cover",b},close:function(a,b){var c,d,e=b&&!isNaN(b)?+b:this.delay,f=this;this.bind(a,"click",function(){c(a)}),d=function(a){a.stopPropagation(),f.unbind(this,f.transition.type,d),m.removeChild(this),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")},c=function(a){"undefined"!=typeof a&&a.parentNode===m&&(f.transition.supported?(f.bind(a,f.transition.type,d),a.className+=" alertify-log-hide"):(m.removeChild(a),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")))},0!==b&&setTimeout(function(){c(a)},e)},dialog:function(a,b,c,e,f){j=d.activeElement;var g=function(){m&&null!==m.scrollTop&&k&&null!==k.scrollTop||g()};if("string"!=typeof a)throw new Error("message must be a string");if("string"!=typeof b)throw new Error("type must be a string");if("undefined"!=typeof c&&"function"!=typeof c)throw new Error("fn must be a function");return this.init(),g(),u.push({type:b,message:a,callback:c,placeholder:e,cssClass:f}),s||this.setup(),this},extend:function(a){if("string"!=typeof a)throw new Error("extend method must have exactly one paramter");return function(b,c){return this.log(b,a,c),this}},hide:function(){var a,b=this;u.splice(0,1),u.length>0?this.setup(!0):(s=!1,a=function(c){c.stopPropagation(),b.unbind(l,b.transition.type,a)},this.transition.supported?(this.bind(l,this.transition.type,a),l.className="alertify alertify-hide alertify-hidden"):l.className="alertify alertify-hide alertify-hidden alertify-isHidden",k.className="alertify-cover alertify-cover-hidden",j.focus())},init:function(){d.createElement("nav"),d.createElement("article"),d.createElement("section"),null==c("alertify-cover")&&(k=d.createElement("div"),k.setAttribute("id","alertify-cover"),k.className="alertify-cover alertify-cover-hidden",d.body.appendChild(k)),null==c("alertify")&&(s=!1,u=[],l=d.createElement("section"),l.setAttribute("id","alertify"),l.className="alertify alertify-hidden",d.body.appendChild(l)),null==c("alertify-logs")&&(m=d.createElement("section"),m.setAttribute("id","alertify-logs"),m.className="alertify-logs alertify-logs-hidden",d.body.appendChild(m)),d.body.setAttribute("tabindex","0"),this.transition=p()},log:function(a,b,c){var d=function(){m&&null!==m.scrollTop||d()};return this.init(),d(),m.className="alertify-logs",this.notify(a,b,c),this},notify:function(a,b,c){var e=d.createElement("article");e.className="alertify-log"+("string"==typeof b&&""!==b?" alertify-log-"+b:""),e.innerHTML=a,m.appendChild(e),setTimeout(function(){e.className=e.className+" alertify-log-show"},50),this.close(e,c)},set:function(a){var b;if("object"!=typeof a&&a instanceof Array)throw new Error("args must be an object");for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},setFocus:function(){o?(o.focus(),o.select()):i.focus()},setup:function(a){var d,j=u[0],k=this;s=!0,d=function(a){a.stopPropagation(),k.setFocus(),k.unbind(l,k.transition.type,d)},this.transition.supported&&!a&&this.bind(l,this.transition.type,d),l.innerHTML=this.build(j),g=c("alertify-resetFocus"),h=c("alertify-resetFocusBack"),f=c("alertify-ok")||b,e=c("alertify-cancel")||b,i="cancel"===q.buttonFocus?e:"none"===q.buttonFocus?c("alertify-noneFocus"):f,o=c("alertify-text")||b,n=c("alertify-form")||b,"string"==typeof j.placeholder&&""!==j.placeholder&&(o.value=j.placeholder),a&&this.setFocus(),this.addListeners(j.callback)},unbind:function(a,b,c){"function"==typeof a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}},{alert:function(a,b,c){return q.dialog(a,"alert",b,"",c),this},confirm:function(a,b,c){return q.dialog(a,"confirm",b,"",c),this},extend:q.extend,init:q.init,log:function(a,b,c){return q.log(a,b,c),this},prompt:function(a,b,c,d){return q.dialog(a,"prompt",b,c,d),this},success:function(a,b){return q.log(a,"success",b),this},error:function(a,b){return q.log(a,"error",b),this},set:function(a){q.set(a)},labels:q.labels,debug:q.handleErrors}},"function"==typeof define?define('alertify',[],function(){return new c}):"undefined"==typeof a.alertify&&(a.alertify=new c)}(this);
define('desktop',[
    //templates
    'text!../views/albums.ejs',
    'text!../views/movies.ejs',
    'text!../views/others.ejs',

    //Modules
    'packery/packery',
    'imagesloaded',
    'async',
    'jquery',
    'api',
    'alertify',

    //Helpers
    'underscore', 'cookie', 'quickfit',


], function(Albums, Movies, Others, Packery, imagesLoaded, async, $, api, alertify){

    //Expression to search case insensitive
    $.expr[":"].contains = $.expr.createPseudo(function(arg) {
        return function( elem ) {
            return $(elem).text().toLowerCase().indexOf(arg.toLowerCase()) >= 0;
        };
    });

    //Expression to search for first letter
    $.expr[':'].startsWith = $.expr.createPseudo(function(arg) {
        return function( elem ) {
            return $(elem).text().replace(/\s+/g, '').charAt(0).toUpperCase() == arg.toUpperCase();
        };
    });

    $.expr[':'].match = $.expr.createPseudo(function(arg) {
        return function( elem ) {
            var c = $(elem).text().replace(/\s+/g, '').charAt(0);
            return c.match( new RegExp( arg, 'ig' ) ); 
        };
    });

    var Desktop = {
        firstLoad : true,
        $container : $('section#desktop'), //Elements container
        itemSelector : '.element',
        displaySelector : null,
        //Packery Instance
        pckry : null,
        hasLayout : false,
        //Socket
        socket : null,
        hasLayout : function() {},
        alphabet : {'A':0,'B':0,'C':0,'D':0,'E':0,'F':0,'G':0,'H':0,'I':0,'J':0,'K':0,'L':0,'M':0,'N':0,'O':0,'P':0,'Q':0,'R':0,'S':0,'T':0,'U':0,'V':0,'W':0,'X':0,'Y':0,'Z':0,'#':0},
        loader : function() {
            var $loader = $('#loader');
            
            if($loader.is(':visible'))
                $loader.fadeOut();
            else 
                $loader.fadeIn();
        },
        showNotification : function(params) {
            // notify.createNotification(params.title, {body : params.text, icon: '/images/planetetrans.png', tag:params.tag, timeout:2500});
        },
        init : function() {
            var self = this;

            if(self.pckry === null && isDesktop == true) {
                self.pckry = new Packery( 
                    document.querySelector('section#desktop'),
                    {
                        itemSelector: '.element',
                        transitionDuration: "0"
                        // columnWidth: $('.grid-sizer').width(),
                    }
                );
            }

            if(self.socket === null)
                self.socket = io.connect('wss://'+document.domain+':3001');

            if(user && isDesktop) {
                api.init(self);
            }


            //hash
//            self.toRemove = window.location.hash.substr(1);
//            
            return self;
        },
        template : function(View, datas) {

            var bytesToSize = function bytesToSize(bytes) {
                var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                if (bytes == 0) return 'n/a';
                var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
                if (i == 0) return bytes + ' ' + sizes[i]; 
                return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
            };

            return _.template(View, _.extend(datas, {bytesToSize : bytesToSize}));
        },
        //Rendering methods
        render : {
            files : function(paths, callback) {
                var render = this;

                async.map(paths, render.path, function(err, results){

                    //Merging results
                    var i = results.length - 1, html = "";

                    do {
                        if(results[i])
                            html += results[i].movies + results[i].albums + results[i].others;
                    } while(i--)

                    callback(err, html);
                });
                
            }, 
            path : function(path, cb) {

                async.parallel({
                    movies : function(callback) 
                    {
                        if(path.movies.length) {

                            //parse each path + search dom id and remove it :p
                            path.movies.forEach(function(movie) {

                                var $el = $(Desktop.itemSelector + '[data-id="' + movie._id + '"]');

                                //Cheating...
                                if($el.length)
                                    Desktop.pckry.remove($el);

                            });

                            callback(null, Desktop.template(Movies, {movies : path.movies}));
                        } else
                            callback(null, '');
                    },
                    albums : function(callback) 
                    {
                        if(path.albums.length) {
                            callback(null, Desktop.template(Albums, {albums : path.albums}));
                        } else
                            callback(null, '');

                    },
                    others : function(callback) 
                    {
                        if(path.others.length) {
                            callback(null, Desktop.template(Others, {others : path.others}));
                        } else 
                            callback(null, '');

                    }
                },
                //Callback Paths
                function(err, results){
                    cb(err, results);
                });
            }
        },
        remove: function(to_remove) {
            var self = this
              , removed = [];

            if(to_remove.length) {
                _.each(to_remove, function(r) {
                    var $item = $(self.itemSelector + '[data-id="' + r.item + '"]'), $el = $item.find('tr[data-id="' + r.file + '"]');

                    if($el.length) {
                        removed.push($el.find('td.file_name').text());

                        if($el.closest('tbody').find('tr').length == 1) {
                            self.pckry.remove($item);
                            $el.remove();
                        } else 
                            $el.remove();

                    } else {
                        removed.push($item.find('h1:first').text());
                        self.pckry.remove($item);
                    }
                });

                if(removed.length == 1)
                    alertify.log(removed[0]+' a été supprimé');
                else
                    alertify.log(removed.length + " fichiers supprimés");

                self.layout();
            }
        },
        append : function(datas) {

            var self = this;

            // if(!self.firstLoad)
            
            self.loader();

            var displayOption = $.cookie('display') === undefined ? '.list' : $.cookie('display');

            $('#displayFilters li').each(function(i, e) { 
                $(e).attr('data-display', displayOption); 
            });
            
            self.render.files(datas, function(err, html) {
                if(err)
                    console.error(err);

                if(html.length > 0) {

                    var $items = $.parseHTML(html), $els = [];

                    _.each($items, function(e) {
                        var isTxt = e instanceof Text; //parseHTML causes element duplicated

                        if(!isTxt)
                            $els.push(e);
                        
                    });

                    $items = $els;
                    delete $els;

                    $items.sort(function (a, b) {
                        a = $(a), b = $(b); //jquerying -"-
                        if (a.data('date-added') == b.data('date-added')) {
                            return 0;
                        } else if (a.data('date-added') < b.data('date-added')) {
                            return 1;
                        }
                        return -1;
                    });

                    if(self.firstLoad) {
                        self.$container.addClass('notransition').css('visibility', 'hidden').append($items);

                        self.pckry.appended($items);
                    } else {
                        self.$container.addClass('notransition').css('visibility', 'hidden').prepend($items);

                        self.pckry.prepended($items);
                    }

                    self.displaySelector = displayOption;

                    self.layout(displayOption, function() { 
                        // self.loader();

                        if(self.firstLoad) {
                            self.firstLoad = false;
                        } else {
                            var count = 0, els = [];

                            _.each($items, function(e) {
                                    if($(e).hasClass('list'))
                                        els.push($(e).find('h1').text());
                            });

                            count = els.length;

                            self.loader();

                            if(count == 1) {
                                alertify.log(els[0] + ' a été ajouté');
                                //self.showNotification({title: 'Fichier ajouté',text: titre + ' ajouté !'});
                            } else if(count != 0) {
                                alertify.log(count + ' élements ajoutés');
                                //self.showNotification({title: 'Fichiers ajoutés',text: count + ' fichiers ajoutés'});
                            }
                        }

                        self.$container.removeClass('notransition').css('visibility', 'visible');

                    });
                }
            });
        },
        countElementsByLetter : function() {
            var self = this, $els = self.$container.find(self.itemSelector + '.list');

            $els.each(function(i, e) {
                var firstLetter = $(this).find('h1').text().charAt(0).toUpperCase();

                if(firstLetter.match(/\d/g))
                    firstLetter = '#';

                self.alphabet[firstLetter]++;
            });

        },
        layoutThumbnails: function(cb) {
            var self = this;
            
            $(self.itemSelector).css('display', 'none');
            
            $(self.itemSelector + '.miniature').each(function() {
                $(this).css('display', 'block');
            });

            $(self.itemSelector + '.miniature').css('visibility', 'hidden');

            var miniatures = document.querySelector('#' + self.$container.attr('id') + ' .miniature');
              //Hiding miniatures

            if(miniatures) {
                
                imagesLoaded(
                    miniatures, 
                function() {

                    $(self.itemSelector + '.miniature h1').quickfit();
                    $(self.itemSelector + '.miniature').css('visibility', 'visible');
                    
                    
                    self.pckry._isLayoutInited = false;
                    self.pckry.layout();

                    self.countElementsByLetter();

                    self.hasLayout();

                    if(typeof cb == 'function')
                        cb();

                });
            }
        },
        layout : function(selector, cb) {
            var self = this;

            selector = selector ? selector : self.displaySelector;

            self.displaySelector = selector;

            if(selector == '.miniature') {
                self.layoutThumbnails(cb);
            } else {

                $(self.itemSelector).css('display', 'none');

                $(self.itemSelector + selector).each(function() {
                    $(this).css('display', 'block');
                });

                self.pckry.layout();
             
                self.countElementsByLetter();

                self.hasLayout();
                if(typeof cb == 'function')
                    cb();
            }
               
        }


    };//Desktop ends

    return Desktop.init();

});
define('theme',[
    'jquery', 'desktop', 'alertify', 'underscore'
], function($, Desktop, alertify){

    $section = Desktop.$container;

    //Some middlewares
    $('.select-on-click').on('click', function(e) { $(this).select(); });

    $('#alert .entypo-cross').on('click', function(e) { $(this).parent().empty(); });

    $(window).load(function() {

        var allowed = notify.permissionLevel();

        switch(allowed) {
            case notify.PERMISSION_DEFAULT:
                //Ask for notify permissions
                $('#alert').append('<p class="warning"><i class="entypo-warning"></i> <a href="#" class="allow-notify">Cliquez ici pour activer les notifications de bureau.</a></p>');
            break;
            // case notify.PERMISSION_GRANTED:

            // break;
            case notify.PERMISSION_DENIED:
            //kaput

            break;
        }
        var $msg = $('#alert').find('.msg');

        if($msg.length) {
            if($msg.hasClass('error'))
                alertify.error($msg.text());
            else if($msg.hasClass('success'))
                alertify.success($msg.text());
            else
                alertify.log($msg.text());
        }

    }).on('scroll', function() {
        var scrollTop = $('body').scrollTop() || $('html').scrollTop();
        if ( scrollTop > $('header').height() + 7 )
            onTopScroll();
        else
            onTopScroll(false);
        
    });

    $('body').on('click', '.delete-item', function(e) {
        e.preventDefault();

        var href =  $(this).attr('href');

        alertify.confirm("Attention cette fonction ne supprime pas le torrent, il est conseillé de supprimer torrent et données depuis votre client ! Êtes-vous sûr de vouloir effectuer cette action ?", function (e) {
            if (e) {
                $.get(href, function(d) {
                    Desktop.remove(d.id, false);
                }, 'json');
            } else {
                return false;
            }
        });

    });

    $('body').on('click', '.reset-db', function(e) {
        e.preventDefault();

        var href =  $(this).attr('href');

        alertify.confirm("Cette fonction réindexe la base de données des fichiers ! L'opération peut-être longue ! Êtes-vous sûr de vouloir effectuer cette action ?", function (e) {
            if (e)
                window.location = href;
            else {
                return false;
            }
        });
    });

    $('body').on('click', '.allow-notify', function() {
        notify.requestPermission(function() {
            $('#alert').empty();
        });
    });

    $('body').on('click', '.reset-item', function(e) {
        var $el = $(this).closest('.element'), id = $el.attr('data-id'), type = $(this).attr('data-type');

        $.get('/reset/'+type+'/'+id , function( ) {
            Desktop.remove(id, false);
        }, 'json');
    });


    var toTop = function(veryTop) {
        var veryTop = veryTop === undefined ? false : veryTop;
        var scrollTop = $('body').scrollTop() || $('html').scrollTop();

        if ( scrollTop > $('header').height() + 7) {

            if(veryTop !== true)
                $('body, html').animate({'scrollTop':$('header').height() + 10});
            else
                $('body, html').animate({'scrollTop':0});
        }
    }


    var onTopScroll = function(onTop) {
        var onTop = onTop === undefined ? true : onTop;

        if(onTop) 
        {
            if(!$('nav#display').hasClass('fixed')) {
                $('nav#display').addClass('fixed').css('opacity', '0.7');
                $section.css('marginTop', '80px');
                $('#toTop').stop().animate({'opacity':'0.8'});
            }
        } else 
        {
            $('nav#display').removeClass('fixed').css('opacity', '1');   
            $section.css('marginTop', '20px');
            $('#toTop').stop().animate({'opacity':'0'});
        }

    }

    $('#toTop').on('click', function(e) {
        toTop(true);
    });

      $('body').on('click', '.showFiles', function() {
        $button = $(this);
        
        if($button.data('text') === undefined)
            $button.data('text', $button.text());

        $files = $(this).next('.files');
        $element = $(this).parent();

        var margin = $files.height() + 20;

        if($files.hasClass('open')) {
            
            $button.html('<i class="entypo-attach"></i>'+$button.data('text'));
            
            $element.toggleClass('notransition').css({'margin-bottom':'20px'});

            $files.css({'visibility':'hidden', 'opacity':'0'});

            Desktop.layout(null, function() {
               $element.toggleClass('notransition');
            });

        } else {
            $button.html('<i class="entypo-attach"></i>Cacher');
    
            $element.toggleClass('notransition').css({'margin-bottom':'+'+margin+'px'});

            Desktop.layout(null, function() {
                $files.css({'top': $element.height() + 20 + 'px', 'visibility': 'visible', 'opacity': 1});
                $element.toggleClass('notransition');
            });
           
        }

        $files.toggleClass('open');
    });

    $('body').on({
        mouseenter : function() {
            $(this).css('opacity', '1');
        },
        mouseleave : function() {
            $(this).css('opacity', '0.7');
        }
    },'nav#display.fixed');

   

    /** Search **/

    $('#search input').on('keyup', function(e) {
        toTop();

        var filter = '', display = $('#displayFilters li:first-child').attr('data-display');

        if($('#displayFilters li.active').length)
            filter = $('#displayFilters li.active').attr('data-filter');

        if($(this).val().length > 2) {
            var matches = $section.find(Desktop.itemSelector + ':contains("'+$(this).val()+'")');
            
            matches.each(function(i, e) {
                if(!$(e).hasClass('highlight')) {
                    var id = $(e).attr('data-id');

                    $section.find(Desktop.itemSelector + '[data-id="'+id+'"]').addClass('highlight');
                }
            });

           Desktop.layout(display+filter+'.highlight');

        } else {
            $section.find('.highlight').toggleClass('highlight');
            Desktop.layout(display+filter);
        }
    });


    /** Filter Methods **/

    $('body').on('click', '#displayFilters li', function(){

        toTop();

        if(!$(this).hasClass('active')) { 
            var selector = $(this).attr('data-filter');
            var display = $(this).attr('data-display');

            $('#displayFilters li.active').removeClass('active');

            $(this).addClass('active');
            
            Desktop.layout(display + selector);
        
        } else {
            $(this).removeClass('active');
            Desktop.layout($(this).attr('data-display'));
        }    
        return false;
    });

    $('body').on('click', '#displayOptions i', function() {
        var selector = $(this).attr('data-filter'), display="";


        if(!$(this).hasClass('active')) {

            $(this).parent().find('.active').removeClass('active');

            $(this).addClass('active');

            $.cookie('display', selector);

            toTop();

            if($('#displayFilters li.active').length)
                display = $('#displayFilters li.active').attr('data-filter');

            Desktop.layout(selector + display);

            $('#displayFilters li').each(function() {
                $(this).attr('data-display', selector);
            });
        }

        return false;
    });

    /**
     * Extends Desktop
     * Called when packery desktop has Layout
     */
    Desktop = _.extend(Desktop, {
        hasLayout : function() {
            var maxPercent = 150, minPercent = 100, min = 0, max = 0;

            _.each(Desktop.alphabet, function(e) {
                max = (e > max ? e : max);
                min = (min > e ? e : min);
            });

            var multiplier = (maxPercent-minPercent)/(max-min);

            $('#alpha-nav li a').each(function(i, e) {
                var letter = $(this).attr('href').substr(1), nb = Desktop.alphabet[letter];

                if(parseInt(nb) !== NaN) {
                    var size = minPercent + ((max-(max-(nb-min)))*multiplier) + '%';

                    $(this).css('font-size',size);
                }
            });
        }
    });

    /**
     * Filters on first letter
     */
    $('#alpha-nav li a').on('click', function(e) {
        e.preventDefault();

        toTop();

        var $letter = $(this)
          , letter = $(this).parent().hasClass('active') ? '' : $letter.attr('href').substr(1);
        
        $section.find('.startsWith').toggleClass('startsWith');

        $(this).closest('ul').find('li.active').removeClass('active');

        var filter = '', display = $('#displayFilters li:first-child').attr('data-display');

        if($('#displayFilters li.active').length)
            filter = $('#displayFilters li.active').attr('data-filter');

        if(letter.length || letter === '#') {

            var matches;

            if(letter == '#')
                matches = $section.find(Desktop.itemSelector + ':match("\\d+")');
            else
                matches = $section.find(Desktop.itemSelector + ':startsWith("'+letter+'")');


            matches.each(function(i, e) {
                if(!$(e).hasClass('startsWith')) {
                    var id = $(e).attr('data-id');

                    $section.find(Desktop.itemSelector + '[data-id="'+id+'"]').addClass('startsWith');
                }
            });

            Desktop.layout(display+filter+'.startsWith', function() {
                $letter.parent().addClass('active');
            });
        } else {
            Desktop.layout(display+filter);
        }
    });

    var socket = Desktop.socket;

    // socket.on('size', function(size) {
    //     $('#diskSpace #usedBar').css('width', size.percent);
    //     $('#diskSpace .used').text(size.pretty);
    //     $('#diskSpace .left').text(' / ' + size.left)
    // });

    var waitForDownloadTimeout;

    socket.on('compressing', function(data) {
        
        // data.done
        var $el = $('.element.list[data-id='+data.id +']'),
        $archiving =  $('#archiving'),
        size = $el.find('a.archive').attr('data-full-size');

        var percentDone = (parseInt(data.done) / parseInt(size)) * 100; 

        percentDone = Math.round(percentDone * 100) / 100;

        percentDone = (percentDone < 100) ? percentDone : 100;

        if(percentDone == 100 && waitForDownloadTimeout == undefined)
            waitForDownloadTimeout = setTimeout(
                $archiving.find('.progress').text('En attente...')
            , 750);

        $archiving.find('.percent').text(percentDone+ '%');
        $archiving.find('.progress').css('width', percentDone+ '%');
    });
    

    //Archive through ajax
    $section.on('click', '.archive', function(e) {
        e.preventDefault();

        var $el = $(this).closest('.element'),
        id = $el.attr('data-id'),
        titre = $el.find('h1').text(),
        $archiving = $('#archiving');
        
        socket.emit('archive', id);

        $archiving.find('.name').text(titre);

        $archiving.show();

        $(window).bind('beforeunload', function() {
            return 'Une compression est en cours';
        });

        $.get($(this).attr('href'), function(res) {
            if(res.error == null) {
                $(window).unbind('beforeunload');
                window.location.href = '/download/archive/'+id;
                $archiving.find('.percent').text('Téléchargement en cours...');
                $archiving.find('.progress').css('width', '100%');

                //todo show err
                setTimeout(function() {
                    $archiving.fadeOut('800');
                    $archiving.find('.percent').delay('800').text('0%');
                }, 3000);
            } else {
                $archiving.find('.percent').text(res.error);
                $archiving.find('.progress').css('width', '100%');
                console.log(res.error);
            }

        }, 'json');
    });

});
/*
 * Collapse plugin for jQuery
 * --
 * source: http://github.com/danielstocks/jQuery-Collapse/
 * site: http://webcloud.se/jQuery-Collapse
 *
 * @author Daniel Stocks (http://webcloud.se)
 * Copyright 2013, Daniel Stocks
 * Released under the MIT, BSD, and GPL Licenses.
 */

(function($) {

  // Constructor
  function Collapse (el, options) {
    options = options || {};
    var _this = this,
      query = options.query || "> :even";

    $.extend(_this, {
      $el: el,
      options : options,
      sections: [],
      isAccordion : options.accordion || false,
      db : options.persist ? jQueryCollapseStorage(el[0].id) : false
    });

    // Figure out what sections are open if storage is used
    _this.states = _this.db ? _this.db.read() : [];

    // For every pair of elements in given
    // element, create a section
    _this.$el.find(query).each(function() {
      var section = new Section($(this), _this);
      _this.sections.push(section);

      // Check current state of section
      var state = _this.states[section._index()];
      if(state === 0) {
        section.$summary.removeClass("open");
      }
      if(state === 1) {
        section.$summary.addClass("open");
      }

      // Show or hide accordingly
      if(section.$summary.hasClass("open")) {
        section.open(true);
      }
      else {
        section.close(true);
      }
    });

    // Capute ALL the clicks!
    (function(scope) {
      _this.$el.on("click", "[data-collapse-summary]",
        $.proxy(_this.handleClick, scope));
    }(_this));
  }

  Collapse.prototype = {
    handleClick: function(e) {
      e.preventDefault();
      var sections = this.sections,
        l = sections.length;
      while(l--) {
        if($.contains(sections[l].$summary[0], e.target)) {
          sections[l].toggle();
          break;
        }
      }
    },
    open : function(eq) {
      if(isFinite(eq)) return this.sections[eq].open();
      $.each(this.sections, function() {
        this.open();
      });
    },
    close: function(eq) {
      if(isFinite(eq)) return this.sections[eq].close();
      $.each(this.sections, function() {
        this.close();
      });
    }
  };

  // Section constructor
  function Section($el, parent) {
    $.extend(this, {
      isOpen : false,
      $summary : $el
        .attr("data-collapse-summary", "")
        .wrapInner('<a href="#"/>'),
      $details : $el.next(),
      options: parent.options,
      parent: parent
    });
  }

  Section.prototype = {
    toggle : function() {
      if(this.isOpen) this.close();
      else this.open();
    },
    close: function(bypass) {
      this._changeState("close", bypass);
    },
    open: function(bypass) {
      var _this = this;
      if(_this.options.accordion && !bypass) {
        $.each(_this.parent.sections, function() {
          this.close();
        });
      }
      _this._changeState("open", bypass);
    },
    _index: function() {
      return $.inArray(this, this.parent.sections);
    },
    _changeState: function(state, bypass) {

      var _this = this;
      _this.isOpen = state == "open";
      if($.isFunction(_this.options[state]) && !bypass) {
        _this.options[state].apply(_this.$details);
      } else {
        if(_this.isOpen) _this.$details.show();
        else _this.$details.hide();
      }
      _this.$summary.removeClass("open close").addClass(state);
      _this.$details.attr("aria-hidden", state == "close");
      _this.parent.$el.trigger(state, _this);
      if(_this.parent.db) {
        _this.parent.db.write(_this._index(), _this.isOpen);
      }
    }
  };

  // Expose in jQuery API
  $.fn.extend({
    collapse: function(options, scan) {
      var nodes = (scan) ? $("body").find("[data-collapse]") : $(this);
      return nodes.each(function() {
        var settings = (scan) ? {} : options,
          values = $(this).attr("data-collapse") || "";
        $.each(values.split(" "), function(i,v) {
          if(v) settings[v] = true;
        });
        new Collapse($(this), settings);
      });
    }
  });

  //jQuery DOM Ready
  $(function() {
    $.fn.collapse(false, true);
  });

  // Expose constructor to
  // global namespace
  jQueryCollapse = Collapse;

})(window.jQuery);

define("collapse", function(){});

/*
 * Storage for jQuery Collapse
 * --
 * source: http://github.com/danielstocks/jQuery-Collapse/
 * site: http://webcloud.se/jQuery-Collapse
 *
 * @author Daniel Stocks (http://webcloud.se)
 * Copyright 2013, Daniel Stocks
 * Released under the MIT, BSD, and GPL Licenses.
 */

(function($) {

  var STORAGE_KEY = "jQuery-Collapse";

  function Storage(id) {
    var DB;
    try {
      DB = window.localStorage || $.fn.collapse.cookieStorage;
    } catch(e) {
      DB = false;
    }
    return DB ? new _Storage(id, DB) : false;
  }
  function _Storage(id, DB) {
    this.id = id;
    this.db = DB;
    this.data = [];
  }
  _Storage.prototype = {
    write: function(position, state) {
      var _this = this;
      _this.data[position] = state ? 1 : 0;
      // Pad out data array with zero values
      $.each(_this.data, function(i) {
        if(typeof _this.data[i] == 'undefined') {
          _this.data[i] = 0;
        }
      });
      var obj = this.getDataObject();
      obj[this.id] = this.data;
      this.db.setItem(STORAGE_KEY, JSON.stringify(obj));
    },
    read: function() {
      var obj = this.getDataObject();
      return obj[this.id] || [];
    },
    getDataObject: function() {
      var string = this.db.getItem(STORAGE_KEY);
      return string ? JSON.parse(string) : {};
    }
  };

  jQueryCollapseStorage = Storage;

})(jQuery);

define("collapse_storage", function(){});

/*!
 * jquery.customSelect() - v0.4.1
 * http://adam.co/lab/jquery/customselect/
 * 2013-05-13
 *
 * Copyright 2013 Adam Coulombe
 * @license http://www.opensource.org/licenses/mit-license.html MIT License
 * @license http://www.gnu.org/licenses/gpl.html GPL2 License 
 */

(function ($) {
    

    $.fn.extend({
        customSelect: function (options) {
            // filter out <= IE6
            if (typeof document.body.style.maxHeight === 'undefined') {
                return this;
            }
            var defaults = {
                    customClass: 'customSelect',
                    mapClass:    true,
                    mapStyle:    true,
                    loaded : function() {
                    	console.log('loaded');
                    }
            },
            options = $.extend(defaults, options),
            prefix = options.customClass,
            changed = function ($select,customSelectSpan) {
                var currentSelected = $select.find(':selected'),
                customSelectSpanInner = customSelectSpan.children(':first'),
                html = currentSelected.html() || '&nbsp;';

                customSelectSpanInner.html(html);
                
                if (currentSelected.attr('disabled')) {
                	customSelectSpan.addClass(getClass('DisabledOption'));
                } else {
                	customSelectSpan.removeClass(getClass('DisabledOption'));
                }
                
                setTimeout(function () {
                    customSelectSpan.removeClass(getClass('Open'));
                    $(document).off('mouseup.'+getClass('Open'));                  
                }, 60);
            },
            getClass = function(suffix){
                return prefix + suffix;
            };

            return this.each(function () {
                var $select = $(this),
                    customSelectInnerSpan = $('<span />').addClass(getClass('Inner')),
                    customSelectSpan = $('<span />');

                $select.after(customSelectSpan.append(customSelectInnerSpan));
                
                customSelectSpan.addClass(prefix);

                if (options.mapClass) {
                    customSelectSpan.addClass($select.attr('class'));
                }
                if (options.mapStyle) {
                    customSelectSpan.attr('style', $select.attr('style'));
                }

                $select
                    .addClass('hasCustomSelect')
                    .on('update', function () {
						changed($select,customSelectSpan);

                        var selectBoxWidth = parseInt($select.outerWidth(), 10) -
                                (parseInt(customSelectSpan.outerWidth(), 10) -
                                    parseInt(customSelectSpan.width(), 10));

						// Set to inline-block before calculating outerHeight
						customSelectSpan.css({
                            display: 'inline-block'
                        });

                        var selectBoxHeight = customSelectSpan.outerHeight();

                        if ($select.attr('disabled')) {
                            customSelectSpan.addClass(getClass('Disabled'));
                        } else {
                            customSelectSpan.removeClass(getClass('Disabled'));
                        }

                        customSelectInnerSpan.css({
                            width:   selectBoxWidth,
                            display: 'inline-block'
                        });

                        $select.css({
                            '-webkit-appearance': 'menulist-button',
                            width:                customSelectSpan.outerWidth(),
                            position:             'absolute',
                            opacity:              0,
                            height:               selectBoxHeight,
                            fontSize:             customSelectSpan.css('font-size')
                        });

                        options.loaded();
                    })
                    .on('change', function () {
                        customSelectSpan.addClass(getClass('Changed'));
                        changed($select,customSelectSpan);
                    })
                    .on('keyup', function (e) {
                        if(!customSelectSpan.hasClass(getClass('Open'))){
                            $select.blur();
                            $select.focus();
                        }else{
                            if(e.which==13||e.which==27){
                                changed($select,customSelectSpan);
                            }
                        }
                    })
                    .on('mousedown', function (e) {
                        customSelectSpan.removeClass(getClass('Changed'));
                    })
                    .on('mouseup', function (e) {
                        
                        if( !customSelectSpan.hasClass(getClass('Open'))){
                            // if FF and there are other selects open, just apply focus
                            if($('.'+getClass('Open')).not(customSelectSpan).length>0 && typeof InstallTrigger !== 'undefined'){
                                $select.focus();
                            }else{
                                customSelectSpan.addClass(getClass('Open'));
                                e.stopPropagation();
                                $(document).one('mouseup.'+getClass('Open'), function (e) {
                                    if( e.target != $select.get(0) && $.inArray(e.target,$select.find('*').get()) < 0 ){
                                        $select.blur();
                                    }else{
                                        changed($select,customSelectSpan);
                                    }
                                });
                            }
                        }
                    })
                    .focus(function () {
                        customSelectSpan.removeClass(getClass('Changed')).addClass(getClass('Focus'));
                    })
                    .blur(function () {
                        customSelectSpan.removeClass(getClass('Focus')+' '+getClass('Open'));
                    })
                    .hover(function () {
                        customSelectSpan.addClass(getClass('Hover'));
                    }, function () {
                        customSelectSpan.removeClass(getClass('Hover'));
                    })
                    .trigger('update');
            });
        }
    });
})(jQuery);
define("customselect", function(){});

define('admin',[
    'jquery', 'alertify', 'collapse', 'collapse_storage', 'customselect'
], function($, alertify){

	var loadCollapse = function() {
		$("#admin.collapse").collapse({
			open: function() {
				this.slideDown(100);
			},
			close: function() {
				this.slideUp(100);
			},
			accordion : true,
			persist : true
		});
	}

	var to;

	$('select').customSelect({
		loaded : function() {
			if(to !== undefined)
				clearTimeout(to);

			to = setTimeout(function() {
					loadCollapse();
				}, 10);
		}
	});

	$('#change-theme input[type="submit"]').on('click', function(evt) {
		evt.preventDefault();

        alertify.confirm("Pas encore tout à fais au point, si vous avez une erreur 502 ou que ça charge dans le vide c'est normal, actualisez :)", function (e) {
            if (e) {
                return $('#change-theme').submit();
            } else {
                return false;
            }
        });


	});

	$('a[href="#more"]').click(function() {
		$(this).closest('li').find('.user-more').slideToggle();
	});

});

define('text!../../plugins/chat/public/views/message.ejs',[],function () { return '<%\nvar l = messages.length;\n\nfor(var i = 0; i < l - 1; i++) {\n\tvar m = messages[i], prev = i >= 1 ? messages[i-1] : null;\n\n\tif(prev !== null && m.user == prev.user) {\n\n\t\tprint(m.message);\n\n\t} else {\n%>\n\t<%= prev === null ? \'<li>\' : \'</li><li>\' %>\n\t\t<span class="pseudo" data-user="<%= m.user %>"><%= m.user %></span><%= m.message %>\n<%\n\t}\n%>\n\n\n<%= i == l - 2 ? \'</li>\': \'\' %>\n\n\n<% \n\n} //end loop\n\n%>';});

define('chat-chat',[
    'jquery', 'desktop', 'text!../../plugins/chat/public/views/message.ejs'
], function($, Desktop, Chat){

	if(user) {
		var socket = Desktop.socket;
		var $msgs = $('#chat .messages');

		$('#chat').on('keydown', '#textarea', function(e) {
			if(e.keyCode == 13 && !e.shiftKey) {
				e.preventDefault();
				socket.emit('chat:message',user.username, $(this).text());
				$(this).empty();
			}
		});

		$(document).ready(function() { 
			if(!$.cookie('chatclosed')) {
				$("#chat").css({height: '350px'}).toggleClass('closed');
				$('#chat i[class*="entypo"]').toggleClass('entypo-minus-squared').toggleClass('entypo-plus-squared');
			}
		})

		$('#chat .top').on('click', function() {
			var $chat = $('#chat');

			if($chat.hasClass('closed')) {
				$chat.animate({height: '350px'}).toggleClass('closed');
				$.cookie('chatclosed', false);
			} else {
				$chat.animate({height: '20px'}).toggleClass('closed');
				$.cookie('chatclosed', true);
			}

			$(this).find('i[class*="entypo"]').toggleClass('entypo-minus-squared').toggleClass('entypo-plus-squared');
		});

		socket.on('connect', function () {
			socket.emit('chat:join',  user.username );
		});

		/*Receive messages for the first time*/
		socket.on('chat:init', function(messages) {

			//console.log(_.template(Chat, {messages : messages}));
			
			$msgs.prepend(
				_.template(Chat, {messages : messages})
			);


			$msgs.scrollTop($msgs[0].scrollHeight);

		});

		socket.on('chat:message', function(m) {
			var last = $msgs.find('li:last .pseudo').attr('data-user'), $last = $msgs.find('li:last');

			if(last == m.user)
				$last.append(m.message);
			else
				$msgs.append('<li><span class="pseudo" data-user="'+m.user+'">'+m.user + '</span>' + m.message +'</li>');

			$msgs.scrollTop($msgs[0].scrollHeight);

		})

		socket.on('chat:joined', function(users) {
			var nb = users.length, users = users.join(', ');

			if(nb < 4)
				$('#chat .users').text(users);
			else
				$('#chat .users').html('<span title="'+users+'">'+ nb + ' utilisateurs');
		});
	}

});
define('checkforupdates-checkforupdates',[
    'jquery', 'desktop', 'alertify'
], function($, Desktop, Chat){

	if(user) {
		var socket = Desktop.socket;

		socket.emit('ckecker:launch', user);

		socket.on('checker:available', function(current) {
			alertify.error("Ezseed à besoin d'un coup de neuf ! La version " + current + " est sortie !", 0);
		});
	}
});
/** 
 * All credits to https://github.com/audiocogs/aurora.js 
 * This file contains Aurora, mp3, flac from @audiocogs
 */
(function(){function m(e,t,n,r,i){this.fromSampleRate=e;this.toSampleRate=t;this.channels=n|0;this.outputBufferSize=r;this.noReturn=!!i;this.initialize()}function T(e){this.stream=e;this.sync=false;this.freerate=0;this.this_frame=e.stream.offset;this.next_frame=e.stream.offset;this.main_data=new Uint8Array(_);this.md_len=0;for(var t in e){if(typeof e[t]==="function")this[t]=e[t].bind(e)}}function D(){this.layer=0;this.mode=0;this.mode_extension=0;this.emphasis=0;this.bitrate=0;this.samplerate=0;this.crc_check=0;this.crc_target=0;this.flags=0;this.private_bits=0}function P(){this.header=null;this.options=0;this.sbsample=H([2,36,32]);this.overlap=H([2,32,18]);this.decoders=[]}function H(e,t){if(!t)t=Float64Array;if(e.length===1){return new t(e[0])}var n=[],r=e[0];for(var i=0;i<r;i++){n[i]=H(e.slice(1),t)}return n}function B(){this.filter=H([2,2,2,16,8]);this.phase=0;this.pcm={samplerate:0,channels:0,length:0,samples:[new Float64Array(1152),new Float64Array(1152)]}}function un(){this.allocation=H([2,32],Uint8Array);this.scalefactor=H([2,32],Uint8Array)}function fn(){this.samples=new Float64Array(3);this.allocation=H([2,32],Uint8Array);this.scfsi=H([2,32],Uint8Array);this.scalefactor=H([2,32,3],Uint8Array)}function Hn(e,t,n){this.table=e;this.linbits=t;this.startbits=n}function qn(){this.main_data_begin=null;this.private_bits=null;this.gr=[new Rn,new Rn];this.scfsi=new Uint8Array(2)}function Rn(){this.ch=[new Un,new Un]}function Un(){this.part2_3_length=null;this.big_values=null;this.global_gain=null;this.scalefac_compress=null;this.flags=null;this.block_type=null;this.table_select=new Uint8Array(3);this.subblock_gain=new Uint8Array(3);this.region0_count=null;this.region1_count=null;this.scalefac=new Uint8Array(39)}function zn(){this.imdct=new Fn;this.si=new qn;this.xr=[new Float64Array(576),new Float64Array(576)];this._exponents=new Int32Array(39);this.reqcache=new Float64Array(16);this.modes=new Int16Array(39);this.output=new Float64Array(36);this.tmp=H([32,3,6]);this.tmp2=new Float64Array(32*3*6)}var e;e=this;var t;t={};var n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};t.Base=function(){function t(){}var e;e=/\b_super\b/;t.extend=function(t){var n,s,o,u,a,f,l;n=function(e){function t(){a=t.__super__.constructor.apply(this,arguments);return a}r(t,e);return t}(this);if(typeof t==="function"){u=Object.keys(n.prototype);t.call(n,n);t={};f=n.prototype;for(o in f){s=f[o];if(i.call(u,o)<0){t[o]=s}}}l=n.__super__;for(o in t){s=t[o];if(typeof s==="function"&&e.test(s)){(function(e,t){return n.prototype[e]=function(){var n,r;r=this._super;this._super=l[e];n=t.apply(this,arguments);this._super=r;return n}})(o,s)}else{n.prototype[o]=s}}return n};return t}();t.Buffer=function(){function i(n){var r;if(n instanceof Uint8Array){this.data=n}else if(n instanceof ArrayBuffer||Array.isArray(n)||typeof n==="number"||t.isNode&&((r=e.Buffer)!=null?r.isBuffer(n):void 0)){this.data=new Uint8Array(n)}else if(n.buffer instanceof ArrayBuffer){this.data=new Uint8Array(n.buffer,n.byteOffset,n.length*n.BYTES_PER_ELEMENT)}else if(n instanceof t.Buffer){this.data=n.data}else{throw new Error("Constructing buffer with unknown type.")}this.length=this.data.length;this.next=null;this.prev=null}var n,r;i.allocate=function(e){return new t.Buffer(e)};i.prototype.copy=function(){return new t.Buffer(new Uint8Array(this.data))};i.prototype.slice=function(e,n){if(n==null){n=this.length}if(e===0&&n>=this.length){return new t.Buffer(this.data)}else{return new t.Buffer(this.data.subarray(e,e+n))}};n=e.BlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder;r=e.URL||e.webkitURL||e.mozURL;i.makeBlob=function(e,t){var r;if(t==null){t="application/octet-stream"}try{return new Blob([e],{type:t})}catch(i){}if(n!=null){r=new n;r.append(e);return r.getBlob(t)}return null};i.makeBlobURL=function(e,t){return r!=null?r.createObjectURL(this.makeBlob(e,t)):void 0};i.revokeBlobURL=function(e){return r!=null?r.revokeObjectURL(e):void 0};i.prototype.toBlob=function(){return i.makeBlob(this.data.buffer)};i.prototype.toBlobURL=function(){return i.makeBlobURL(this.data.buffer)};return i}();t.BufferList=function(){function e(){this.first=null;this.last=null;this.numBuffers=0;this.availableBytes=0;this.availableBuffers=0}e.prototype.copy=function(){var e;e=new t.BufferList;e.first=this.first;e.last=this.last;e.numBuffers=this.numBuffers;e.availableBytes=this.availableBytes;e.availableBuffers=this.availableBuffers;return e};e.prototype.append=function(e){var t;e.prev=this.last;if((t=this.last)!=null){t.next=e}this.last=e;if(this.first==null){this.first=e}this.availableBytes+=e.length;this.availableBuffers++;return this.numBuffers++};e.prototype.advance=function(){if(this.first){this.availableBytes-=this.first.length;this.availableBuffers--;this.first=this.first.next;return this.first!=null}return false};e.prototype.rewind=function(){var e;if(this.first&&!this.first.prev){return false}this.first=((e=this.first)!=null?e.prev:void 0)||this.last;if(this.first){this.availableBytes+=this.first.length;this.availableBuffers++}return this.first!=null};e.prototype.reset=function(){var e;e=[];while(this.rewind()){continue}return e};return e}();var n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.Stream=function(){function v(e){this.list=e;this.localOffset=0;this.offset=0}var e,n,i,s,o,u,a,f,l,c,h,p,d;e=new ArrayBuffer(16);d=new Uint8Array(e);l=new Int8Array(e);h=new Uint16Array(e);a=new Int16Array(e);p=new Uint32Array(e);f=new Int32Array(e);i=new Float32Array(e);if(typeof Float64Array!=="undefined"&&Float64Array!==null){s=new Float64Array(e)}c=(new Uint16Array((new Uint8Array([18,52])).buffer))[0]===13330;t.UnderflowError=function(e){function t(){this.name="AV.UnderflowError"}r(t,e);return t}(Error);v.fromBuffer=function(e){var n;n=new t.BufferList;n.append(e);return new t.Stream(n)};v.prototype.copy=function(){var e;e=new t.Stream(this.list.copy());e.localOffset=this.localOffset;e.offset=this.offset;return e};v.prototype.available=function(e){return e<=this.list.availableBytes-this.localOffset};v.prototype.remainingBytes=function(){return this.list.availableBytes-this.localOffset};v.prototype.advance=function(e){if(!this.available(e)){throw new t.UnderflowError}this.localOffset+=e;this.offset+=e;while(this.list.first&&this.localOffset>=this.list.first.length){this.localOffset-=this.list.first.length;this.list.advance()}return this};v.prototype.rewind=function(e){if(e>this.offset){throw new t.UnderflowError}if(!this.list.first){this.list.rewind();this.localOffset=this.list.first.length}this.localOffset-=e;this.offset-=e;while(this.list.first.prev&&this.localOffset<0){this.list.rewind();this.localOffset+=this.list.first.length}return this};v.prototype.seek=function(e){if(e>this.offset){return this.advance(e-this.offset)}else if(e<this.offset){return this.rewind(this.offset-e)}};v.prototype.readUInt8=function(){var e;if(!this.available(1)){throw new t.UnderflowError}e=this.list.first.data[this.localOffset];this.localOffset+=1;this.offset+=1;if(this.localOffset===this.list.first.length){this.localOffset=0;this.list.advance()}return e};v.prototype.peekUInt8=function(e){var n;if(e==null){e=0}if(!this.available(e+1)){throw new t.UnderflowError}e=this.localOffset+e;n=this.list.first;while(n){if(n.length>e){return n.data[e]}e-=n.length;n=n.next}return 0};v.prototype.read=function(e,t){var n,r,i,s;if(t==null){t=false}if(t===c){for(n=r=0;r<e;n=r+=1){d[n]=this.readUInt8()}}else{for(n=i=s=e-1;i>=0;n=i+=-1){d[n]=this.readUInt8()}}};v.prototype.peek=function(e,t,n){var r,i,s;if(n==null){n=false}if(n===c){for(r=i=0;i<e;r=i+=1){d[r]=this.peekUInt8(t+r)}}else{for(r=s=0;s<e;r=s+=1){d[e-r-1]=this.peekUInt8(t+r)}}};v.prototype.readInt8=function(){this.read(1);return l[0]};v.prototype.peekInt8=function(e){if(e==null){e=0}this.peek(1,e);return l[0]};v.prototype.readUInt16=function(e){this.read(2,e);return h[0]};v.prototype.peekUInt16=function(e,t){if(e==null){e=0}this.peek(2,e,t);return h[0]};v.prototype.readInt16=function(e){this.read(2,e);return a[0]};v.prototype.peekInt16=function(e,t){if(e==null){e=0}this.peek(2,e,t);return a[0]};v.prototype.readUInt24=function(e){if(e){return this.readUInt16(true)+(this.readUInt8()<<16)}else{return(this.readUInt16()<<8)+this.readUInt8()}};v.prototype.peekUInt24=function(e,t){if(e==null){e=0}if(t){return this.peekUInt16(e,true)+(this.peekUInt8(e+2)<<16)}else{return(this.peekUInt16(e)<<8)+this.peekUInt8(e+2)}};v.prototype.readInt24=function(e){if(e){return this.readUInt16(true)+(this.readInt8()<<16)}else{return(this.readInt16()<<8)+this.readUInt8()}};v.prototype.peekInt24=function(e,t){if(e==null){e=0}if(t){return this.peekUInt16(e,true)+(this.peekInt8(e+2)<<16)}else{return(this.peekInt16(e)<<8)+this.peekUInt8(e+2)}};v.prototype.readUInt32=function(e){this.read(4,e);return p[0]};v.prototype.peekUInt32=function(e,t){if(e==null){e=0}this.peek(4,e,t);return p[0]};v.prototype.readInt32=function(e){this.read(4,e);return f[0]};v.prototype.peekInt32=function(e,t){if(e==null){e=0}this.peek(4,e,t);return f[0]};v.prototype.readFloat32=function(e){this.read(4,e);return i[0]};v.prototype.peekFloat32=function(e,t){if(e==null){e=0}this.peek(4,e,t);return i[0]};v.prototype.readFloat64=function(e){this.read(8,e);if(s){return s[0]}else{return o()}};o=function(){var e,t,n,r,i,s;r=p[0],n=p[1];if(!n||n===2147483648){return 0}s=1-(n>>>31)*2;e=n>>>20&2047;t=n&1048575;if(e===2047){if(t){return NaN}return s*Infinity}e-=1023;i=(t|1048576)*Math.pow(2,e-20);i+=r*Math.pow(2,e-52);return s*i};v.prototype.peekFloat64=function(e,t){if(e==null){e=0}this.peek(8,e,t);if(s){return s[0]}else{return o()}};v.prototype.readFloat80=function(e){this.read(10,e);return u()};u=function(){var e,t,n,r,i,s,o;r=p[0],i=p[1];e=d[9];t=d[8];o=1-(e>>>7)*2;n=(e&127)<<8|t;if(n===0&&i===0&&r===0){return 0}if(n===32767){if(i===0&&r===0){return o*Infinity}return NaN}n-=16383;s=i*Math.pow(2,n-31);s+=r*Math.pow(2,n-63);return o*s};v.prototype.peekFloat80=function(e,t){if(e==null){e=0}this.peek(10,e,t);return u()};v.prototype.readBuffer=function(e){var n,r,i,s;r=t.Buffer.allocate(e);i=r.data;for(n=s=0;s<e;n=s+=1){i[n]=this.readUInt8()}return r};v.prototype.peekBuffer=function(e,n){var r,i,s,o;if(e==null){e=0}i=t.Buffer.allocate(n);s=i.data;for(r=o=0;o<n;r=o+=1){s[r]=this.peekUInt8(e+r)}return i};v.prototype.readSingleBuffer=function(e){var t;t=this.list.first.slice(this.localOffset,e);this.advance(t.length);return t};v.prototype.peekSingleBuffer=function(e,t){var n;n=this.list.first.slice(this.localOffset+e,t);return n};v.prototype.readString=function(e,t){if(t==null){t="ascii"}return n.call(this,0,e,t,true)};v.prototype.peekString=function(e,t,r){if(e==null){e=0}if(r==null){r="ascii"}return n.call(this,e,t,r,false)};n=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;n=n.toLowerCase();h=t===null?0:-1;if(t==null){t=Infinity}l=e+t;d="";switch(n){case"ascii":case"latin1":while(e<l&&(f=this.peekUInt8(e++))!==h){d+=String.fromCharCode(f)}break;case"utf8":case"utf-8":while(e<l&&(i=this.peekUInt8(e++))!==h){if((i&128)===0){d+=String.fromCharCode(i)}else if((i&224)===192){s=this.peekUInt8(e++)&63;d+=String.fromCharCode((i&31)<<6|s)}else if((i&240)===224){s=this.peekUInt8(e++)&63;o=this.peekUInt8(e++)&63;d+=String.fromCharCode((i&15)<<12|s<<6|o)}else if((i&248)===240){s=this.peekUInt8(e++)&63;o=this.peekUInt8(e++)&63;u=this.peekUInt8(e++)&63;p=((i&15)<<18|s<<12|o<<6|u)-65536;d+=String.fromCharCode(55296+(p>>10),56320+(p&1023))}}break;case"utf16-be":case"utf16be":case"utf16le":case"utf16-le":case"utf16bom":case"utf16-bom":switch(n){case"utf16be":case"utf16-be":c=false;break;case"utf16le":case"utf16-le":c=true;break;case"utf16bom":case"utf16-bom":if(t<2||(a=this.peekUInt16(e))===h){if(r){this.advance(e+=2)}return d}c=a===65534;e+=2}while(e<l&&(v=this.peekUInt16(e,c))!==h){e+=2;if(v<55296||v>57343){d+=String.fromCharCode(v)}else{if(v>56319){throw new Error("Invalid utf16 sequence.")}m=this.peekUInt16(e,c);if(m<56320||m>57343){throw new Error("Invalid utf16 sequence.")}d+=String.fromCharCode(v,m);e+=2}}if(v===h){e+=2}break;default:throw new Error("Unknown encoding: "+n)}if(r){this.advance(e)}return d};return v}();t.Bitstream=function(){function e(e){this.stream=e;this.bitPosition=0}e.prototype.copy=function(){var e;e=new t.Bitstream(this.stream.copy());e.bitPosition=this.bitPosition;return e};e.prototype.offset=function(){return 8*this.stream.offset+this.bitPosition};e.prototype.available=function(e){return this.stream.available((e+8-this.bitPosition)/8)};e.prototype.advance=function(e){var t;t=this.bitPosition+e;this.stream.advance(t>>3);return this.bitPosition=t&7};e.prototype.rewind=function(e){var t;t=this.bitPosition-e;this.stream.rewind(Math.abs(t>>3));return this.bitPosition=t&7};e.prototype.seek=function(e){var t;t=this.offset();if(e>t){return this.advance(e-t)}else if(e<t){return this.rewind(t-e)}};e.prototype.align=function(){if(this.bitPosition!==0){this.bitPosition=0;return this.stream.advance(1)}};e.prototype.read=function(e,t){var n,r,i,s,o,u,a;if(e===0){return 0}a=e+this.bitPosition;if(a<=8){n=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-e}else if(a<=16){n=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-e}else if(a<=24){n=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-e}else if(a<=32){n=this.stream.peekUInt32()<<this.bitPosition>>>32-e}else if(a<=40){r=this.stream.peekUInt8(0)*4294967296;i=this.stream.peekUInt8(1)<<24>>>0;s=this.stream.peekUInt8(2)<<16;o=this.stream.peekUInt8(3)<<8;u=this.stream.peekUInt8(4);n=r+i+s+o+u;n%=Math.pow(2,40-this.bitPosition);n=Math.floor(n/Math.pow(2,40-this.bitPosition-e))}else{throw new Error("Too many bits!")}if(t){if(a<32){if(n>>>e-1){n=((1<<e>>>0)-n)*-1}}else{if(n/Math.pow(2,e-1)|0){n=(Math.pow(2,e)-n)*-1}}}this.advance(e);return n};e.prototype.peek=function(e,t){var n,r,i,s,o,u,a;if(e===0){return 0}a=e+this.bitPosition;if(a<=8){n=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-e}else if(a<=16){n=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-e}else if(a<=24){n=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-e}else if(a<=32){n=this.stream.peekUInt32()<<this.bitPosition>>>32-e}else if(a<=40){r=this.stream.peekUInt8(0)*4294967296;i=this.stream.peekUInt8(1)<<24>>>0;s=this.stream.peekUInt8(2)<<16;o=this.stream.peekUInt8(3)<<8;u=this.stream.peekUInt8(4);n=r+i+s+o+u;n%=Math.pow(2,40-this.bitPosition);n=Math.floor(n/Math.pow(2,40-this.bitPosition-e))}else{throw new Error("Too many bits!")}if(t){if(a<32){if(n>>>e-1){n=((1<<e>>>0)-n)*-1}}else{if(n/Math.pow(2,e-1)|0){n=(Math.pow(2,e)-n)*-1}}}return n};e.prototype.readLSB=function(e,t){var n,r;if(e===0){return 0}if(e>40){throw new Error("Too many bits!")}r=e+this.bitPosition;n=this.stream.peekUInt8(0)>>>this.bitPosition;if(r>8){n|=this.stream.peekUInt8(1)<<8-this.bitPosition}if(r>16){n|=this.stream.peekUInt8(2)<<16-this.bitPosition}if(r>24){n+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0}if(r>32){n+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)}if(r>=32){n%=Math.pow(2,e)}else{n&=(1<<e)-1}if(t){if(r<32){if(n>>>e-1){n=((1<<e>>>0)-n)*-1}}else{if(n/Math.pow(2,e-1)|0){n=(Math.pow(2,e)-n)*-1}}}this.advance(e);return n};e.prototype.peekLSB=function(e,t){var n,r;if(e===0){return 0}if(e>40){throw new Error("Too many bits!")}r=e+this.bitPosition;n=this.stream.peekUInt8(0)>>>this.bitPosition;if(r>8){n|=this.stream.peekUInt8(1)<<8-this.bitPosition}if(r>16){n|=this.stream.peekUInt8(2)<<16-this.bitPosition}if(r>24){n+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0}if(r>32){n+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)}if(r>=32){n%=Math.pow(2,e)}else{n&=(1<<e)-1}if(t){if(r<32){if(n>>>e-1){n=((1<<e>>>0)-n)*-1}}else{if(n/Math.pow(2,e-1)|0){n=(Math.pow(2,e)-n)*-1}}}return n};return e}();var s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},o=[].slice;t.EventEmitter=function(e){function t(){s=t.__super__.constructor.apply(this,arguments);return s}r(t,e);t.prototype.on=function(e,t){var n;if(this.events==null){this.events={}}if((n=this.events)[e]==null){n[e]=[]}return this.events[e].push(t)};t.prototype.off=function(e,t){var n,r;if(!((r=this.events)!=null?r[e]:void 0)){return}n=this.events[e].indexOf(t);if(~n){return this.events[e].splice(n,1)}};t.prototype.once=function(e,t){var n;return this.on(e,n=function(){this.off(e,n);return t.apply(this,arguments)})};t.prototype.emit=function(){var e,t,n,r,i,s,u;t=arguments[0],e=2<=arguments.length?o.call(arguments,1):[];if(!((s=this.events)!=null?s[t]:void 0)){return}u=this.events[t].slice();for(r=0,i=u.length;r<i;r++){n=u[r];n.apply(this,e)}};return t}(t.Base);var u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.BufferSource=function(n){function o(e){this.loop=u(this.loop,this);if(e instanceof t.BufferList){this.list=e}else{this.list=new t.BufferList;this.list.append(new t.Buffer(e))}this.paused=true}var i,s;r(o,n);s=e.setImmediate||function(t){return e.setTimeout(t,0)};i=e.clearImmediate||function(t){return e.clearTimeout(t)};o.prototype.start=function(){this.paused=false;return this._timer=s(this.loop)};o.prototype.loop=function(){this.emit("progress",(this.list.numBuffers-this.list.availableBuffers+1)/this.list.numBuffers*100|0);this.emit("data",this.list.first);if(this.list.advance()){return s(this.loop)}else{return this.emit("end")}};o.prototype.pause=function(){i(this._timer);return this.paused=true};o.prototype.reset=function(){this.pause();return this.list.rewind()};return o}(t.EventEmitter);var n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.Demuxer=function(e){function i(e,n){var r,i,s=this;r=new t.BufferList;r.append(n);this.stream=new t.Stream(r);i=false;e.on("data",function(e){i=true;r.append(e);return s.readChunk(e)});e.on("error",function(e){return s.emit("error",e)});e.on("end",function(){if(!i){s.readChunk(n)}return s.emit("end")});this.seekPoints=[];this.init()}var n;r(i,e);i.probe=function(e){return false};i.prototype.init=function(){};i.prototype.readChunk=function(e){};i.prototype.addSeekPoint=function(e,t){var n;n=this.searchTimestamp(t);return this.seekPoints.splice(n,0,{offset:e,timestamp:t})};i.prototype.searchTimestamp=function(e,t){var n,r,i,s;r=0;n=this.seekPoints.length;if(n>0&&this.seekPoints[n-1].timestamp<e){return n}while(r<n){i=r+n>>1;s=this.seekPoints[i].timestamp;if(s<e){r=i+1}else if(s>=e){n=i}}if(n>this.seekPoints.length){n=this.seekPoints.length}return n};i.prototype.seek=function(e){var t,n;if(this.format&&this.format.framesPerPacket>0&&this.format.bytesPerPacket>0){n={timestamp:e,offset:this.format.bytesPerPacket*e/this.format.framesPerPacket};return n}else{t=this.searchTimestamp(e);return this.seekPoints[t]}};n=[];i.register=function(e){return n.push(e)};i.find=function(e){var r,i,s,o;i=t.Stream.fromBuffer(e);for(s=0,o=n.length;s<o;s++){r=n[s];if(r.probe(i)){return r}}return null};return i}(t.EventEmitter);var n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.Decoder=function(e){function i(e,n){var r,i=this;this.demuxer=e;this.format=n;r=new t.BufferList;this.stream=new t.Stream(r);this.bitstream=new t.Bitstream(this.stream);this.receivedFinalBuffer=false;this.waiting=false;this.demuxer.on("cookie",function(e){var t;try{return i.setCookie(e)}catch(n){t=n;return i.emit("error",t)}});this.demuxer.on("data",function(e){r.append(e);if(i.waiting){return i.decode()}});this.demuxer.on("end",function(){i.receivedFinalBuffer=true;if(i.waiting){return i.decode()}});this.init()}var n;r(i,e);i.prototype.init=function(){};i.prototype.setCookie=function(e){};i.prototype.readChunk=function(){};i.prototype.decode=function(){var e,n,r;this.waiting=false;n=this.bitstream.offset();try{r=this.readChunk()}catch(i){e=i;if(!(e instanceof t.UnderflowError)){this.emit("error",e);return false}}if(r){this.emit("data",r);return true}else if(!this.receivedFinalBuffer){this.bitstream.seek(n);this.waiting=true}else{this.emit("end")}return false};i.prototype.seek=function(e){var t;t=this.demuxer.seek(e);this.stream.seek(t.offset);return t.timestamp};n={};i.register=function(e,t){return n[e]=t};i.find=function(e){return n[e]||null};return i}(t.EventEmitter);var u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.Queue=function(e){function t(e){var t=this;this.asset=e;this.write=u(this.write,this);this.readyMark=64;this.finished=false;this.buffering=true;this.ended=false;this.buffers=[];this.asset.on("data",this.write);this.asset.on("end",function(){return t.ended=true});this.asset.decodePacket()}r(t,e);t.prototype.write=function(e){if(e){this.buffers.push(e)}if(this.buffering){if(this.buffers.length>=this.readyMark||this.ended){this.buffering=false;return this.emit("ready")}else{return this.asset.decodePacket()}}};t.prototype.read=function(){if(this.buffers.length===0){return null}this.asset.decodePacket();return this.buffers.shift()};t.prototype.reset=function(){this.buffers.length=0;this.buffering=true;return this.asset.decodePacket()};return t}(t.EventEmitter);var u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.AudioDevice=function(e){function i(e,t){this.sampleRate=e;this.channels=t;this.updateTime=u(this.updateTime,this);this.playing=false;this.currentTime=0;this._lastTime=0}var n;r(i,e);i.prototype.start=function(){var e=this;if(this.playing){return}this.playing=true;if(this.device==null){this.device=t.AudioDevice.create(this.sampleRate,this.channels)}if(!this.device){throw new Error("No supported audio device found.")}this._lastTime=this.device.getDeviceTime();this._timer=setInterval(this.updateTime,200);return this.device.on("refill",this.refill=function(t){return e.emit("refill",t)})};i.prototype.stop=function(){if(!this.playing){return}this.playing=false;this.device.off("refill",this.refill);return clearInterval(this._timer)};i.prototype.destroy=function(){this.stop();return this.device.destroy()};i.prototype.seek=function(e){this.currentTime=e;if(this.playing){this._lastTime=this.device.getDeviceTime()}return this.emit("timeUpdate",this.currentTime)};i.prototype.updateTime=function(){var e;e=this.device.getDeviceTime();this.currentTime+=(e-this._lastTime)/this.device.sampleRate*1e3|0;this._lastTime=e;return this.emit("timeUpdate",this.currentTime)};n=[];i.register=function(e){return n.push(e)};i.create=function(e,t){var r,i,s;for(i=0,s=n.length;i<s;i++){r=n[i];if(r.supported){return new r(e,t)}}return null};return i}(t.EventEmitter);var u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.Asset=function(e){function n(e){var t=this;this.source=e;this._decode=u(this._decode,this);this.findDecoder=u(this.findDecoder,this);this.probe=u(this.probe,this);this.buffered=0;this.duration=null;this.format=null;this.metadata=null;this.active=false;this.demuxer=null;this.decoder=null;this.source.once("data",this.probe);this.source.on("error",function(e){t.emit("error",e);return t.stop()});this.source.on("progress",function(e){t.buffered=e;return t.emit("buffer",t.buffered)})}r(n,e);n.fromURL=function(e){return new t.Asset(new t.HTTPSource(e))};n.fromFile=function(e){return new t.Asset(new t.FileSource(e))};n.fromBuffer=function(e){return new t.Asset(new t.BufferSource(e))};n.prototype.start=function(e){if(this.active){return}if(e!=null){this.shouldDecode=e}if(this.shouldDecode==null){this.shouldDecode=true}this.active=true;this.source.start();if(this.decoder&&this.shouldDecode){return this._decode()}};n.prototype.stop=function(){if(!this.active){return}this.active=false;return this.source.pause()};n.prototype.get=function(e,t){var n=this;if(e!=="format"&&e!=="duration"&&e!=="metadata"){return}if(this[e]!=null){return t(this[e])}else{this.once(e,function(e){n.stop();return t(e)});return this.start()}};n.prototype.decodePacket=function(){return this.decoder.decode()};n.prototype.decodeToBuffer=function(e){var t,n,r;r=0;t=[];this.on("data",n=function(e){r+=e.length;return t.push(e)});this.once("end",function(){var i,s,o,u,a;i=new Float32Array(r);o=0;for(u=0,a=t.length;u<a;u++){s=t[u];i.set(s,o);o+=s.length}this.off("data",n);return e(i)});return this.start()};n.prototype.probe=function(e){var n,r=this;if(!this.active){return}n=t.Demuxer.find(e);if(!n){return this.emit("error","A demuxer for this container was not found.")}this.demuxer=new n(this.source,e);this.demuxer.on("format",this.findDecoder);this.demuxer.on("duration",function(e){r.duration=e;return r.emit("duration",r.duration)});this.demuxer.on("metadata",function(e){r.metadata=e;return r.emit("metadata",r.metadata)});return this.demuxer.on("error",function(e){r.emit("error",e);return r.stop()})};n.prototype.findDecoder=function(e){var n,r,i=this;this.format=e;if(!this.active){return}this.emit("format",this.format);n=t.Decoder.find(this.format.formatID);if(!n){return this.emit("error","A decoder for "+this.format.formatID+" was not found.")}this.decoder=new n(this.demuxer,this.format);if(this.format.floatingPoint){this.decoder.on("data",function(e){return i.emit("data",e)})}else{r=Math.pow(2,this.format.bitsPerChannel-1);this.decoder.on("data",function(e){var t,n,s,o,u;t=new Float32Array(e.length);for(n=o=0,u=e.length;o<u;n=++o){s=e[n];t[n]=s/r}return i.emit("data",t)})}this.decoder.on("error",function(e){i.emit("error",e);return i.stop()});this.decoder.on("end",function(){return i.emit("end")});this.emit("decodeStart");if(this.shouldDecode){return this._decode()}};n.prototype._decode=function(){while(this.decoder.decode()&&this.active){continue}if(this.active){return this.decoder.once("data",this._decode)}};return n}(t.EventEmitter);var u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.Player=function(e){function n(e){var n=this;this.asset=e;this.startPlaying=u(this.startPlaying,this);this.playing=false;this.buffered=0;this.currentTime=0;this.duration=0;this.volume=100;this.pan=0;this.metadata={};this.filters=[new t.VolumeFilter(this,"volume"),new t.BalanceFilter(this,"pan")];this.asset.on("buffer",function(e){n.buffered=e;return n.emit("buffer",n.buffered)});this.asset.on("decodeStart",function(){n.queue=new t.Queue(n.asset);return n.queue.once("ready",n.startPlaying)});this.asset.on("format",function(e){n.format=e;return n.emit("format",n.format)});this.asset.on("metadata",function(e){n.metadata=e;return n.emit("metadata",n.metadata)});this.asset.on("duration",function(e){n.duration=e;return n.emit("duration",n.duration)});this.asset.on("error",function(e){return n.emit("error",e)})}r(n,e);n.fromURL=function(e){return new t.Player(t.Asset.fromURL(e))};n.fromFile=function(e){return new t.Player(t.Asset.fromFile(e))};n.fromBuffer=function(e){return new t.Player(t.Asset.fromBuffer(e))};n.prototype.preload=function(){if(!this.asset){return}this.startedPreloading=true;return this.asset.start(false)};n.prototype.play=function(){var e;if(this.playing){return}if(!this.startedPreloading){this.preload()}this.playing=true;return(e=this.device)!=null?e.start():void 0};n.prototype.pause=function(){var e;if(!this.playing){return}this.playing=false;return(e=this.device)!=null?e.stop():void 0};n.prototype.togglePlayback=function(){if(this.playing){return this.pause()}else{return this.play()}};n.prototype.stop=function(){var e;this.pause();this.asset.stop();return(e=this.device)!=null?e.destroy():void 0};n.prototype.seek=function(e){var t,n=this;if((t=this.device)!=null){t.stop()}this.queue.once("ready",function(){var e,t;if((e=n.device)!=null){e.seek(n.currentTime)}if(n.playing){return(t=n.device)!=null?t.start():void 0}});e=e/1e3*this.format.sampleRate;e=this.asset.decoder.seek(e);this.currentTime=e/this.format.sampleRate*1e3|0;this.queue.reset();return this.currentTime};n.prototype.startPlaying=function(){var e,n,r=this;e=this.queue.read();n=0;this.device=new t.AudioDevice(this.format.sampleRate,this.format.channelsPerFrame);this.device.on("timeUpdate",function(e){r.currentTime=e;return r.emit("progress",r.currentTime)});this.refill=function(t){var i,s,o,u,a,f,l,c;if(!r.playing){return}if(!e){e=r.queue.read();n=0}i=0;while(e&&i<t.length){u=Math.min(e.length-n,t.length-i);for(o=a=0;a<u;o=a+=1){t[i++]=e[n++]}if(n===e.length){e=r.queue.read();n=0}}c=r.filters;for(f=0,l=c.length;f<l;f++){s=c[f];s.process(t)}if(!e){if(r.queue.ended){r.currentTime=r.duration;r.emit("progress",r.currentTime);r.emit("end");r.stop()}else{r.device.stop()}}};this.device.on("refill",this.refill);if(this.playing){this.device.start()}return this.emit("ready")};return n}(t.EventEmitter);t.Filter=function(){function e(e,t){if(e&&t){Object.defineProperty(this,"value",{get:function(){return e[t]}})}}e.prototype.process=function(e){};return e}();var s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.VolumeFilter=function(e){function t(){s=t.__super__.constructor.apply(this,arguments);return s}r(t,e);t.prototype.process=function(e){var t,n,r,i;if(this.value>=100){return}n=Math.max(0,Math.min(100,this.value))/100;for(t=r=0,i=e.length;r<i;t=r+=1){e[t]*=n}};return t}(t.Filter);var s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.BalanceFilter=function(e){function t(){s=t.__super__.constructor.apply(this,arguments);return s}r(t,e);t.prototype.process=function(e){var t,n,r,i;if(this.value===0){return}n=Math.max(-50,Math.min(50,this.value));for(t=r=0,i=e.length;r<i;t=r+=2){e[t]*=Math.min(1,(50-n)/50);e[t+1]*=Math.min(1,(50+n)/50)}};return t}(t.Filter);var a,s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};a=function(e){function n(){s=n.__super__.constructor.apply(this,arguments);return s}r(n,e);t.Demuxer.register(n);n.probe=function(e){return e.peekString(0,4)==="caff"};n.prototype.readChunk=function(){var e,t,n,r,i,s,o,u,a,f,c,h,p,d;if(!this.format&&this.stream.available(64)){if(this.stream.readString(4)!=="caff"){return this.emit("error","Invalid CAF, does not begin with 'caff'")}this.stream.advance(4);if(this.stream.readString(4)!=="desc"){return this.emit("error","Invalid CAF, 'caff' is not followed by 'desc'")}if(!(this.stream.readUInt32()===0&&this.stream.readUInt32()===32)){return this.emit("error","Invalid 'desc' size, should be 32")}this.format={};this.format.sampleRate=this.stream.readFloat64();this.format.formatID=this.stream.readString(4);i=this.stream.readUInt32();if(this.format.formatID==="lpcm"){this.format.floatingPoint=Boolean(i&1);this.format.littleEndian=Boolean(i&2)}this.format.bytesPerPacket=this.stream.readUInt32();this.format.framesPerPacket=this.stream.readUInt32();this.format.channelsPerFrame=this.stream.readUInt32();this.format.bitsPerChannel=this.stream.readUInt32();this.emit("format",this.format)}while(this.stream.available(1)){if(!this.headerCache){this.headerCache={type:this.stream.readString(4),oversize:this.stream.readUInt32()!==0,size:this.stream.readUInt32()};if(this.headerCache.oversize){return this.emit("error","Holy Shit, an oversized file, not supported in JS")}}switch(this.headerCache.type){case"kuki":if(this.stream.available(this.headerCache.size)){if(this.format.formatID==="aac "){a=this.stream.offset+this.headerCache.size;if(n=l.readEsds(this.stream)){this.emit("cookie",n)}this.stream.seek(a)}else{e=this.stream.readBuffer(this.headerCache.size);this.emit("cookie",e)}this.headerCache=null}break;case"pakt":if(this.stream.available(this.headerCache.size)){if(this.stream.readUInt32()!==0){return this.emit("error","Sizes greater than 32 bits are not supported.")}this.numPackets=this.stream.readUInt32();if(this.stream.readUInt32()!==0){return this.emit("error","Sizes greater than 32 bits are not supported.")}this.numFrames=this.stream.readUInt32();this.primingFrames=this.stream.readUInt32();this.remainderFrames=this.stream.readUInt32();this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0);this.sentDuration=true;t=0;f=0;for(s=h=0,d=this.numPackets;h<d;s=h+=1){this.addSeekPoint(t,f);t+=this.format.bytesPerPacket||l.readDescrLen(this.stream);f+=this.format.framesPerPacket||l.readDescrLen(this.stream)}this.headerCache=null}break;case"info":r=this.stream.readUInt32();u={};for(s=p=0;0<=r?p<r:p>r;s=0<=r?++p:--p){o=this.stream.readString(null);c=this.stream.readString(null);u[o]=c}this.emit("metadata",u);this.headerCache=null;break;case"data":if(!this.sentFirstDataChunk){this.stream.advance(4);this.headerCache.size-=4;if(this.format.bytesPerPacket!==0&&!this.sentDuration){this.numFrames=this.headerCache.size/this.format.bytesPerPacket;this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0)}this.sentFirstDataChunk=true}e=this.stream.readSingleBuffer(this.headerCache.size);this.headerCache.size-=e.length;this.emit("data",e);if(this.headerCache.size<=0){this.headerCache=null}break;default:if(this.stream.available(this.headerCache.size)){this.stream.advance(this.headerCache.size);this.headerCache=null}}}};return n}(t.Demuxer);var l,s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};l=function(e){function m(){s=m.__super__.constructor.apply(this,arguments);return s}var n,o,u,a,f,l,c,h,p,d,v;r(m,e);t.Demuxer.register(m);o=["M4A ","M4P ","M4B ","M4V ","isom","mp42","qt  "];m.probe=function(e){var t;return e.peekString(4,4)==="ftyp"&&(t=e.peekString(8,4),i.call(o,t)>=0)};m.prototype.init=function(){this.atoms=[];this.offsets=[];this.track=null;return this.tracks=[]};f={};c={};a=function(e,t){var n,r,i,s,o;n=[];o=e.split(".").slice(0,-1);for(i=0,s=o.length;i<s;i++){r=o[i];n.push(r);c[n.join(".")]=true}if(f[e]==null){f[e]={}}return f[e].fn=t};u=function(e,t){if(f[e]==null){f[e]={}}return f[e].after=t};m.prototype.readChunk=function(){var e,t,n;this["break"]=false;while(this.stream.available(1)&&!this["break"]){if(!this.readHeaders){if(!this.stream.available(8)){return}this.len=this.stream.readUInt32()-8;this.type=this.stream.readString(4);if(this.len===0){continue}this.atoms.push(this.type);this.offsets.push(this.stream.offset+this.len);this.readHeaders=true}t=this.atoms.join(".");e=f[t];if(e!=null?e.fn:void 0){if(!(this.stream.available(this.len)||t==="mdat")){return}e.fn.call(this);if(t in c){this.readHeaders=false}}else if(t in c){this.readHeaders=false}else{if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}while(this.stream.offset>=this.offsets[this.offsets.length-1]){e=f[this.atoms.join(".")];if(e!=null?e.after:void 0){e.after.call(this)}n=this.atoms.pop();this.offsets.pop();this.readHeaders=false}}};a("ftyp",function(){var e;if(e=this.stream.readString(4),i.call(o,e)<0){return this.emit("error","Not a valid M4A file.")}return this.stream.advance(this.len-4)});a("moov.trak",function(){this.track={};return this.tracks.push(this.track)});a("moov.trak.tkhd",function(){this.stream.advance(4);this.stream.advance(8);this.track.id=this.stream.readUInt32();return this.stream.advance(this.len-16)});a("moov.trak.mdia.hdlr",function(){this.stream.advance(4);this.stream.advance(4);this.track.type=this.stream.readString(4);this.stream.advance(12);return this.stream.advance(this.len-24)});a("moov.trak.mdia.mdhd",function(){this.stream.advance(4);this.stream.advance(8);this.track.timeScale=this.stream.readUInt32();this.track.duration=this.stream.readUInt32();return this.stream.advance(4)});n={ulaw:8,alaw:8,in24:24,in32:32,fl32:32,fl64:64};a("moov.trak.mdia.minf.stbl.stsd",function(){var e,t,r,i,s;this.stream.advance(4);t=this.stream.readUInt32();if(this.track.type!=="soun"){return this.stream.advance(this.len-8)}if(t!==1){return this.emit("error","Only expecting one entry in sample description atom!")}this.stream.advance(4);e=this.track.format={};e.formatID=this.stream.readString(4);this.stream.advance(6);this.stream.advance(2);r=this.stream.readUInt16();this.stream.advance(6);e.channelsPerFrame=this.stream.readUInt16();e.bitsPerChannel=this.stream.readUInt16();this.stream.advance(4);e.sampleRate=this.stream.readUInt16();this.stream.advance(2);if(r===1){e.framesPerPacket=this.stream.readUInt32();this.stream.advance(4);e.bytesPerFrame=this.stream.readUInt32();this.stream.advance(4)}else if(r!==0){this.emit("error","Unknown version in stsd atom")}if(n[e.formatID]!=null){e.bitsPerChannel=n[e.formatID]}e.floatingPoint=(i=e.formatID)==="fl32"||i==="fl64";e.littleEndian=e.formatID==="sowt"&&e.bitsPerChannel>8;if((s=e.formatID)==="twos"||s==="sowt"||s==="in24"||s==="in32"||s==="fl32"||s==="fl64"||s==="raw "||s==="NONE"){return e.formatID="lpcm"}});a("moov.trak.mdia.minf.stbl.stsd.alac",function(){this.stream.advance(4);return this.track.cookie=this.stream.readBuffer(this.len-4)});a("moov.trak.mdia.minf.stbl.stsd.esds",function(){var e;e=this.stream.offset+this.len;this.track.cookie=m.readEsds(this.stream);return this.stream.seek(e)});a("moov.trak.mdia.minf.stbl.stsd.wave.enda",function(){return this.track.format.littleEndian=!!this.stream.readUInt16()});m.readDescrLen=function(e){var t,n,r;r=0;n=4;while(n--){t=e.readUInt8();r=r<<7|t&127;if(!(t&128)){break}}return r};m.readEsds=function(e){var t,n,r,i;e.advance(4);i=e.readUInt8();r=m.readDescrLen(e);if(i===3){e.advance(2);n=e.readUInt8();if(n&128){e.advance(2)}if(n&64){e.advance(e.readUInt8())}if(n&32){e.advance(2)}}else{e.advance(2)}i=e.readUInt8();r=m.readDescrLen(e);if(i===4){t=e.readUInt8();e.advance(1);e.advance(3);e.advance(4);e.advance(4);i=e.readUInt8();r=m.readDescrLen(e);if(i===5){return e.readBuffer(r)}}return null};a("moov.trak.mdia.minf.stbl.stts",function(){var e,t,n;this.stream.advance(4);e=this.stream.readUInt32();this.track.stts=[];for(t=n=0;n<e;t=n+=1){this.track.stts[t]={count:this.stream.readUInt32(),duration:this.stream.readUInt32()}}return this.setupSeekPoints()});a("moov.trak.mdia.minf.stbl.stsc",function(){var e,t,n;this.stream.advance(4);e=this.stream.readUInt32();this.track.stsc=[];for(t=n=0;n<e;t=n+=1){this.track.stsc[t]={first:this.stream.readUInt32(),count:this.stream.readUInt32(),id:this.stream.readUInt32()}}return this.setupSeekPoints()});a("moov.trak.mdia.minf.stbl.stsz",function(){var e,t,n;this.stream.advance(4);this.track.sampleSize=this.stream.readUInt32();e=this.stream.readUInt32();if(this.track.sampleSize===0&&e>0){this.track.sampleSizes=[];for(t=n=0;n<e;t=n+=1){this.track.sampleSizes[t]=this.stream.readUInt32()}}return this.setupSeekPoints()});a("moov.trak.mdia.minf.stbl.stco",function(){var e,t,n;this.stream.advance(4);e=this.stream.readUInt32();this.track.chunkOffsets=[];for(t=n=0;n<e;t=n+=1){this.track.chunkOffsets[t]=this.stream.readUInt32()}return this.setupSeekPoints()});a("moov.trak.tref.chap",function(){var e,t,n;e=this.len>>2;this.track.chapterTracks=[];for(t=n=0;n<e;t=n+=1){this.track.chapterTracks[t]=this.stream.readUInt32()}});m.prototype.setupSeekPoints=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;if(!(this.track.chunkOffsets!=null&&this.track.stsc!=null&&this.track.sampleSize!=null&&this.track.stts!=null)){return}o=0;u=0;u=0;a=0;i=0;n=0;f=0;this.track.seekPoints=[];p=this.track.chunkOffsets;v=[];for(e=l=0,h=p.length;l<h;e=++l){r=p[e];for(t=c=0,d=this.track.stsc[o].count;c<d;t=c+=1){this.track.seekPoints.push({offset:n,position:r,timestamp:f});s=this.track.sampleSize||this.track.sampleSizes[i++];n+=s;r+=s;f+=this.track.stts[u].duration;if(u+1<this.track.stts.length&&++a===this.track.stts[u].count){a=0;u++}}if(o+1<this.track.stsc.length&&e+1===this.track.stsc[o+1].first){v.push(o++)}else{v.push(void 0)}}return v};u("moov",function(){var e,t,n,r;if(this.mdatOffset!=null){this.stream.seek(this.mdatOffset-8)}r=this.tracks;for(t=0,n=r.length;t<n;t++){e=r[t];if(!(e.type==="soun")){continue}this.track=e;break}if(this.track.type!=="soun"){this.track=null;return this.emit("error","No audio tracks in m4a file.")}this.emit("format",this.track.format);this.emit("duration",this.track.duration/this.track.timeScale*1e3|0);if(this.track.cookie){this.emit("cookie",this.track.cookie)}return this.seekPoints=this.track.seekPoints});a("mdat",function(){var e,t,n,r,i,s,o,u;if(!this.startedData){if(this.mdatOffset==null){this.mdatOffset=this.stream.offset}if(this.tracks.length===0){e=Math.min(this.stream.remainingBytes(),this.len);this.stream.advance(e);this.len-=e;return}this.chunkIndex=0;this.stscIndex=0;this.sampleIndex=0;this.tailOffset=0;this.tailSamples=0;this.startedData=true}if(!this.readChapters){this.readChapters=this.parseChapters();if(this["break"]=!this.readChapters){return}this.stream.seek(this.mdatOffset)}i=this.track.chunkOffsets[this.chunkIndex]+this.tailOffset;n=0;if(!this.stream.available(i-this.stream.offset)){this["break"]=true;return}this.stream.seek(i);while(this.chunkIndex<this.track.chunkOffsets.length){r=this.track.stsc[this.stscIndex].count-this.tailSamples;t=0;for(s=u=0;u<r;s=u+=1){o=this.track.sampleSize||this.track.sampleSizes[this.sampleIndex];if(!this.stream.available(n+o)){break}n+=o;t+=o;this.sampleIndex++}if(s<r){this.tailOffset+=t;this.tailSamples+=s;break}else{this.chunkIndex++;this.tailOffset=0;this.tailSamples=0;if(this.stscIndex+1<this.track.stsc.length&&this.chunkIndex+1===this.track.stsc[this.stscIndex+1].first){this.stscIndex++}if(i+n!==this.track.chunkOffsets[this.chunkIndex]){break}}}if(n>0){this.emit("data",this.stream.readBuffer(n));return this["break"]=this.chunkIndex===this.track.chunkOffsets.length}else{return this["break"]=true}});m.prototype.parseChapters=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;if(!(((f=this.track.chapterTracks)!=null?f.length:void 0)>0)){return true}t=this.track.chapterTracks[0];l=this.tracks;for(u=0,a=l.length;u<a;u++){o=l[u];if(o.id===t){break}}if(o.id!==t){this.emit("error","Chapter track does not exist.")}if(this.chapters==null){this.chapters=[]}while(this.chapters.length<o.seekPoints.length){i=o.seekPoints[this.chapters.length];if(!this.stream.available(i.position-this.stream.offset+32)){return false}this.stream.seek(i.position);n=this.stream.readUInt16();s=null;if(!this.stream.available(n)){return false}if(n>2){e=this.stream.peekUInt16();if(e===65279||e===65534){s=this.stream.readString(n,"utf16-bom")}}if(s==null){s=this.stream.readString(n,"utf8")}r=(c=(h=o.seekPoints[this.chapters.length+1])!=null?h.timestamp:void 0)!=null?c:o.duration;this.chapters.push({title:s,timestamp:i.timestamp/o.timeScale*1e3|0,duration:(r-i.timestamp)/o.timeScale*1e3|0})}this.emit("chapters",this.chapters);return true};a("moov.udta.meta",function(){this.metadata={};return this.stream.advance(4)});u("moov.udta.meta",function(){return this.emit("metadata",this.metadata)});d=function(e,t,n){return a("moov.udta.meta.ilst."+e+".data",function(){this.stream.advance(8);this.len-=8;return n.call(this,t)})};v=function(e){return this.metadata[e]=this.stream.readString(this.len,"utf8")};d("©alb","album",v);d("©arg","arranger",v);d("©art","artist",v);d("©ART","artist",v);d("aART","albumArtist",v);d("catg","category",v);d("©com","composer",v);d("©cpy","copyright",v);d("cprt","copyright",v);d("©cmt","comments",v);d("©day","releaseDate",v);d("desc","description",v);d("©gen","genre",v);d("©grp","grouping",v);d("©isr","ISRC",v);d("keyw","keywords",v);d("©lab","recordLabel",v);d("ldes","longDescription",v);d("©lyr","lyrics",v);d("©nam","title",v);d("©phg","recordingCopyright",v);d("©prd","producer",v);d("©prf","performers",v);d("purd","purchaseDate",v);d("purl","podcastURL",v);d("©swf","songwriter",v);d("©too","encoder",v);d("©wrt","composer",v);d("covr","coverArt",function(e){return this.metadata[e]=this.stream.readBuffer(this.len)});p=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Capella","Euro-House","Dance Hall"];d("gnre","genre",function(e){return this.metadata[e]=p[this.stream.readUInt16()-1]});d("tmpo","tempo",function(e){return this.metadata[e]=this.stream.readUInt16()});d("rtng","rating",function(e){var t;t=this.stream.readUInt8();return this.metadata[e]=t===2?"Clean":t!==0?"Explicit":"None"});h=function(e){this.stream.advance(2);this.metadata[e]=this.stream.readUInt16()+" of "+this.stream.readUInt16();return this.stream.advance(this.len-6)};d("disk","diskNumber",h);d("trkn","trackNumber",h);l=function(e){return this.metadata[e]=this.stream.readUInt8()===1};d("cpil","compilation",l);d("pcst","podcast",l);d("pgap","gapless",l);return m}(t.Demuxer);var c,s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};c=function(e){function n(){s=n.__super__.constructor.apply(this,arguments);return s}r(n,e);t.Demuxer.register(n);n.probe=function(e){var t;return e.peekString(0,4)==="FORM"&&((t=e.peekString(8,4))==="AIFF"||t==="AIFC")};n.prototype.readChunk=function(){var e,t,n,r;if(!this.readStart&&this.stream.available(12)){if(this.stream.readString(4)!=="FORM"){return this.emit("error","Invalid AIFF.")}this.fileSize=this.stream.readUInt32();this.fileType=this.stream.readString(4);this.readStart=true;if((r=this.fileType)!=="AIFF"&&r!=="AIFC"){return this.emit("error","Invalid AIFF.")}}while(this.stream.available(1)){if(!this.readHeaders&&this.stream.available(8)){this.type=this.stream.readString(4);this.len=this.stream.readUInt32()}switch(this.type){case"COMM":if(!this.stream.available(this.len)){return}this.format={formatID:"lpcm",channelsPerFrame:this.stream.readUInt16(),sampleCount:this.stream.readUInt32(),bitsPerChannel:this.stream.readUInt16(),sampleRate:this.stream.readFloat80(),framesPerPacket:1,littleEndian:false,floatingPoint:false};this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame;if(this.fileType==="AIFC"){t=this.stream.readString(4);this.format.littleEndian=t==="sowt"&&this.format.bitsPerChannel>8;this.format.floatingPoint=t==="fl32"||t==="fl64";if(t==="twos"||t==="sowt"||t==="fl32"||t==="fl64"||t==="NONE"){t="lpcm"}this.format.formatID=t;this.len-=4}this.stream.advance(this.len-18);this.emit("format",this.format);this.emit("duration",this.format.sampleCount/this.format.sampleRate*1e3|0);break;case"SSND":if(!(this.readSSNDHeader&&this.stream.available(4))){n=this.stream.readUInt32();this.stream.advance(4);this.stream.advance(n);this.readSSNDHeader=true}e=this.stream.readSingleBuffer(this.len);this.len-=e.length;this.readHeaders=this.len>0;this.emit("data",e);break;default:if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}if(this.type!=="SSND"){this.readHeaders=false}}};return n}(t.Demuxer);var h,s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};h=function(e){function i(){s=i.__super__.constructor.apply(this,arguments);return s}var n;r(i,e);t.Demuxer.register(i);i.probe=function(e){return e.peekString(0,4)==="RIFF"&&e.peekString(8,4)==="WAVE"};n={1:"lpcm",3:"lpcm",6:"alaw",7:"ulaw"};i.prototype.readChunk=function(){var e,t,r;if(!this.readStart&&this.stream.available(12)){if(this.stream.readString(4)!=="RIFF"){return this.emit("error","Invalid WAV file.")}this.fileSize=this.stream.readUInt32(true);this.readStart=true;if(this.stream.readString(4)!=="WAVE"){return this.emit("error","Invalid WAV file.")}}while(this.stream.available(1)){if(!this.readHeaders&&this.stream.available(8)){this.type=this.stream.readString(4);this.len=this.stream.readUInt32(true)}switch(this.type){case"fmt ":r=this.stream.readUInt16(true);if(!(r in n)){return this.emit("error","Unsupported format in WAV file.")}this.format={formatID:n[r],floatingPoint:r===3,littleEndian:n[r]==="lpcm",channelsPerFrame:this.stream.readUInt16(true),sampleRate:this.stream.readUInt32(true),framesPerPacket:1};this.stream.advance(4);this.stream.advance(2);this.format.bitsPerChannel=this.stream.readUInt16(true);this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame;this.emit("format",this.format);this.stream.advance(this.len-16);break;case"data":if(!this.sentDuration){t=this.format.bitsPerChannel/8;this.emit("duration",this.len/t/this.format.channelsPerFrame/this.format.sampleRate*1e3|0);this.sentDuration=true}e=this.stream.readSingleBuffer(this.len);this.len-=e.length;this.readHeaders=this.len>0;this.emit("data",e);break;default:if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}if(this.type!=="data"){this.readHeaders=false}}};return i}(t.Demuxer);var p,s,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};p=function(e){function o(){s=o.__super__.constructor.apply(this,arguments);return s}var n,i;r(o,e);t.Demuxer.register(o);o.probe=function(e){return e.peekString(0,4)===".snd"};n=[8,8,16,24,32,32,64];n[26]=8;i={1:"ulaw",27:"alaw"};o.prototype.readChunk=function(){var e,t,r,s;if(!this.readHeader&&this.stream.available(24)){if(this.stream.readString(4)!==".snd"){return this.emit("error","Invalid AU file.")}s=this.stream.readUInt32();t=this.stream.readUInt32();r=this.stream.readUInt32();this.format={formatID:i[r]||"lpcm",littleEndian:false,floatingPoint:r===6||r===7,bitsPerChannel:n[r-1],sampleRate:this.stream.readUInt32(),channelsPerFrame:this.stream.readUInt32(),framesPerPacket:1};if(this.format.bitsPerChannel==null){return this.emit("error","Unsupported encoding in AU file.")}this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame;if(t!==4294967295){e=this.format.bitsPerChannel/8;this.emit("duration",t/e/this.format.channelsPerFrame/this.format.sampleRate*1e3|0)}this.emit("format",this.format);this.readHeader=true}if(this.readHeader){while(this.stream.available(1)){this.emit("data",this.stream.readSingleBuffer(this.stream.remainingBytes()))}}};return o}(t.Demuxer);var d,s,u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};d=function(e){function n(){this.readChunk=u(this.readChunk,this);s=n.__super__.constructor.apply(this,arguments);return s}r(n,e);t.Decoder.register("lpcm",n);n.prototype.readChunk=function(){var e,t,n,r,i,s,o,u,a,f,l,c;s=this.stream;n=this.format.littleEndian;e=Math.min(4096,s.remainingBytes());i=e/(this.format.bitsPerChannel/8)|0;if(e<this.format.bitsPerChannel/8){return null}if(this.format.floatingPoint){switch(this.format.bitsPerChannel){case 32:r=new Float32Array(i);for(t=o=0;o<i;t=o+=1){r[t]=s.readFloat32(n)}break;case 64:r=new Float64Array(i);for(t=u=0;u<i;t=u+=1){r[t]=s.readFloat64(n)}break;default:throw new Error("Unsupported bit depth.")}}else{switch(this.format.bitsPerChannel){case 8:r=new Int8Array(i);for(t=a=0;a<i;t=a+=1){r[t]=s.readInt8()}break;case 16:r=new Int16Array(i);for(t=f=0;f<i;t=f+=1){r[t]=s.readInt16(n)}break;case 24:r=new Int32Array(i);for(t=l=0;l<i;t=l+=1){r[t]=s.readInt24(n)}break;case 32:r=new Int32Array(i);for(t=c=0;c<i;t=c+=1){r[t]=s.readInt32(n)}break;default:throw new Error("Unsupported bit depth.")}}return r};return n}(t.Decoder);var v,s,u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};v=function(e){function l(){this.readChunk=u(this.readChunk,this);s=l.__super__.constructor.apply(this,arguments);return s}var n,i,o,a,f;r(l,e);t.Decoder.register("ulaw",l);t.Decoder.register("alaw",l);f=128;i=15;a=4;o=112;n=132;l.prototype.init=function(){var e,t,r,s,u,l,c;this.format.bitsPerChannel=16;this.table=s=new Int16Array(256);if(this.format.formatID==="ulaw"){for(e=l=0;l<256;e=++l){u=~e;r=((u&i)<<3)+n;r<<=(u&o)>>>a;s[e]=u&f?n-r:r-n}}else{for(e=c=0;c<256;e=++c){u=e^85;r=u&i;t=(u&o)>>>a;if(t){r=r+r+1+32<<t+2}else{r=r+r+1<<3}s[e]=u&f?r:-r}}};l.prototype.readChunk=function(){var e,t,n,r,i,s;r=this.stream,i=this.table;n=Math.min(4096,this.stream.remainingBytes());if(n===0){return}t=new Int16Array(n);for(e=s=0;s<n;e=s+=1){t[e]=i[r.readUInt8()]}return t};return l}(t.Decoder);var n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.HTTPSource=function(e){function n(e){this.url=e;this.chunkSize=1<<20;this.inflight=false;this.reset()}r(n,e);n.prototype.start=function(){var e=this;if(this.length){if(!this.inflight){return this.loop()}}this.inflight=true;this.xhr=new XMLHttpRequest;this.xhr.onload=function(t){e.length=parseInt(e.xhr.getResponseHeader("Content-Length"));e.inflight=false;return e.loop()};this.xhr.onerror=function(t){e.pause();return e.emit("error",t)};this.xhr.onabort=function(t){return e.inflight=false};this.xhr.open("HEAD",this.url,true);return this.xhr.send(null)};n.prototype.loop=function(){var e,n=this;if(this.inflight||!this.length){return this.emit("error","Something is wrong in HTTPSource.loop")}this.inflight=true;this.xhr=new XMLHttpRequest;this.xhr.onload=function(e){var r,i,s,o,u,a;if(n.xhr.response){r=new Uint8Array(n.xhr.response)}else{o=n.xhr.responseText;r=new Uint8Array(o.length);for(s=u=0,a=o.length;0<=a?u<a:u>a;s=0<=a?++u:--u){r[s]=o.charCodeAt(s)&255}}i=new t.Buffer(r);n.offset+=i.length;n.emit("data",i);if(n.offset>=n.length){n.emit("end")}n.inflight=false;if(!(n.offset>=n.length)){return n.loop()}};this.xhr.onprogress=function(e){return n.emit("progress",(n.offset+e.loaded)/n.length*100)};this.xhr.onerror=function(e){n.emit("error",e);return n.pause()};this.xhr.onabort=function(e){return n.inflight=false};this.xhr.open("GET",this.url,true);this.xhr.responseType="arraybuffer";e=Math.min(this.offset+this.chunkSize,this.length);this.xhr.setRequestHeader("Range","bytes="+this.offset+"-"+e);this.xhr.overrideMimeType("text/plain; charset=x-user-defined");return this.xhr.send(null)};n.prototype.pause=function(){var e;this.inflight=false;return(e=this.xhr)!=null?e.abort():void 0};n.prototype.reset=function(){this.pause();return this.offset=0};return n}(t.EventEmitter);var n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};t.FileSource=function(e){function n(e){this.file=e;if(typeof FileReader==="undefined"||FileReader===null){return this.emit("error","This browser does not have FileReader support.")}this.offset=0;this.length=this.file.size;this.chunkSize=1<<20;this.file[this.slice="slice"]||this.file[this.slice="webkitSlice"]||this.file[this.slice="mozSlice"]}r(n,e);n.prototype.start=function(){var e=this;if(this.reader){if(!this.active){return this.loop()}}this.reader=new FileReader;this.active=true;this.reader.onload=function(n){var r;r=new t.Buffer(new Uint8Array(n.target.result));e.offset+=r.length;e.emit("data",r);e.active=false;if(e.offset<e.length){return e.loop()}};this.reader.onloadend=function(){if(e.offset===e.length){e.emit("end");return e.reader=null}};this.reader.onerror=function(t){return e.emit("error",t)};this.reader.onprogress=function(t){return e.emit("progress",(e.offset+t.loaded)/e.length*100)};return this.loop()};n.prototype.loop=function(){var e,t;this.active=true;t=Math.min(this.offset+this.chunkSize,this.length);e=this.file[this.slice](this.offset,t);return this.reader.readAsArrayBuffer(e)};n.prototype.pause=function(){var e;this.active=false;return(e=this.reader)!=null?e.abort():void 0};n.prototype.reset=function(){this.pause();return this.offset=0};return n}(t.EventEmitter);m.prototype.initialize=function(){if(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0){if(this.fromSampleRate==this.toSampleRate){this.resampler=this.bypassResampler;this.ratioWeight=1}else{if(this.fromSampleRate<this.toSampleRate){this.compileLinearInterpolationFunction();this.lastWeight=1}else{this.compileMultiTapFunction();this.tailExists=false;this.lastWeight=0}this.ratioWeight=this.fromSampleRate/this.toSampleRate;this.initializeBuffers()}}else{throw new Error("Invalid settings specified for the resampler.")}};m.prototype.compileLinearInterpolationFunction=function(){var e="var bufferLength = buffer.length;  var outLength = this.outputBufferSize;  if ((bufferLength % "+this.channels+") == 0) {    if (bufferLength > 0) {     var ratioWeight = this.ratioWeight;     var weight = this.lastWeight;     var firstWeight = 0;      var secondWeight = 0;     var sourceOffset = 0;     var outputOffset = 0;     var outputBuffer = this.outputBuffer;     for (; weight < 1; weight += ratioWeight) {       secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var t=0;t<this.channels;++t){e+="outputBuffer[outputOffset++] = (this.lastOutput["+t+"] * firstWeight) + (buffer["+t+"] * secondWeight);"}e+="}      weight -= 1;      for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var t=0;t<this.channels;++t){e+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(t>0?" + "+t:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+t)+"] * secondWeight);"}e+="weight += ratioWeight;        sourceOffset = Math.floor(weight) * "+this.channels+";      }";for(var t=0;t<this.channels;++t){e+="this.lastOutput["+t+"] = buffer[sourceOffset++];"}e+='this.lastWeight = weight % 1;     return this.bufferSlice(outputOffset);    }   else {      return (this.noReturn) ? 0 : [];    } } else {    throw(new Error("Buffer was of incorrect sample length.")); }';this.resampler=Function("buffer",e)};m.prototype.compileMultiTapFunction=function(){var e="var bufferLength = buffer.length; var outLength = this.outputBufferSize;  if ((bufferLength % "+this.channels+") == 0) {    if (bufferLength > 0) {     var ratioWeight = this.ratioWeight;     var weight = 0;";for(var t=0;t<this.channels;++t){e+="var output"+t+" = 0;"}e+="var actualPosition = 0;     var amountToNext = 0;     var alreadyProcessedTail = !this.tailExists;      this.tailExists = false;      var outputBuffer = this.outputBuffer;     var outputOffset = 0;     var currentPosition = 0;      do {        if (alreadyProcessedTail) {         weight = ratioWeight;";for(t=0;t<this.channels;++t){e+="output"+t+" = 0;"}e+="}       else {          weight = this.lastWeight;";for(t=0;t<this.channels;++t){e+="output"+t+" = this.lastOutput["+t+"];"}e+="alreadyProcessedTail = true;       }       while (weight > 0 && actualPosition < bufferLength) {         amountToNext = 1 + actualPosition - currentPosition;          if (weight >= amountToNext) {";for(t=0;t<this.channels;++t){e+="output"+t+" += buffer[actualPosition++] * amountToNext;"}e+="currentPosition = actualPosition;            weight -= amountToNext;         }         else {";for(t=0;t<this.channels;++t){e+="output"+t+" += buffer[actualPosition"+(t>0?" + "+t:"")+"] * weight;"}e+="currentPosition += weight;            weight = 0;           break;          }       }       if (weight == 0) {";for(t=0;t<this.channels;++t){e+="outputBuffer[outputOffset++] = output"+t+" / ratioWeight;"}e+="}       else {          this.lastWeight = weight;";for(t=0;t<this.channels;++t){e+="this.lastOutput["+t+"] = output"+t+";"}e+='this.tailExists = true;          break;        }     } while (actualPosition < bufferLength && outputOffset < outLength);      return this.bufferSlice(outputOffset);    }   else {      return (this.noReturn) ? 0 : [];    } } else {    throw(new Error("Buffer was of incorrect sample length.")); }';this.resampler=Function("buffer",e)};m.prototype.bypassResampler=function(e){if(this.noReturn){this.outputBuffer=e;return e.length}else{return e}};m.prototype.bufferSlice=function(e){if(this.noReturn){return e}else{try{return this.outputBuffer.subarray(0,e)}catch(t){try{this.outputBuffer.length=e;return this.outputBuffer}catch(t){return this.outputBuffer.slice(0,e)}}}};m.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize);this.lastOutput=new Float32Array(this.channels)}catch(e){this.outputBuffer=[];this.lastOutput=[]}};var g,u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};g=function(n){function a(e,t){this.sampleRate=e;this.channels=t;this.refill=u(this.refill,this);this.context=o!=null?o:o=new i;this.deviceSampleRate=this.context.sampleRate;this.bufferSize=Math.ceil(4096/(this.deviceSampleRate/this.sampleRate)*this.channels);this.bufferSize+=this.bufferSize%this.channels;if(this.deviceSampleRate!==this.sampleRate){this.resampler=new m(this.sampleRate,this.deviceSampleRate,this.channels,4096*this.channels)}this.node=this.context[s](4096,this.channels,this.channels);this.node.onaudioprocess=this.refill;this.node.connect(this.context.destination)}var i,s,o;r(a,n);t.AudioDevice.register(a);i=e.AudioContext||e.webkitAudioContext;a.supported=i&&(typeof i.prototype[s="createScriptProcessor"]==="function"||typeof i.prototype[s="createJavaScriptNode"]==="function");o=null;a.prototype.refill=function(e){var t,n,r,i,s,o,u,a,f,l;o=e.outputBuffer;t=o.numberOfChannels;n=new Array(t);for(i=u=0;u<t;i=u+=1){n[i]=o.getChannelData(i)}r=new Float32Array(this.bufferSize);this.emit("refill",r);if(this.resampler){r=this.resampler.resampler(r)}for(i=a=0,l=o.length;a<l;i=a+=1){for(s=f=0;f<t;s=f+=1){n[s][i]=r[i*t+s]}}};a.prototype.destroy=function(){return this.node.disconnect(0)};a.prototype.getDeviceTime=function(){return this.context.currentTime*this.sampleRate};return a}(t.EventEmitter);var y,u=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};y=function(e){function s(e,t){this.sampleRate=e;this.channels=t;this.refill=u(this.refill,this);this.audio=new Audio;this.audio.mozSetup(this.channels,this.sampleRate);this.writePosition=0;this.prebufferSize=this.sampleRate/2;this.tail=null;this.timer=n(this.refill,100)}var n,i;r(s,e);t.AudioDevice.register(s);s.supported=typeof Audio!=="undefined"&&Audio!==null&&"mozWriteAudio"in new Audio;s.prototype.refill=function(){var e,t,n,r;if(this.tail){r=this.audio.mozWriteAudio(this.tail);this.writePosition+=r;if(this.writePosition<this.tail.length){this.tail=this.tail.subarray(r)}else{this.tail=null}}n=this.audio.mozCurrentSampleOffset();e=n+this.prebufferSize-this.writePosition;if(e>0){t=new Float32Array(e);this.emit("refill",t);r=this.audio.mozWriteAudio(t);if(r<t.length){this.tail=t.subarray(r)}this.writePosition+=r}};s.prototype.destroy=function(){return i(this.timer)};s.prototype.getDeviceTime=function(){return this.audio.mozCurrentSampleOffset()/this.channels};n=function(e,n){var r,i;r=t.Buffer.makeBlobURL("setInterval(function() { postMessage('ping'); }, "+n+");");if(r==null){return setInterval(e,n)}i=new Worker(r);i.onmessage=e;i.url=r;return i};i=function(e){if(e.terminate){e.terminate();return URL.revokeObjectURL(e.url)}else{return clearInterval(e)}};return s}(t.EventEmitter);const b=["latin1","utf16-bom","utf16-be","utf8"];var w=t.Base.extend({constructor:function(e,t){this.header=e;this.stream=t;this.offset=0},read:function(){if(!this.data){this.data={};var e;while(e=this.readFrame()){if(e.key in this.data){if(!Array.isArray(this.data[e.key]))this.data[e.key]=[this.data[e.key]];this.data[e.key].push(e.value)}else{this.data[e.key]=e.value}}}return this.data},readFrame:function(){if(this.offset>=this.header.length)return null;var e=this.readHeader();var t=e.identifier;if(e.identifier.charCodeAt(0)===0){this.offset+=this.header.length+1;return null}if(!this.frameTypes[t]){for(var n in this.map){if(this.map[n].indexOf(t)!==-1){t=n;break}}}if(this.frameTypes[t]){var r=this.decodeFrame(e,this.frameTypes[t]),i=Object.keys(r);if(i.length===1)r=r[i[0]];var s={value:r}}else{var s={value:this.stream.readBuffer(Math.min(e.length,this.header.length-this.offset))}}s.key=this.names[e.identifier]?this.names[e.identifier]:e.identifier;if(s.key==="coverArt")s.value=s.value.data;this.offset+=10+e.length;return s},decodeFrame:function(e,t){var n=this.stream,r=n.offset;var i=0,s={};var o=Object.keys(t).length,u=0;for(var a in t){var f=t[a];var l=e.length-(n.offset-r);u++;switch(a){case"encoding":i=n.readUInt8();continue;case"language":s.language=n.readString(3);continue}switch(f){case"latin1":s[a]=n.readString(u===o?l:null,"latin1");break;case"string":s[a]=n.readString(u===o?l:null,b[i]);break;case"binary":s[a]=n.readBuffer(l);break;case"int16":s[a]=n.readInt16();break;case"int8":s[a]=n.readInt8();break;case"int24":s[a]=n.readInt24();break;case"int32":s[a]=n.readInt32();break;case"int32+":s[a]=n.readInt32();if(l>4)throw new Error("Seriously dude? Stop playing this song and get a life!");break;case"date":var c=n.readString(8);s[a]=new Date(c.slice(0,4),c.slice(4,6)-1,c.slice(6,8));break;case"frame_id":s[a]=n.readString(4);break;default:throw new Error("Unknown key type "+f)}}var l=e.length-(n.offset-r);if(l>0)n.advance(l);return s}});var E=w.extend({readHeader:function(){var e=this.stream.readString(4);var t=0;if(this.header.major===4){for(var n=0;n<4;n++)t=(t<<7)+(this.stream.readUInt8()&127)}else{t=this.stream.readUInt32()}return{identifier:e,length:t,flags:this.stream.readUInt16()}},map:{text:["TIT1","TIT2","TIT3","TALB","TOAL","TRCK","TPOS","TSST","TSRC","TPE1","TPE2","TPE3","TPE4","TOPE","TEXT","TOLY","TCOM","TMCL","TIPL","TENC","TBPM","TLEN","TKEY","TLAN","TCON","TFLT","TMED","TMOO","TCOP","TPRO","TPUB","TOWN","TRSN","TRSO","TOFN","TDLY","TDEN","TDOR","TDRC","TDRL","TDTG","TSSE","TSOA","TSOP","TSOT","TDAT","TIME","TORY","TRDA","TSIZ","TYER","TCMP","TSO2","TSOC"],url:["WCOM","WCOP","WOAF","WOAR","WOAS","WORS","WPAY","WPUB"]},frameTypes:{text:{encoding:1,value:"string"},url:{value:"latin1"},TXXX:{encoding:1,description:"string",value:"string"},WXXX:{encoding:1,description:"string",value:"latin1"},USLT:{encoding:1,language:1,description:"string",value:"string"},COMM:{encoding:1,language:1,description:"string",value:"string"},APIC:{encoding:1,mime:"latin1",type:"int8",description:"string",data:"binary"},UFID:{owner:"latin1",identifier:"binary"},MCDI:{value:"binary"},PRIV:{owner:"latin1",value:"binary"},GEOB:{encoding:1,mime:"latin1",filename:"string",description:"string",data:"binary"},PCNT:{value:"int32+"},POPM:{email:"latin1",rating:"int8",counter:"int32+"},AENC:{owner:"latin1",previewStart:"int16",previewLength:"int16",encryptionInfo:"binary"},ETCO:{format:"int8",data:"binary"},MLLT:{framesBetweenReference:"int16",bytesBetweenReference:"int24",millisecondsBetweenReference:"int24",bitsForBytesDeviation:"int8",bitsForMillisecondsDev:"int8",data:"binary"},SYTC:{format:"int8",tempoData:"binary"},SYLT:{encoding:1,language:1,format:"int8",contentType:"int8",description:"string",data:"binary"},RVA2:{identification:"latin1",data:"binary"},EQU2:{interpolationMethod:"int8",identification:"latin1",data:"binary"},RVRB:{left:"int16",right:"int16",bouncesLeft:"int8",bouncesRight:"int8",feedbackLL:"int8",feedbackLR:"int8",feedbackRR:"int8",feedbackRL:"int8",premixLR:"int8",premixRL:"int8"},RBUF:{size:"int24",flag:"int8",offset:"int32"},LINK:{identifier:"frame_id",url:"latin1",data:"binary"},POSS:{format:"int8",position:"binary"},USER:{encoding:1,language:1,value:"string"},OWNE:{encoding:1,price:"latin1",purchaseDate:"date",seller:"string"},COMR:{encoding:1,price:"latin1",validUntil:"date",contactURL:"latin1",receivedAs:"int8",seller:"string",description:"string",logoMime:"latin1",logo:"binary"},ENCR:{owner:"latin1",methodSymbol:"int8",data:"binary"},GRID:{owner:"latin1",groupSymbol:"int8",data:"binary"},SIGN:{groupSymbol:"int8",signature:"binary"},SEEK:{value:"int32"},ASPI:{dataStart:"int32",dataLength:"int32",numPoints:"int16",bitsPerPoint:"int8",data:"binary"},IPLS:{encoding:1,value:"string"},RVAD:{adjustment:"int8",bits:"int8",data:"binary"},EQUA:{adjustmentBits:"int8",data:"binary"}},names:{TIT1:"grouping",TIT2:"title",TIT3:"subtitle",TALB:"album",TOAL:"originalAlbumTitle",TRCK:"trackNumber",TPOS:"diskNumber",TSST:"setSubtitle",TSRC:"ISRC",TPE1:"artist",TPE2:"albumArtist",TPE3:"conductor",TPE4:"modifiedBy",TOPE:"originalArtist",TEXT:"lyricist",TOLY:"originalLyricist",TCOM:"composer",TMCL:"musicianCreditsList",TIPL:"involvedPeopleList",TENC:"encodedBy",TBPM:"tempo",TLEN:"length",TKEY:"initialKey",TLAN:"language",TCON:"genre",TFLT:"fileType",TMED:"mediaType",TMOO:"mood",TCOP:"copyright",TPRO:"producedNotice",TPUB:"publisher",TOWN:"fileOwner",TRSN:"internetRadioStationName",TRSO:"internetRadioStationOwner",TOFN:"originalFilename",TDLY:"playlistDelay",TDEN:"encodingTime",TDOR:"originalReleaseTime",TDRC:"recordingTime",TDRL:"releaseTime",TDTG:"taggingTime",TSSE:"encodedWith",TSOA:"albumSortOrder",TSOP:"performerSortOrder",TSOT:"titleSortOrder",TXXX:"userText",USLT:"lyrics",APIC:"coverArt",UFID:"uniqueIdentifier",MCDI:"CDIdentifier",COMM:"comments",WCOM:"commercialInformation",WCOP:"copyrightInformation",WOAF:"officialAudioFileWebpage",WOAR:"officialArtistWebpage",WOAS:"officialAudioSourceWebpage",WORS:"officialInternetRadioStationHomepage",WPAY:"payment",WPUB:"officialPublisherWebpage",WXXX:"url",PRIV:"private",GEOB:"generalEncapsulatedObject",PCNT:"playCount",POPM:"rating",AENC:"audioEncryption",ETCO:"eventTimingCodes",MLLT:"MPEGLocationLookupTable",SYTC:"synchronisedTempoCodes",SYLT:"synchronisedLyrics",RVA2:"volumeAdjustment",EQU2:"equalization",RVRB:"reverb",RBUF:"recommendedBufferSize",LINK:"link",POSS:"positionSynchronisation",USER:"termsOfUse",OWNE:"ownership",COMR:"commercial",ENCR:"encryption",GRID:"groupIdentifier",SIGN:"signature",SEEK:"seek",ASPI:"audioSeekPointIndex",TDAT:"date",TIME:"time",TORY:"originalReleaseYear",TRDA:"recordingDates",TSIZ:"size",TYER:"year",IPLS:"involvedPeopleList",RVAD:"volumeAdjustment",EQUA:"equalization",TCMP:"compilation",TSO2:"albumArtistSortOrder",TSOC:"composerSortOrder"}});var S=E.extend({readHeader:function(){var e=this.stream.readString(3);if(this.frameReplacements[e]&&!this.frameTypes[e])this.frameTypes[e]=this.frameReplacements[e];return{identifier:this.replacements[e]||e,length:this.stream.readUInt24()}},replacements:{UFI:"UFID",TT1:"TIT1",TT2:"TIT2",TT3:"TIT3",TP1:"TPE1",TP2:"TPE2",TP3:"TPE3",TP4:"TPE4",TCM:"TCOM",TXT:"TEXT",TLA:"TLAN",TCO:"TCON",TAL:"TALB",TPA:"TPOS",TRK:"TRCK",TRC:"TSRC",TYE:"TYER",TDA:"TDAT",TIM:"TIME",TRD:"TRDA",TMT:"TMED",TFT:"TFLT",TBP:"TBPM",TCR:"TCOP",TPB:"TPUB",TEN:"TENC",TSS:"TSSE",TOF:"TOFN",TLE:"TLEN",TSI:"TSIZ",TDY:"TDLY",TKE:"TKEY",TOT:"TOAL",TOA:"TOPE",TOL:"TOLY",TOR:"TORY",TXX:"TXXX",WAF:"WOAF",WAR:"WOAR",WAS:"WOAS",WCM:"WCOM",WCP:"WCOP",WPB:"WPUB",WXX:"WXXX",IPL:"IPLS",MCI:"MCDI",ETC:"ETCO",MLL:"MLLT",STC:"SYTC",ULT:"USLT",SLT:"SYLT",COM:"COMM",RVA:"RVAD",EQU:"EQUA",REV:"RVRB",GEO:"GEOB",CNT:"PCNT",POP:"POPM",BUF:"RBUF",CRA:"AENC",LNK:"LINK",TST:"TSOT",TSP:"TSOP",TSA:"TSOA",TCP:"TCMP",TS2:"TSO2",TSC:"TSOC"},frameReplacements:{PIC:{encoding:1,format:"int24",type:"int8",description:"string",data:"binary"},CRM:{owner:"latin1",description:"latin1",data:"binary"}}});var x=t.Demuxer.extend(function(){t.Demuxer.register(this);this.probe=function(e){var n=e.offset;var r=x.getID3v2Header(e);if(r)e.advance(10+r.length);var i=new T(new t.Bitstream(e));var s=null;try{s=D.decode(i)}catch(o){}e.seek(n);return!!s};this.getID3v2Header=function(e){if(e.peekString(0,3)=="ID3"){e=t.Stream.fromBuffer(e.peekBuffer(0,10));e.advance(3);var n=e.readUInt8();var r=e.readUInt8();var i=e.readUInt8();var s=e.readBuffer(4).data;var o=s[0]<<21|s[1]<<14|s[2]<<7|s[3];return{version:"2."+n+"."+r,major:n,minor:r,flags:i,length:o}}return null};const e=[[32,17],[17,9]];this.prototype.parseDuration=function(t){var n=this.stream;var r;var i=n.offset;if(!t||t.layer!==3)return false;n.advance(e[t.flags&k.LSF_EXT?1:0][t.nchannels()===1?1:0]);var s=n.readString(4);if(s==="Xing"||s==="Info"){var o=n.readUInt32();if(o&1)r=n.readUInt32();if(o&2)var u=n.readUInt32();if(o&4&&r&&u){for(var a=0;a<100;a++){var f=n.readUInt8();var l=f/256*u|0;var c=a/100*r*t.nbsamples()*32|0;this.addSeekPoint(l,c)}}if(o&8)n.advance(4)}else{n.seek(i+4+32);s=n.readString(4);if(s=="VBRI"&&n.readUInt16()===1){n.advance(4);n.advance(4);r=n.readUInt32();var h=n.readUInt16();var p=n.readUInt16();var d=n.readUInt16();var v=n.readUInt16();var m="readUInt"+d*8;var l=0;for(var a=0;a<h;a++){this.addSeekPoint(l,v*a);l+=n[m]()}}}if(!r)return false;this.emit("duration",r*t.nbsamples()*32/t.samplerate*1e3|0);return true};this.prototype.readChunk=function(){var e=this.stream;if(!this.sentInfo){var n=x.getID3v2Header(e);if(n){e.advance(10);if(n.major>2){var r=new E(n,e)}else{var r=new S(n,e)}this.emit("metadata",r.read())}var i=e.offset;var s=new T(new t.Bitstream(e));var o=D.decode(s);if(!o)return this.emit("error","Could not find first frame.");this.emit("format",{formatID:"mp3",sampleRate:o.samplerate,channelsPerFrame:o.nchannels(),bitrate:o.bitrate,floatingPoint:true});var u=this.parseDuration(o);e.advance(i-e.offset);this.dataSize=0;if(!u){this.on("end",function(){this.emit("duration",this.dataSize*8/o.bitrate*1e3|0)})}this.sentInfo=true}while(e.available(1)){var a=e.readSingleBuffer(e.remainingBytes());this.dataSize+=a.length;this.emit("data",a)}}});T.prototype.getU8=function(e){var t=this.stream.stream;return t.peekUInt8(e-t.offset)};T.prototype.nextByte=function(){var e=this.stream;return e.bitPosition===0?e.stream.offset:e.stream.offset+1};T.prototype.doSync=function(){var e=this.stream.stream;this.align();while(this.available(16)&&!(e.peekUInt8(0)===255&&(e.peekUInt8(1)&224)===224)){this.advance(8)}if(!this.available(M))return false;return true};T.prototype.reset=function(e){this.seek(e*8);this.next_frame=e;this.sync=true};const N=[[0,32e3,64e3,96e3,128e3,16e4,192e3,224e3,256e3,288e3,32e4,352e3,384e3,416e3,448e3],[0,32e3,48e3,56e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4,384e3],[0,32e3,4e4,48e3,56e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4],[0,32e3,48e3,56e3,64e3,8e4,96e3,112e3,128e3,144e3,16e4,176e3,192e3,224e3,256e3],[0,8e3,16e3,24e3,32e3,4e4,48e3,56e3,64e3,8e4,96e3,112e3,128e3,144e3,16e4]];const C=[44100,48e3,32e3];const k={NPRIVATE_III:7,INCOMPLETE:8,PROTECTION:16,COPYRIGHT:32,ORIGINAL:64,PADDING:128,I_STEREO:256,MS_STEREO:512,FREEFORMAT:1024,LSF_EXT:4096,MC_EXT:8192,MPEG_2_5_EXT:16384};const L={HEADER:256,III:31};const A={SINGLE_CHANNEL:0,DUAL_CHANNEL:1,JOINT_STEREO:2,STEREO:3};const O={NONE:0,_50_15_US:1,CCITT_J_17:3,RESERVED:2};const M=8;const _=511+2048+M;D.prototype.copy=function(){var e=new D;var t=Object.keys(this);for(var n in t){e[n]=this[n]}return e};D.prototype.nchannels=function(){return this.mode===0?1:2};D.prototype.nbsamples=function(){return this.layer===1?12:this.layer===3&&this.flags&k.LSF_EXT?18:36};D.prototype.framesize=function(){if(this.bitrate===0)return null;var e=this.flags&k.PADDING?1:0;switch(this.layer){case 1:var t=this.bitrate*12/this.samplerate|0;return(t+e)*4;case 2:var t=this.bitrate*144/this.samplerate|0;return t+e;case 3:default:var n=this.flags&k.LSF_EXT?1:0;var t=this.bitrate*144/(this.samplerate<<n)|0;return t+e}};D.prototype.decode=function(e){this.flags=0;this.private_bits=0;e.advance(11);if(e.read(1)===0)this.flags|=k.MPEG_2_5_EXT;if(e.read(1)===0){this.flags|=k.LSF_EXT}else if(this.flags&k.MPEG_2_5_EXT){throw new t.UnderflowError}this.layer=4-e.read(2);if(this.layer===4)throw new Error("Invalid layer");if(e.read(1)===0)this.flags|=k.PROTECTION;var n=e.read(4);if(n===15)throw new Error("Invalid bitrate");if(this.flags&k.LSF_EXT){this.bitrate=N[3+(this.layer>>1)][n]}else{this.bitrate=N[this.layer-1][n]}n=e.read(2);if(n===3)throw new Error("Invalid sampling frequency");this.samplerate=C[n];if(this.flags&k.LSF_EXT){this.samplerate/=2;if(this.flags&k.MPEG_2_5_EXT)this.samplerate/=2}if(e.read(1))this.flags|=k.PADDING;if(e.read(1))this.private_bits|=L.HEADER;this.mode=3-e.read(2);this.mode_extension=e.read(2);if(e.read(1))this.flags|=k.COPYRIGHT;if(e.read(1))this.flags|=k.ORIGINAL;this.emphasis=e.read(2);if(this.flags&k.PROTECTION)this.crc_target=e.read(16)};D.decode=function(e){var n=e.next_frame;var r=true;var i=null;while(r){r=false;if(e.sync){if(!e.available(M)){e.next_frame=n;throw new t.UnderflowError}else if(!(e.getU8(n)===255&&(e.getU8(n+1)&224)===224)){e.this_frame=n;e.next_frame=n+1;throw new t.UnderflowError}}else{e.seek(n*8);if(!e.doSync())throw new t.UnderflowError;n=e.nextByte()}e.this_frame=n;e.next_frame=n+1;e.seek(e.this_frame*8);i=new D;i.decode(e);if(i.bitrate===0){if(e.freerate===0||!e.sync||i.layer===3&&e.freerate>64e4)D.free_bitrate(e,i);i.bitrate=e.freerate;i.flags|=k.FREEFORMAT}var s=i.flags&k.PADDING?1:0;if(i.layer===1){var o=((12*i.bitrate/i.samplerate<<0)+s)*4}else{var u=i.layer===3&&i.flags&k.LSF_EXT?72:144;var o=(u*i.bitrate/i.samplerate<<0)+s}if(!e.available(o+M)){e.next_frame=e.this_frame;throw new t.UnderflowError}e.next_frame=e.this_frame+o;if(!e.sync){n=e.next_frame;if(!(e.getU8(n)===255&&(e.getU8(n+1)&224)===224)){n=e.next_frame=e.this_frame+1;r=true;continue}e.sync=true}}i.flags|=k.INCOMPLETE;return i};D.free_bitrate=function(e,n){var r=n.flags&k.PADDING?1:0,i=n.layer===3&&n.flags&k.LSF_EXT?72:144;var s=e.offset();var o=0;while(e.doSync()){var u=n.copy();var a=e.copy();if(u.decode(a)&&u.layer===n.layer&&u.samplerate===n.samplerate){var f=e.nextByte()-e.this_frame;if(n.layer===1){o=n.samplerate*(f-4*r+4)/48/1e3|0}else{o=n.samplerate*(f-r+1)/i/1e3|0}if(o>=8)break}e.advance(8)}e.seek(s);if(o<8||n.layer===3&&o>640)throw new t.UnderflowError;e.freerate=o*1e3};P.layers=[];P.prototype.decode=function(e){if(!this.header||!(this.header.flags&k.INCOMPLETE))this.header=D.decode(e);this.header.flags&=~k.INCOMPLETE;var t=this.decoders[this.header.layer-1];if(!t){var n=P.layers[this.header.layer];if(!n)throw new Error("Layer "+this.header.layer+" is not supported.");t=this.decoders[this.header.layer-1]=new n}t.decode(e,this)};const j=.998795456;const F=.995184727;const I=.98917651;const q=.98078528;const R=.970031253;const U=.956940336;const z=.941544065;const W=.923879533;const X=.903989293;const V=.881921264;const $=.85772861;const J=.831469612;const K=.803207531;const Q=.773010453;const G=.740951125;const Y=.707106781;const Z=.671558955;const et=.634393284;const tt=.595699304;const nt=.555570233;const rt=.514102744;const it=.471396737;const st=.427555093;const ot=.382683432;const ut=.336889853;const at=.290284677;const ft=.24298018;const lt=.195090322;const ct=.146730474;const ht=.09801714;const pt=.049067674;B.dct32=function(e,t,n,r){var i,s,o,u,a,f,l,c;var h,p,d,v,m,g,y,b;var w,E,S,x,T,N,C,k;var L,A,O,M,_,D,P,H;var B,dt,vt,mt,gt,yt,bt,wt;var Et,St,xt,Tt,Nt,Ct,kt,Lt;var At,Ot,Mt,_t,Dt,Pt,Ht,Bt;var jt,Ft,It,qt,Rt,Ut,zt,Wt;var Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt;var Zt,en,tn,nn,rn,sn,on,un;var an,fn,ln,cn,hn,pn,dn,vn;var mn,gn,yn,bn,wn,En,Sn,xn;var Tn,Nn,Cn,kn,Ln,An,On,Mn;var _n,Dn,Pn,Hn,Bn,jn,Fn,In;var qn,Rn,Un,zn,Wn,Xn,Vn,$n;var Jn,Kn,Qn,Gn,Yn,Zn,er,tr;var nr,rr,ir,sr,or,ur,ar,fr;var lr,cr,hr,pr,dr,vr,mr,gr;var yr,br,wr,Er,Sr,xr,Tr,Nr;var Cr,kr,Lr,Ar,Or,Mr,_r,Dr;var Pr,Hr,Br,jr,Fr,Ir,qr,Rr;var Ur,zr,Wr,Xr,Vr,$r,Jr,Kr;var Qr;i=e[0]+e[31];w=(e[0]-e[31])*j;s=e[15]+e[16];E=(e[15]-e[16])*pt;St=w+E;qt=(w-E)*F;dt=i+s;Mt=(i-s)*F;o=e[7]+e[24];S=(e[7]-e[24])*G;u=e[8]+e[23];x=(e[8]-e[23])*Z;xt=S+x;Rt=(S-x)*ht;vt=o+u;_t=(o-u)*ht;a=e[3]+e[28];T=(e[3]-e[28])*z;f=e[12]+e[19];N=(e[12]-e[19])*ut;Tt=T+N;Ut=(T-N)*Q;mt=a+f;Dt=(a-f)*Q;l=e[4]+e[27];C=(e[4]-e[27])*X;c=e[11]+e[20];k=(e[11]-e[20])*st;Nt=C+k;zt=(C-k)*et;gt=l+c;Pt=(l-c)*et;h=e[1]+e[30];L=(e[1]-e[30])*I;p=e[14]+e[17];A=(e[14]-e[17])*ct;Ct=L+A;Wt=(L-A)*U;yt=h+p;Ht=(h-p)*U;d=e[6]+e[25];O=(e[6]-e[25])*K;v=e[9]+e[22];M=(e[9]-e[22])*tt;kt=O+M;Xt=(O-M)*at;bt=d+v;Bt=(d-v)*at;m=e[2]+e[29];_=(e[2]-e[29])*R;g=e[13]+e[18];D=(e[13]-e[18])*ft;Lt=_+D;Vt=(_-D)*V;wt=m+g;jt=(m-g)*V;y=e[5]+e[26];P=(e[5]-e[26])*$;b=e[10]+e[21];H=(e[10]-e[21])*rt;At=P+H;$t=(P-H)*it;Et=y+b;Ft=(y-b)*it;Qt=dt+vt;gn=(dt-vt)*q;Gt=mt+gt;yn=(mt-gt)*lt;Yt=yt+bt;bn=(yt-bt)*J;Zt=wt+Et;wn=(wt-Et)*nt;en=St+xt;Sn=(St-xt)*q;tn=Tt+Nt;xn=(Tt-Nt)*lt;nn=Ct+kt;Tn=(Ct-kt)*J;rn=Lt+At;Nn=(Lt-At)*nt;on=Mt+_t;Ln=(Mt-_t)*q;un=Dt+Pt;An=(Dt-Pt)*lt;an=Ht+Bt;On=(Ht-Bt)*J;fn=jt+Ft;Mn=(jt-Ft)*nt;cn=qt+Rt;Pn=(qt-Rt)*q;hn=Ut+zt;Hn=(Ut-zt)*lt;pn=Wt+Xt;Bn=(Wt-Xt)*J;dn=Vt+$t;jn=(Vt-$t)*nt;Rn=Qt+Gt;Un=Yt+Zt;r[15][t]=Rn+Un;n[0][t]=(Rn-Un)*Y;zn=en+tn;Wn=nn+rn;B=zn+Wn;r[14][t]=B;Vn=on+un;$n=an+fn;It=Vn+$n;r[13][t]=It;Kn=cn+hn;Qn=pn+dn;Jt=Kn+Qn;Ot=Jt*2-B;r[12][t]=Ot;Zn=gn+yn;er=bn+wn;En=Zn+er;r[11][t]=En;nr=Sn+xn;rr=Tn+Nn;Cn=nr+rr;Kt=Cn*2-Ot;r[10][t]=Kt;or=Ln+An;ur=On+Mn;_n=or+ur;ln=_n*2-It;r[9][t]=ln;lr=Pn+Hn;cr=Bn+jn;Fn=lr+cr;vn=Fn*2-Jt;sn=vn*2-Kt;r[8][t]=sn;vr=(Qt-Gt)*W;mr=(Yt-Zt)*ot;gr=vr+mr;r[7][t]=gr;n[8][t]=(vr-mr)*Y*2-gr;yr=(en-tn)*W;br=(nn-rn)*ot;wr=yr+br;mn=wr*2-sn;r[6][t]=mn;Sr=(on-un)*W;xr=(an-fn)*ot;Tr=Sr+xr;Dn=Tr*2-ln;r[5][t]=Dn;Cr=(cn-hn)*W;kr=(pn-dn)*ot;Lr=Cr+kr;In=Lr*2-vn;kn=In*2-mn;r[4][t]=kn;Mr=(gn-yn)*W;_r=(bn-wn)*ot;Dr=Mr+_r;tr=Dr*2-En;r[3][t]=tr;Pr=(Zn-er)*Y*2-tr;n[4][t]=Pr;n[12][t]=((Mr-_r)*Y*2-Dr)*2-Pr;Hr=(Sn-xn)*W;Br=(Tn-Nn)*ot;jr=Hr+Br;ir=jr*2-Cn;qn=ir*2-kn;r[2][t]=qn;Fr=(nr-rr)*Y*2-ir;qr=(Ln-An)*W;Rr=(On-Mn)*ot;Ur=qr+Rr;ar=Ur*2-_n;Jn=ar*2-Dn;r[1][t]=Jn;fr=(Vn-$n)*Y*2-Jn;n[2][t]=fr;zr=(or-ur)*Y*2-ar;Nr=zr*2-fr;n[6][t]=Nr;Wr=((Sr-xr)*Y*2-Tr)*2-Nr;n[10][t]=Wr;n[14][t]=(((qr-Rr)*Y*2-Ur)*2-zr)*2-Wr;Xr=(Pn-Hn)*W;Vr=(Bn-jn)*ot;$r=Xr+Vr;hr=$r*2-Fn;Gn=hr*2-In;pr=(Kn-Qn)*Y*2-Gn;Xn=Gn*2-qn;r[0][t]=Xn;Yn=(zn-Wn)*Y*2-Xn;n[1][t]=Yn;sr=pr*2-Yn;n[3][t]=sr;dr=Fr*2-sr;n[5][t]=dr;Jr=(lr-cr)*Y*2-hr;Ar=Jr*2-pr;Er=Ar*2-dr;n[7][t]=Er;Or=((yr-br)*Y*2-wr)*2-Er;n[9][t]=Or;Kr=((Cr-kr)*Y*2-Lr)*2-Ar;Ir=Kr*2-Or;n[11][t]=Ir;Qr=(((Hr-Br)*Y*2-jr)*2-Fr)*2-Ir;n[13][t]=Qr;n[15][t]=((((Xr-Vr)*Y*2-$r)*2-Jr)*2-Kr)*2-Qr};const dt=[[0,-442505e-9,.003250122,-.007003784,.031082153,-.07862854,.100311279,-.572036743,1.144989014,.572036743,.100311279,.07862854,.031082153,.007003784,.003250122,442505e-9,0,-442505e-9,.003250122,-.007003784,.031082153,-.07862854,.100311279,-.572036743,1.144989014,.572036743,.100311279,.07862854,.031082153,.007003784,.003250122,442505e-9],[-15259e-9,-473022e-9,.003326416,-.007919312,.030517578,-.084182739,.090927124,-.600219727,1.144287109,.543823242,.108856201,.073059082,.031478882,.006118774,.003173828,396729e-9,-15259e-9,-473022e-9,.003326416,-.007919312,.030517578,-.084182739,.090927124,-.600219727,1.144287109,.543823242,.108856201,.073059082,.031478882,.006118774,.003173828,396729e-9],[-15259e-9,-534058e-9,.003387451,-.008865356,.029785156,-.089706421,.080688477,-.628295898,1.142211914,.515609741,.116577148,.067520142,.031738281,.0052948,.003082275,366211e-9,-15259e-9,-534058e-9,.003387451,-.008865356,.029785156,-.089706421,.080688477,-.628295898,1.142211914,.515609741,.116577148,.067520142,.031738281,.0052948,.003082275,366211e-9],[-15259e-9,-579834e-9,.003433228,-.009841919,.028884888,-.095169067,.069595337,-.656219482,1.138763428,.487472534,.123474121,.06199646,.031845093,.004486084,.002990723,320435e-9,-15259e-9,-579834e-9,.003433228,-.009841919,.028884888,-.095169067,.069595337,-.656219482,1.138763428,.487472534,.123474121,.06199646,.031845093,.004486084,.002990723,320435e-9],[-15259e-9,-62561e-8,.003463745,-.010848999,.027801514,-.100540161,.057617187,-.683914185,1.133926392,.459472656,.129577637,.056533813,.031814575,.003723145,.00289917,289917e-9,-15259e-9,-62561e-8,.003463745,-.010848999,.027801514,-.100540161,.057617187,-.683914185,1.133926392,.459472656,.129577637,.056533813,.031814575,.003723145,.00289917,289917e-9],[-15259e-9,-686646e-9,.003479004,-.011886597,.026535034,-.105819702,.044784546,-.71131897,1.127746582,.431655884,.134887695,.051132202,.031661987,.003005981,.002792358,259399e-9,-15259e-9,-686646e-9,.003479004,-.011886597,.026535034,-.105819702,.044784546,-.71131897,1.127746582,.431655884,.134887695,.051132202,.031661987,.003005981,.002792358,259399e-9],[-15259e-9,-747681e-9,.003479004,-.012939453,.025085449,-.110946655,.031082153,-.738372803,1.120223999,.404083252,.139450073,.045837402,.031387329,.002334595,.002685547,244141e-9,-15259e-9,-747681e-9,.003479004,-.012939453,.025085449,-.110946655,.031082153,-.738372803,1.120223999,.404083252,.139450073,.045837402,.031387329,.002334595,.002685547,244141e-9],[-30518e-9,-808716e-9,.003463745,-.014022827,.023422241,-.115921021,.01651001,-.765029907,1.111373901,.376800537,.143264771,.040634155,.031005859,.001693726,.002578735,213623e-9,-30518e-9,-808716e-9,.003463745,-.014022827,.023422241,-.115921021,.01651001,-.765029907,1.111373901,.376800537,.143264771,.040634155,.031005859,.001693726,.002578735,213623e-9],[-30518e-9,-88501e-8,.003417969,-.01512146,.021575928,-.120697021,.001068115,-.791213989,1.101211548,.349868774,.146362305,.035552979,.030532837,.001098633,.002456665,198364e-9,-30518e-9,-88501e-8,.003417969,-.01512146,.021575928,-.120697021,.001068115,-.791213989,1.101211548,.349868774,.146362305,.035552979,.030532837,.001098633,.002456665,198364e-9],[-30518e-9,-961304e-9,.003372192,-.016235352,.01953125,-.125259399,-.015228271,-.816864014,1.089782715,.323318481,.148773193,.030609131,.029937744,549316e-9,.002349854,167847e-9,-30518e-9,-961304e-9,.003372192,-.016235352,.01953125,-.125259399,-.015228271,-.816864014,1.089782715,.323318481,.148773193,.030609131,.029937744,549316e-9,.002349854,167847e-9],[-30518e-9,-.001037598,.00328064,-.017349243,.01725769,-.129562378,-.03237915,-.841949463,1.07711792,.297210693,.150497437,.025817871,.029281616,30518e-9,.002243042,152588e-9,-30518e-9,-.001037598,.00328064,-.017349243,.01725769,-.129562378,-.03237915,-.841949463,1.07711792,.297210693,.150497437,.025817871,.029281616,30518e-9,.002243042,152588e-9],[-45776e-9,-.001113892,.003173828,-.018463135,.014801025,-.133590698,-.050354004,-.866363525,1.063217163,.271591187,.151596069,.021179199,.028533936,-442505e-9,.002120972,137329e-9,-45776e-9,-.001113892,.003173828,-.018463135,.014801025,-.133590698,-.050354004,-.866363525,1.063217163,.271591187,.151596069,.021179199,.028533936,-442505e-9,.002120972,137329e-9],[-45776e-9,-.001205444,.003051758,-.019577026,.012115479,-.137298584,-.069168091,-.890090942,1.048156738,.246505737,.152069092,.016708374,.02772522,-869751e-9,.00201416,12207e-8,-45776e-9,-.001205444,.003051758,-.019577026,.012115479,-.137298584,-.069168091,-.890090942,1.048156738,.246505737,.152069092,.016708374,.02772522,-869751e-9,.00201416,12207e-8],[-61035e-9,-.001296997,.002883911,-.020690918,.009231567,-.140670776,-.088775635,-.91305542,1.031936646,.221984863,.15196228,.012420654,.02684021,-.001266479,.001907349,106812e-9,-61035e-9,-.001296997,.002883911,-.020690918,.009231567,-.140670776,-.088775635,-.91305542,1.031936646,.221984863,.15196228,.012420654,.02684021,-.001266479,.001907349,106812e-9],[-61035e-9,-.00138855,.002700806,-.021789551,.006134033,-.143676758,-.109161377,-.935195923,1.01461792,.198059082,.151306152,.00831604,.025909424,-.001617432,.001785278,106812e-9,-61035e-9,-.00138855,.002700806,-.021789551,.006134033,-.143676758,-.109161377,-.935195923,1.01461792,.198059082,.151306152,.00831604,.025909424,-.001617432,.001785278,106812e-9],[-76294e-9,-.001480103,.002487183,-.022857666,.002822876,-.146255493,-.130310059,-.956481934,.996246338,.174789429,.150115967,.004394531,.024932861,-.001937866,.001693726,91553e-9,-76294e-9,-.001480103,.002487183,-.022857666,.002822876,-.146255493,-.130310059,-.956481934,.996246338,.174789429,.150115967,.004394531,.024932861,-.001937866,.001693726,91553e-9],[-76294e-9,-.001586914,.002227783,-.023910522,-686646e-9,-.148422241,-.152206421,-.976852417,.976852417,.152206421,.148422241,686646e-9,.023910522,-.002227783,.001586914,76294e-9,-76294e-9,-.001586914,.002227783,-.023910522,-686646e-9,-.148422241,-.152206421,-.976852417,.976852417,.152206421,.148422241,686646e-9,.023910522,-.002227783,.001586914,76294e-9]];B.prototype.full=function(e,t,n){var r,i,s,o;for(var u=0;u<t;++u){var a=e.sbsample[u];var f=this.filter[u];var l=this.phase;var c=this.pcm.samples[u];var h=0;var p=0;for(var d=0;d<n;++d){B.dct32(a[d],l>>1,f[0][l&1],f[1][l&1]);var v=l&~1;var m=l-1&15|1;var g=f[0][l&1];var y=f[0][~l&1];var b=f[1][~l&1];var w=0;var E=0;var S=0;r=0;o=dt[r];_fx=y[E];_fe=g[w];s=_fx[0]*o[m+0];s+=_fx[1]*o[m+14];s+=_fx[2]*o[m+12];s+=_fx[3]*o[m+10];s+=_fx[4]*o[m+8];s+=_fx[5]*o[m+6];s+=_fx[6]*o[m+4];s+=_fx[7]*o[m+2];s=-s;s+=_fe[0]*o[v+0];s+=_fe[1]*o[v+14];s+=_fe[2]*o[v+12];s+=_fe[3]*o[v+10];s+=_fe[4]*o[v+8];s+=_fe[5]*o[v+6];s+=_fe[6]*o[v+4];s+=_fe[7]*o[v+2];c[h++]=s;p=h+30;for(var x=1;x<16;++x){++w;++r;o=dt[r];_fo=b[S];_fe=g[w];s=_fo[0]*o[m+0];s+=_fo[1]*o[m+14];s+=_fo[2]*o[m+12];s+=_fo[3]*o[m+10];s+=_fo[4]*o[m+8];s+=_fo[5]*o[m+6];s+=_fo[6]*o[m+4];s+=_fo[7]*o[m+2];s=-s;s+=_fe[7]*o[v+2];s+=_fe[6]*o[v+4];s+=_fe[5]*o[v+6];s+=_fe[4]*o[v+8];s+=_fe[3]*o[v+10];s+=_fe[2]*o[v+12];s+=_fe[1]*o[v+14];s+=_fe[0]*o[v+0];c[h++]=s;s=_fe[0]*o[-v+31-16];s+=_fe[1]*o[-v+31-14];s+=_fe[2]*o[-v+31-12];s+=_fe[3]*o[-v+31-10];s+=_fe[4]*o[-v+31-8];s+=_fe[5]*o[-v+31-6];s+=_fe[6]*o[-v+31-4];s+=_fe[7]*o[-v+31-2];s+=_fo[7]*o[-m+31-2];s+=_fo[6]*o[-m+31-4];s+=_fo[5]*o[-m+31-6];s+=_fo[4]*o[-m+31-8];s+=_fo[3]*o[-m+31-10];s+=_fo[2]*o[-m+31-12];s+=_fo[1]*o[-m+31-14];s+=_fo[0]*o[-m+31-16];c[p--]=s;++S}++r;o=dt[r];_fo=b[S];s=_fo[0]*o[m+0];s+=_fo[1]*o[m+14];s+=_fo[2]*o[m+12];s+=_fo[3]*o[m+10];s+=_fo[4]*o[m+8];s+=_fo[5]*o[m+6];s+=_fo[6]*o[m+4];s+=_fo[7]*o[m+2];c[h]=-s;h+=16;l=(l+1)%16}}};B.prototype.frame=function(e){var t=e.header.nchannels();var n=e.header.nbsamples();this.pcm.samplerate=e.header.samplerate;this.pcm.channels=t;this.pcm.length=32*n;this.full(e,t,n);this.phase=(this.phase+n)%16};const vt=new Float32Array([2,1.587401051968,1.259921049895,1,.793700525984,.629960524947,.5,.396850262992,.314980262474,.25,.198425131496,.157490131237,.125,.099212565748,.078745065618,.0625,.049606282874,.039372532809,.03125,.024803141437,.019686266405,.015625,.012401570719,.009843133202,.0078125,.006200785359,.004921566601,.00390625,.00310039268,.002460783301,.001953125,.00155019634,.00123039165,.0009765625,.00077509817,.000615195825,.00048828125,.000387549085,.000307597913,.000244140625,.000193774542,.000153798956,.000122070313,96887271e-12,76899478e-12,61035156e-12,48443636e-12,38449739e-12,30517578e-12,24221818e-12,1922487e-11,15258789e-12,12110909e-12,9612435e-12,7629395e-12,6055454e-12,4806217e-12,3814697e-12,3027727e-12,2403109e-12,1907349e-12,1513864e-12,1201554e-12,0]);const mt=new Uint8Array([4,4,4,4,4,4,6,6,6,8,10,12,16,18,22,28,34,40,46,54,54,192]);const gt=new Uint8Array([4,4,4,4,4,4,6,6,8,8,10,12,16,20,24,28,34,42,50,54,76,158]);const yt=new Uint8Array([4,4,4,4,4,4,6,6,8,10,12,16,20,24,30,38,46,56,68,84,102,26]);const bt=new Uint8Array([4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,6,6,6,10,10,10,12,12,12,14,14,14,16,16,16,20,20,20,26,26,26,66,66,66]);const wt=new Uint8Array([4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,22,22,22,30,30,30,56,56,56]);const Et=new Uint8Array([4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,12,12,12,16,16,16,20,20,20,26,26,26,34,34,34,42,42,42,12,12,12]);const St=new Uint8Array([4,4,4,4,4,4,6,6,4,4,4,6,6,6,6,6,6,10,10,10,12,12,12,14,14,14,16,16,16,20,20,20,26,26,26,66,66,66]);const xt=new Uint8Array([4,4,4,4,4,4,6,6,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,22,22,22,30,30,30,56,56,56]);const Tt=new Uint8Array([4,4,4,4,4,4,6,6,4,4,4,6,6,6,8,8,8,12,12,12,16,16,16,20,20,20,26,26,26,34,34,34,42,42,42,12,12,12]);const Nt=new Uint8Array([6,6,6,6,6,6,8,10,12,14,16,18,22,26,32,38,46,54,62,70,76,36]);const Ct=new Uint8Array([6,6,6,6,6,6,8,10,12,14,16,20,24,28,32,38,46,52,60,68,58,54]);const kt=Ct;const Lt=new Uint8Array([4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,32,32,32,44,44,44,12,12,12]);const At=new Uint8Array([4,4,4,4,4,4,4,4,4,6,6,6,6,6,6,8,8,8,10,10,10,14,14,14,18,18,18,26,26,26,32,32,32,42,42,42,18,18,18]);const Ot=new Uint8Array([4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,30,30,30,40,40,40,18,18,18]);const Mt=new Uint8Array([6,6,6,6,6,6,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,32,32,32,44,44,44,12,12,12]);const _t=new Uint8Array([6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,10,10,10,14,14,14,18,18,18,26,26,26,32,32,32,42,42,42,18,18,18]);const Dt=new Uint8Array([6,6,6,6,6,6,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,30,30,30,40,40,40,18,18,18]);const Pt=kt;const Ht=Pt;const Bt=new Uint8Array([12,12,12,12,12,12,16,20,24,28,32,40,48,56,64,76,90,2,2,2,2,2]);const jt=Ot;const Ft=jt;const It=new Uint8Array([8,8,8,8,8,8,8,8,8,12,12,12,16,16,16,20,20,20,24,24,24,28,28,28,36,36,36,2,2,2,2,2,2,2,2,2,26,26,26]);const qt=Dt;const Rt=qt;const Ut=new Uint8Array([12,12,12,4,4,4,8,8,8,12,12,12,16,16,16,20,20,20,24,24,24,28,28,28,36,36,36,2,2,2,2,2,2,2,2,2,26,26,26]);const zt=[{l:mt,s:bt,m:St},{l:gt,s:wt,m:xt},{l:yt,s:Et,m:Tt},{l:Nt,s:Lt,m:Mt},{l:Ct,s:At,m:_t},{l:kt,s:Ot,m:Dt},{l:Pt,s:jt,m:qt},{l:Ht,s:Ft,m:Rt},{l:Bt,s:It,m:Ut}];const Wt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0]);const Xt=new Float32Array([.59460355750136,.70710678118655,.84089641525371,1,1.18920711500272,1.4142135623731,1.68179283050743]);const Vt=new Float32Array([+.857492926,+.881741997,+.949628649,+.983314592,+.995517816,+.999160558,+.999899195,+.999993155]);const $t=new Float32Array([-.514495755,-.471731969,-.313377454,-.1819132,-.094574193,-.040965583,-.014198569,-.003699975]);const Jt=1;const Kt=2;const Qt=4;const Gt=8;const Yt=1;const Zt=2;const en=new Float32Array([.043619387,.130526192,.216439614,.3007058,.382683432,.461748613,.537299608,.608761429,.675590208,.737277337,.79335334,.843391446,.887010833,.923879533,.953716951,.976296007,.991444861,.999048222,.999048222,.991444861,.976296007,.953716951,.923879533,.887010833,.843391446,.79335334,.737277337,.675590208,.608761429,.537299608,.461748613,.382683432,.3007058,.216439614,.130526192,.043619387]);const tn=new Float32Array([.130526192,.382683432,.608761429,.79335334,.923879533,.991444861,.991444861,.923879533,.79335334,.608761429,.382683432,.130526192]);const nn=new Float32Array([0,.211324865,.366025404,.5,.633974596,.788675135,1]);const rn=[new Float32Array([.840896415,.707106781,.594603558,.5,.420448208,.353553391,.297301779,.25,.210224104,.176776695,.148650889,.125,.105112052,.088388348,.074325445]),new Float32Array([.707106781,.5,.353553391,.25,.176776695,.125,.088388348,.0625,.044194174,.03125,.022097087,.015625,.011048543,.0078125,.005524272])];const sn=[{slen1:0,slen2:0},{slen1:0,slen2:1},{slen1:0,slen2:2},{slen1:0,slen2:3},{slen1:3,slen2:0},{slen1:1,slen2:1},{slen1:1,slen2:2},{slen1:1,slen2:3},{slen1:2,slen2:1},{slen1:2,slen2:2},{slen1:2,slen2:3},{slen1:3,slen2:1},{slen1:3,slen2:2},{slen1:3,slen2:3},{slen1:4,slen2:2},{slen1:4,slen2:3}];const on=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];P.layers[1]=un;const an=new Float32Array([1.33333333333333,1.14285714285714,1.06666666666667,1.03225806451613,1.01587301587302,1.00787401574803,1.00392156862745,1.00195694716243,1.00097751710655,1.00048851978505,1.0002442002442,1.00012208521548,1.00006103888177,1.00003051850948]);un.prototype.decode=function(e,t){var n=t.header;var r=n.nchannels();var i=32;if(n.mode===A.JOINT_STEREO){n.flags|=k.I_STEREO;i=4+n.mode_extension*4}if(n.flags&k.PROTECTION){}var s=this.allocation;for(var o=0;o<i;o++){for(var u=0;u<r;u++){var a=e.read(4);if(a===15)throw new Error("forbidden bit allocation value");s[u][o]=a?a+1:0}}for(var o=i;o<32;o++){var a=e.read(4);if(a===15)throw new Error("forbidden bit allocation value");s[0][o]=s[1][o]=a?a+1:0}var f=this.scalefactor;for(var o=0;o<32;o++){for(var u=0;u<r;u++){if(s[u][o]){f[u][o]=e.read(6)}}}for(var l=0;l<12;l++){for(var o=0;o<i;o++){for(var u=0;u<r;u++){var a=s[u][o];t.sbsample[u][l][o]=a?this.sample(e,a)*vt[f[u][o]]:0}}for(var o=i;o<32;o++){var a=s[0][o];if(a){var c=this.sample(e,a);for(var u=0;u<r;u++){t.sbsample[u][l][o]=c*vt[f[u][o]]}}else{for(var u=0;u<r;u++){t.sbsample[u][l][o]=0}}}}};un.prototype.sample=function(e,t){var n=e.read(t);n^=1<<t-1;n|=-(n&1<<t-1);n/=1<<t-1;n+=1>>t-1;return n*an[t-2]};P.layers[2]=fn;const ln=[{sblimit:27,offsets:[7,7,7,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0]},{sblimit:30,offsets:[7,7,7,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0]},{sblimit:8,offsets:[5,5,2,2,2,2,2,2]},{sblimit:12,offsets:[5,5,2,2,2,2,2,2,2,2,2,2]},{sblimit:30,offsets:[4,4,4,4,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}];const cn=[{nbal:2,offset:0},{nbal:2,offset:3},{nbal:3,offset:3},{nbal:3,offset:1},{nbal:4,offset:2},{nbal:4,offset:3},{nbal:4,offset:4},{nbal:4,offset:5}];const hn=[[0,1,16],[0,1,2,3,4,5,16],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],[0,1,3,4,5,6,7,8,9,10,11,12,13,14,15],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16],[0,2,4,5,6,7,8,9,10,11,12,13,14,15,16]];const pn=[{nlevels:3,group:2,bits:5,C:1.33333333333,D:.5},{nlevels:5,group:3,bits:7,C:1.6,D:.5},{nlevels:7,group:0,bits:3,C:1.14285714286,D:.25},{nlevels:9,group:4,bits:10,C:1.77777777777,D:.5},{nlevels:15,group:0,bits:4,C:1.06666666666,D:.125},{nlevels:31,group:0,bits:5,C:1.03225806452,D:.0625},{nlevels:63,group:0,bits:6,C:1.01587301587,D:.03125},{nlevels:127,group:0,bits:7,C:1.00787401575,D:.015625},{nlevels:255,group:0,bits:8,C:1.00392156863,D:.0078125},{nlevels:511,group:0,bits:9,C:1.00195694716,D:.00390625},{nlevels:1023,group:0,bits:10,C:1.00097751711,D:.001953125},{nlevels:2047,group:0,bits:11,C:1.00048851979,D:.0009765625},{nlevels:4095,group:0,bits:12,C:1.00024420024,D:.00048828125},{nlevels:8191,group:0,bits:13,C:1.00012208522,D:.00024414063},{nlevels:16383,group:0,bits:14,C:1.00006103888,D:.00012207031},{nlevels:32767,group:0,bits:15,C:1.00003051851,D:6103516e-11},{nlevels:65535,group:0,bits:16,C:1.00001525902,D:3051758e-11}];fn.prototype.decode=function(e,t){var n=t.header;var r=n.nchannels();var i;if(n.flags&k.LSF_EXT){i=4}else if(n.flags&k.FREEFORMAT){i=n.samplerate===48e3?0:1}else{var s=n.bitrate;if(r===2){s/=2}else{if(s>192e3)throw new Error("bad bitrate/mode combination")}if(s<=48e3)i=n.samplerate===32e3?3:2;else if(s<=8e4)i=0;else i=n.samplerate===48e3?0:1}var o=ln[i].sblimit;var u=ln[i].offsets;var a=32;if(n.mode===A.JOINT_STEREO){n.flags|=k.I_STEREO;a=4+n.mode_extension*4}if(a>o)a=o;var f=this.allocation;for(var l=0;l<a;l++){var c=cn[u[l]].nbal;for(var h=0;h<r;h++)f[h][l]=e.read(c)}for(var l=a;l<o;l++){var c=cn[u[l]].nbal;f[0][l]=f[1][l]=e.read(c)}var p=this.scfsi;for(var l=0;l<o;l++){for(var h=0;h<r;h++){if(f[h][l])p[h][l]=e.read(2)}}if(n.flags&k.PROTECTION){}var d=this.scalefactor;for(var l=0;l<o;l++){for(var h=0;h<r;h++){if(f[h][l]){d[h][l][0]=e.read(6);switch(p[h][l]){case 2:d[h][l][2]=d[h][l][1]=d[h][l][0];break;case 0:d[h][l][1]=e.read(6);case 1:case 3:d[h][l][2]=e.read(6)}if(p[h][l]&1)d[h][l][1]=d[h][l][p[h][l]-1]}}}for(var v=0;v<12;v++){for(var l=0;l<a;l++){for(var h=0;h<r;h++){if(i=f[h][l]){i=hn[cn[u[l]].offset][i-1];this.decodeSamples(e,pn[i]);var m=vt[d[h][l][v>>2]];for(var g=0;g<3;g++){t.sbsample[h][3*v+g][l]=this.samples[g]*m}}else{for(var g=0;g<3;g++){t.sbsample[h][3*v+g][l]=0}}}}for(var l=a;l<o;l++){if(i=f[0][l]){i=hn[cn[u[l]].offset][i-1];this.decodeSamples(e,pn[i]);for(var h=0;h<r;h++){var m=vt[d[h][l][v>>2]];for(var g=0;g<3;g++){t.sbsample[h][3*v+g][l]=this.samples[g]*m}}}else{for(var h=0;h<r;h++){for(var g=0;g<3;g++){t.sbsample[h][3*v+g][l]=0}}}}for(var h=0;h<r;h++){for(var g=0;g<3;g++){for(var l=o;l<32;l++){t.sbsample[h][3*v+g][l]=0}}}}};fn.prototype.decodeSamples=function(e,t){var n=this.samples;var r=t.group;if(r){var i=e.read(t.bits);var s=t.nlevels;for(var o=0;o<3;o++){n[o]=i%s;i=i/s|0}}else{r=t.bits;for(var o=0;o<3;o++){n[o]=e.read(r)}}for(var o=0;o<3;o++){var u=n[o]^1<<r-1;u|=-(u&1<<r-1);u/=1<<r-1;n[o]=(u+t.D)*t.C}};var dn=function(e,t){return{"final":0,ptr:{bits:t,offset:e}}};var vn=function(e,t,n,r,i){return{"final":1,value:{v:e,w:t,x:n,y:r}}};const mn=[dn(16,2),dn(20,2),dn(24,1),dn(26,1),vn(0,0,1,0,4),vn(0,0,0,1,4),vn(0,1,0,0,4),vn(1,0,0,0,4),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(0,0,0,0,1),vn(1,0,1,1,2),vn(1,1,1,1,2),vn(1,1,0,1,2),vn(1,1,1,0,2),vn(0,1,1,1,2),vn(0,1,0,1,2),vn(1,0,0,1,1),vn(1,0,0,1,1),vn(0,1,1,0,1),vn(0,0,1,1,1),vn(1,0,1,0,1),vn(1,1,0,0,1)];const gn=[vn(1,1,1,1,4),vn(1,1,1,0,4),vn(1,1,0,1,4),vn(1,1,0,0,4),vn(1,0,1,1,4),vn(1,0,1,0,4),vn(1,0,0,1,4),vn(1,0,0,0,4),vn(0,1,1,1,4),vn(0,1,1,0,4),vn(0,1,0,1,4),vn(0,1,0,0,4),vn(0,0,1,1,4),vn(0,0,1,0,4),vn(0,0,0,1,4),vn(0,0,0,0,4)];var yn=function(e,t,n){return{"final":1,value:{x:e,y:t,hlen:n}}};const bn=[yn(0,0,0)];const wn=[yn(1,1,3),yn(0,1,3),yn(1,0,2),yn(1,0,2),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1)];const En=[dn(8,3),yn(1,1,3),yn(0,1,3),yn(1,0,3),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(2,2,3),yn(0,2,3),yn(1,2,2),yn(1,2,2),yn(2,1,2),yn(2,1,2),yn(2,0,2),yn(2,0,2)];const Sn=[dn(8,3),yn(1,0,3),yn(1,1,2),yn(1,1,2),yn(0,1,2),yn(0,1,2),yn(0,0,2),yn(0,0,2),yn(2,2,3),yn(0,2,3),yn(1,2,2),yn(1,2,2),yn(2,1,2),yn(2,1,2),yn(2,0,2),yn(2,0,2)];const xn=[dn(8,4),yn(1,1,3),yn(0,1,3),yn(1,0,3),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),dn(24,1),yn(3,2,4),yn(3,1,3),yn(3,1,3),yn(1,3,4),yn(0,3,4),yn(3,0,4),yn(2,2,4),yn(1,2,3),yn(1,2,3),yn(2,1,3),yn(2,1,3),yn(0,2,3),yn(0,2,3),yn(2,0,3),yn(2,0,3),yn(3,3,1),yn(2,3,1)];const Tn=[dn(16,3),dn(24,1),dn(26,1),yn(1,2,4),yn(2,1,4),yn(2,0,4),yn(0,1,3),yn(0,1,3),yn(1,1,2),yn(1,1,2),yn(1,1,2),yn(1,1,2),yn(1,0,3),yn(1,0,3),yn(0,0,3),yn(0,0,3),yn(3,3,3),yn(0,3,3),yn(2,3,2),yn(2,3,2),yn(3,2,2),yn(3,2,2),yn(3,0,2),yn(3,0,2),yn(1,3,1),yn(3,1,1),yn(2,2,1),yn(0,2,1)];const Nn=[dn(16,4),dn(32,4),dn(48,2),yn(1,1,4),yn(0,1,3),yn(0,1,3),yn(1,0,3),yn(1,0,3),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),dn(52,2),dn(56,1),dn(58,1),yn(1,5,4),yn(5,1,4),dn(60,1),yn(5,0,4),dn(62,1),yn(2,4,4),yn(4,2,4),yn(1,4,3),yn(1,4,3),yn(4,1,3),yn(4,1,3),yn(4,0,3),yn(4,0,3),yn(0,4,4),yn(2,3,4),yn(3,2,4),yn(0,3,4),yn(1,3,3),yn(1,3,3),yn(3,1,3),yn(3,1,3),yn(3,0,3),yn(3,0,3),yn(2,2,3),yn(2,2,3),yn(1,2,2),yn(1,2,2),yn(1,2,2),yn(1,2,2),yn(2,1,1),yn(2,1,1),yn(0,2,2),yn(2,0,2),yn(5,5,2),yn(4,5,2),yn(5,4,2),yn(5,3,2),yn(3,5,1),yn(4,4,1),yn(2,5,1),yn(5,2,1),yn(0,5,1),yn(3,4,1),yn(4,3,1),yn(3,3,1)];const Cn=[dn(16,4),dn(32,4),yn(1,2,4),yn(2,1,4),yn(1,1,2),yn(1,1,2),yn(1,1,2),yn(1,1,2),yn(0,1,3),yn(0,1,3),yn(1,0,3),yn(1,0,3),yn(0,0,2),yn(0,0,2),yn(0,0,2),yn(0,0,2),dn(48,3),dn(56,2),dn(60,1),yn(1,5,4),yn(5,1,4),dn(62,1),dn(64,1),yn(2,4,4),yn(4,2,4),yn(1,4,4),yn(4,1,3),yn(4,1,3),yn(0,4,4),yn(4,0,4),yn(2,3,4),yn(3,2,4),yn(1,3,4),yn(3,1,4),yn(0,3,4),yn(3,0,4),yn(2,2,2),yn(2,2,2),yn(2,2,2),yn(2,2,2),yn(0,2,2),yn(0,2,2),yn(0,2,2),yn(0,2,2),yn(2,0,2),yn(2,0,2),yn(2,0,2),yn(2,0,2),yn(5,5,3),yn(5,4,3),yn(4,5,2),yn(4,5,2),yn(5,3,1),yn(5,3,1),yn(5,3,1),yn(5,3,1),yn(3,5,2),yn(4,4,2),yn(2,5,1),yn(2,5,1),yn(5,2,1),yn(0,5,1),yn(3,4,1),yn(4,3,1),yn(5,0,1),yn(3,3,1)];const kn=[dn(16,4),dn(32,3),dn(40,2),dn(44,2),dn(48,1),yn(1,2,4),yn(2,1,4),yn(2,0,4),yn(1,1,3),yn(1,1,3),yn(0,1,3),yn(0,1,3),yn(1,0,3),yn(1,0,3),yn(0,0,3),yn(0,0,3),dn(50,1),yn(3,5,4),yn(5,3,4),dn(52,1),yn(4,4,4),yn(2,5,4),yn(5,2,4),yn(1,5,4),yn(5,1,3),yn(5,1,3),yn(3,4,3),yn(3,4,3),yn(4,3,3),yn(4,3,3),yn(5,0,4),yn(0,4,4),yn(2,4,3),yn(4,2,3),yn(3,3,3),yn(4,0,3),yn(1,4,2),yn(1,4,2),yn(4,1,2),yn(4,1,2),yn(2,3,2),yn(3,2,2),yn(1,3,1),yn(1,3,1),yn(3,1,1),yn(3,1,1),yn(0,3,2),yn(3,0,2),yn(2,2,1),yn(0,2,1),yn(5,5,1),yn(4,5,1),yn(5,4,1),yn(0,5,1)];const Ln=[dn(16,4),dn(32,4),dn(48,2),yn(1,1,4),yn(0,1,3),yn(0,1,3),yn(1,0,3),yn(1,0,3),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),dn(52,3),dn(60,2),dn(64,3),dn(72,1),dn(74,2),dn(78,2),dn(82,2),yn(1,7,4),yn(7,1,4),dn(86,1),dn(88,2),dn(92,2),yn(1,6,4),yn(6,1,4),yn(6,0,4),dn(96,1),dn(98,1),dn(100,1),yn(1,4,4),yn(4,1,4),yn(4,0,4),yn(2,3,4),yn(3,2,4),yn(0,3,4),yn(1,3,3),yn(1,3,3),yn(3,1,3),yn(3,1,3),yn(3,0,3),yn(3,0,3),yn(2,2,3),yn(2,2,3),yn(1,2,2),yn(2,1,2),yn(0,2,2),yn(2,0,2),yn(7,7,3),yn(6,7,3),yn(7,6,3),yn(5,7,3),yn(7,5,3),yn(6,6,3),yn(4,7,2),yn(4,7,2),yn(7,4,2),yn(5,6,2),yn(6,5,2),yn(3,7,2),yn(7,3,2),yn(7,3,2),yn(4,6,2),yn(4,6,2),yn(5,5,3),yn(5,4,3),yn(6,3,2),yn(6,3,2),yn(2,7,1),yn(7,2,1),yn(6,4,2),yn(0,7,2),yn(7,0,1),yn(7,0,1),yn(6,2,1),yn(6,2,1),yn(4,5,2),yn(3,5,2),yn(0,6,1),yn(0,6,1),yn(5,3,2),yn(4,4,2),yn(3,6,1),yn(2,6,1),yn(2,5,2),yn(5,2,2),yn(1,5,1),yn(1,5,1),yn(5,1,1),yn(5,1,1),yn(3,4,2),yn(4,3,2),yn(0,5,1),yn(5,0,1),yn(2,4,1),yn(4,2,1),yn(3,3,1),yn(0,4,1)];const An=[dn(16,4),dn(32,4),dn(48,4),dn(64,3),yn(1,2,4),dn(72,1),yn(1,1,3),yn(1,1,3),yn(0,1,3),yn(0,1,3),yn(1,0,3),yn(1,0,3),yn(0,0,2),yn(0,0,2),yn(0,0,2),yn(0,0,2),dn(74,2),dn(78,3),dn(86,2),dn(90,1),dn(92,2),yn(2,7,4),yn(7,2,4),dn(96,1),yn(7,1,3),yn(7,1,3),yn(1,7,4),yn(7,0,4),yn(3,6,4),yn(6,3,4),yn(6,0,4),dn(98,1),dn(100,1),yn(1,5,4),yn(6,2,3),yn(6,2,3),yn(2,6,4),yn(0,6,4),yn(1,6,3),yn(1,6,3),yn(6,1,3),yn(6,1,3),yn(5,1,4),yn(3,4,4),yn(5,0,4),dn(102,1),yn(2,4,4),yn(4,2,4),yn(1,4,4),yn(4,1,4),yn(0,4,4),yn(4,0,4),yn(2,3,3),yn(2,3,3),yn(3,2,3),yn(3,2,3),yn(1,3,2),yn(1,3,2),yn(1,3,2),yn(1,3,2),yn(3,1,2),yn(3,1,2),yn(3,1,2),yn(3,1,2),yn(0,3,3),yn(3,0,3),yn(2,2,2),yn(2,2,2),yn(2,1,1),yn(2,1,1),yn(2,1,1),yn(2,1,1),yn(0,2,1),yn(2,0,1),yn(7,7,2),yn(6,7,2),yn(7,6,2),yn(7,5,2),yn(6,6,2),yn(6,6,2),yn(4,7,2),yn(4,7,2),yn(7,4,2),yn(7,4,2),yn(5,7,3),yn(5,5,3),yn(5,6,2),yn(6,5,2),yn(3,7,1),yn(3,7,1),yn(7,3,1),yn(4,6,1),yn(4,5,2),yn(5,4,2),yn(3,5,2),yn(5,3,2),yn(6,4,1),yn(0,7,1),yn(4,4,1),yn(2,5,1),yn(5,2,1),yn(0,5,1),yn(4,3,1),yn(3,3,1)];const On=[dn(16,4),dn(32,4),dn(48,4),dn(64,2),dn(68,3),dn(76,1),yn(1,2,4),yn(2,1,4),dn(78,1),yn(0,0,4),yn(1,1,3),yn(1,1,3),yn(0,1,3),yn(0,1,3),yn(1,0,3),yn(1,0,3),dn(80,2),dn(84,1),dn(86,1),dn(88,1),yn(5,6,4),yn(3,7,4),dn(90,1),yn(2,7,4),yn(7,2,4),yn(4,6,4),yn(6,4,4),yn(1,7,4),yn(7,1,4),dn(92,1),yn(3,6,4),yn(6,3,4),yn(4,5,4),yn(5,4,4),yn(4,4,4),dn(94,1),yn(2,6,3),yn(2,6,3),yn(6,2,3),yn(6,2,3),yn(6,1,3),yn(6,1,3),yn(1,6,4),yn(6,0,4),yn(3,5,4),yn(5,3,4),yn(2,5,4),yn(5,2,4),yn(1,5,3),yn(1,5,3),yn(5,1,3),yn(5,1,3),yn(3,4,3),yn(3,4,3),yn(4,3,3),yn(4,3,3),yn(5,0,4),yn(0,4,4),yn(2,4,3),yn(2,4,3),yn(4,2,3),yn(4,2,3),yn(1,4,3),yn(1,4,3),yn(3,3,2),yn(4,1,2),yn(2,3,2),yn(3,2,2),yn(4,0,3),yn(0,3,3),yn(3,0,2),yn(3,0,2),yn(1,3,1),yn(1,3,1),yn(1,3,1),yn(1,3,1),yn(3,1,1),yn(2,2,1),yn(0,2,1),yn(2,0,1),yn(7,7,2),yn(6,7,2),yn(7,6,1),yn(7,6,1),yn(5,7,1),yn(7,5,1),yn(6,6,1),yn(4,7,1),yn(7,4,1),yn(6,5,1),yn(7,3,1),yn(5,5,1),yn(0,7,1),yn(7,0,1),yn(0,6,1),yn(0,5,1)];const Mn=[dn(16,4),dn(32,4),dn(48,4),dn(64,2),yn(1,1,4),yn(0,1,4),yn(1,0,3),yn(1,0,3),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),dn(68,4),dn(84,4),dn(100,4),dn(116,4),dn(132,4),dn(148,4),dn(164,3),dn(172,3),dn(180,3),dn(188,3),dn(196,3),dn(204,3),dn(212,1),dn(214,2),dn(218,3),dn(226,1),dn(228,2),dn(232,2),dn(236,2),dn(240,2),yn(8,1,4),dn(244,1),dn(246,1),dn(248,1),dn(250,2),dn(254,1),yn(1,5,4),yn(5,1,4),dn(256,1),dn(258,1),dn(260,1),yn(1,4,4),yn(4,1,3),yn(4,1,3),yn(0,4,4),yn(4,0,4),yn(2,3,4),yn(3,2,4),yn(1,3,3),yn(1,3,3),yn(3,1,3),yn(3,1,3),yn(0,3,3),yn(0,3,3),yn(3,0,3),yn(3,0,3),yn(2,2,3),yn(2,2,3),yn(1,2,2),yn(2,1,2),yn(0,2,2),yn(2,0,2),dn(262,4),dn(278,4),dn(294,4),dn(310,3),dn(318,2),dn(322,2),dn(326,3),dn(334,2),dn(338,1),dn(340,2),dn(344,2),dn(348,2),dn(352,2),dn(356,2),yn(1,15,4),yn(15,1,4),yn(15,0,4),dn(360,1),dn(362,1),dn(364,1),yn(14,2,4),dn(366,1),yn(1,14,4),yn(14,1,4),dn(368,1),dn(370,1),dn(372,1),dn(374,1),dn(376,1),dn(378,1),yn(12,6,4),yn(3,13,4),dn(380,1),yn(2,13,4),yn(13,2,4),yn(1,13,4),yn(11,7,4),dn(382,1),dn(384,1),yn(12,3,4),dn(386,1),yn(4,11,4),yn(13,1,3),yn(13,1,3),yn(0,13,4),yn(13,0,4),yn(8,10,4),yn(10,8,4),yn(4,12,4),yn(12,4,4),yn(6,11,4),yn(11,6,4),yn(3,12,3),yn(3,12,3),yn(2,12,3),yn(2,12,3),yn(12,2,3),yn(12,2,3),yn(5,11,3),yn(5,11,3),yn(11,5,4),yn(8,9,4),yn(1,12,3),yn(1,12,3),yn(12,1,3),yn(12,1,3),yn(9,8,4),yn(0,12,4),yn(12,0,3),yn(12,0,3),yn(11,4,4),yn(6,10,4),yn(10,6,4),yn(7,9,4),yn(3,11,3),yn(3,11,3),yn(11,3,3),yn(11,3,3),yn(8,8,4),yn(5,10,4),yn(2,11,3),yn(2,11,3),yn(10,5,4),yn(6,9,4),yn(10,4,3),yn(10,4,3),yn(7,8,4),yn(8,7,4),yn(9,4,3),yn(9,4,3),yn(7,7,4),yn(7,6,4),yn(11,2,2),yn(11,2,2),yn(11,2,2),yn(11,2,2),yn(1,11,2),yn(1,11,2),yn(11,1,2),yn(11,1,2),yn(0,11,3),yn(11,0,3),yn(9,6,3),yn(4,10,3),yn(3,10,3),yn(10,3,3),yn(5,9,3),yn(9,5,3),yn(2,10,2),yn(2,10,2),yn(10,2,2),yn(10,2,2),yn(1,10,2),yn(1,10,2),yn(10,1,2),yn(10,1,2),yn(0,10,3),yn(6,8,3),yn(10,0,2),yn(10,0,2),yn(8,6,3),yn(4,9,3),yn(9,3,2),yn(9,3,2),yn(3,9,3),yn(5,8,3),yn(8,5,3),yn(6,7,3),yn(2,9,2),yn(2,9,2),yn(9,2,2),yn(9,2,2),yn(5,7,3),yn(7,5,3),yn(3,8,2),yn(3,8,2),yn(8,3,2),yn(8,3,2),yn(6,6,3),yn(4,7,3),yn(7,4,3),yn(5,6,3),yn(6,5,3),yn(7,3,3),yn(1,9,1),yn(9,1,1),yn(0,9,2),yn(9,0,2),yn(4,8,2),yn(8,4,2),yn(7,2,2),yn(7,2,2),yn(4,6,3),yn(6,4,3),yn(2,8,1),yn(2,8,1),yn(2,8,1),yn(2,8,1),yn(8,2,1),yn(1,8,1),yn(3,7,2),yn(2,7,2),yn(1,7,1),yn(1,7,1),yn(7,1,1),yn(7,1,1),yn(5,5,2),yn(0,7,2),yn(7,0,2),yn(3,6,2),yn(6,3,2),yn(4,5,2),yn(5,4,2),yn(2,6,2),yn(6,2,2),yn(3,5,2),yn(0,8,1),yn(8,0,1),yn(1,6,1),yn(6,1,1),yn(0,6,1),yn(6,0,1),yn(5,3,2),yn(4,4,2),yn(2,5,1),yn(2,5,1),yn(5,2,1),yn(0,5,1),yn(3,4,1),yn(4,3,1),yn(5,0,1),yn(2,4,1),yn(4,2,1),yn(3,3,1),dn(388,3),yn(15,15,4),yn(14,15,4),yn(13,15,4),yn(14,14,4),yn(12,15,4),yn(13,14,4),yn(11,15,4),yn(15,11,4),yn(12,14,4),yn(13,12,4),dn(396,1),yn(14,12,3),yn(14,12,3),yn(13,13,3),yn(13,13,3),yn(15,10,4),yn(12,13,4),yn(11,14,3),yn(11,14,3),yn(14,11,3),yn(14,11,3),yn(9,15,3),yn(9,15,3),yn(15,9,3),yn(15,9,3),yn(14,10,3),yn(14,10,3),yn(11,13,3),yn(11,13,3),yn(13,11,3),yn(13,11,3),yn(8,15,3),yn(8,15,3),yn(15,8,3),yn(15,8,3),yn(12,12,3),yn(12,12,3),yn(10,14,4),yn(9,14,4),yn(8,14,3),yn(8,14,3),yn(7,15,4),yn(7,14,4),yn(15,7,2),yn(15,7,2),yn(15,7,2),yn(15,7,2),yn(13,10,2),yn(13,10,2),yn(10,13,3),yn(11,12,3),yn(12,11,3),yn(15,6,3),yn(6,15,2),yn(6,15,2),yn(14,8,2),yn(5,15,2),yn(9,13,2),yn(13,9,2),yn(15,5,2),yn(14,7,2),yn(10,12,2),yn(11,11,2),yn(4,15,2),yn(4,15,2),yn(15,4,2),yn(15,4,2),yn(12,10,3),yn(14,6,3),yn(15,3,2),yn(15,3,2),yn(3,15,1),yn(3,15,1),yn(8,13,2),yn(13,8,2),yn(2,15,1),yn(15,2,1),yn(6,14,2),yn(9,12,2),yn(0,15,1),yn(0,15,1),yn(12,9,2),yn(5,14,2),yn(10,11,1),yn(10,11,1),yn(7,13,2),yn(13,7,2),yn(4,14,1),yn(4,14,1),yn(12,8,2),yn(13,6,2),yn(3,14,1),yn(3,14,1),yn(11,9,1),yn(11,9,1),yn(9,11,2),yn(10,10,2),yn(11,10,1),yn(14,5,1),yn(14,4,1),yn(8,12,1),yn(6,13,1),yn(14,3,1),yn(2,14,1),yn(0,14,1),yn(14,0,1),yn(5,13,1),yn(13,5,1),yn(7,12,1),yn(12,7,1),yn(4,13,1),yn(8,11,1),yn(11,8,1),yn(13,4,1),yn(9,10,1),yn(10,9,1),yn(6,12,1),yn(13,3,1),yn(7,11,1),yn(5,12,1),yn(12,5,1),yn(9,9,1),yn(7,10,1),yn(10,7,1),yn(9,7,1),yn(15,14,3),yn(15,12,3),yn(15,13,2),yn(15,13,2),yn(14,13,1),yn(14,13,1),yn(14,13,1),yn(14,13,1),yn(10,15,1),yn(14,9,1)];const _n=[dn(16,4),dn(32,4),dn(48,4),dn(64,4),dn(80,4),dn(96,3),dn(104,3),dn(112,2),dn(116,1),dn(118,1),yn(1,1,3),yn(1,1,3),yn(0,1,4),yn(1,0,4),yn(0,0,3),yn(0,0,3),dn(120,4),dn(136,4),dn(152,4),dn(168,4),dn(184,4),dn(200,3),dn(208,3),dn(216,4),dn(232,3),dn(240,3),dn(248,3),dn(256,3),dn(264,2),dn(268,3),dn(276,3),dn(284,2),dn(288,2),dn(292,2),dn(296,2),dn(300,2),dn(304,2),dn(308,2),dn(312,2),dn(316,2),dn(320,1),dn(322,1),dn(324,1),dn(326,2),dn(330,1),dn(332,1),dn(334,2),dn(338,1),dn(340,1),dn(342,1),yn(9,1,4),dn(344,1),dn(346,1),dn(348,1),dn(350,1),dn(352,1),yn(2,8,4),yn(8,2,4),yn(1,8,4),yn(8,1,4),dn(354,1),dn(356,1),dn(358,1),dn(360,1),yn(2,7,4),yn(7,2,4),yn(6,4,4),yn(1,7,4),yn(5,5,4),yn(7,1,4),dn(362,1),yn(3,6,4),yn(6,3,4),yn(4,5,4),yn(5,4,4),yn(2,6,4),yn(6,2,4),yn(1,6,4),dn(364,1),yn(3,5,4),yn(6,1,3),yn(6,1,3),yn(5,3,4),yn(4,4,4),yn(2,5,3),yn(2,5,3),yn(5,2,3),yn(5,2,3),yn(1,5,3),yn(1,5,3),yn(5,1,3),yn(5,1,3),yn(0,5,4),yn(5,0,4),yn(3,4,3),yn(3,4,3),yn(4,3,3),yn(2,4,3),yn(4,2,3),yn(3,3,3),yn(4,1,2),yn(4,1,2),yn(1,4,3),yn(0,4,3),yn(2,3,2),yn(2,3,2),yn(3,2,2),yn(3,2,2),yn(4,0,3),yn(0,3,3),yn(1,3,2),yn(1,3,2),yn(3,1,2),yn(3,0,2),yn(2,2,1),yn(2,2,1),yn(1,2,1),yn(2,1,1),yn(0,2,1),yn(2,0,1),dn(366,1),dn(368,1),yn(14,14,4),dn(370,1),dn(372,1),dn(374,1),yn(15,11,4),dn(376,1),yn(13,13,4),yn(10,15,4),yn(15,10,4),yn(11,14,4),yn(14,11,4),yn(12,13,4),yn(13,12,4),yn(9,15,4),yn(15,9,4),yn(14,10,4),yn(11,13,4),yn(13,11,4),yn(8,15,4),yn(15,8,4),yn(12,12,4),yn(9,14,4),yn(14,9,4),yn(7,15,4),yn(15,7,4),yn(10,13,4),yn(13,10,4),yn(11,12,4),yn(6,15,4),dn(378,1),yn(12,11,3),yn(12,11,3),yn(15,6,3),yn(15,6,3),yn(8,14,4),yn(14,8,4),yn(5,15,4),yn(9,13,4),yn(15,5,3),yn(15,5,3),yn(7,14,3),yn(7,14,3),yn(14,7,3),yn(14,7,3),yn(10,12,3),yn(10,12,3),yn(12,10,3),yn(12,10,3),yn(11,11,3),yn(11,11,3),yn(13,9,4),yn(8,13,4),yn(4,15,3),yn(4,15,3),yn(15,4,3),yn(15,4,3),yn(3,15,3),yn(3,15,3),yn(15,3,3),yn(15,3,3),yn(13,8,3),yn(13,8,3),yn(14,6,3),yn(14,6,3),yn(2,15,3),yn(2,15,3),yn(15,2,3),yn(15,2,3),yn(6,14,4),yn(15,0,4),yn(1,15,3),yn(1,15,3),yn(15,1,3),yn(15,1,3),yn(9,12,3),yn(9,12,3),yn(12,9,3),yn(12,9,3),yn(5,14,3),yn(10,11,3),yn(11,10,3),yn(14,5,3),yn(7,13,3),yn(13,7,3),yn(4,14,3),yn(14,4,3),yn(8,12,3),yn(12,8,3),yn(3,14,3),yn(6,13,3),yn(13,6,3),yn(14,3,3),yn(9,11,3),yn(11,9,3),yn(2,14,3),yn(2,14,3),yn(10,10,3),yn(10,10,3),yn(14,2,3),yn(14,2,3),yn(1,14,3),yn(1,14,3),yn(14,1,3),yn(14,1,3),yn(0,14,4),yn(14,0,4),yn(5,13,3),yn(5,13,3),yn(13,5,3),yn(13,5,3),yn(7,12,3),yn(12,7,3),yn(4,13,3),yn(8,11,3),yn(13,4,2),yn(13,4,2),yn(11,8,3),yn(9,10,3),yn(10,9,3),yn(6,12,3),yn(12,6,3),yn(3,13,3),yn(13,3,2),yn(13,3,2),yn(13,2,2),yn(13,2,2),yn(2,13,3),yn(0,13,3),yn(1,13,2),yn(1,13,2),yn(7,11,2),yn(7,11,2),yn(11,7,2),yn(11,7,2),yn(13,1,2),yn(13,1,2),yn(5,12,3),yn(13,0,3),yn(12,5,2),yn(12,5,2),yn(8,10,2),yn(8,10,2),yn(10,8,2),yn(4,12,2),yn(12,4,2),yn(6,11,2),yn(11,6,2),yn(11,6,2),yn(9,9,3),yn(0,12,3),yn(3,12,2),yn(3,12,2),yn(12,3,2),yn(12,3,2),yn(7,10,2),yn(7,10,2),yn(10,7,2),yn(10,7,2),yn(10,6,2),yn(10,6,2),yn(12,0,3),yn(0,11,3),yn(12,2,1),yn(12,2,1),yn(2,12,2),yn(5,11,2),yn(11,5,2),yn(1,12,2),yn(8,9,2),yn(9,8,2),yn(12,1,2),yn(4,11,2),yn(11,4,2),yn(6,10,2),yn(3,11,2),yn(7,9,2),yn(11,3,1),yn(11,3,1),yn(9,7,2),yn(8,8,2),yn(2,11,2),yn(5,10,2),yn(11,2,1),yn(11,2,1),yn(10,5,2),yn(1,11,2),yn(11,1,1),yn(11,1,1),yn(11,0,2),yn(6,9,2),yn(9,6,2),yn(4,10,2),yn(10,4,2),yn(7,8,2),yn(8,7,2),yn(3,10,2),yn(10,3,1),yn(10,3,1),yn(5,9,1),yn(9,5,1),yn(2,10,1),yn(10,2,1),yn(1,10,1),yn(10,1,1),yn(0,10,2),yn(10,0,2),yn(6,8,1),yn(6,8,1),yn(8,6,1),yn(4,9,1),yn(9,4,1),yn(3,9,1),yn(9,3,1),yn(9,3,1),yn(7,7,2),yn(0,9,2),yn(5,8,1),yn(8,5,1),yn(2,9,1),yn(6,7,1),yn(7,6,1),yn(9,2,1),yn(1,9,1),yn(9,0,1),yn(4,8,1),yn(8,4,1),yn(5,7,1),yn(7,5,1),yn(3,8,1),yn(8,3,1),yn(6,6,1),yn(4,7,1),yn(7,4,1),yn(0,8,1),yn(8,0,1),yn(5,6,1),yn(6,5,1),yn(3,7,1),yn(7,3,1),yn(4,6,1),yn(0,7,1),yn(7,0,1),yn(0,6,1),yn(6,0,1),yn(15,15,1),yn(14,15,1),yn(15,14,1),yn(13,15,1),yn(15,13,1),yn(12,15,1),yn(15,12,1),yn(13,14,1),yn(14,13,1),yn(11,15,1),yn(12,14,1),yn(14,12,1),yn(10,14,1),yn(0,15,1)];const Dn=[dn(16,4),dn(32,4),dn(48,4),dn(64,2),yn(1,1,4),yn(0,1,4),yn(1,0,3),yn(1,0,3),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),yn(0,0,1),dn(68,3),dn(76,3),dn(84,2),yn(15,15,4),dn(88,2),dn(92,1),dn(94,4),yn(15,2,4),dn(110,1),yn(1,15,4),yn(15,1,4),dn(112,4),dn(128,4),dn(144,4),dn(160,4),dn(176,4),dn(192,4),dn(208,3),dn(216,3),dn(224,3),dn(232,3),dn(240,3),dn(248,3),dn(256,3),dn(264,2),dn(268,2),dn(272,1),dn(274,2),dn(278,2),dn(282,1),yn(5,1,4),dn(284,1),dn(286,1),dn(288,1),dn(290,1),yn(1,4,4),yn(4,1,4),dn(292,1),yn(2,3,4),yn(3,2,4),yn(1,3,3),yn(1,3,3),yn(3,1,3),yn(3,1,3),yn(0,3,4),yn(3,0,4),yn(2,2,3),yn(2,2,3),yn(1,2,2),yn(2,1,2),yn(0,2,2),yn(2,0,2),yn(14,15,3),yn(15,14,3),yn(13,15,3),yn(15,13,3),yn(12,15,3),yn(15,12,3),yn(11,15,3),yn(15,11,3),yn(10,15,2),yn(10,15,2),yn(15,10,3),yn(9,15,3),yn(15,9,3),yn(15,8,3),yn(8,15,2),yn(8,15,2),yn(7,15,2),yn(15,7,2),yn(6,15,2),yn(15,6,2),yn(5,15,2),yn(15,5,2),yn(4,15,1),yn(4,15,1),yn(15,4,1),yn(15,3,1),yn(15,0,1),yn(15,0,1),yn(15,0,1),yn(15,0,1),yn(15,0,1),yn(15,0,1),yn(15,0,1),yn(15,0,1),yn(3,15,2),yn(3,15,2),yn(3,15,2),yn(3,15,2),dn(294,4),dn(310,3),dn(318,3),dn(326,3),yn(2,15,1),yn(0,15,1),dn(334,2),dn(338,2),dn(342,2),dn(346,1),dn(348,2),dn(352,2),dn(356,1),dn(358,2),dn(362,2),dn(366,2),dn(370,2),yn(14,3,4),dn(374,1),dn(376,1),dn(378,1),dn(380,1),dn(382,1),dn(384,1),dn(386,1),yn(0,13,4),dn(388,1),dn(390,1),dn(392,1),yn(3,12,4),dn(394,1),yn(1,12,4),yn(12,0,4),dn(396,1),yn(14,2,3),yn(14,2,3),yn(2,14,4),yn(1,14,4),yn(13,3,4),yn(2,13,4),yn(13,2,4),yn(13,1,4),yn(3,11,4),dn(398,1),yn(1,13,3),yn(1,13,3),yn(12,4,4),yn(6,11,4),yn(12,3,4),yn(10,7,4),yn(2,12,3),yn(2,12,3),yn(12,2,4),yn(11,5,4),yn(12,1,4),yn(0,12,4),yn(4,11,4),yn(11,4,4),yn(6,10,4),yn(10,6,4),yn(11,3,3),yn(11,3,3),yn(5,10,4),yn(10,5,4),yn(2,11,3),yn(2,11,3),yn(11,2,3),yn(11,2,3),yn(1,11,3),yn(1,11,3),yn(11,1,3),yn(11,1,3),yn(0,11,4),yn(11,0,4),yn(6,9,4),yn(9,6,4),yn(4,10,4),yn(10,4,4),yn(7,8,4),yn(8,7,4),yn(10,3,3),yn(10,3,3),yn(3,10,4),yn(5,9,4),yn(2,10,3),yn(2,10,3),yn(9,5,4),yn(6,8,4),yn(10,1,3),yn(10,1,3),yn(8,6,4),yn(7,7,4),yn(9,4,3),yn(9,4,3),yn(4,9,4),yn(5,7,4),yn(6,7,3),yn(6,7,3),yn(10,2,2),yn(10,2,2),yn(10,2,2),yn(10,2,2),yn(1,10,2),yn(1,10,2),yn(0,10,3),yn(10,0,3),yn(3,9,3),yn(9,3,3),yn(5,8,3),yn(8,5,3),yn(2,9,2),yn(2,9,2),yn(9,2,2),yn(9,2,2),yn(7,6,3),yn(0,9,3),yn(1,9,2),yn(1,9,2),yn(9,1,2),yn(9,1,2),yn(9,0,3),yn(4,8,3),yn(8,4,3),yn(7,5,3),yn(3,8,3),yn(8,3,3),yn(6,6,3),yn(2,8,3),yn(8,2,2),yn(8,2,2),yn(4,7,3),yn(7,4,3),yn(1,8,2),yn(1,8,2),yn(8,1,2),yn(8,1,2),yn(8,0,2),yn(8,0,2),yn(0,8,3),yn(5,6,3),yn(3,7,2),yn(3,7,2),yn(7,3,2),yn(7,3,2),yn(6,5,3),yn(4,6,3),yn(2,7,2),yn(2,7,2),yn(7,2,2),yn(7,2,2),yn(6,4,3),yn(5,5,3),yn(0,7,2),yn(0,7,2),yn(1,7,1),yn(1,7,1),yn(1,7,1),yn(1,7,1),yn(7,1,1),yn(7,1,1),yn(7,0,2),yn(3,6,2),yn(6,3,2),yn(4,5,2),yn(5,4,2),yn(2,6,2),yn(6,2,1),yn(1,6,1),yn(6,1,1),yn(6,1,1),yn(0,6,2),yn(6,0,2),yn(5,3,1),yn(5,3,1),yn(3,5,2),yn(4,4,2),yn(2,5,1),yn(5,2,1),yn(1,5,1),yn(0,5,1),yn(3,4,1),yn(4,3,1),yn(5,0,1),yn(2,4,1),yn(4,2,1),yn(3,3,1),yn(0,4,1),yn(4,0,1),yn(12,14,4),dn(400,1),yn(13,14,3),yn(13,14,3),yn(14,9,3),yn(14,9,3),yn(14,10,4),yn(13,9,4),yn(14,14,2),yn(14,14,2),yn(14,14,2),yn(14,14,2),yn(14,13,3),yn(14,13,3),yn(14,11,3),yn(14,11,3),yn(11,14,2),yn(11,14,2),yn(12,13,2),yn(12,13,2),yn(13,12,3),yn(13,11,3),yn(10,14,2),yn(10,14,2),yn(12,12,2),yn(12,12,2),yn(10,13,3),yn(13,10,3),yn(7,14,3),yn(10,12,3),yn(12,10,2),yn(12,10,2),yn(12,9,3),yn(7,13,3),yn(5,14,2),yn(5,14,2),yn(11,13,1),yn(11,13,1),yn(11,13,1),yn(11,13,1),yn(9,14,1),yn(9,14,1),yn(11,12,2),yn(12,11,2),yn(8,14,2),yn(14,8,2),yn(9,13,2),yn(14,7,2),yn(11,11,2),yn(8,13,2),yn(13,8,2),yn(6,14,2),yn(14,6,1),yn(9,12,1),yn(10,11,2),yn(11,10,2),yn(14,5,2),yn(13,7,2),yn(4,14,1),yn(4,14,1),yn(14,4,2),yn(8,12,2),yn(12,8,1),yn(3,14,1),yn(6,13,1),yn(6,13,1),yn(13,6,2),yn(9,11,2),yn(11,9,2),yn(10,10,2),yn(14,1,1),yn(14,1,1),yn(13,4,1),yn(13,4,1),yn(11,8,2),yn(10,9,2),yn(7,11,1),yn(7,11,1),yn(11,7,2),yn(13,0,2),yn(0,14,1),yn(14,0,1),yn(5,13,1),yn(13,5,1),yn(7,12,1),yn(12,7,1),yn(4,13,1),yn(8,11,1),yn(9,10,1),yn(6,12,1),yn(12,6,1),yn(3,13,1),yn(5,12,1),yn(12,5,1),yn(8,10,1),yn(10,8,1),yn(9,9,1),yn(4,12,1),yn(11,6,1),yn(7,10,1),yn(5,11,1),yn(8,9,1),yn(9,8,1),yn(7,9,1),yn(9,7,1),yn(8,8,1),yn(14,12,1),yn(13,13,1)];const Pn=[dn(16,4),dn(32,4),dn(48,4),yn(15,15,4),dn(64,4),dn(80,4),dn(96,4),dn(112,4),dn(128,4),dn(144,4),dn(160,3),dn(168,2),yn(1,1,4),yn(0,1,4),yn(1,0,4),yn(0,0,4),yn(14,15,4),yn(15,14,4),yn(13,15,4),yn(15,13,4),yn(12,15,4),yn(15,12,4),yn(11,15,4),yn(15,11,4),yn(15,10,3),yn(15,10,3),yn(10,15,4),yn(9,15,4),yn(15,9,3),yn(15,9,3),yn(15,8,3),yn(15,8,3),yn(8,15,4),yn(7,15,4),yn(15,7,3),yn(15,7,3),yn(6,15,3),yn(6,15,3),yn(15,6,3),yn(15,6,3),yn(5,15,3),yn(5,15,3),yn(15,5,3),yn(15,5,3),yn(4,15,3),yn(4,15,3),yn(15,4,3),yn(15,4,3),yn(3,15,3),yn(3,15,3),yn(15,3,3),yn(15,3,3),yn(2,15,3),yn(2,15,3),yn(15,2,3),yn(15,2,3),yn(15,1,3),yn(15,1,3),yn(1,15,4),yn(15,0,4),dn(172,3),dn(180,3),dn(188,3),dn(196,3),dn(204,4),dn(220,3),dn(228,3),dn(236,3),dn(244,2),dn(248,2),dn(252,2),dn(256,2),dn(260,2),dn(264,2),dn(268,2),dn(272,2),dn(276,2),dn(280,3),dn(288,2),dn(292,2),dn(296,2),dn(300,3),dn(308,2),dn(312,3),dn(320,1),dn(322,2),dn(326,2),dn(330,1),dn(332,2),dn(336,1),dn(338,1),dn(340,1),dn(342,1),dn(344,1),dn(346,1),dn(348,1),dn(350,1),dn(352,1),dn(354,1),dn(356,1),dn(358,1),dn(360,1),dn(362,1),dn(364,1),dn(366,1),dn(368,1),dn(370,2),dn(374,1),dn(376,2),yn(7,3,4),dn(380,1),yn(7,2,4),yn(4,6,4),yn(6,4,4),yn(5,5,4),yn(7,1,4),yn(3,6,4),yn(6,3,4),yn(4,5,4),yn(5,4,4),yn(2,6,4),yn(6,2,4),yn(1,6,4),yn(6,1,4),dn(382,1),yn(3,5,4),yn(5,3,4),yn(4,4,4),yn(2,5,4),yn(5,2,4),yn(1,5,4),dn(384,1),yn(5,1,3),yn(5,1,3),yn(3,4,4),yn(4,3,4),yn(2,4,3),yn(2,4,3),yn(4,2,3),yn(4,2,3),yn(3,3,3),yn(3,3,3),yn(1,4,3),yn(1,4,3),yn(4,1,3),yn(4,1,3),yn(0,4,4),yn(4,0,4),yn(2,3,3),yn(2,3,3),yn(3,2,3),yn(3,2,3),yn(1,3,2),yn(1,3,2),yn(1,3,2),yn(1,3,2),yn(3,1,2),yn(3,1,2),yn(3,1,2),yn(3,1,2),yn(0,3,3),yn(3,0,3),yn(2,2,2),yn(2,2,2),yn(1,2,1),yn(1,2,1),yn(1,2,1),yn(1,2,1),yn(2,1,1),yn(2,1,1),yn(0,2,2),yn(2,0,2),yn(0,15,1),yn(0,15,1),yn(0,15,1),yn(0,15,1),yn(14,14,3),yn(13,14,3),yn(14,13,3),yn(12,14,3),yn(14,12,3),yn(13,13,3),yn(11,14,3),yn(14,11,3),yn(12,13,3),yn(13,12,3),yn(10,14,3),yn(14,10,3),yn(11,13,3),yn(13,11,3),yn(12,12,3),yn(9,14,3),yn(14,9,3),yn(10,13,3),yn(13,10,3),yn(11,12,3),yn(12,11,3),yn(8,14,3),yn(14,8,3),yn(9,13,3),yn(13,9,3),yn(7,14,3),yn(14,7,3),yn(10,12,3),yn(12,10,3),yn(12,10,3),yn(11,11,3),yn(11,11,3),yn(8,13,3),yn(8,13,3),yn(13,8,3),yn(13,8,3),yn(0,14,4),yn(14,0,4),yn(0,13,3),yn(0,13,3),yn(14,6,2),yn(14,6,2),yn(14,6,2),yn(14,6,2),yn(6,14,3),yn(9,12,3),yn(12,9,2),yn(12,9,2),yn(5,14,2),yn(5,14,2),yn(11,10,2),yn(11,10,2),yn(14,5,2),yn(14,5,2),yn(10,11,3),yn(7,13,3),yn(13,7,2),yn(13,7,2),yn(14,4,2),yn(14,4,2),yn(8,12,2),yn(8,12,2),yn(12,8,2),yn(12,8,2),yn(4,14,3),yn(2,14,3),yn(3,14,2),yn(3,14,2),yn(6,13,2),yn(13,6,2),yn(14,3,2),yn(9,11,2),yn(11,9,2),yn(10,10,2),yn(14,2,2),yn(1,14,2),yn(14,1,2),yn(5,13,2),yn(13,5,2),yn(7,12,2),yn(12,7,2),yn(4,13,2),yn(8,11,2),yn(11,8,2),yn(13,4,2),yn(9,10,2),yn(10,9,2),yn(6,12,2),yn(12,6,2),yn(3,13,2),yn(13,3,2),yn(2,13,2),yn(13,2,2),yn(1,13,2),yn(7,11,2),yn(11,7,2),yn(13,1,2),yn(5,12,2),yn(12,5,2),yn(8,10,2),yn(10,8,2),yn(9,9,2),yn(4,12,2),yn(12,4,2),yn(6,11,2),yn(6,11,2),yn(11,6,2),yn(11,6,2),yn(13,0,3),yn(0,12,3),yn(3,12,2),yn(3,12,2),yn(12,3,2),yn(7,10,2),yn(10,7,2),yn(2,12,2),yn(12,2,2),yn(5,11,2),yn(11,5,2),yn(1,12,2),yn(8,9,2),yn(9,8,2),yn(12,1,2),yn(4,11,2),yn(12,0,3),yn(0,11,3),yn(3,11,2),yn(3,11,2),yn(11,0,3),yn(0,10,3),yn(1,10,2),yn(1,10,2),yn(11,4,1),yn(11,4,1),yn(6,10,2),yn(10,6,2),yn(7,9,2),yn(7,9,2),yn(9,7,2),yn(9,7,2),yn(10,0,3),yn(0,9,3),yn(9,0,2),yn(9,0,2),yn(11,3,1),yn(8,8,1),yn(2,11,2),yn(5,10,2),yn(11,2,1),yn(11,2,1),yn(10,5,2),yn(1,11,2),yn(11,1,2),yn(6,9,2),yn(9,6,1),yn(10,4,1),yn(4,10,2),yn(7,8,2),yn(8,7,1),yn(8,7,1),yn(3,10,1),yn(10,3,1),yn(5,9,1),yn(9,5,1),yn(2,10,1),yn(10,2,1),yn(10,1,1),yn(6,8,1),yn(8,6,1),yn(7,7,1),yn(4,9,1),yn(9,4,1),yn(3,9,1),yn(9,3,1),yn(5,8,1),yn(8,5,1),yn(2,9,1),yn(6,7,1),yn(7,6,1),yn(9,2,1),yn(1,9,1),yn(9,1,1),yn(4,8,1),yn(8,4,1),yn(5,7,1),yn(7,5,1),yn(3,8,1),yn(8,3,1),yn(6,6,1),yn(2,8,1),yn(8,2,1),yn(1,8,1),yn(4,7,1),yn(7,4,1),yn(8,1,1),yn(8,1,1),yn(0,8,2),yn(8,0,2),yn(5,6,1),yn(6,5,1),yn(1,7,1),yn(1,7,1),yn(0,7,2),yn(7,0,2),yn(3,7,1),yn(2,7,1),yn(0,6,1),yn(6,0,1),yn(0,5,1),yn(5,0,1)];const Bn=[mn,gn];const jn=[new Hn(bn,0,0),new Hn(wn,0,3),new Hn(En,0,3),new Hn(Sn,0,3),null,new Hn(xn,0,3),new Hn(Tn,0,4),new Hn(Nn,0,4),new Hn(Cn,0,4),new Hn(kn,0,4),new Hn(Ln,0,4),new Hn(An,0,4),new Hn(On,0,4),new Hn(Mn,0,4),null,new Hn(_n,0,4),new Hn(Dn,1,4),new Hn(Dn,2,4),new Hn(Dn,3,4),new Hn(Dn,4,4),new Hn(Dn,6,4),new Hn(Dn,8,4),new Hn(Dn,10,4),new Hn(Dn,13,4),new Hn(Pn,4,4),new Hn(Pn,5,4),new Hn(Pn,6,4),new Hn(Pn,7,4),new Hn(Pn,8,4),new Hn(Pn,9,4),new Hn(Pn,11,4),new Hn(Pn,13,4)];var Fn=function(){function e(){this.tmp_imdct36=new Float64Array(18);this.tmp_dctIV=new Float64Array(18);this.tmp_sdctII=new Float64Array(9)}function c(e,t,n){var r,c,h,p,d,v,m,g,y,b,w,E,S;var x,T,N,C,k,L,A,O,M,_,D,P,H;var B,j,F,I,q,R,U,z;r=e[3]+e[5];c=e[3]-e[5];h=e[6]+e[2];p=e[6]-e[2];d=e[1]+e[7];v=e[1]-e[7];m=e[8]+e[0];g=e[8]-e[0];y=r+h;b=r-h;w=r-m;E=h-m;S=y+m;x=c-p;T=x+g;N=p+g;C=c-g;k=c+p;B=k*-u;j=C*-i;F=N*-a;I=T*-s;q=v*-s;R=E*-l;U=w*-f;z=b*-o;L=e[4]+d;A=2*e[4]-d;O=A+R;M=A-R;_=A+U;D=q+F;P=q-F;H=q+j;t[n+0]=L+S;t[n+2]=B-H;t[n+4]=z-O;t[n+6]=I;t[n+8]=M-U;t[n+10]=P-j;t[n+12]=S-2*L;t[n+14]=D+B;t[n+16]=_+z}e.prototype.imdct36=function(e,t){var n=this.tmp_imdct36;this.dctIV(e,n);for(var r=0;r<9;++r){t[r]=n[9+r]}for(var r=9;r<27;++r){t[r]=-n[36-(9+r)-1]}for(var r=27;r<36;++r){t[r]=-n[r-27]}};var t=[];for(r=0;r<18;r++){t[r]=2*Math.cos(Math.PI*(2*r+1)/(4*18))}e.prototype.dctIV=function(e,n){var r=this.tmp_dctIV;for(var i=0;i<18;++i){r[i]=e[i]*t[i]}this.sdctII(r,n);n[0]/=2;for(var i=1;i<18;++i){n[i]=n[i]/2-n[i-1]}};var n=[];for(var r=0;r<9;++r){n[r]=2*Math.cos(Math.PI*(2*r+1)/(2*18))}e.prototype.sdctII=function(e,t){var r=this.tmp_sdctII;for(var i=0;i<9;++i){r[i]=e[i]+e[18-i-1]}c(r,t,0);for(var i=0;i<9;++i){r[i]=(e[i]-e[18-i-1])*n[i]}c(r,t,1);for(var i=3;i<18;i+=2){t[i]-=t[i-2]}};var i=2*Math.cos(1*Math.PI/18);var s=2*Math.cos(3*Math.PI/18);var o=2*Math.cos(4*Math.PI/18);var u=2*Math.cos(5*Math.PI/18);var a=2*Math.cos(7*Math.PI/18);var f=2*Math.cos(8*Math.PI/18);var l=2*Math.cos(16*Math.PI/18);return e}();const In=[[.608761429,-.923879533,-.130526192,.991444861,-.382683432,-.79335334],[-.79335334,.382683432,.991444861,.130526192,-.923879533,-.608761429],[.382683432,-.923879533,.923879533,-.382683432,-.382683432,.923879533],[-.923879533,-.382683432,.382683432,.923879533,.923879533,.382683432],[.130526192,-.382683432,.608761429,-.79335334,.923879533,-.991444861],[-.991444861,-.923879533,-.79335334,-.608761429,-.382683432,-.130526192]];P.layers[3]=zn;zn.prototype.decode=function(e,n){var r=n.header;var i=0;var s=0;var o=r.nchannels();var u=r.flags&k.LSF_EXT?o===1?9:17:o===1?17:32;if(e.next_frame-e.nextByte()<u){e.md_len=0;throw new Error("Bad frame length")}if(r.flags&k.PROTECTION){}var a=this.sideInfo(e,o,r.flags&k.LSF_EXT);var f=a.si;var l=a.data_bitlen;var c=a.priv_bitlen;r.flags|=c;r.private_bits|=f.private_bits;var h=e.copy();h.seek(e.next_frame*8);var p=h.read(16);if((p&65510)===65506){if((p&1)===0)h.advance(16);h.advance(16);i=h.read(p&8?9:8)}var d=e.next_frame-e.nextByte();if(i>f.main_data_begin+d)i=0;var s=f.main_data_begin+d-i;var v=0;var m;if(f.main_data_begin===0){m=e.stream;e.md_len=0;v=s}else{if(f.main_data_begin>e.md_len){throw new Error("bad main_data_begin pointer")}else{var g=e.md_len;if(s>f.main_data_begin){if(e.md_len+s-f.main_data_begin>_){throw new Error("Assertion failed: (stream.md_len + md_len - si.main_data_begin <= MAD_BUFFER_MDLEN)")}v=s-f.main_data_begin;this.memcpy(e.main_data,e.md_len,e.stream.stream,e.nextByte(),v);e.md_len+=v}m=new t.Bitstream(t.Stream.fromBuffer(new t.Buffer(e.main_data)));m.advance((g-f.main_data_begin)*8)}}var y=d-v;this.decodeMainData(m,n,f,o);if(y>=i){this.memcpy(e.main_data,0,e.stream.stream,e.next_frame-i,i);e.md_len=i}else{if(s<f.main_data_begin){var b=f.main_data_begin-s;if(b+y>i)b=i-y;if(b<e.md_len){this.memcpy(e.main_data,0,e.main_data,e.md_len-b,b);e.md_len=b}}else{e.md_len=0}this.memcpy(e.main_data,e.md_len,e.stream.stream,e.next_frame-y,y);e.md_len+=y}};zn.prototype.memcpy=function(e,t,n,r,i){var s;if(n.subarray)s=n.subarray(r,r+i);else s=n.peekBuffer(r-n.offset,i).data;e.set(s,t);return e};zn.prototype.sideInfo=function(e,t,n){var r=this.si;var i=0;var s=n?t===1?1:2:t===1?5:3;r.main_data_begin=e.read(n?8:9);r.private_bits=e.read(s);var o=1;if(!n){o=2;for(var u=0;u<t;++u)r.scfsi[u]=e.read(4)}for(var a=0;a<o;a++){var f=r.gr[a];for(var u=0;u<t;u++){var l=f.ch[u];l.part2_3_length=e.read(12);l.big_values=e.read(9);l.global_gain=e.read(8);l.scalefac_compress=e.read(n?9:4);i+=l.part2_3_length;if(l.big_values>288)throw new Error("bad big_values count");l.flags=0;if(e.read(1)){l.block_type=e.read(2);if(l.block_type===0)throw new Error("reserved block_type");if(!n&&l.block_type===2&&r.scfsi[u])throw new Error("bad scalefactor selection info");l.region0_count=7;l.region1_count=36;if(e.read(1))l.flags|=Gt;else if(l.block_type===2)l.region0_count=8;for(var c=0;c<2;c++)l.table_select[c]=e.read(5);for(var c=0;c<3;c++)l.subblock_gain[c]=e.read(3)}else{l.block_type=0;for(var c=0;c<3;c++)l.table_select[c]=e.read(5);l.region0_count=e.read(4);l.region1_count=e.read(3)}l.flags|=e.read(n?2:3)}}return{si:r,data_bitlen:i,priv_bitlen:s}};zn.prototype.decodeMainData=function(e,t,n,r){var i=t.header;var s=i.samplerate;if(i.flags&k.MPEG_2_5_EXT)s*=2;var o=(s>>7&15)+(s>>15&1)-8;if(i.flags&k.MPEG_2_5_EXT)o+=3;var u=i.flags&k.LSF_EXT?1:2;var a=this.xr;for(var f=0;f<u;++f){var l=n.gr[f];var c=[];var h=0;for(var p=0;p<r;++p){var d=l.ch[p];var v;c[p]=zt[o].l;if(d.block_type===2){c[p]=d.flags&Gt?zt[o].m:zt[o].s}if(i.flags&k.LSF_EXT){v=this.scalefactors_lsf(e,d,p===0?0:n.gr[1].ch[1],i.mode_extension)}else{v=this.scalefactors(e,d,n.gr[0].ch[p],f===0?0:n.scfsi[p])}this.huffmanDecode(e,a[p],d,c[p],v)}if(i.mode===A.JOINT_STEREO&&i.mode_extension!==0)this.stereo(a,n.gr,f,i,c[0]);for(var p=0;p<r;p++){var d=l.ch[p];var m=t.sbsample[p].slice(18*f);var g,h=0,y,b;var w=this.output;if(d.block_type===2){this.reorder(a[p],d,c[p]);if(d.flags&Gt)this.aliasreduce(a[p],36)}else{this.aliasreduce(a[p],576)}if(d.block_type!==2||d.flags&Gt){var E=d.block_type;if(d.flags&Gt)E=0;for(var g=0;g<2;++g,h+=18){this.imdct_l(a[p].subarray(h,h+18),w,E);this.overlap(w,t.overlap[p][g],m,g)}}else{for(var g=0;g<2;++g,h+=18){this.imdct_s(a[p].subarray(h,h+18),w);this.overlap(w,t.overlap[p][g],m,g)}}this.freqinver(m,1);var y=576;while(y>36&&a[p][y-1]===0){--y}b=32-((576-y)/18<<0);if(d.block_type!==2){for(var g=2;g<b;++g,h+=18){this.imdct_l(a[p].subarray(h,h+18),w,d.block_type);this.overlap(w,t.overlap[p][g],m,g);if(g&1)this.freqinver(m,g)}}else{for(var g=2;g<b;++g,h+=18){this.imdct_s(a[p].subarray(h,h+18),w);this.overlap(w,t.overlap[p][g],m,g);if(g&1)this.freqinver(m,g)}}for(var g=b;g<32;++g){this.overlap_z(t.overlap[p][g],m,g);if(g&1)this.freqinver(m,g)}}}};zn.prototype.scalefactors=function(e,t,n,r){var i=e.offset();var s=sn[t.scalefac_compress].slen1;var o=sn[t.scalefac_compress].slen2;var u;if(t.block_type===2){u=0;var a=t.flags&Gt?8+3*3:6*3;while(a--)t.scalefac[u++]=e.read(s);a=6*3;while(a--)t.scalefac[u++]=e.read(o);a=1*3;while(a--)t.scalefac[u++]=0}else{if(r&8){for(var u=0;u<6;++u)t.scalefac[u]=n.scalefac[u]}else{for(var u=0;u<6;++u)t.scalefac[u]=e.read(s)}if(r&4){for(var u=6;u<11;++u)t.scalefac[u]=n.scalefac[u]}else{for(var u=6;u<11;++u)t.scalefac[u]=e.read(s)}if(r&2){for(var u=11;u<16;++u)t.scalefac[u]=n.scalefac[u]}else{for(var u=11;u<16;++u)t.scalefac[u]=e.read(o)}if(r&1){for(var u=16;u<21;++u)t.scalefac[u]=n.scalefac[u]}else{for(var u=16;u<21;++u)t.scalefac[u]=e.read(o)}t.scalefac[21]=0}return e.offset()-i};zn.prototype.scalefactors_lsf=function(e,t,n,r){var i=e.offset();var s=t.scalefac_compress;var o=t.block_type===2?t.flags&Gt?2:1:0;var u=new Int32Array(4);var a;if(!(r&Yt&&n)){if(s<400){u[0]=(s>>>4)/5;u[1]=(s>>>4)%5;u[2]=s%16>>>2;u[3]=s%4;a=on[0][o]}else if(s<500){s-=400;u[0]=(s>>>2)/5;u[1]=(s>>>2)%5;u[2]=s%4;u[3]=0;a=on[1][o]}else{s-=500;u[0]=s/3;u[1]=s%3;u[2]=0;u[3]=0;t.flags|=Qt;a=on[2][o]}var f=0;for(var l=0;l<4;l++){for(var c=0;c<a[l];c++){t.scalefac[f++]=e.read(u[l])}}while(f<39){t.scalefac[f++]=0}}else{s>>>=1;if(s<180){u[0]=s/36;u[1]=s%36/6;u[2]=s%36%6;u[3]=0;a=on[3][o]}else if(s<244){s-=180;u[0]=s%64>>>4;u[1]=s%16>>>2;u[2]=s%4;u[3]=0;a=on[4][o]}else{s-=244;u[0]=s/3;u[1]=s%3;u[2]=0;u[3]=0;a=on[5][o]}var f=0;for(var l=0;l<4;++l){var h=(1<<u[l])-1;for(var c=0;c<a[l];++c){var p=e.read(u[l]);t.scalefac[f]=p;n.scalefac[f++]=p===h?1:0}}while(f<39){t.scalefac[f]=0;n.scalefac[f++]=0}}return e.offset()-i};zn.prototype.huffmanDecode=function(e,t,n,r,i){var s=this._exponents;var o=0;var u=n.part2_3_length-i;if(u<0)throw new Error("bad audio data length");this.exponents(n,r,s);var a=e.copy();e.advance(u);var f=8-a.bitPosition;f+=32-1-24+(24-f)&~7;var l=a.read(f);u-=f;var c=0;var h=0;var p=this.reqcache;var d=c+r[o++];var v=n.region0_count+1;var m=jn[n.table_select[h]];var g=m.table;var y=m.linbits;var b=m.startbits;if(typeof g==="undefined")throw new Error("bad Huffman table select");var w=0;var E=s[w++];var S=0;var x=n.big_values;while(x--&&f+u>0){if(c===d){d+=r[o++];if(--v===0){if(h===0)v=n.region1_count+1;else v=0;m=jn[n.table_select[++h]];g=m.table;y=m.linbits;b=m.startbits;if(typeof g==="undefined")throw new Error("bad Huffman table select")}if(E!==s[w]){E=s[w];S=0}++w}if(f<21){var T=32-1-21+(21-f)&~7;l=l<<T|a.read(T);f+=T;u-=T}var N=b;var C=g[l>>f-N&(1<<N)-1];while(!C.final){f-=N;N=C.ptr.bits;C=g[C.ptr.offset+(l>>f-N&(1<<N)-1)]}f-=C.value.hlen;if(y){var k=C.value.x;var L=false;switch(k){case 0:t[c]=0;break;case 15:if(f<y+2){l=l<<16|a.read(16);f+=16;u-=16}k+=l>>f-y&(1<<y)-1;f-=y;O=this.requantize(k,E);L=true;break;default:if(S&1<<k){O=p[k]}else{S|=1<<k;O=p[k]=this.requantize(k,E)}L=true}if(L){t[c]=l&1<<f-- -1?-O:O}k=C.value.y;var A=false;switch(k){case 0:t[c+1]=0;break;case 15:if(f<y+1){l=l<<16|a.read(16);f+=16;u-=16}k+=l>>f-y&(1<<y)-1;f-=y;O=this.requantize(k,E);A=true;break;default:if(S&1<<k){O=p[k]}else{S|=1<<k;p[k]=this.requantize(k,E);O=p[k]}A=true}if(A){t[c+1]=l&1<<f-- -1?-O:O}}else{var k=C.value.x;if(k===0){t[c]=0}else{if(S&1<<k)O=p[k];else{S|=1<<k;O=p[k]=this.requantize(k,E)}t[c]=l&1<<f-- -1?-O:O}k=C.value.y;if(k===0){t[c+1]=0}else{if(S&1<<k)O=p[k];else{S|=1<<k;O=p[k]=this.requantize(k,E)}t[c+1]=l&1<<f-- -1?-O:O}}c+=2}if(f+u<0)throw new Error("Huffman data overrun");var g=Bn[n.flags&Jt];var O=this.requantize(1,E);while(f+u>0&&c<=572){if(f<10){l=l<<16|a.read(16);f+=16;u-=16}var _=g[l>>f-4&(1<<4)-1];if(!_.final){f-=4;_=g[_.ptr.offset+(l>>f-_.ptr.bits&(1<<_.ptr.bits)-1)]}f-=_.value.hlen;if(c===d){d+=r[o++];if(E!==s[w]){E=s[w];O=this.requantize(1,E)}++w}t[c]=_.value.v?l&1<<f-- -1?-O:O:0;t[c+1]=_.value.w?l&1<<f-- -1?-O:O:0;c+=2;if(c===d){d+=r[o++];if(E!==s[w]){E=s[w];O=this.requantize(1,E)}++w}t[c]=_.value.x?l&1<<f-- -1?-O:O:0;t[c+1]=_.value.y?l&1<<f-- -1?-O:O:0;c+=2;if(f+u<0){c-=4}}if(-u>M*8){throw new Error("assertion failed: (-bits_left <= BUFFER_GUARD * CHAR_BIT)")}while(c<576){t[c]=0;t[c+1]=0;c+=2}};zn.prototype.requantize=function(e,t){var n=t%4>>0;t=t/4>>0;var r=Math.pow(e,4/3);r*=Math.pow(2,t/4);if(n){r*=Math.pow(2,n/4)}if(t<0){r/=Math.pow(2,-t*(3/4))}return r};zn.prototype.exponents=function(e,t,n){var r=e.global_gain-210;var i=e.flags&Kt?2:1;if(e.block_type===2){var s=0,o=0;if(e.flags&Gt){var u=e.flags&Qt?~0:0;while(o<36){n[s]=r-(e.scalefac[s]+(Wt[s]&u)<<i);o+=t[s++]}}var a=r-8*e.subblock_gain[0];var f=r-8*e.subblock_gain[1];var l=r-8*e.subblock_gain[2];while(o<576){n[s+0]=a-(e.scalefac[s+0]<<i);n[s+1]=f-(e.scalefac[s+1]<<i);n[s+2]=l-(e.scalefac[s+2]<<i);o+=3*t[s];s+=3}}else{if(e.flags&Qt){for(var s=0;s<22;s++){n[s]=r-(e.scalefac[s]+Wt[s]<<i)}}else{for(var s=0;s<22;s++){n[s]=r-(e.scalefac[s]<<i)}}}};zn.prototype.stereo=function(e,t,n,r,i){var s=t[n];var o=this.modes;var u,a,f,l;if(s.ch[0].block_type!==s.ch[1].block_type||(s.ch[0].flags&Gt)!==(s.ch[1].flags&Gt))throw new Error("incompatible stereo block_type");for(var l=0;l<39;l++)o[l]=r.mode_extension;if(r.mode_extension&Yt){var c=s.ch[1];var h=e[1];r.flags|=k.I_STEREO;if(c.block_type===2){var p,d,v,m=new Uint32Array(3),g;p=d=v=m[0]=m[1]=m[2]=0;u=a=0;if(c.flags&Gt){while(a<36){f=i[u++];for(var l=0;l<f;++l){if(h[l]){p=u;break}}h+=f;a+=f}d=u}var g=0;while(a<576){f=i[u++];for(l=0;l<f;++l){if(h[l]){v=m[g]=u;break}}h+=f;a+=f;g=(g+1)%3}if(v)p=d;for(l=0;l<p;++l)o[l]=r.mode_extension&~Yt;g=0;for(l=d;l<v;++l){if(l<m[g])o[l]=r.mode_extension&~Yt;g=(g+1)%3}}else{var m=0;for(u=a=0;a<576;a+=f){f=i[u++];for(l=0;l<f;++l){if(h[l]){m=u;break}}h+=f}for(l=0;l<m;++l)o[l]=r.mode_extension&~Yt}if(r.flags&k.LSF_EXT){var y=t[n+1].ch[1].scalefac;var b=rn[c.scalefac_compress&1];for(u=a=0;a<576;++u,a+=f){f=i[u];if(!(o[u]&Yt))continue;if(y[u]){o[u]&=~Yt;continue}is_pos=c.scalefac[u];for(l=0;l<f;++l){var w=e[0][a+l];if(is_pos===0){e[1][a+l]=w}else{var E=w*b[(is_pos-1)/2];if(is_pos&1){e[0][a+l]=E;e[1][a+l]=w}else{e[1][a+l]=E}}}}}else{for(u=a=0;a<576;++u,a+=f){f=i[u];if(!(o[u]&Yt))continue;is_pos=c.scalefac[u];if(is_pos>=7){o[u]&=~Yt;continue}for(l=0;l<f;++l){var w=e[0][a+l];e[0][a+l]=w*nn[is_pos];e[1][a+l]=w*nn[6-is_pos]}}}}if(r.mode_extension&Zt){r.flags|=k.MS_STEREO;var S=Xt[3+ -2];for(u=a=0;a<576;++u,a+=f){f=i[u];if(o[u]!==Zt)continue;for(l=0;l<f;++l){var x=e[0][a+l];var T=e[1][a+l];e[0][a+l]=(x+T)*S;e[1][a+l]=(x-T)*S}}}};zn.prototype.aliasreduce=function(e,t){for(var n=18;n<t;n+=18){for(var r=0;r<8;++r){var i=e[n-r-1];var s=e[n+r];e[n-r-1]=i*Vt[r]-s*$t[r];e[n+r]=s*Vt[r]+i*$t[r]}}};zn.prototype.imdct_l=function(e,t,n){this.imdct.imdct36(e,t);switch(n){case 0:for(var r=0;r<36;++r)t[r]=t[r]*en[r];break;case 1:for(var r=0;r<18;++r)t[r]=t[r]*en[r];for(var r=24;r<30;++r)t[r]=t[r]*tn[r-18];for(var r=30;r<36;++r)t[r]=0;break;case 3:for(var r=0;r<6;++r)t[r]=0;for(var r=6;r<12;++r)t[r]=t[r]*tn[r-6];for(var r=18;r<36;++r)t[r]=t[r]*en[r];break}};zn.prototype.imdct_s=function(e,t){var n=0;var r;var i=0;var s=new Float64Array(36);var o,u;for(var a=0;a<3;++a){var f=0;for(var l=0;l<3;++l){u=e[i+0]*In[f][0]+e[i+1]*In[f][1]+e[i+2]*In[f][2]+e[i+3]*In[f][3]+e[i+4]*In[f][4]+e[i+5]*In[f][5];s[n+l+0]=u;s[n+5-l]=-s[n+l+0];++f;u=e[i+0]*In[f][0]+e[i+1]*In[f][1]+e[i+2]*In[f][2]+e[i+3]*In[f][3]+e[i+4]*In[f][4]+e[i+5]*In[f][5];s[n+l+6]=u;s[n+11-l]=s[n+l+6];++f}n+=12;i+=6}n=0;var r=0;for(var l=0;l<6;++l){t[l+0]=0;t[l+6]=s[n+0+0]*tn[r+0];u=s[n+0+6]*tn[r+6]+s[n+12+0]*tn[r+0];t[l+12]=u;u=s[n+12+6]*tn[r+6]+s[n+24+0]*tn[r+0];t[l+18]=u;t[l+24]=s[n+24+6]*tn[r+6];t[l+30]=0;++n;++r}};zn.prototype.overlap=function(e,t,n,r){for(var i=0;i<18;++i){n[i][r]=e[i]+t[i];t[i]=e[i+18]}};zn.prototype.freqinver=function(e,t){for(var n=1;n<18;n+=2)e[n][t]=-e[n][t]};zn.prototype.overlap_z=function(e,t,n){for(var r=0;r<18;++r){t[r][n]=e[r];e[r]=0}};zn.prototype.reorder=function(e,t,n){var r=0;var i=this.tmp;var s=new Uint32Array(3);var o=new Uint32Array(3);var u=0;if(t.flags&Gt){var u=2;var a=0;while(a<36)a+=n[r++]}for(var l=0;l<3;++l){s[l]=u;o[l]=0}f=n[r++];l=0;for(var a=18*u;a<576;++a){if(f--===0){f=n[r++]-1;l=(l+1)%3}i[s[l]][l][o[l]++]=e[a];if(o[l]===6){o[l]=0;++s[l]}}var c=this.tmp2;var h=0;for(var p=0;p<32;p++){for(var d=0;d<3;d++){for(var v=0;v<6;v++){c[h++]=i[p][d][v]}}}var m=576-18*u;for(var p=0;p<m;p++){e[18*u+p]=c[u+p]}};var Wn=t.Decoder.extend(function(){t.Decoder.register("mp3",this);this.prototype.init=function(){this.mp3_stream=new T(this.bitstream);this.frame=new P;this.synth=new B;this.seeking=false};this.prototype.readChunk=function(){var e=this.mp3_stream;var n=this.frame;var r=this.synth;if(this.seeking){while(true){try{n.decode(e);break}catch(i){if(i instanceof t.UnderflowError)throw i}}this.seeking=false}else{n.decode(e)}r.frame(n);var s=r.pcm.samples,o=r.pcm.channels,u=r.pcm.length,a=new Float32Array(u*o),f=0;for(var l=0;l<u;l++){for(var c=0;c<o;c++){a[f++]=s[c][l]}}return a};this.prototype.seek=function(e){var t;if(this.demuxer.seekPoints.length>0){e=this._super(e);t=this.stream.offset}else{t=e*this.format.bitrate/8/this.format.sampleRate}this.mp3_stream.reset(t);for(var n=0;n<4096;n++){var r=t+n;for(var i=0;i<3;i++){this.mp3_stream.reset(r);try{var s=D.decode(this.mp3_stream)}catch(o){break}var u=s.framesize();if(u==null)break;r+=u}if(i===3)break}if(i!==3)n=0;this.mp3_stream.reset(t+n);if(this.demuxer.seekPoints.length===0)e=this.stream.offset/(this.format.bitrate/8)*this.format.sampleRate;this.seeking=true;return e}});var Xn=t.Demuxer.extend(function(){t.Demuxer.register(this);this.probe=function(e){return e.peekString(0,4)==="fLaC"};const e=0,n=1,r=2,i=3,s=4,o=5,u=6,a=127,f=34;this.prototype.readChunk=function(){var n=this.stream;if(!this.readHeader&&n.available(4)){if(n.readString(4)!=="fLaC")return this.emit("error","Invalid FLAC file.");this.readHeader=true}while(n.available(1)&&!this.last){if(!this.readBlockHeaders){var r=n.readUInt8();this.last=(r&128)===128,this.type=r&127,this.size=n.readUInt24()}if(!this.foundStreamInfo&&this.type!==e)return this.emit("error","STREAMINFO must be the first block");if(!n.available(this.size))return;switch(this.type){case e:if(this.foundStreamInfo)return this.emit("error","STREAMINFO can only occur once.");if(this.size!==f)return this.emit("error","STREAMINFO size is wrong.");this.foundStreamInfo=true;var o=new t.Bitstream(n);var a={minBlockSize:o.read(16),maxBlockSize:o.read(16),minFrameSize:o.read(24),maxFrameSize:o.read(24)};this.format={formatID:"flac",sampleRate:o.read(20),channelsPerFrame:o.read(3)+1,bitsPerChannel:o.read(5)+1};this.emit("format",this.format);this.emit("cookie",a);var l=o.read(36);this.emit("duration",l/this.format.sampleRate*1e3|0);n.advance(16);this.readBlockHeaders=false;break;case i:for(var c=0;c<this.size/18;c++){if(n.peekUInt32(0)==4294967295&&n.peekUInt32(1)==4294967295){n.advance(18)}else{if(n.readUInt32()>0){this.emit("error","Seek points with sample number >UInt32 not supported")}var h=n.readUInt32();if(n.readUInt32()>0){this.emit("error","Seek points with stream offset >UInt32 not supported")}var p=n.readUInt32();n.advance(2);this.addSeekPoint(p,h)}}break;case s:this.metadata||(this.metadata={});var d=n.readUInt32(true);this.metadata.vendor=n.readString(d);var v=n.readUInt32(true);for(var m=0;m<v;m++){d=n.readUInt32(true);var g=n.readString(d,"utf8"),y=g.indexOf("=");this.metadata[g.slice(0,y).toLowerCase()]=g.slice(y+1)}break;case u:var b=n.readUInt32();if(b!==3){n.advance(this.size-4)}else{var w=n.readUInt32(),E=n.readString(w),S=n.readUInt32(),x=n.readString(S),T=n.readUInt32(),N=n.readUInt32(),C=n.readUInt32(),k=n.readUInt32(),v=n.readUInt32(),L=n.readBuffer(v);this.metadata||(this.metadata={});this.metadata.coverArt=L}break;default:n.advance(this.size);this.readBlockHeaders=false}if(this.last&&this.metadata)this.emit("metadata",this.metadata)}while(n.available(1)&&this.last){var A=n.readSingleBuffer(n.remainingBytes());this.emit("data",A)}}});var Vn=t.Decoder.extend(function(){function c(e){var t=0,n=0;while(true){n=e>>>24;if(n)break;t+=8;n=e>>>16;if(n&255)break;t+=8;n=e>>>8;if(n&255)break;t+=8;n=e;if(n&255)break;t+=8;return t}if(!(n&240))t+=4;else n>>>=4;if(n&8)return t;if(n&4)return t+1;if(n&2)return t+2;if(n&1)return t+3;return t+4}t.Decoder.register("flac",this);this.prototype.setCookie=function(e){this.cookie=e;this.decoded=[];for(var t=0;t<this.format.channelsPerFrame;t++){this.decoded[t]=new Int32Array(e.maxBlockSize)}};const e=new Int16Array([0,192,576<<0,576<<1,576<<2,576<<3,0,0,256<<0,256<<1,256<<2,256<<3,256<<4,256<<5,256<<6,256<<7]);const n=new Int32Array([0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0]);const r=new Int8Array([0,8,12,0,16,20,24,0]);const i=8,s=0,o=8,u=9,a=10;this.prototype.readChunk=function(){var t=this.bitstream;if(!t.available(32))return;if((t.read(15)&32767)!==32764)throw new Error("Invalid sync code");var f=t.read(1),l=t.read(4),c=t.read(4),h=t.read(4),p=t.read(3);t.advance(1);this.chMode=h;var d;if(h<i){d=h+1;this.chMode=s}else if(h<=a){d=2}else{throw new Error("Invalid channel mode")}if(d!==this.format.channelsPerFrame)throw new Error("Switching channel layout mid-stream not supported.");if(p===3||p===7)throw new Error("Invalid sample size code");this.bps=r[p];if(this.bps!==this.format.bitsPerChannel)throw new Error("Switching bits per sample mid-stream not supported.");var v,m;if(this.bps>16){v=32-this.bps;m=true}else{v=16-this.bps;m=false}var g=0;while(t.read(1)===1)g++;var y=t.read(7-g);for(;g>1;g--){t.advance(2);y=y<<6|t.read(6)}if(l===0)throw new Error("Reserved blocksize code");else if(l===6)this.blockSize=t.read(8)+1;else if(l===7)this.blockSize=t.read(16)+1;else this.blockSize=e[l];var b;if(c<12)b=n[c];else if(c===12)b=t.read(8)*1e3;else if(c===13)b=t.read(16);else if(c===14)b=t.read(16)*10;else throw new Error("Invalid sample rate code");t.advance(8);for(var w=0;w<d;w++)this.decodeSubframe(w);t.align();t.advance(16);var E=new ArrayBuffer(this.blockSize*d*this.bps/8),S=m?new Int32Array(E):new Int16Array(E),x=this.blockSize,T=this.decoded,N=0;switch(this.chMode){case s:for(var C=0;C<x;C++){for(var w=0;w<d;w++){S[N++]=T[w][C]<<v}}break;case o:for(var w=0;w<x;w++){var k=T[0][w],L=T[1][w];S[N++]=k<<v;S[N++]=k-L<<v}break;case u:for(var w=0;w<x;w++){var k=T[0][w],L=T[1][w];S[N++]=k+L<<v;S[N++]=L<<v}break;case a:for(var w=0;w<x;w++){var k=T[0][w],L=T[1][w];k-=L>>1;S[N++]=k+L<<v;S[N++]=k<<v}break}return S};this.prototype.decodeSubframe=function(e){var t=0,n=this.bitstream,r=this.blockSize,i=this.decoded;this.curr_bps=this.bps;if(e===0){if(this.chMode===u)this.curr_bps++}else{if(this.chMode===o||this.chMode===a)this.curr_bps++}if(n.read(1))throw new Error("Invalid subframe padding");var s=n.read(6);if(n.read(1)){t=1;while(!n.read(1))t++;this.curr_bps-=t}if(this.curr_bps>32)throw new Error("decorrelated bit depth > 32 ("+this.curr_bps+")");if(s===0){var f=n.read(this.curr_bps,true);for(var l=0;l<r;l++)i[e][l]=f}else if(s===1){var c=this.curr_bps;for(var l=0;l<r;l++)i[e][l]=n.read(c,true)}else if(s>=8&&s<=12){this.decode_subframe_fixed(e,s&~8)}else if(s>=32){this.decode_subframe_lpc(e,(s&~32)+1)}else{throw new Error("Invalid coding type")}if(t){for(var l=0;l<r;l++)i[e][l]<<=t}};this.prototype.decode_subframe_fixed=function(e,t){var n=this.decoded[e],r=this.bitstream,i=this.curr_bps;for(var s=0;s<t;s++)n[s]=r.read(i,true);this.decode_residuals(e,t);var o=0,u=0,a=0,f=0;if(t>0)o=n[t-1];if(t>1)u=o-n[t-2];if(t>2)a=u-n[t-2]+n[t-3];if(t>3)f=a-n[t-2]+2*n[t-3]-n[t-4];switch(t){case 0:break;case 1:case 2:case 3:case 4:var l=new Int32Array([o,u,a,f]),c=this.blockSize;for(var s=t;s<c;s++){l[t-1]+=n[s];for(var h=t-2;h>=0;h--){l[h]+=l[h+1]}n[s]=l[0]}break;default:throw new Error("Invalid Predictor Order "+t)}};this.prototype.decode_subframe_lpc=function(e,t){var n=this.bitstream,r=this.decoded[e],i=this.curr_bps,s=this.blockSize;for(var o=0;o<t;o++){r[o]=n.read(i,true)}var u=n.read(4)+1;if(u===16)throw new Error("Invalid coefficient precision");var a=n.read(5,true);if(a<0)throw new Error("Negative qlevel, maybe buggy stream");var f=new Int32Array(32);for(var o=0;o<t;o++){f[o]=n.read(u,true)}this.decode_residuals(e,t);if(this.bps>16)throw new Error("no 64-bit integers in JS, could probably use doubles though");for(var o=t;o<s-1;o+=2){var l=r[o-t],c=0,h=0,p;for(var d=t-1;d>0;d--){p=f[d];c+=p*l;l=r[o-d];h+=p*l}p=f[0];c+=p*l;l=r[o]+=c>>a;h+=p*l;r[o+1]+=h>>a}if(o<s){var v=0;for(var d=0;d<t;d++)v+=f[d]*r[o-d-1];r[o]+=v>>a}};const f=32767;this.prototype.decode_residuals=function(e,t){var n=this.bitstream,r=n.read(2);if(r>1)throw new Error("Illegal residual coding method "+r);var i=n.read(4),s=this.blockSize>>>i;if(t>s)throw new Error("Invalid predictor order "+t+" > "+s);var o=this.decoded[e],u=t,a=t;for(var l=0;l<1<<i;l++){var c=n.read(r===0?4:5);if(c===(r===0?15:31)){c=n.read(5);for(;a<s;a++)o[u++]=n.read(c,true)}else{for(;a<s;a++)o[u++]=this.golomb(c,f,0)}a=0}};const l=25;this.prototype.golomb=function(e,t,n){var r=this.bitstream,i=r.bitPosition,s=r.peek(32-i)<<i,o=0;var u=31-c(s|1);if(u-e>=32-l&&32-u<t){s>>>=u-e;s+=30-u<<e;r.advance(32+e-u);o=s}else{for(var a=0;r.read(1)===0;a++)s=r.peek(32-i)<<i;if(a<t-1){if(e)s=r.read(e);else s=0;o=s+(a<<e)}else if(a===t-1){s=r.read(n);o=s+1}else{o=-1}}return o>>1^-(o&1)}});return e.AV=t})();
define("listen-aurora.min", function(){});

/*
 * Minimal classList shim for IE 9
 * By Devon Govett
 * MIT LICENSE
 */


if (!("classList" in document.documentElement) && Object.defineProperty && typeof HTMLElement !== 'undefined') {
    Object.defineProperty(HTMLElement.prototype, 'classList', {
        get: function() {
            var self = this;
            function update(fn) {
                return function(value) {
                    var classes = self.className.split(/\s+/),
                        index = classes.indexOf(value);

                    fn(classes, index, value);
                    self.className = classes.join(" ");
                }
            }

            var ret = {                    
                add: update(function(classes, index, value) {
                    ~index || classes.push(value);
                }),

                remove: update(function(classes, index) {
                    ~index && classes.splice(index, 1);
                }),

                toggle: update(function(classes, index, value) {
                    ~index ? classes.splice(index, 1) : classes.push(value);
                }),

                contains: function(value) {
                    return !!~self.className.split(/\s+/).indexOf(value);
                },

                item: function(i) {
                    return self.className.split(/\s+/)[i] || null;
                }
            };
            
            Object.defineProperty(ret, 'length', {
                get: function() {
                    return self.className.split(/\s+/).length;
                }
            });

            return ret;
        }
    });
};
define("listen-classlist", function(){});

UNKNOWN_ART = 'img/avatar.jpeg';

function DGAuroraPlayer(player, DGPlayer) {
    this.player = player;
    this.ui = DGPlayer;
    
    DGPlayer.seekTime = 0;
    DGPlayer.duration = 0;
    DGPlayer.bufferProgress = 0;

    var onplay, onpause, onvolume, onformat, onbuffer, onprogress, onduration, onmetadata;
    
    DGPlayer.on('play', onplay = function() {
        player.play();
        DGPlayer.state = 'playing';
    });
    
    DGPlayer.on('pause', onpause = function() {
        player.pause();
        DGPlayer.state = 'paused';
    });

    DGPlayer.on('volume', onvolume = function(value) {
        player.volume = value;
    });
    
    player.on('buffer', onbuffer = function(percent) {
        DGPlayer.bufferProgress = percent;
    });
    
    player.on('progress', onprogress = function(time) {
        DGPlayer.seekTime = time;
    });
    
    player.on('duration', onduration = function(duration) {
        DGPlayer.duration = duration;
    });
    
    player.on('metadata', onmetadata = function(data) {
        DGPlayer.songTitle = data.title;
        DGPlayer.album = data;
        
        if(DGPlayer.current.picture)
            DGPlayer.coverArt = DGPlayer.current.picture;
        else if (data.coverArt)
            DGPlayer.coverArt = data.coverArt.toBlobURL();
        else 
            DGPlayer.coverArt = UNKNOWN_ART;
        
    });
    
    var originalDescription = DGPlayer.fileDescription;
    player.on('error', onerror = function(e) {
    	console.log(e);

        // reset state
        DGPlayer.state = 'paused';
        DGPlayer.duration = 0;
        DGPlayer.bufferProgress = 0;
        DGPlayer.seekTime = 0;
        DGPlayer.coverArt = UNKNOWN_ART;
        DGPlayer.songTitle = 'Unknown Title';
        DGPlayer.songArtist = 'Unknown Artist';
        
        // DGPlayer.fileDescription = "Hmm. I don't recognize that format. Try another.";
        // setTimeout(function() {
        //     DGPlayer.fileDescription = originalDescription;
        // }, 3000);
    });
    
    player.volume = DGPlayer.volume;
    player.play();
    DGPlayer.state = 'playing';
    
    this.disconnect = function() {
        if (player) player.stop();
        
        DGPlayer.off('play', onplay);
        DGPlayer.off('pause', onpause);
        DGPlayer.off('volume', onvolume);
        player.off('buffer', onbuffer);
        player.off('format', onformat);
        player.off('progress', onprogress);
        player.off('duration', onduration);
        player.off('metadata', onmetadata);
    }
};
define("listen-DGAuroraPlayer", function(){});

function DGPlayer(root) {
    
    // Get elements
    var events = {},
        state = 'paused';
    
    // Preload images
    // new Image().src = "/dgplayer/resources/playbutton_active.png";
    // new Image().src = "/dgplayer/resources/pausebutton.png";
    // new Image().src = "/dgplayer/resources/pausebutton_active.png";
    // new Image().src = "/dgplayer/resources/choosefile_pressed.png";
    
    // Prevent text selection in IE
    root.onselectstart = function() {
        return false
    }
    
    var seekBar = (function() {
        
        var loading = root.querySelector(".seek .track .loaded"),
            progress = root.querySelector(".seek .track .progress"),
            played = root.querySelector(".seek span:first-child"),
            remaining = root.querySelector(".seek span:last-child"),
            maxWidth = loading.parentNode.offsetWidth - 2,
            loaded = 0, currentTime = 0, trackLength = 0, oldSeconds = 0;
            
            
        function pad(input) {
            return ("00" + input).slice(-2);
        }
        
        return {
            getTrackLength: function() {
                return trackLength;
            },

            setTrackLength: function(time) {
                trackLength = time;
                this.seekTime = currentTime;
            },

            getCurrentTime: function() {
                return currentTime;
            },

            setCurrentTime: function(time) {
                oldSeconds = Math.floor(currentTime / 1000 % 60);;
                currentTime = time;
                
                if (currentTime >= trackLength && trackLength > 0) {
                    emit("pause");
                    emit("trackends");
                }

                var t = currentTime / 1000,
                    seconds = Math.floor(t % 60),
                    minutes = Math.floor((t /= 60) % 60);
                    
                if (seconds === oldSeconds)
                    return;
                
                played.innerHTML = minutes + ':' + pad(seconds);
                
                // only show the progress bar and remaining time if we know the duration
                if (trackLength > 0) {
                    var r = (trackLength - currentTime) / 1000,
                        remainingSeconds = Math.floor(r % 60),
                        remainingMinutes = Math.floor((r /= 60) % 60);
                    
                    remaining.innerHTML = '-' + remainingMinutes + ':' + pad(remainingSeconds);
                    position = Math.max(0, Math.min(1, currentTime / trackLength));
                    progress.style.width = maxWidth * position + 'px';
                } else {
                    remaining.innerHTML = '-0:00';
                }
            },
            
            getAmountLoaded: function() {
                return loaded;
            },
            
            setAmountLoaded: function(val) {
                loaded = Math.max(0, Math.min(100, val));
                loading.style.width = maxWidth * (loaded / 100) + 'px';
            }
        }
        
    })();
        
    var playpause = (function() {
        
        var button = root.querySelector(".button"),
            icon = button.querySelector("i"),
            interval = null, playing = false;
            
        button.onclick = function() {
            emit(playing ? "pause" : "play");
        };

        root.addEventListener('keyup', function(e) {
            e.which === 32 && emit(playing ? "pause" : "play");
        });
        
        function setPlaying(play) {
            if (playing = play) {
                icon.classList.remove("entypo-play");
                icon.classList.add("entypo-pause");
            } else {
                icon.classList.remove("entypo-pause");
                icon.classList.add("entypo-play");
            }
        }
        
        return {
            setPlaying: setPlaying,
            getPlaying: function() {
                return playing;
            }
        }
        
    })();
    
    var slider = (function() {
        
       var handle = root.querySelector(".volume .handle"),
        progress = root.querySelector(".volume .progress"),
        track = root.querySelector(".volume .track")
        volumeLeft = root.querySelector(".volume img:last-child"),
        volumeRight = root.querySelector(".volume img:first-child");
            
        var lastX = 0, 
            down = false,
            width = 70,
            handleSize = 20,
            min = 0,
            max = width - handleSize / 2 - 3,
            curX = Math.floor(width / 2 - handleSize / 2),
            value = 50;
            
        function update(dontEmit) {
            if ('webkitTransform' in handle.style)
                handle.style.webkitTransform = "translate3d(" + curX + "px,0, 0)";
            else
                handle.style.left = curX + "px";

           progress.style.width = curX + "px";
           
            value = Math.round( (curX - min) / (max - min) * 100);

            if (!dontEmit)
                emit("volume", value);
        }
        update();
        
        handle.onmousedown = handle.ontouchstart = function(e) {
            lastX = e.targetTouches ? e.targetTouches[0].pageX : e.clientX;
            down = true;
            e.stopPropagation();
            handle.classList.add("active");
            e.preventDefault();
        }
        
        function onMove(e) {
            var eventX = e.targetTouches ? e.targetTouches[0].pageX : e.clientX;
            var x = Math.max(min, Math.min(max, curX + eventX - lastX));

            if (!down || x === curX) return;

            curX = x;
            lastX = eventX;
            update();
        }
        
        function onUp(e) {
            if(!down) return;
            down = false;
            handle.classList.remove("active");
        }
        
        document.addEventListener("mousemove", onMove, false);
        document.addEventListener("touchmove", onMove, false);
        document.addEventListener("mouseup", onUp, false);
        document.addEventListener("touchend", onUp, false);
        
        function animate() {
            handle.classList.add("animatable");
            progress.classList.add("animatable");

            update();

            setTimeout(function() {
                handle.classList.remove("animatable");
                progress.classList.remove("animatable");
            }, 250);
        }
        
        volumeLeft.onclick = function() {
            curX = max;
            animate();
        }

        volumeRight.onclick = function() {
            curX = min;
            animate();
        }
        
        // Handle clicking on the track
        track.onmousedown = track.ontouchstart = function(e) {
            var x = e.targetTouches ? e.targetTouches[0].pageX : e.clientX;
            
            // Get the absolute offsetTop of the track
            var offset = 0, obj = track;
            while (obj) {
                offset += obj.offsetLeft;
                obj = obj.offsetParent;
            }
            curX = Math.max(min, Math.min(max, x - offset - (handleSize + min)));

            handle.onmousedown(e);
            update();
        }
        
        return {
            getValue: function() {
                return value;
            },
            
            setValue: function(val) {
                val = Math.max(0, Math.min(100, val));
                curY = max - (val / 100) * (max - min);
                update(true);
            }
        }
        
    })();
    
    
    function emit(event) {
        if (!events[event]) return;
        
        var args = Array.prototype.slice.call(arguments, 1),
            callbacks = events[event];
            
        for (var i = 0, len = callbacks.length; i < len; i++) {
            callbacks[i].apply(null, args);
        }
    } 
    
    var API = {
        on: function(event, fn) {
            events[event] || (events[event] = []);
            events[event].push(fn);
        },
        
        off: function(event, fn) {
            var eventsOf = events[event],
                index = eventsOf.indexOf(fn);
                
            ~index && eventsOf.splice(index, 1);
        }
    };
    
    // Object.defineProperty shim for Opera
    Object.defineProperty || (Object.defineProperty = function(obj, prop, config) {
        if (config.get && obj.__defineGetter__)
            obj.__defineGetter__(prop, config.get);
            
        if (config.set && obj.__defineSetter__)
            obj.__defineSetter__(prop, config.set);
    })
    
    Object.defineProperty(API, "bufferProgress", {
        get: seekBar.getAmountLoaded,
        set: seekBar.setAmountLoaded
    });
    
    Object.defineProperty(API, "state", {
        set: function(newstate) {
            playpause.setPlaying(newstate == 'playing' || newstate == 'buffering');                
            state = newstate;
        },
        
        get: function() { 
            return state;
        }
    });
    
    Object.defineProperty(API, "duration", {
        get: seekBar.getTrackLength,
        set: seekBar.setTrackLength
    });
    
    Object.defineProperty(API, "seekTime", {
        get: seekBar.getCurrentTime,
        set: seekBar.setCurrentTime
    });
    
    Object.defineProperty(API, "volume", {
        get: slider.getValue,
        set: slider.setValue
    });
    
    var img = root.querySelector(".avatar img");
    Object.defineProperty(API, "coverArt", {
        get: function() {
            return img.src;
        },
        
        set: function(src) {
            img.src = src;
        }
    });
    
    var title = root.querySelector("span.title"),
        artist = root.querySelector("span.artist");
        
    Object.defineProperty(API, "songTitle", {
        get: function() {
            return title.innerHTML;
        },
        
        set: function(val) {
            title.innerHTML = val;
        }
    });
    
    Object.defineProperty(API, "songArtist", {
        get: function() {
            return artist.innerHTML;
        },
        
        set: function(val) {
            artist.innerHTML = val;
        }
    });
    
    /**
     * Playlist
     */
    
    var songs = [] //stores the songs array
      , current //stores the current song
      , track //stores the active track number
      , playlistLoaded = false
      , $playlist = root.querySelector("#playlist")
      //On Song click
      , onSongClick = function(evt) {

            evt.preventDefault();    

            var no = evt.target.parentElement.dataset.no;

            var active = $playlist.querySelector("li.active");

            if(active)
                active.classList.remove("active");

            evt.target.parentElement.classList.add("active");

            API.current = no;

            emit("playlist");

        }
      //Change current active class to current track
      , setActivePlaylist = function() {
            var active = $playlist.querySelector("li.active");

            if(active)
                active.classList.remove("active");

            if(songs.length)
                $playlist.querySelector("li[data-no='"+track+"']").classList.add('active');
        }

    var playlist = function() {
        var prev = root.querySelector(".button-prev")
        , next = root.querySelector(".button-next")
        , showlist = root.querySelector(".button-playlist")
        , playlistTemplate = 
                     "<ol>"
                   + "<% for(var i in songs) {"
                   + "  var song = songs[i];"
                   + "%>"
                   + "<li data-no='<%= i %>'><a href=''><%= song.name %></a></li>"
                   + "<% } %>"
                   + "</ol>"
        ;

        /**
         * loadElements - load playlist items, templating
         */
        var loadElements = function() {

            var listElements = $playlist.querySelectorAll("li");

            for (var i = 0; i < listElements.length; i++)
                listElements[i].onclick = onSongClick;

            playlistLoaded = true;
          
        };

        //Set active on play
        API.on('play', setActivePlaylist);

        //Set next on ends
        API.on('trackends', function() {
            var previous = API.current;

            API.current = track + 1 < songs.length ? track + 1 : track;
            
            if(API.current == previous)
                emit("pause");
            else {
                setActivePlaylist();
                emit("playlist");
            }
        });

        prev.onclick = function(evt) {
            API.current = track - 1 >= 0 ? track - 1 : track;
            setActivePlaylist();
            emit("playlist");
        }

        next.onclick = function(evt) {
            API.current = track + 1 < songs.length ? track + 1 : track;
            setActivePlaylist();
            emit("playlist");
        }

        showlist.onclick = function(evt) {
            this.classList.toggle('active');
            $playlist.classList.toggle('show');
        }

        return {
            getValue: function() {
                return songs;
            },
            setValue: function(datas) {
                var albumEnd = songs.length;
                
                songs = _.union(songs, datas);

                $playlist.innerHTML = _.template(playlistTemplate, {songs : songs});

                loadElements();

                if(albumEnd !== 0 && songs.length > albumEnd) {
                    track = albumEnd;
                    current = songs[track];
                    emit("playlist");
                } else if(albumEnd == songs.length) {
                    //Hmm, playlist is firing twice, can't trace it ...
                } else {
                    track = 0;
                    current = songs[track];
                }
                setActivePlaylist();

            }
        }

    }();

    Object.defineProperty(API, "playlist", {
        get: playlist.getValue,
        set: playlist.setValue
    });

    var playlistAlbum = {artist : null, album : null, picture : null};

    Object.defineProperty(API, "album", {
        get : function() {
            return album;
        },
        set : function(album) {
            album = _.extend(playlistAlbum,album);

            playlistAlbum = album;

            if(album.artist && album.album)
                API.songArtist = album.artist + " - " + album.album;
            else if(album.artist && !album.album)
                API.songArtist = album.artist;
            else
                API.songArtist = album.album;

            if(album.picture)
                API.coverArt = album.picture;

            if(album.songs)
                API.playlist = album.songs;
        }
    });

    Object.defineProperty(API, "current", {
        get: function() {
            return current;
        },
        set: function(no) {
            track = no;
            current = songs[no];
        }
    });


    Object.defineProperty(API, "addSong", {
        get: function() {
            return false;
        },
        set: function(song) {            
            songs.push(song);

            var i = songs.length - 1, songTemplate = "<li data-no='<%= i %>'><a href=''><%= song.name %></a></li>";

            //Dummy element
            var dummy = document.createElement('div');
            dummy.innerHTML = _.template(songTemplate, {i : i, song : song});
            dummy = dummy.firstChild;

            dummy.onclick = onSongClick;

            $playlist.querySelector("ol").appendChild(dummy);

            delete dummy;
        }
    });

    Object.defineProperty(API, "removeSong", {
        get: function() {
            return false;
        },
        set: function(i) {
            if(songs[i]) {

                if(current == songs[i])
                    emit("pause"); //stop

                songs.splice(i, 1);

                var songElement = $playlist.querySelector("li[data-no='"+i+"']");

                songElement.removeEventListener('click', onSongClick);

                $playlist.querySelector("ol").removeChild(songElement);

                //reset data-no
                var elements = $playlist.querySelectorAll("ol > li");

                for(var j in elements)
                    if(elements[j].dataset)
                        elements[j].dataset.no = j;
                
                
            } else
                console.error("Song doesn't exist");
        }
    });
    
    return API;
    
};
define("listen-player", function(){});

define('listen-listen',[
    'jquery', 'desktop'
], function($, Desktop){
    // Chrome doesn't support changing the sample rate, and uses whatever the hardware supports.
    // We cheat here.  Instead of resampling on the fly, we're currently just loading two different
    // files based on common hardware sample rates.
    var _sampleRate = (function() {
        var AudioContext = (window.AudioContext || window.webkitAudioContext);
        if (!AudioContext)
            return 44100;
        
        return new AudioContext().sampleRate;
    }());

    $(window).load(function() {

        DGPlayer = DGPlayer(document.getElementById('dgplayer')); 

        // (function(DGPlayer) {
            

        //     // var add = document.querySelector('.add-song'), remove = document.querySelector('.remove-song');

        //     // add.onclick = function() {
        //     //     DGPlayer.addSong =  {
        //     //         "name":"Jeux de vagues",
        //     //         "url":"medias/BIS1447-002-mp3_320.mp3",
        //     //         "picture" : "medias/debussy.jpg"
        //     //     };
        //     // }

        //     // remove.onclick = function() {
        //     //     DGPlayer.removeSong = 2; //dummy example ofc
        //     // }

        DGPlayer.album = {};
            
        DGPlayer.volume = 100;
        
        var player, onplay;
        
        DGPlayer.on('play', onplay = function(){
            if (player)
                player.disconnect();
                
            player = new DGAuroraPlayer(AV.Player.fromURL(DGPlayer.current.url), DGPlayer);
            DGPlayer.off('play', onplay);
        });


        DGPlayer.on('playlist', onplaylist = function() {
            if(player) {
                player.disconnect();

                DGPlayer.state = 'paused';
            }

            player = new DGAuroraPlayer(AV.Player.fromURL(DGPlayer.current.url), DGPlayer);

        });


        // })(DGPlayer(document.getElementById('dgplayer')));

        $(Desktop.$container).on('click', '.listen', function(event) {
            event.preventDefault();

            var el = $(this).closest(Desktop.itemSelector);

            $.get('/plugins/listen/'+el.attr('data-id'), function(data) {
                DGPlayer.album = data.album;

                if($('#dgplayer').is(':hidden')) 
                    $('#dgplayer').fadeIn().find('.button').click();
            }, 'json');
        });
    });

});
require.config({
  "baseUrl": "/javascripts",
  "paths": {
    "async": "helpers/async",
    "underscore": "helpers/underscore",
    "notify": "modules/desktop-notify",
    "cookie": "modules/jquery.cookie",
    "quickfit": "modules/quickfit",
    "collapse": "modules/jquery.collapse",
    "collapse_storage": "modules/jquery.collapse_storage",
    "customselect": "modules/customselect",
    "text": "text",
    "classie": "packery/classie",
    "eventie": "packery/eventie",
    "doc-ready": "packery/doc-ready",
    "eventEmitter": "packery/eventEmitter",
    "get-style-property": "packery/get-style-property",
    "get-size": "packery/get-size",
    "matches-selector": "packery/matches-selector",
    "outlayer": "packery/outlayer",
    "imagesloaded": "packery/imagesloaded/imagesloaded",
    "packery": "packery/packery/js",
    "desktop": "desktop",
    "api": "api",
    "alertify": "alertify",
    "theme": "../js/theme",
    "admin": "../js/admin",
    "chat-chat": "/Users/soyuka/Sites/ezseed2/app/plugins/chat/public/js/chat",
    "checkforupdates-checkforupdates": "/Users/soyuka/Sites/ezseed2/app/plugins/checkforupdates/public/js/checkforupdates",
    "listen-DGAuroraPlayer": "/Users/soyuka/Sites/ezseed2/app/plugins/listen/public/js/DGAuroraPlayer",
    "listen-classlist": "/Users/soyuka/Sites/ezseed2/app/plugins/listen/public/js/classlist",
    "listen-listen": "/Users/soyuka/Sites/ezseed2/app/plugins/listen/public/js/listen",
    "listen-player": "/Users/soyuka/Sites/ezseed2/app/plugins/listen/public/js/player",
    "listen-aurora.min": "/Users/soyuka/Sites/ezseed2/app/plugins/listen/public/audiocogs/aurora.min"
  },
  "shim": {
    "notify": [
      "jquery"
    ],
    "cookie": [
      "jquery"
    ],
    "quickfit": [
      "jquery"
    ],
    "collapse": [
      "jquery"
    ],
    "collapse_storage": [
      "collapse",
      "jquery"
    ],
    "customselect": [
      "jquery"
    ],
    "theme": {
      "deps": [
        "desktop"
      ]
    },
    "admin": {
      "deps": [
        "collapse",
        "collapse_storage",
        "customselect"
      ]
    }
  },
  "waitSeconds": 25
});
//DO NOT MOVE THIS LINE


require(['desktop', 'imagesloaded', 'theme', 'admin', "chat-chat","checkforupdates-checkforupdates","listen-aurora.min","listen-classlist","listen-DGAuroraPlayer","listen-player","listen-listen"], function(Desktop) {

    var socket = Desktop.socket;

    // socket.on('files', function(d) {
    //     d = JSON.parse(d);
    //     //console.log('Receiving files', d.paths);

    //     if(config.location == '/')
    //         Desktop.append(d.paths);
    // });
    
    socket.on('remove', function(id) {
        Desktop.remove(id);
    });

    //SOME TEST DATAS
    // var datas = JSON.parse(' [{"__v":0,"_id":"5257bdb48019e16201000005","albums":[{"artist":"Current Value","album":"Rare & The Unreleased 1997 - 2000","year":"2012","genre":"Drum n Bass","picture":"images/cover/audio.png","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","_id":"525bcbbc2731536906000004","__v":0,"dateAdded":"2013-10-14T10:47:24.124Z","songs":[{"name":"01. Current Value - Bass Mob.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/01. Current Value - Bass Mob.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":17918201,"_id":"525bcbbc2731536906000013","episode":null},{"name":"02. Current Value - Bass Riot.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/02. Current Value - Bass Riot.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":16506546,"_id":"525bcbbc2731536906000012","episode":null},{"name":"03. Current Value - Endless Rounds.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/03. Current Value - Endless Rounds.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":19592140,"_id":"525bcbbc2731536906000011","episode":null},{"name":"04. Current Value - I.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/04. Current Value - I.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":18218073,"_id":"525bcbbc2731536906000010","episode":null},{"name":"05. Current Value - II.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/05. Current Value - II.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":19529422,"_id":"525bcbbc273153690600000f","episode":null},{"name":"06. Current Value - III.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/06. Current Value - III.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":17835644,"_id":"525bcbbc273153690600000e","episode":null},{"name":"07. Current Value - Intermitter.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/07. Current Value - Intermitter.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":19092673,"_id":"525bcbbc273153690600000d","episode":null},{"name":"08. Current Value - Monolith.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/08. Current Value - Monolith.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":17884765,"_id":"525bcbbc273153690600000c","episode":null},{"name":"09. Current Value - Sub Low Reference.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/09. Current Value - Sub Low Reference.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":18021664,"_id":"525bcbbc273153690600000b","episode":null},{"name":"10. Current Value - Tekkno Session.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/10. Current Value - Tekkno Session.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":19364353,"_id":"525bcbbc273153690600000a","episode":null},{"name":"11. Current Value - Termination.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/11. Current Value - Termination.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":17010192,"_id":"525bcbbc2731536906000009","episode":null},{"name":"12. Current Value - Untitled 1.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/12. Current Value - Untitled 1.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":16877488,"_id":"525bcbbc2731536906000008","episode":null},{"name":"13. Current Value - Untitled 2.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/13. Current Value - Untitled 2.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":16334141,"_id":"525bcbbc2731536906000007","episode":null},{"name":"14. Current Value - Untitled Master.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/14. Current Value - Untitled Master.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":18846086,"_id":"525bcbbc2731536906000006","episode":null},{"name":"15. Current Value - VI.mp3","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR/15. Current Value - VI.mp3","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/[PC085] Current Value - Rare & The Unreleased 1997 - 2000 WEB-320-CBR","type":"audio","size":16977782,"_id":"525bcbbc2731536906000005","episode":null}]}],"dateUpdated":"2013-10-14T12:33:48.846Z","movies":[{"movieType":"movie","name":"Sound Of Noise","title":"Sound Of Noise","synopsis":"L’officier de police Amadeus Warnebring est né dans une illustre famille de musiciens. Ironie du sort, il déteste la musique.<br/>Sa vie bascule le jour où un groupe de musiciens déjantés décide d’exécuter une œuvre musicale apocalyptique en utilisant la ville comme instrument de musique…<br/>Il s’engage alors dans sa  première enquête policière musicale...","trailer":"http://www.allocine.fr/blogvision/19113214","picture":"http://images.allocine.fr/medias/nmedia/18/69/23/18/19589366.jpg","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","_id":"525be4ac2520d8cc06000004","__v":0,"dateAdded":"2013-10-14T12:33:48.836Z","videos":[{"name":"Sound Of Noise","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Sound.Of.Noise.2010.VOSTFR.DVDRiP.XViD-STVFRVTW777.avi","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","type":"video","size":736797838,"_id":"525be4ac2520d8cc06000005","episode":null}]},{"movieType":"tvseries","name":"Person Of Interest","season":"03","title":"Person of Interest","synopsis":"Un agent paramilitaire de la CIA, présumé mort, est recruté par un millionnaire reclu pour travailler sur un projet top-secret : prévenir le crime avant qu\'il ne se produise ! Un ingénieux programme élaboré par Finch identifie chaque jour des personnes qui vont être impliquées dans un crime. Victime ou coupable ? Reese va devoir mener l\'enquête pour découvrir qui est en danger et empêcher qu\'un nouveau meurtre soit commis...","trailer":"http://www.allocine.fr/blogvision/19325944","picture":"http://images.allocine.fr/medias/nmedia/18/84/44/70/19775786.jpg","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E01.PROPER.VOSTFR.720p.HDTV.x264-ATeam","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E01.PROPER.VOSTFR.720p.HDTV.x264-ATeam","_id":"525be4ac2520d8cc06000006","__v":0,"dateAdded":"2013-10-14T12:33:48.838Z","videos":[{"name":"Person Of Interest","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E01.PROPER.VOSTFR.720p.HDTV.x264-ATeam/Person.Of.Interest.S03E01.PROPER.VOSTFR.720p.HDTV.x264-ATeam.mkv","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E01.PROPER.VOSTFR.720p.HDTV.x264-ATeam","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E01.PROPER.VOSTFR.720p.HDTV.x264-ATeam","type":"video","size":993730388,"_id":"525be4ac2520d8cc06000009","episode":"01"},{"name":"Person Of Interest","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E02.PROPER.VOSTFR.720p.HDTV.x264-ATeam/Person.Of.Interest.S03E02.PROPER.VOSTFR.720p.HDTV.x264-ATeam.mkv","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E02.PROPER.VOSTFR.720p.HDTV.x264-ATeam","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.Of.Interest.S03E02.PROPER.VOSTFR.720p.HDTV.x264-ATeam","type":"video","size":1043404384,"_id":"525be4ac2520d8cc06000008","episode":"02"},{"name":"Person of Interest","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.of.Interest.S03E03.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON/Person.of.Interest.S03E03.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON.mkv","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.of.Interest.S03E03.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/Person.of.Interest.S03E03.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON","type":"video","size":991023158,"_id":"525be4ac2520d8cc06000007","episode":"03"}]},{"movieType":"tvseries","name":"The Simpsons","season":"25","title":"Les Simpson","synopsis":"Les Simpson, famille américaine moyenne, vivent à Springfield. Homer, le père, a deux passions : regarder la télé et boire des bières. Mais son quotidien est rarement reposant, entre son fils Bart qui fait toutes les bêtises possibles, sa fille Lisa qui est une surdouée, ou encore sa femme Marge qui ne supporte pas de le voir se soûler à longueur de journée.","trailer":"http://www.allocine.fr/blogvision/19383605","picture":"http://images.allocine.fr/medias/nmedia/18/79/96/51/19694367.jpg","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/The.Simpsons.S25E01.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/The.Simpsons.S25E01.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON","_id":"525be4ac2520d8cc0600000a","__v":0,"dateAdded":"2013-10-14T12:33:48.838Z","videos":[{"name":"The Simpsons","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/The.Simpsons.S25E01.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON/The.Simpsons.S25E01.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON.mkv","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/The.Simpsons.S25E01.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/The.Simpsons.S25E01.FASTSUB.VOSTFR.720p.HDTV.x264-ADDiCTiON","type":"video","size":390259712,"_id":"525be4ac2520d8cc0600000b","episode":"01"}]}],"others":[{"name":"InstallESD.dmg","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","_id":"525bcd5df963937d06000004","__v":0,"files":[{"name":"InstallESD.dmg","path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka/InstallESD.dmg","prevDir":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","prevDirRelative":"/Users/soyuka/Sites/ezseed2/downloads/soyuka","type":"application","size":4450989350,"_id":"525bcd5df963937d06000005","episode":null}],"dateAdded":"2013-10-14T10:54:21.925Z"}],"path":"/Users/soyuka/Sites/ezseed2/downloads/soyuka"}]')

});








        
define("main.build", function(){});
