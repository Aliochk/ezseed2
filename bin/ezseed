#!/usr/bin/env node

/**
 * Module dependencies.
 */
var pathInfo = require('path')
	, jf = require('jsonfile')
	, fs = require('fs')
  	, app_path = pathInfo.resolve(__dirname, '..');


global.app_path = app_path;

if(!fs.readFileSync(app_path + '/app/config.json'))
	global.config = jf.readFileSync(app_path + '/app/config.json');

//Writing conf file
if(global.config.root.length == 0) {
  global.config.root = app_path + '/app';
}

var program = require('commander')
  , colors = require('colors')
  , mongoose = require('mongoose')
  ;

colors.setTheme({
  silly: 'rainbow',
  input: 'grey',
  verbose: 'cyan',
  prompt: 'grey',
  info: 'cyan',
  data: 'grey',
  help: 'cyan',
  warn: 'yellow',
  debug: 'blue',
  error: 'red'
});

program
	.version('2.0.0');


program.on('--help', function(){

	var ASCII = new Buffer("\
		   ___  ___  ___  ___  ___  ___     _  _  ___    \n\
		  (  _)(_  )/ __)(  _)(  _)(   \\   ( )( )(__ \\   \n\
		   ) _) / / \\__ \\ ) _) ) _) ) ) )   \\\\// / __/   \n\
		  (___)(___)(___/(___)(___)(___/    (__) \\___)   \n\
		  									   \n\
	").toString();

	console.log(ASCII.yellow.bold);
	console.log("Made with love by ".magenta + "soyuka".bold.magenta);
	console.log("Big Thanks too : ".magenta + "Gaaa".rainbow +" (rutorrent), ".magenta +"Lines".rainbow +" (design), ".magenta +"Jay_kay".rainbow +" (ideas), ".magenta + "LeBedouin".rainbow +" ($$), ".magenta + "Winux".rainbow +", ".magenta + "H4T".rainbow +", ".magenta + "Ulule participants".rainbow +", ".magenta + "wouya (<3)".rainbow +" !".magenta)

	console.log(" ");
});

require('./command/install')(program);

require('./command/useradd')(program);
require('./command/update')(program);
require('./command/userdel')(program);
require('./command/passwd')(program);

//Specials daemons (1 per user or all users)
require('./client/rutorrent/daemon')(program);
require('./client/transmission/daemon')(program);

require('./command/reboot')(program);

program
	.command('deploy')
	.action(require('./lib/deploy'));

mongoose.connect('mongodb://localhost/ezseed');

var mongo = mongoose.connection;

mongo.on('error', console.error.bind(console, 'connection error:'.error));
mongo.once('open', function callback () {
	program.parse(process.argv);
	if (!program.args.length) program.help();
});

